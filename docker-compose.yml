version: "3.8"
services:
  # Spark goes here
  spark-master:
    image: bitnami/spark:3.2.1
    user: root
    container_name: spark-master
    restart: always
    networks:
      cluster-network:
        ipv4_address: 172.18.0.15
    ports:
      - "7077:7077"
    hostname: spark-master
    environment:
      - SPARK_MODE=master
      - SPARK_RPC_AUTHENTICATION_ENABLED=no
      - SPARK_RPC_ENCRYPTION_ENABLED=no
      - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
      - SPARK_SSL_ENABLED=no
    volumes:
        - spark-jobs:/spark-jobs:rw
        - spark-events:/tmp/spark-events

  spark-worker-01:
    image: bitnami/spark:3.2.1
    container_name: spark-worker-01
    restart: always
    networks:
      cluster-network:
        ipv4_address: 172.18.0.16
    hostname: spark-worker-01
    environment:
      - SPARK_MODE=worker
      - SPARK_MASTER_URL=spark://spark-master:7077
      - SPARK_WORKER_MEMORY=2G
      - SPARK_WORKER_CORES=2
      - SPARK_RPC_AUTHENTICATION_ENABLED=no
      - SPARK_RPC_ENCRYPTION_ENABLED=no
      - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
      - SPARK_SSL_ENABLED=no
    depends_on:
      - spark-master
     volumes:
          - spark-jobs:/spark-jobs:rw

  spark-worker-02:
    image: bitnami/spark:3.2.1
    container_name: spark-worker-02
    restart: always
    networks:
      cluster-network:
        ipv4_address: 172.18.0.17
    hostname: spark-worker-02
    environment:
      - SPARK_MODE=worker
      - SPARK_MASTER_URL=spark://spark-master:7077
      - SPARK_WORKER_MEMORY=2G
      - SPARK_WORKER_CORES=2
      - SPARK_RPC_AUTHENTICATION_ENABLED=no
      - SPARK_RPC_ENCRYPTION_ENABLED=no
      - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
      - SPARK_SSL_ENABLED=no
    depends_on:
      - spark-master
    volumes:
        - spark-jobs:/spark-jobs:rw

  spark-worker-03:
    image: bitnami/spark:3.2.1
    container_name: spark-worker-03
    restart: always
    networks:
      cluster-network:
        ipv4_address: 172.18.0.18
    hostname: spark-worker-03
    environment:
      - SPARK_MODE=worker
      - SPARK_MASTER_URL=spark://spark-master:7077
      - SPARK_WORKER_MEMORY=2G
      - SPARK_WORKER_CORES=2
      - SPARK_RPC_AUTHENTICATION_ENABLED=no
      - SPARK_RPC_ENCRYPTION_ENABLED=no
      - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
      - SPARK_SSL_ENABLED=no
    depends_on:
      - spark-master
    volumes:
        - spark-jobs:/spark-jobs:rw

networks:
  cluster-network:
    name: cluster-network
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.18.0.0/16
          gateway: 172.18.0.1
          
