/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[1,4],Array(78).concat([function(e,t,a){"use strict";a.r(t),a.d(t,"visualizationTypes",(function(){return d}));var n=a(0),i=a(21),l=a.n(i),s=(a(6),a(2)),r=a(87),o=a(88);const u=n.i18n.translate("xpack.lens.xyVisualization.barGroupLabel",{defaultMessage:"Bar"}),c=n.i18n.translate("xpack.lens.xyVisualization.lineGroupLabel",{defaultMessage:"Line and area"}),d=[{id:"bar",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M5 7a1 1 0 011 1v13a1 1 0 01-1 1H1a1 1 0 01-1-1V8a1 1 0 011-1h4zm16-7a1 1 0 011 1v20a1 1 0 01-1 1h-4a1 1 0 01-1-1V1a1 1 0 011-1h4z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M13 11a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4zm16-7a1 1 0 011 1v16a1 1 0 01-1 1h-4a1 1 0 01-1-1V5a1 1 0 011-1h4z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.barLabel",{defaultMessage:"Bar vertical"}),groupLabel:u,sortPriority:4},{id:"bar_horizontal",icon:o.a,label:n.i18n.translate("xpack.lens.xyVisualization.barHorizontalLabel",{defaultMessage:"H. Bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.barHorizontalFullLabel",{defaultMessage:"Bar horizontal"}),groupLabel:u},{id:"bar_stacked",icon:r.a,label:n.i18n.translate("xpack.lens.xyVisualization.stackedBarLabel",{defaultMessage:"Bar vertical stacked"}),groupLabel:u},{id:"bar_percentage_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M6 13v8a1 1 0 01-1 1H1a1 1 0 01-1-1v-8h6zm8-4v12a1 1 0 01-1 1H9a1 1 0 01-1-1V9h6zm8 4v8a1 1 0 01-1 1h-4a1 1 0 01-1-1v-8h6zm8 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7h6z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 0a1 1 0 011 1v11h-6V1a1 1 0 011-1h4zM5 0a1 1 0 011 1v10H0V1a1 1 0 011-1h4zm16 0a1 1 0 011 1v10h-6V1a1 1 0 011-1h4zm-8 0a1 1 0 011 1v6H8V1a1 1 0 011-1h4z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarLabel",{defaultMessage:"Bar vertical percentage"}),groupLabel:u},{id:"bar_horizontal_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M18 16v6H1a1 1 0 01-1-1v-4a1 1 0 011-1h17zm-3-8v6H1.222C.547 14 0 13.552 0 13V9c0-.552.547-1 1.222-1H15zm1-8v6H1.042C.466 6 0 5.552 0 5V1c0-.552.466-1 1.042-1H16z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1h-9v-6h9zm-9.222-8C20.453 8 21 8.448 21 9v4c0 .552-.547 1-1.222 1H17V8h2.778zm3.18-8C23.534 0 24 .448 24 1v4c0 .552-.466 1-1.042 1H18V0h4.958z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalLabel",{defaultMessage:"H. Stacked bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalFullLabel",{defaultMessage:"Bar horizontal stacked"}),groupLabel:u},{id:"bar_horizontal_percentage_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M20 16v6H1a1 1 0 01-1-1v-4a1 1 0 011-1h19zm-3-8v6H1.222C.547 14 0 13.552 0 13V9c0-.552.547-1 1.222-1H17zm1-8v6H1.042C.466 6 0 5.552 0 5V1c0-.552.466-1 1.042-1H18z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1h-7v-6h7zm-.222-8C29.453 8 30 8.448 30 9v4c0 .552-.547 1-1.222 1H19V8h9.778zm.18-8C29.534 0 30 .448 30 1v4c0 .552-.466 1-1.042 1H20V0h8.958z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalLabel",{defaultMessage:"H. Percentage bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalFullLabel",{defaultMessage:"Bar horizontal percentage"}),groupLabel:u},{id:"area",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M30 6v15a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-6.994 5.865-6.997C20.5 11 23 11 24 11s3-5 6-5z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M6 1c3 0 5 6 6 6s3.5-3 6-3c1.667 0 2.944 2.333 3.833 6.999l.309.001c-1.013 0-2.27 0-3.593.002h-.684C15.231 11.007 13 18 12 18s-3.5-3-6-3-5 4-6 4V7c1-1.5 3-6 6-6z",className:"lensChartIcon__subdued"})),label:n.i18n.translate("xpack.lens.xyVisualization.areaLabel",{defaultMessage:"Area"}),groupLabel:c},{id:"area_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:31,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M0 15.213l.484.091.813.146.762.129C3.779 15.859 5.09 16 6 16c.986 0 1.712-.25 3.166-.966l.281-.14C10.802 14.217 11.381 14 12 14c.507 0 .988.146 1.89.571l1.209.592c1.28.617 1.977.837 2.901.837 1.028 0 1.75-.349 3.119-1.344l.89-.659C23.034 13.252 23.535 13 24 13c.581 0 1.232.185 2.598.718l1.1.436.568.217c.72.27 1.256.438 1.736.532L30 21a1 1 0 01-1 1H1a1 1 0 01-1-1v-5.787z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M24 1c1.334 0 3.334 1 6 3v8.842l-.324-.098c-.346-.11-.759-.262-1.273-.462l-1.101-.436-.568-.217-.536-.193C25.277 11.118 24.676 11 24 11c-1.028 0-1.75.349-3.119 1.344l-.89.659c-1.024.745-1.524.997-1.99.997-.508 0-.989-.146-1.89-.571l-1.21-.592c-1.28-.617-1.977-.837-2.9-.837-.987 0-1.713.25-3.167.966l-.281.14C7.198 13.783 6.619 14 6 14l-.334-.007c-1.182-.045-3.08-.317-5.665-.815V9c2 0 4.666 1 6 1 2 0 4-4 6-4s4 1 6 1 4-6 6-6z",className:"lensChartIcon__subdued"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedAreaLabel",{defaultMessage:"Area stacked"}),groupLabel:c},{id:"area_percentage_stacked",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M0 13v8a1 1 0 001 1h28a1 1 0 001-1V9.25c-1.251-.929-2.45-1.734-3.493-2.313a11.028 11.028 0 00-1.478-.703C24.592 6.072 24.25 6 24 6c-.262 0-.63.212-1.126.77-.472.53-.952 1.249-1.458 2.007l-.013.02c-.49.736-1.006 1.51-1.53 2.098C19.37 11.462 18.739 12 18 12c-1.062 0-2.112-.263-3.092-.508l-.03-.007C13.869 11.232 12.929 11 12 11c-.337 0-.729.171-1.2.525-.466.35-.94.822-1.446 1.329l-.015.015c-.49.489-1.01 1.01-1.539 1.406-.529.396-1.137.725-1.8.725-.657 0-1.57-.212-2.48-.424l-.058-.014C2.275 14.287 1.032 14 0 14v-1z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M29 0a1 1 0 011 1v6.012c-1.06-.764-2.085-1.437-3.007-1.95a11.93 11.93 0 00-1.616-.765C24.887 4.115 24.418 4 24 4c-.738 0-1.369.538-1.874 1.105-.523.589-1.039 1.362-1.529 2.098l-.013.02c-.506.758-.985 1.476-1.458 2.007-.495.558-.864.77-1.126.77-.928 0-1.867-.232-2.879-.485l-.029-.007C14.112 9.263 13.062 9 12 9c-.663 0-1.271.328-1.8.725-.528.396-1.05.917-1.538 1.406l-.015.015c-.507.507-.98.98-1.447 1.329-.471.354-.863.525-1.2.525-.528 0-1.328-.183-2.311-.412l-.034-.007C2.507 12.314 1.159 12 .001 12V1a1 1 0 011-1h28z",className:"lensChartIcon__subdued"})),label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageAreaLabel",{defaultMessage:"Area percentage"}),groupLabel:c},{id:"line",icon:({title:e,titleId:t,...a})=>Object(s.jsx)("svg",l()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M23.434 16.456c.211.553.406.982.58 1.277l.073.119c.038.058.072.105.101.141.52-.04 1.07-.248 2.13-.77l.235-.117C28.198 16.283 28.953 16 30 16v2c-.507 0-.988.146-1.89.571l-1.209.592C25.621 19.78 24.924 20 24 20l-.174-.005c-1.251-.076-1.805-1.036-2.994-4.993L22.93 15c.18.563.335 1.012.505 1.455zM6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.377 0 1.925.863 3.168 4.999L19.07 9a26.766 26.766 0 00-.505-1.457c-.24-.631-.46-1.1-.652-1.395l-.051-.074-.045-.06c-.452.064-.988.375-2.007 1.13l-.691.512-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M0 21c1.123 0 1.852-.477 3.295-1.885l.758-.75.345-.33C5.208 17.275 5.648 17 6 17c.466 0 .967.252 1.99.997l.891.659.458.325C10.424 19.728 11.093 20 12 20c1.325 0 1.996-.772 3.546-3.444l.593-1.028.385-.646C17.328 13.562 17.796 13 18 13h6c1.333 0 1.978-.795 3.452-3.676l.692-1.37.358-.69C29.333 5.7 29.831 5 30 5V3c-1.333 0-1.978.795-3.452 3.676l-.692 1.37-.358.69C24.667 10.3 24.169 11 24 11h-6c-1.325 0-1.996.772-3.546 3.444l-.593 1.028-.385.646C12.672 17.438 12.204 18 12 18c-.466 0-.967-.252-1.99-.997l-.891-.659-.458-.325C7.576 15.272 6.907 15 6 15c-1.123 0-1.852.477-3.295 1.885l-.758.75-.345.33C.792 18.725.352 19 0 19v2z",className:"lensChartIcon__accent"})),label:n.i18n.translate("xpack.lens.xyVisualization.lineLabel",{defaultMessage:"Line"}),groupLabel:c,sortPriority:2}]},,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(21),i=a.n(n),l=(a(6),a(2));const s=({title:e,titleId:t,...a})=>Object(l.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{className:"lensChartIcon__subdued",d:"M6 13v8a1 1 0 01-1 1H1a1 1 0 01-1-1v-8h6zm8-4v12a1 1 0 01-1 1H9a1 1 0 01-1-1V9h6zm8 4v8a1 1 0 01-1 1h-4a1 1 0 01-1-1v-8h6zm8 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7h6z"}),Object(l.jsx)("path",{d:"M29 1a1 1 0 011 1v10h-6V2a1 1 0 011-1h4zM5 7a1 1 0 011 1v3H0V8a1 1 0 011-1h4zm16-4a1 1 0 011 1v7h-6V4a1 1 0 011-1h4zm-8-3a1 1 0 011 1v6H8V1a1 1 0 011-1h4z",className:"lensChartIcon__accent"}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(21),i=a.n(n),l=(a(6),a(2));const s=({title:e,titleId:t,...a})=>Object(l.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1v-4a1 1 0 011-1h28zM22 0a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h21z",className:"lensChartIcon__subdued"}),Object(l.jsx)("path",{d:"M0 9a1 1 0 011-1h15a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V9z",className:"lensChartIcon__accent"}))},function(e,t,a){"use strict";let n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.KBN_FIELD_TYPES=t.ES_FIELD_TYPES=void 0,t.ES_FIELD_TYPES=n,function(e){e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram"}(n||(t.ES_FIELD_TYPES=n={})),t.KBN_FIELD_TYPES=i,function(e){e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing"}(i||(t.KBN_FIELD_TYPES=i={}))},,,,,,,,,,,function(e,t){e.exports={pow:function(e,t){if(null==t)throw new Error("Missing exponent");return Array.isArray(e)?e.map((e=>Math.pow(e,t))):Math.pow(e,t)}}},,function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n={number:{decimalsToPattern:(e=2)=>0===e?"0,0":`0,0.${"0".repeat(e)}`},percent:{decimalsToPattern:(e=2)=>0===e?"0,0%":`0,0.${"0".repeat(e)}%`},bytes:{decimalsToPattern:(e=2)=>0===e?"0,0b":`0,0.${"0".repeat(e)}b`}}},,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(317);case"v8light":return a(319)}},,,,,,,,,,,,,,function(e,t,a){var n=a(237),i={};for(var l in n)n.hasOwnProperty(l)&&(i[n[l]]=l);var s=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var r in s)if(s.hasOwnProperty(r)){if(!("channels"in s[r]))throw new Error("missing channels property: "+r);if(!("labels"in s[r]))throw new Error("missing channel labels property: "+r);if(s[r].labels.length!==s[r].channels)throw new Error("channel and label counts mismatch: "+r);var o=s[r].channels,u=s[r].labels;delete s[r].channels,delete s[r].labels,Object.defineProperty(s[r],"channels",{value:o}),Object.defineProperty(s[r],"labels",{value:u})}s.rgb.hsl=function(e){var t,a,n=e[0]/255,i=e[1]/255,l=e[2]/255,s=Math.min(n,i,l),r=Math.max(n,i,l),o=r-s;return r===s?t=0:n===r?t=(i-l)/o:i===r?t=2+(l-n)/o:l===r&&(t=4+(n-i)/o),(t=Math.min(60*t,360))<0&&(t+=360),a=(s+r)/2,[t,100*(r===s?0:a<=.5?o/(r+s):o/(2-r-s)),100*a]},s.rgb.hsv=function(e){var t,a,n,i,l,s=e[0]/255,r=e[1]/255,o=e[2]/255,u=Math.max(s,r,o),c=u-Math.min(s,r,o),d=function(e){return(u-e)/6/c+.5};return 0===c?i=l=0:(l=c/u,t=d(s),a=d(r),n=d(o),s===u?i=n-a:r===u?i=1/3+t-n:o===u&&(i=2/3+a-t),i<0?i+=1:i>1&&(i-=1)),[360*i,100*l,100*u]},s.rgb.hwb=function(e){var t=e[0],a=e[1],n=e[2];return[s.rgb.hsl(e)[0],1/255*Math.min(t,Math.min(a,n))*100,100*(n=1-1/255*Math.max(t,Math.max(a,n)))]},s.rgb.cmyk=function(e){var t,a=e[0]/255,n=e[1]/255,i=e[2]/255;return[100*((1-a-(t=Math.min(1-a,1-n,1-i)))/(1-t)||0),100*((1-n-t)/(1-t)||0),100*((1-i-t)/(1-t)||0),100*t]},s.rgb.keyword=function(e){var t=i[e];if(t)return t;var a,l,s,r=1/0;for(var o in n)if(n.hasOwnProperty(o)){var u=(l=e,s=n[o],Math.pow(l[0]-s[0],2)+Math.pow(l[1]-s[1],2)+Math.pow(l[2]-s[2],2));u<r&&(r=u,a=o)}return a},s.keyword.rgb=function(e){return n[e]},s.rgb.xyz=function(e){var t=e[0]/255,a=e[1]/255,n=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92)+.1805*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)),100*(.2126*t+.7152*a+.0722*n),100*(.0193*t+.1192*a+.9505*n)]},s.rgb.lab=function(e){var t=s.rgb.xyz(e),a=t[0],n=t[1],i=t[2];return n/=100,i/=108.883,a=(a/=95.047)>.008856?Math.pow(a,1/3):7.787*a+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(a-n),200*(n-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},s.hsl.rgb=function(e){var t,a,n,i,l,s=e[0]/360,r=e[1]/100,o=e[2]/100;if(0===r)return[l=255*o,l,l];t=2*o-(a=o<.5?o*(1+r):o+r-o*r),i=[0,0,0];for(var u=0;u<3;u++)(n=s+1/3*-(u-1))<0&&n++,n>1&&n--,l=6*n<1?t+6*(a-t)*n:2*n<1?a:3*n<2?t+(a-t)*(2/3-n)*6:t,i[u]=255*l;return i},s.hsl.hsv=function(e){var t=e[0],a=e[1]/100,n=e[2]/100,i=a,l=Math.max(n,.01);return a*=(n*=2)<=1?n:2-n,i*=l<=1?l:2-l,[t,100*(0===n?2*i/(l+i):2*a/(n+a)),(n+a)/2*100]},s.hsv.rgb=function(e){var t=e[0]/60,a=e[1]/100,n=e[2]/100,i=Math.floor(t)%6,l=t-Math.floor(t),s=255*n*(1-a),r=255*n*(1-a*l),o=255*n*(1-a*(1-l));switch(n*=255,i){case 0:return[n,o,s];case 1:return[r,n,s];case 2:return[s,n,o];case 3:return[s,r,n];case 4:return[o,s,n];case 5:return[n,s,r]}},s.hsv.hsl=function(e){var t,a,n,i=e[0],l=e[1]/100,s=e[2]/100,r=Math.max(s,.01);return n=(2-l)*s,a=l*r,[i,100*(a=(a/=(t=(2-l)*r)<=1?t:2-t)||0),100*(n/=2)]},s.hwb.rgb=function(e){var t,a,n,i,l,s,r,o=e[0]/360,u=e[1]/100,c=e[2]/100,d=u+c;switch(d>1&&(u/=d,c/=d),n=6*o-(t=Math.floor(6*o)),0!=(1&t)&&(n=1-n),i=u+n*((a=1-c)-u),t){default:case 6:case 0:l=a,s=i,r=u;break;case 1:l=i,s=a,r=u;break;case 2:l=u,s=a,r=i;break;case 3:l=u,s=i,r=a;break;case 4:l=i,s=u,r=a;break;case 5:l=a,s=u,r=i}return[255*l,255*s,255*r]},s.cmyk.rgb=function(e){var t=e[0]/100,a=e[1]/100,n=e[2]/100,i=e[3]/100;return[255*(1-Math.min(1,t*(1-i)+i)),255*(1-Math.min(1,a*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i))]},s.xyz.rgb=function(e){var t,a,n,i=e[0]/100,l=e[1]/100,s=e[2]/100;return a=-.9689*i+1.8758*l+.0415*s,n=.0557*i+-.204*l+1.057*s,t=(t=3.2406*i+-1.5372*l+-.4986*s)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,[255*(t=Math.min(Math.max(0,t),1)),255*(a=Math.min(Math.max(0,a),1)),255*(n=Math.min(Math.max(0,n),1))]},s.xyz.lab=function(e){var t=e[0],a=e[1],n=e[2];return a/=100,n/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116)-16,500*(t-a),200*(a-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},s.lab.xyz=function(e){var t,a,n,i=e[0];t=e[1]/500+(a=(i+16)/116),n=a-e[2]/200;var l=Math.pow(a,3),s=Math.pow(t,3),r=Math.pow(n,3);return a=l>.008856?l:(a-16/116)/7.787,t=s>.008856?s:(t-16/116)/7.787,n=r>.008856?r:(n-16/116)/7.787,[t*=95.047,a*=100,n*=108.883]},s.lab.lch=function(e){var t,a=e[0],n=e[1],i=e[2];return(t=360*Math.atan2(i,n)/2/Math.PI)<0&&(t+=360),[a,Math.sqrt(n*n+i*i),t]},s.lch.lab=function(e){var t,a=e[0],n=e[1];return t=e[2]/360*2*Math.PI,[a,n*Math.cos(t),n*Math.sin(t)]},s.rgb.ansi16=function(e){var t=e[0],a=e[1],n=e[2],i=1 in arguments?arguments[1]:s.rgb.hsv(e)[2];if(0===(i=Math.round(i/50)))return 30;var l=30+(Math.round(n/255)<<2|Math.round(a/255)<<1|Math.round(t/255));return 2===i&&(l+=60),l},s.hsv.ansi16=function(e){return s.rgb.ansi16(s.hsv.rgb(e),e[2])},s.rgb.ansi256=function(e){var t=e[0],a=e[1],n=e[2];return t===a&&a===n?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(a/255*5)+Math.round(n/255*5)},s.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var a=.5*(1+~~(e>50));return[(1&t)*a*255,(t>>1&1)*a*255,(t>>2&1)*a*255]},s.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var a;return e-=16,[Math.floor(e/36)/5*255,Math.floor((a=e%36)/6)/5*255,a%6/5*255]},s.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},s.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var a=t[0];3===t[0].length&&(a=a.split("").map((function(e){return e+e})).join(""));var n=parseInt(a,16);return[n>>16&255,n>>8&255,255&n]},s.rgb.hcg=function(e){var t,a=e[0]/255,n=e[1]/255,i=e[2]/255,l=Math.max(Math.max(a,n),i),s=Math.min(Math.min(a,n),i),r=l-s;return t=r<=0?0:l===a?(n-i)/r%6:l===n?2+(i-a)/r:4+(a-n)/r+4,t/=6,[360*(t%=1),100*r,100*(r<1?s/(1-r):0)]},s.hsl.hcg=function(e){var t,a=e[1]/100,n=e[2]/100,i=0;return(t=n<.5?2*a*n:2*a*(1-n))<1&&(i=(n-.5*t)/(1-t)),[e[0],100*t,100*i]},s.hsv.hcg=function(e){var t=e[1]/100,a=e[2]/100,n=t*a,i=0;return n<1&&(i=(a-n)/(1-n)),[e[0],100*n,100*i]},s.hcg.rgb=function(e){var t=e[0]/360,a=e[1]/100,n=e[2]/100;if(0===a)return[255*n,255*n,255*n];var i,l=[0,0,0],s=t%1*6,r=s%1,o=1-r;switch(Math.floor(s)){case 0:l[0]=1,l[1]=r,l[2]=0;break;case 1:l[0]=o,l[1]=1,l[2]=0;break;case 2:l[0]=0,l[1]=1,l[2]=r;break;case 3:l[0]=0,l[1]=o,l[2]=1;break;case 4:l[0]=r,l[1]=0,l[2]=1;break;default:l[0]=1,l[1]=0,l[2]=o}return i=(1-a)*n,[255*(a*l[0]+i),255*(a*l[1]+i),255*(a*l[2]+i)]},s.hcg.hsv=function(e){var t=e[1]/100,a=t+e[2]/100*(1-t),n=0;return a>0&&(n=t/a),[e[0],100*n,100*a]},s.hcg.hsl=function(e){var t=e[1]/100,a=e[2]/100*(1-t)+.5*t,n=0;return a>0&&a<.5?n=t/(2*a):a>=.5&&a<1&&(n=t/(2*(1-a))),[e[0],100*n,100*a]},s.hcg.hwb=function(e){var t=e[1]/100,a=t+e[2]/100*(1-t);return[e[0],100*(a-t),100*(1-a)]},s.hwb.hcg=function(e){var t=e[1]/100,a=1-e[2]/100,n=a-t,i=0;return n<1&&(i=(a-n)/(1-n)),[e[0],100*n,100*i]},s.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},s.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},s.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},s.gray.hsl=s.gray.hsv=function(e){return[0,0,e[0]]},s.gray.hwb=function(e){return[0,100,e[0]]},s.gray.cmyk=function(e){return[0,0,0,e[0]]},s.gray.lab=function(e){return[e[0],0,0]},s.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),a=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(a.length)+a},s.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},function(e,t,a){const{get:n}=a(31),i=a(81),{parse:l}=a(239),{functions:s}=a(240),r=i((function(e,t){if(null==e)throw new Error("Missing expression");if("string"!=typeof e)throw new Error("Expression must be a string");try{return l(e,t)}catch(e){throw new Error(`Failed to parse expression. ${e.message}`)}}));function o(e,t,a){const i=Object.assign({},s,a);return function e(a){if("number"==typeof a)return a;if("function"===a.type)return function(t){const{name:a,args:n}=t,l=i[a];if(!l)throw new Error(`No such function: ${a}`);const s=n.map(e);return l.skipNumberValidation||u(s)?l(...s):NaN}(a);if("variable"===a.type){const e=function(e,t){const a=n(e,t);return void 0!==a?a:e[t]}(t,a.value);if(void 0===e)throw new Error(`Unknown variable: ${a.value}`);return e}if("namedArgument"===a.type)throw new Error(`Named arguments are not supported in tinymath itself, at ${a.name}`)}(e)}function u(e){return e.every((e=>Array.isArray(e)?u(e):"number"==typeof e&&!isNaN(e)))}e.exports={parse:r,evaluate:function(e,t={},a={}){return t=t||{},o(r(e),t,a)},interpret:o}},function(e,t){e.exports={add:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>e+t)):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e+t[a]))}return Array.isArray(e)?e.map((e=>e+t)):Array.isArray(t)?t.map((t=>t+e)):e+t}))}}},function(e,t){function a(e){if(Array.isArray(e))return e.length;throw new Error("Must pass an array")}e.exports={size:a},a.skipNumberValidation=!0},function(e,t){const a=(e,t)=>Math.log(e)/Math.log(t);e.exports={log:function(e,t=Math.E){if(t<=0)throw new Error("Base out of range");if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Must be greater than 0");return a(e,t)}));if(e<0)throw new Error("Must be greater than 0");return a(e,t)}}},function(e,t){e.exports={max:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.max(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.max(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.max(e,t))):Array.isArray(t)?t.map((t=>Math.max(t,e))):Math.max(e,t)}))}}},function(e,t){e.exports={transpose:function(e,t){const a=e[t].length;return e[t].map(((t,n)=>e.map((e=>{if(Array.isArray(e)){if(e.length!==a)throw new Error("Array length mismatch");return e[n]}return e}))))}}},function(e,t){e.exports={min:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.min(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.min(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.min(e,t))):Array.isArray(t)?t.map((t=>Math.min(t,e))):Math.min(e,t)}))}}},function(e,t){e.exports={subtract:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e-t[a]))}return Array.isArray(e)?e.map((e=>e-t)):Array.isArray(t)?t.map((t=>e-t)):e-t}}},,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(6);t.default=function(e){n.useEffect(e,[])}},function(e,t,a){e.exports=a(22)(6)},function(e,t,a){"use strict";var n=a(72);Object.defineProperty(t,"__esModule",{value:!0}),t.KbnFieldType=void 0;var i=n(a(1)),l=a(89);t.KbnFieldType=class KbnFieldType{constructor(e={}){(0,i.default)(this,"name",void 0),(0,i.default)(this,"sortable",void 0),(0,i.default)(this,"filterable",void 0),(0,i.default)(this,"esTypes",void 0),this.name=e.name||l.KBN_FIELD_TYPES.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(321);case"v8light":return a(323)}},,,,,,,,,,,,,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(152);case"v8light":return a(154)}},function(e,t,a){var n=a(66),i=a(153);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(155);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(157);case"v8light":return a(159)}},function(e,t,a){var n=a(66),i=a(158);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(160);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}\n",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(41),i=a(116),l=n.__importDefault(a(117));t.default=function(e,t){l.default(e,t,i.isDeepEqual)}},,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(189);case"v8light":return a(191)}},function(e,t,a){var n=a(66),i=a(190);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(192);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(194);case"v8light":return a(196)}},function(e,t,a){var n=a(66),i=a(195);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(197);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(199);case"v8light":return a(201)}},function(e,t,a){var n=a(66),i=a(200);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(202);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(204);case"v8light":return a(206)}},function(e,t,a){var n=a(66),i=a(205);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(207);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(212);case"v8light":return a(214)}},function(e,t,a){var n=a(66),i=a(213);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(215);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(217);case"v8light":return a(219)}},function(e,t,a){var n=a(66),i=a(218);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(220);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(222);case"v8light":return a(224)}},function(e,t,a){var n=a(66),i=a(223);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(225);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(227);case"v8light":return a(229)}},function(e,t,a){var n=a(66),i=a(228);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(230);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}\n",""]),e.exports=t},function(e,t,a){"use strict";var n=a(232),i=a(236),l=[].slice,s=["keyword","gray","hex"],r={};Object.keys(i).forEach((function(e){r[l.call(i[e].labels).sort().join("")]=e}));var o={};function u(e,t){if(!(this instanceof u))return new u(e,t);if(t&&t in s&&(t=null),t&&!(t in i))throw new Error("Unknown model: "+t);var a,c;if(e)if(e instanceof u)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var d=n.get(e);if(null===d)throw new Error("Unable to parse color from string: "+e);this.model=d.model,c=i[this.model].channels,this.color=d.value.slice(0,c),this.valpha="number"==typeof d.value[c]?d.value[c]:1}else if(e.length){this.model=t||"rgb",c=i[this.model].channels;var p=l.call(e,0,c);this.color=m(p,c),this.valpha="number"==typeof e[c]?e[c]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var g=Object.keys(e);"alpha"in e&&(g.splice(g.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var f=g.sort().join("");if(!(f in r))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=r[f];var b=i[this.model].labels,h=[];for(a=0;a<b.length;a++)h.push(e[b[a]]);this.color=m(h)}else this.model="rgb",this.color=[0,0,0],this.valpha=1;if(o[this.model])for(c=i[this.model].channels,a=0;a<c;a++){var x=o[this.model][a];x&&(this.color[a]=x(this.color[a]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function c(e,t,a){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(o[e]||(o[e]=[]))[t]=a})),e=e[0],function(n){var i;return arguments.length?(a&&(n=a(n)),(i=this[e]()).color[t]=n,i):(i=this[e]().color[t],a&&(i=a(i)),i)}}function d(e){return function(t){return Math.max(0,Math.min(e,t))}}function p(e){return Array.isArray(e)?e:[e]}function m(e,t){for(var a=0;a<t;a++)"number"!=typeof e[a]&&(e[a]=0);return e}u.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var t=this.model in n.to?this:this.rgb(),a=1===(t=t.round("number"==typeof e?e:1)).valpha?t.color:t.color.concat(this.valpha);return n.to[t.model](a)},percentString:function(e){var t=this.rgb().round("number"==typeof e?e:1),a=1===t.valpha?t.color:t.color.concat(this.valpha);return n.to.rgb.percent(a)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},t=i[this.model].channels,a=i[this.model].labels,n=0;n<t;n++)e[a[n]]=this.color[n];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new u(this.color.map(function(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new u(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:c("rgb",0,d(255)),green:c("rgb",1,d(255)),blue:c("rgb",2,d(255)),hue:c(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:c("hsl",1,d(100)),lightness:c("hsl",2,d(100)),saturationv:c("hsv",1,d(100)),value:c("hsv",2,d(100)),chroma:c("hcg",1,d(100)),gray:c("hcg",2,d(100)),white:c("hwb",1,d(100)),wblack:c("hwb",2,d(100)),cyan:c("cmyk",0,d(100)),magenta:c("cmyk",1,d(100)),yellow:c("cmyk",2,d(100)),black:c("cmyk",3,d(100)),x:c("xyz",0,d(100)),y:c("xyz",1,d(100)),z:c("xyz",2,d(100)),l:c("lab",0,d(100)),a:c("lab",1),b:c("lab",2),keyword:function(e){return arguments.length?new u(e):i[this.model].keyword(this.color)},hex:function(e){return arguments.length?new u(e):n.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,t=[],a=0;a<e.length;a++){var n=e[a]/255;t[a]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),a=e.luminosity();return t>a?(t+.05)/(a+.05):(a+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},dark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},light:function(){return!this.dark()},negate:function(){for(var e=this.rgb(),t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten:function(e){var t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken:function(e){var t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate:function(e){var t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate:function(e){var t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten:function(e){var t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken:function(e){var t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale:function(){var e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return u.rgb(t,t,t)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var t=this.hsl(),a=t.color[0];return a=(a=(a+e)%360)<0?360+a:a,t.color[0]=a,t},mix:function(e,t){var a=this.rgb(),n=e.rgb(),i=void 0===t?.5:t,l=2*i-1,s=a.alpha()-n.alpha(),r=((l*s==-1?l:(l+s)/(1+l*s))+1)/2,o=1-r;return u.rgb(r*a.red()+o*n.red(),r*a.green()+o*n.green(),r*a.blue()+o*n.blue(),a.alpha()*i+n.alpha()*(1-i))}},Object.keys(i).forEach((function(e){if(-1===s.indexOf(e)){var t=i[e].channels;u.prototype[e]=function(){if(this.model===e)return new u(this);if(arguments.length)return new u(arguments,e);var a="number"==typeof arguments[t]?t:this.valpha;return new u(p(i[this.model][e].raw(this.color)).concat(a),e)},u[e]=function(a){return"number"==typeof a&&(a=m(l.call(arguments),t)),new u(a,e)}}})),e.exports=u},function(e,t,a){var n=a(233),i=a(234),l={};for(var s in n)n.hasOwnProperty(s)&&(l[n[s]]=s);var r=e.exports={to:{},get:{}};function o(e,t,a){return Math.min(Math.max(t,e),a)}function u(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}r.get=function(e){var t,a;switch(e.substring(0,3).toLowerCase()){case"hsl":t=r.get.hsl(e),a="hsl";break;case"hwb":t=r.get.hwb(e),a="hwb";break;default:t=r.get.rgb(e),a="rgb"}return t?{model:a,value:t}:null},r.get.rgb=function(e){if(!e)return null;var t,a,i,l=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=t[2],t=t[1],a=0;a<3;a++){var s=2*a;l[a]=parseInt(t.slice(s,s+2),16)}i&&(l[3]=parseInt(i,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(i=(t=t[1])[3],a=0;a<3;a++)l[a]=parseInt(t[a]+t[a],16);i&&(l[3]=parseInt(i+i,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(a=0;a<3;a++)l[a]=parseInt(t[a+1],0);t[4]&&(l[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(l=n[t[1]])?(l[3]=1,l):null:null;for(a=0;a<3;a++)l[a]=Math.round(2.55*parseFloat(t[a+1]));t[4]&&(l[3]=parseFloat(t[4]))}for(a=0;a<3;a++)l[a]=o(l[a],0,255);return l[3]=o(l[3],0,1),l},r.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,o(parseFloat(t[2]),0,100),o(parseFloat(t[3]),0,100),o(isNaN(a)?1:a,0,1)]}return null},r.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,o(parseFloat(t[2]),0,100),o(parseFloat(t[3]),0,100),o(isNaN(a)?1:a,0,1)]}return null},r.to.hex=function(){var e=i(arguments);return"#"+u(e[0])+u(e[1])+u(e[2])+(e[3]<1?u(Math.round(255*e[3])):"")},r.to.rgb=function(){var e=i(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},r.to.rgb.percent=function(){var e=i(arguments),t=Math.round(e[0]/255*100),a=Math.round(e[1]/255*100),n=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+a+"%, "+n+"%)":"rgba("+t+"%, "+a+"%, "+n+"%, "+e[3]+")"},r.to.hsl=function(){var e=i(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},r.to.hwb=function(){var e=i(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},r.to.keyword=function(e){return l[e.slice(0,3)]}},function(e,t,a){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(e,t,a){"use strict";var n=a(235),i=Array.prototype.concat,l=Array.prototype.slice,s=e.exports=function(e){for(var t=[],a=0,s=e.length;a<s;a++){var r=e[a];n(r)?t=i.call(t,l.call(r)):t.push(r)}return t};s.wrap=function(e){return function(){return e(s(arguments))}}},function(e,t){e.exports=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},function(e,t,a){var n=a(118),i=a(238),l={};Object.keys(n).forEach((function(e){l[e]={},Object.defineProperty(l[e],"channels",{value:n[e].channels}),Object.defineProperty(l[e],"labels",{value:n[e].labels});var t=i(e);Object.keys(t).forEach((function(a){var n=t[a];l[e][a]=function(e){var t=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var a=e(t);if("object"==typeof a)for(var n=a.length,i=0;i<n;i++)a[i]=Math.round(a[i]);return a};return"conversion"in e&&(t.conversion=e.conversion),t}(n),l[e][a].raw=function(e){var t=function(t){return null==t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(n)}))})),e.exports=l},function(e,t,a){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(e,t,a){var n=a(118);function i(e,t){return function(a){return t(e(a))}}function l(e,t){for(var a=[t[e].parent,e],l=n[t[e].parent][e],s=t[e].parent;t[s].parent;)a.unshift(t[s].parent),l=i(n[t[s].parent][s],l),s=t[s].parent;return l.conversion=a,l}e.exports=function(e){for(var t=function(e){var t=function(){for(var e={},t=Object.keys(n),a=t.length,i=0;i<a;i++)e[t[i]]={distance:-1,parent:null};return e}(),a=[e];for(t[e].distance=0;a.length;)for(var i=a.pop(),l=Object.keys(n[i]),s=l.length,r=0;r<s;r++){var o=l[r],u=t[o];-1===u.distance&&(u.distance=t[i].distance+1,u.parent=i,a.unshift(o))}return t}(e),a={},i=Object.keys(t),s=i.length,r=0;r<s;r++){var o=i[r];null!==t[o].parent&&(a[o]=l(o,t))}return a}},function(e,t,a){"use strict";function n(e,t,a,i){var l=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(l,n.prototype),l.expected=t,l.found=a,l.location=i,l.name="SyntaxError",l}function i(e,t,a){return a=a||" ",e.length>t?e:(t-=e.length,e+(a+=a.repeat(t)).slice(0,t))}!function(e,t){function a(){this.constructor=e}a.prototype=t.prototype,e.prototype=new a}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var a,n=null;for(a=0;a<e.length;a++)if(e[a].source===this.location.source){n=e[a].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,s=this.location.source+":"+l.line+":"+l.column;if(n){var r=this.location.end,o=i("",l.line.toString().length),u=n[l.line-1],c=l.line===r.line?r.column:u.length+1;t+="\n --\x3e "+s+"\n"+o+" |\n"+l.line+" | "+u+"\n"+o+" | "+i("",l.column-1)+i("",c-l.column,"^")}else t+="\n at "+s}return t},n.buildMessage=function(e,t){var a={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?l(e[0])+"-"+l(e[1]):l(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function l(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return a[e.type](e)}return"Expected "+function(e){var t,a,n=e.map(s);if(n.sort(),n.length>0){for(t=1,a=1;t<n.length;t++)n[t-1]!==n[t]&&(n[a]=n[t],a++);n.length=a}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:n,parse:function(e,t){var a,i={},l=(t=void 0!==t?t:{}).grammarSource,s={start:me},r=me,o='"',u='\\"',c="'",d="\\'",p="-",m=/^[ \t\n\r]/,g=/^[0-9A-Za-z._@[\]\-]/,f=/^[^"]/,b=/^[^']/,h=/^[a-zA-Z_]/,x=/^[a-zA-Z_\-]/,v=/^[eE]/,y=/^[1-9]/,j=/^[0-9]/,O=ue("whitespace"),k=oe([" ","\t","\n","\r"],!1,!1),I=(oe([" "],!1,!1),oe(['"',"'"],!1,!1),oe([["A","Z"],["a","z"],"_","@",".","[","]","-"],!1,!1),oe([["0","9"],["A","Z"],["a","z"],".","_","@","[","]","-"],!1,!1)),T=ue("literal"),F=re('"',!1),M=re('\\"',!1),w=oe(['"'],!0,!1),_=re("'",!1),C=re("\\'",!1),E=oe(["'"],!0,!1),S=re("+",!1),P=re("-",!1),A=re("*",!1),L=re("/",!1),D=re("(",!1),N=re(")",!1),z=ue("arguments"),B=re(",",!1),V=oe([["a","z"],["A","Z"],"_"],!1,!1),R=re("=",!1),H=ue("function"),G=oe([["a","z"],["A","Z"],"_","-"],!1,!1),q=ue("number"),$=oe(["e","E"],!1,!1),W=ue("exponent"),U=re(".",!1),Y=re("0",!1),K=oe([["1","9"]],!1,!1),X=oe([["0","9"]],!1,!1),Z=function(e,t){return t},Q=function(e){return e.join("")},J=0,ee=0,te=[{line:1,column:1}],ae=0,ne=[],ie=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=s[t.startRule]}function le(){return e.substring(ee,J)}function se(){return de(ee,J)}function re(e,t){return{type:"literal",text:e,ignoreCase:t}}function oe(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function ue(e){return{type:"other",description:e}}function ce(t){var a,n=te[t];if(n)return n;for(a=t-1;!te[a];)a--;for(n={line:(n=te[a]).line,column:n.column};a<t;)10===e.charCodeAt(a)?(n.line++,n.column=1):n.column++,a++;return te[t]=n,n}function de(e,t){var a=ce(e),n=ce(t);return{source:l,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:n.line,column:n.column}}}function pe(e){J<ae||(J>ae&&(ae=J,ne=[]),ne.push(e))}function me(){return be()}function ge(){var t,a;for(ie++,t=[],m.test(e.charAt(J))?(a=e.charAt(J),J++):(a=i,0===ie&&pe(k));a!==i;)t.push(a),m.test(e.charAt(J))?(a=e.charAt(J),J++):(a=i,0===ie&&pe(k));return ie--,a=i,0===ie&&pe(O),t}function fe(){var t;return g.test(e.charAt(J))?(t=e.charAt(J),J++):(t=i,0===ie&&pe(I)),t}function be(){var t,a,n,l,s,r;if(t=J,ge(),(a=he())!==i){if(n=[],l=J,43===e.charCodeAt(J)?(s="+",J++):(s=i,0===ie&&pe(S)),s===i&&(45===e.charCodeAt(J)?(s=p,J++):(s=i,0===ie&&pe(P))),s!==i&&(r=he())!==i?l=s=[s,r]:(J=l,l=i),l!==i)for(;l!==i;)n.push(l),l=J,43===e.charCodeAt(J)?(s="+",J++):(s=i,0===ie&&pe(S)),s===i&&(45===e.charCodeAt(J)?(s=p,J++):(s=i,0===ie&&pe(P))),s!==i&&(r=he())!==i?l=s=[s,r]:(J=l,l=i);else n=i;n!==i?(l=ge(),ee=t,t=function(e,t){const a=t.reduce(((e,t)=>({type:"function",name:"+"===t[0]?"add":"subtract",args:[e,t[1]]})),e);return"object"==typeof a&&(a.location=Oe(se()),a.text=le()),a}(a,n)):(J=t,t=i)}else J=t,t=i;return t===i&&(t=he()),t}function he(){var t,a,n,l,s,r;if(t=J,ge(),(a=xe())!==i){for(n=[],l=J,42===e.charCodeAt(J)?(s="*",J++):(s=i,0===ie&&pe(A)),s===i&&(47===e.charCodeAt(J)?(s="/",J++):(s=i,0===ie&&pe(L))),s!==i&&(r=xe())!==i?l=s=[s,r]:(J=l,l=i);l!==i;)n.push(l),l=J,42===e.charCodeAt(J)?(s="*",J++):(s=i,0===ie&&pe(A)),s===i&&(47===e.charCodeAt(J)?(s="/",J++):(s=i,0===ie&&pe(L))),s!==i&&(r=xe())!==i?l=s=[s,r]:(J=l,l=i);l=ge(),ee=t,t=function(e,t){const a=t.reduce(((e,t)=>({type:"function",name:"*"===t[0]?"multiply":"divide",args:[e,t[1]]})),e);return"object"==typeof a&&(a.location=Oe(se()),a.text=le()),a}(a,n)}else J=t,t=i;return t===i&&(t=xe()),t}function xe(){var t;return(t=function(){var t,a,n,l;return t=J,ge(),40===e.charCodeAt(J)?(a="(",J++):(a=i,0===ie&&pe(D)),a!==i?(ge(),(n=be())!==i?(ge(),41===e.charCodeAt(J)?(l=")",J++):(l=i,0===ie&&pe(N)),l!==i?(ge(),ee=t,t=n):(J=t,t=i)):(J=t,t=i)):(J=t,t=i),t}())===i&&(t=function(){var t,a,n,l,s,r;if(ie++,t=J,ge(),a=[],x.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(G)),n!==i)for(;n!==i;)a.push(n),x.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(G));else a=i;return a!==i?(40===e.charCodeAt(J)?(n="(",J++):(n=i,0===ie&&pe(D)),n!==i?(ge(),l=function(){var t,a,n,l,s,r,o;if(ie++,t=J,(a=ve())!==i){for(n=[],l=J,s=ge(),44===e.charCodeAt(J)?(r=",",J++):(r=i,0===ie&&pe(B)),r!==i?(ge(),(o=ve())!==i?(ee=l,l=Z(0,o)):(J=l,l=i)):(J=l,l=i);l!==i;)n.push(l),l=J,s=ge(),44===e.charCodeAt(J)?(r=",",J++):(r=i,0===ie&&pe(B)),r!==i?(ge(),(o=ve())!==i?(ee=l,l=Z(0,o)):(J=l,l=i)):(J=l,l=i);l=ge(),44===e.charCodeAt(J)?(s=",",J++):(s=i,0===ie&&pe(B)),s===i&&(s=null),ee=t,t=[a].concat(n)}else J=t,t=i;return ie--,t===i&&(a=i,0===ie&&pe(z)),t}(),l===i&&(l=null),ge(),41===e.charCodeAt(J)?(s=")",J++):(s=i,0===ie&&pe(N)),s!==i?(ge(),ee=t,r=l,t={type:"function",name:a.join(""),args:r||[],location:Oe(se()),text:le()}):(J=t,t=i)):(J=t,t=i)):(J=t,t=i),ie--,t===i&&0===ie&&pe(H),t}())===i&&(t=function(){var t,a;return ie++,t=J,ge(),(a=ye())===i&&(a=function(){var t,a,n,l,s;if(t=J,ge(),34===e.charCodeAt(J)?(a=o,J++):(a=i,0===ie&&pe(F)),a!==i){for(n=[],l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(M)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));l!==i;)n.push(l),l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(M)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));34===e.charCodeAt(J)?(l=o,J++):(l=i,0===ie&&pe(F)),l!==i?(s=ge(),ee=t,t={type:"variable",value:n.join(""),location:Oe(se()),text:le()}):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,ge(),39===e.charCodeAt(J)?(a=c,J++):(a=i,0===ie&&pe(_)),a!==i){for(n=[],l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(C)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(E)));l!==i;)n.push(l),l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(C)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(E)));39===e.charCodeAt(J)?(l=c,J++):(l=i,0===ie&&pe(_)),l!==i?(s=ge(),ee=t,t={type:"variable",value:n.join(""),location:Oe(se()),text:le()}):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,ge(),a=[],(n=fe())!==i)for(;n!==i;)a.push(n),n=fe();else a=i;a!==i?(n=ge(),ee=t,t={type:"variable",value:a.join(""),location:Oe(se()),text:le()}):(J=t,t=i)}}return t}()),a!==i?(ge(),ee=t,t=a):(J=t,t=i),ie--,t===i&&0===ie&&pe(T),t}()),t}function ve(){var t,a,n,l,s,r;if(t=J,a=[],h.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(V)),n!==i)for(;n!==i;)a.push(n),h.test(e.charAt(J))?(n=e.charAt(J),J++):(n=i,0===ie&&pe(V));else a=i;return a!==i?(n=ge(),61===e.charCodeAt(J)?(l="=",J++):(l=i,0===ie&&pe(R)),l!==i?(ge(),(s=ye())===i&&(s=function(){var t,a,n,l,s;if(t=J,34===e.charCodeAt(J)?(a=o,J++):(a=i,0===ie&&pe(F)),a!==i){for(n=[],l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(M)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));l!==i;)n.push(l),l=J,e.substr(J,2)===u?(s=u,J+=2):(s=i,0===ie&&pe(M)),s!==i&&(ee=l,s='"'),(l=s)===i&&(f.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(w)));34===e.charCodeAt(J)?(l=o,J++):(l=i,0===ie&&pe(F)),l!==i?(ee=t,t=Q(n)):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,39===e.charCodeAt(J)?(a=c,J++):(a=i,0===ie&&pe(_)),a!==i){for(n=[],l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(C)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(E)));l!==i;)n.push(l),l=J,e.substr(J,2)===d?(s=d,J+=2):(s=i,0===ie&&pe(C)),s!==i&&(ee=l,s="'"),(l=s)===i&&(b.test(e.charAt(J))?(l=e.charAt(J),J++):(l=i,0===ie&&pe(E)));39===e.charCodeAt(J)?(l=c,J++):(l=i,0===ie&&pe(_)),l!==i?(ee=t,t=Q(n)):(J=t,t=i)}else J=t,t=i;if(t===i){if(t=J,a=[],(n=fe())!==i)for(;n!==i;)a.push(n),n=fe();else a=i;a!==i&&(ee=t,a=Q(a)),t=a}}return t}()),s!==i?(ge(),ee=t,r=s,t={type:"namedArgument",name:a.join(""),value:r,location:Oe(se()),text:le()}):(J=t,t=i)):(J=t,t=i)):(J=t,t=i),t===i&&(t=be()),t}function ye(){var t,a,n,l,s;return ie++,t=J,45===e.charCodeAt(J)?(a=p,J++):(a=i,0===ie&&pe(P)),a===i&&(a=null),n=function(){var t,a,n,l;if(48===e.charCodeAt(J)?(t="0",J++):(t=i,0===ie&&pe(Y)),t===i)if(t=J,y.test(e.charAt(J))?(a=e.charAt(J),J++):(a=i,0===ie&&pe(K)),a!==i){for(n=[],l=je();l!==i;)n.push(l),l=je();t=a=[a,n]}else J=t,t=i;return t}(),n!==i?(l=function(){var t,a,n,l;if(t=J,46===e.charCodeAt(J)?(a=".",J++):(a=i,0===ie&&pe(U)),a!==i){if(n=[],(l=je())!==i)for(;l!==i;)n.push(l),l=je();else n=i;n!==i?t=a=[a,n]:(J=t,t=i)}else J=t,t=i;return t}(),l===i&&(l=null),s=function(){var t,a,n,l,s;if(ie++,t=J,a=function(){var t;return v.test(e.charAt(J))?(t=e.charAt(J),J++):(t=i,0===ie&&pe($)),t}(),a!==i){if(45===e.charCodeAt(J)?(n=p,J++):(n=i,0===ie&&pe(P)),n===i&&(n=null),l=[],(s=je())!==i)for(;s!==i;)l.push(s),s=je();else l=i;l!==i?t=a=[a,n,l]:(J=t,t=i)}else J=t,t=i;return ie--,t===i&&(a=i,0===ie&&pe(W)),t}(),s===i&&(s=null),ee=t,t=parseFloat(le())):(J=t,t=i),ie--,t===i&&(a=i,0===ie&&pe(q)),t}function je(){var t;return j.test(e.charAt(J))?(t=e.charAt(J),J++):(t=i,0===ie&&pe(X)),t}function Oe(e){return{min:e.start.offset,max:e.end.offset}}if((a=r())!==i&&J===e.length)return a;throw a!==i&&J<e.length&&pe({type:"end"}),function(e,t,a){return new n(n.buildMessage(e,t),e,t,a)}(ne,ae<e.length?e.charAt(ae):null,ae<e.length?de(ae,ae+1):de(ae,ae))}}},function(e,t,a){const{abs:n}=a(241),{add:i}=a(120),{cbrt:l}=a(242),{ceil:s}=a(243),{clamp:r}=a(244),{cos:o}=a(245),{count:u}=a(246),{cube:c}=a(247),{degtorad:d}=a(248),{divide:p}=a(249),{exp:m}=a(250),{first:g}=a(251),{fix:f}=a(252),{floor:b}=a(253),{last:h}=a(254),{log:x}=a(122),{log10:v}=a(255),{max:y}=a(123),{mean:j}=a(256),{median:O}=a(257),{min:k}=a(125),{mod:I}=a(258),{mode:T}=a(259),{multiply:F}=a(260),{pi:M}=a(261),{pow:w}=a(100),{radtodeg:_}=a(262),{random:C}=a(263),{range:E}=a(264),{round:S}=a(265),{sin:P}=a(266),{size:A}=a(121),{sqrt:L}=a(267),{square:D}=a(268),{subtract:N}=a(126),{sum:z}=a(269),{tan:B}=a(270),{unique:V}=a(271);e.exports={functions:{abs:n,add:i,cbrt:l,ceil:s,clamp:r,cos:o,count:u,cube:c,degtorad:d,divide:p,exp:m,first:g,fix:f,floor:b,last:h,log:x,log10:v,max:y,mean:j,median:O,min:k,mod:I,mode:T,multiply:F,pi:M,pow:w,radtodeg:_,random:C,range:E,round:S,sin:P,size:A,sqrt:L,square:D,subtract:N,sum:z,tan:B,unique:V}}},function(e,t){e.exports={abs:function(e){return Array.isArray(e)?e.map((e=>Math.abs(e))):Math.abs(e)}}},function(e,t){e.exports={cbrt:function(e){return Array.isArray(e)?e.map((e=>Math.cbrt(e))):Math.cbrt(e)}}},function(e,t){e.exports={ceil:function(e){return Array.isArray(e)?e.map((e=>Math.ceil(e))):Math.ceil(e)}}},function(e,t){const a=(e,t,a)=>{if(t>a)throw new Error("Min must be less than max");return Math.min(Math.max(e,t),a)};e.exports={clamp:function(e,t,n){if(null===n)throw new Error("Missing maximum value. You may want to use the 'min' function instead");if(null===t)throw new Error("Missing minimum value. You may want to use the 'max' function instead");if(Array.isArray(n)){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==n.length||e.length!==t.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t[i],n)))}if(Array.isArray(e)){if(e.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t,n)))}if(Array.isArray(t)){if(t.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e,t[i],n)))}return n.map((n=>a(e,t,n)))}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>a(e,t[n])))}return Array.isArray(e)?e.map((e=>a(e,t,n))):Array.isArray(t)?t.map((t=>a(e,t,n))):a(e,t,n)}}},function(e,t){e.exports={cos:function(e){return Array.isArray(e)?e.map((e=>Math.cos(e))):Math.cos(e)}}},function(e,t,a){const{size:n}=a(121);function i(e){return n(e)}e.exports={count:i},i.skipNumberValidation=!0},function(e,t,a){const{pow:n}=a(100);e.exports={cube:function(e){return n(e,3)}}},function(e,t){e.exports={degtorad:function(e){return Array.isArray(e)?e.map((e=>e*Math.PI/180)):e*Math.PI/180}}},function(e,t){e.exports={divide:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e/t[a]}))}if(Array.isArray(t))return t.map((t=>e/t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e/t)):e/t}}},function(e,t){e.exports={exp:function(e){return Array.isArray(e)?e.map((e=>Math.exp(e))):Math.exp(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[0]:e}e.exports={first:a},a.skipNumberValidation=!0},function(e,t){const a=e=>e>0?Math.floor(e):Math.ceil(e);e.exports={fix:function(e){return Array.isArray(e)?e.map((e=>a(e))):a(e)}}},function(e,t){e.exports={floor:function(e){return Array.isArray(e)?e.map((e=>Math.floor(e))):Math.floor(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[e.length-1]:e}e.exports={last:a},a.skipNumberValidation=!0},function(e,t,a){const{log:n}=a(122);e.exports={log10:function(e){return n(e,10)}}},function(e,t,a){const{add:n}=a(120);e.exports={mean:function(...e){if(1===e.length)return Array.isArray(e[0])?n(e[0])/e[0].length:e[0];const t=n(...e);return Array.isArray(t)?t.map((t=>t/e.length)):t/e.length}}},function(e,t,a){const{transpose:n}=a(124),i=e=>{const t=e.length,a=Math.floor(t/2);return e.sort(((e,t)=>t-e)),t%2==0?(e[a]+e[a-1])/2:e[a]};e.exports={median:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={mod:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e%t[a]}))}if(Array.isArray(t))return t.map((t=>e%t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e%t)):e%t}}},function(e,t,a){const{transpose:n}=a(124),i=e=>{let t=0;const a={};return e.map((e=>{void 0===a[e]&&(a[e]=0),a[e]+=1,a[e]>t&&(t=a[e])})),Object.keys(a).filter((e=>a[e]===t)).map((e=>parseFloat(e))).sort(((e,t)=>e-t))};e.exports={mode:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={multiply:function(...e){return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e*t[a]))}return Array.isArray(e)?e.map((e=>e*t)):Array.isArray(t)?t.map((t=>t*e)):e*t}))}}},function(e,t){e.exports={pi:function(){return Math.PI}}},function(e,t){e.exports={radtodeg:function(e){return Array.isArray(e)?e.map((e=>180*e/Math.PI)):180*e/Math.PI}}},function(e,t){e.exports={random:function(e,t){if(null==e)return Math.random();if(null==t){if(e<0)throw new Error("Min is greater than max");return Math.random()*e}if(e>t)throw new Error("Min is greater than max");return Math.random()*(t-e)+e}}},function(e,t,a){const{max:n}=a(123),{min:i}=a(125),{subtract:l}=a(126);e.exports={range:function(...e){return l(n(...e),i(...e))}}},function(e,t){const a=(e,t)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);e.exports={round:function(e,t=0){return Array.isArray(e)?e.map((e=>a(e,t))):a(e,t)}}},function(e,t){e.exports={sin:function(e){return Array.isArray(e)?e.map((e=>Math.sin(e))):Math.sin(e)}}},function(e,t){e.exports={sqrt:function(e){if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}));if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}}},function(e,t,a){const{pow:n}=a(100);e.exports={square:function(e){return n(e,2)}}},function(e,t){const a=(e,t)=>e+t;e.exports={sum:function(...e){return e.reduce(((e,t)=>Array.isArray(t)?e+t.reduce(a,0):e+t),0)}}},function(e,t){e.exports={tan:function(e){return Array.isArray(e)?e.map((e=>Math.tan(e))):Math.tan(e)}}},function(e,t){function a(e){return Array.isArray(e)?e.filter(((t,a)=>e.indexOf(t)===a)).length:1}e.exports={unique:a},a.skipNumberValidation=!0},,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(279);case"v8light":return a(281)}},function(e,t,a){var n=a(66),i=a(280);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #343741}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #343741}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#25262E}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#7a7f89;font-family:Menlo, Monaco, 'Courier New', monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #343741;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#1D1E24}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #343741}.lnsFormula__docsSidebar{background:#25262E}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #343741}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #343741}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #343741;padding-top:40px}.lnsFormulaOverflow{z-index:9001}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(282);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #D3DAE6}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #D3DAE6}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#F5F7FA}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#69707D;font-family:Menlo, Monaco, 'Courier New', monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #D3DAE6;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#fff}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #D3DAE6}.lnsFormula__docsSidebar{background:#F5F7FA}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #D3DAE6}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #D3DAE6}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #D3DAE6;padding-top:40px}.lnsFormulaOverflow{z-index:9001}\n",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(41),i=a(6),l=n.__importDefault(a(129));t.default=function(e){var t=i.useRef(e);t.current=e,l.default((function(){return function(){return t.current()}}))}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(285);case"v8light":return a(287)}},function(e,t,a){var n=a(66),i=a(286);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(288);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(290);case"v8light":return a(292)}},function(e,t,a){var n=a(66),i=a(291);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(293);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(295);case"v8light":return a(297)}},function(e,t,a){var n=a(66),i=a(296);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#343741}.lnFieldSelect__option--nonExistant{background-color:#25262E}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(298);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#D3DAE6}.lnFieldSelect__option--nonExistant{background-color:#F5F7FA}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(300);case"v8light":return a(302)}},function(e,t,a){var n=a(66),i=a(301);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".kbnFieldButton{font-size:14px;font-size:1rem;line-height:1.71429rem;border-radius:6px;margin-bottom:4px;display:flex;align-items:center;transition:box-shadow 150ms cubic-bezier(0.694, 0.0482, 0.335, 1),background-color 150ms cubic-bezier(0.694, 0.0482, 0.335, 1)}.kbnFieldButton:focus-within,.kbnFieldButton-isActive{outline:2px solid currentColor}.kbnFieldButton:focus-within:focus-visible,.kbnFieldButton-isActive:focus-visible{outline-style:auto}.kbnFieldButton:focus-within:not(:focus-visible),.kbnFieldButton-isActive:not(:focus-visible){outline:none}.kbnFieldButton--isDraggable{background:#25262E}.kbnFieldButton--isDraggable:hover,.kbnFieldButton--isDraggable:focus,.kbnFieldButton--isDraggable:focus-within{box-shadow:0 0.9px 4px -1px rgba(0,0,0,0.2),0 2.6px 8px -1px rgba(0,0,0,0.15),0 5.7px 12px -1px rgba(0,0,0,0.125),0 15px 15px -1px rgba(0,0,0,0.1);border-radius:6px;z-index:2}.kbnFieldButton--isDraggable .kbnFieldButton__button:hover,.kbnFieldButton--isDraggable .kbnFieldButton__button:focus{cursor:grab}.kbnFieldButton__button{flex-grow:1;text-align:left;padding:8px;display:flex;align-items:flex-start;line-height:normal}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0;margin-right:8px}.kbnFieldButton__name{flex-grow:1;word-break:break-word}.kbnFieldButton__infoIcon{flex-shrink:0;margin-left:4px}.kbnFieldButton__fieldAction{margin-right:8px}.kbnFieldButton--small{font-size:12px}.kbnFieldButton--small .kbnFieldButton__button{padding:4px}.kbnFieldButton--small .kbnFieldButton__fieldIcon,.kbnFieldButton--small .kbnFieldButton__fieldAction{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(303);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".kbnFieldButton{font-size:14px;font-size:1rem;line-height:1.71429rem;border-radius:6px;margin-bottom:4px;display:flex;align-items:center;transition:box-shadow 150ms cubic-bezier(0.694, 0.0482, 0.335, 1),background-color 150ms cubic-bezier(0.694, 0.0482, 0.335, 1)}.kbnFieldButton:focus-within,.kbnFieldButton-isActive{outline:2px solid currentColor}.kbnFieldButton:focus-within:focus-visible,.kbnFieldButton-isActive:focus-visible{outline-style:auto}.kbnFieldButton:focus-within:not(:focus-visible),.kbnFieldButton-isActive:not(:focus-visible){outline:none}.kbnFieldButton--isDraggable{background:#fff}.kbnFieldButton--isDraggable:hover,.kbnFieldButton--isDraggable:focus,.kbnFieldButton--isDraggable:focus-within{box-shadow:0 0.9px 4px -1px rgba(0,0,0,0.08),0 2.6px 8px -1px rgba(0,0,0,0.06),0 5.7px 12px -1px rgba(0,0,0,0.05),0 15px 15px -1px rgba(0,0,0,0.04);border-radius:6px;z-index:2}.kbnFieldButton--isDraggable .kbnFieldButton__button:hover,.kbnFieldButton--isDraggable .kbnFieldButton__button:focus{cursor:grab}.kbnFieldButton__button{flex-grow:1;text-align:left;padding:8px;display:flex;align-items:flex-start;line-height:normal}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0;margin-right:8px}.kbnFieldButton__name{flex-grow:1;word-break:break-word}.kbnFieldButton__infoIcon{flex-shrink:0;margin-left:4px}.kbnFieldButton__fieldAction{margin-right:8px}.kbnFieldButton--small{font-size:12px}.kbnFieldButton--small .kbnFieldButton__button{padding:4px}.kbnFieldButton--small .kbnFieldButton__fieldIcon,.kbnFieldButton--small .kbnFieldButton__fieldAction{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ES_FIELD_TYPES",{enumerable:!0,get:function(){return l.ES_FIELD_TYPES}}),Object.defineProperty(t,"KBN_FIELD_TYPES",{enumerable:!0,get:function(){return l.KBN_FIELD_TYPES}}),Object.defineProperty(t,"KbnFieldType",{enumerable:!0,get:function(){return n.KbnFieldType}}),Object.defineProperty(t,"castEsToKbnFieldTypeName",{enumerable:!0,get:function(){return i.castEsToKbnFieldTypeName}}),Object.defineProperty(t,"getFilterableKbnTypeNames",{enumerable:!0,get:function(){return i.getFilterableKbnTypeNames}}),Object.defineProperty(t,"getKbnFieldType",{enumerable:!0,get:function(){return i.getKbnFieldType}}),Object.defineProperty(t,"getKbnTypeNames",{enumerable:!0,get:function(){return i.getKbnTypeNames}});var n=a(131),i=a(305),l=a(89)},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKbnTypeNames=t.getKbnFieldType=t.getFilterableKbnTypeNames=t.castEsToKbnFieldTypeName=void 0;var n=a(306),i=a(89);const l=(0,n.createKbnFieldTypes)();t.getKbnFieldType=e=>l.find((t=>t.name===e))||n.kbnFieldTypeUnknown,t.getKbnTypeNames=()=>l.filter((e=>e.name)).map((e=>e.name)),t.castEsToKbnFieldTypeName=e=>{const t=l.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:i.KBN_FIELD_TYPES.UNKNOWN},t.getFilterableKbnTypeNames=()=>l.filter((e=>e.filterable)).map((e=>e.name))},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kbnFieldTypeUnknown=t.createKbnFieldTypes=void 0;var n=a(131),i=a(89);const l=new n.KbnFieldType({name:i.KBN_FIELD_TYPES.UNKNOWN});t.kbnFieldTypeUnknown=l,t.createKbnFieldTypes=()=>[new n.KbnFieldType({name:i.KBN_FIELD_TYPES.STRING,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.STRING,i.ES_FIELD_TYPES.TEXT,i.ES_FIELD_TYPES.KEYWORD,i.ES_FIELD_TYPES.VERSION,i.ES_FIELD_TYPES._TYPE,i.ES_FIELD_TYPES._ID]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.NUMBER,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.FLOAT,i.ES_FIELD_TYPES.HALF_FLOAT,i.ES_FIELD_TYPES.SCALED_FLOAT,i.ES_FIELD_TYPES.DOUBLE,i.ES_FIELD_TYPES.INTEGER,i.ES_FIELD_TYPES.LONG,i.ES_FIELD_TYPES.UNSIGNED_LONG,i.ES_FIELD_TYPES.SHORT,i.ES_FIELD_TYPES.BYTE,i.ES_FIELD_TYPES.TOKEN_COUNT]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.FLOAT_RANGE,i.ES_FIELD_TYPES.DOUBLE_RANGE,i.ES_FIELD_TYPES.INTEGER_RANGE,i.ES_FIELD_TYPES.LONG_RANGE]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.DATE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.DATE,i.ES_FIELD_TYPES.DATE_NANOS]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.DATE_RANGE]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.IP,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.IP]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.IP_RANGE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.IP_RANGE]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.BOOLEAN,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.BOOLEAN]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.OBJECT,esTypes:[i.ES_FIELD_TYPES.OBJECT]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.NESTED,esTypes:[i.ES_FIELD_TYPES.NESTED]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.GEO_POINT,esTypes:[i.ES_FIELD_TYPES.GEO_POINT]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.GEO_SHAPE,esTypes:[i.ES_FIELD_TYPES.GEO_SHAPE]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.ATTACHMENT,esTypes:[i.ES_FIELD_TYPES.ATTACHMENT]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.MURMUR3,esTypes:[i.ES_FIELD_TYPES.MURMUR3]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES._SOURCE,esTypes:[i.ES_FIELD_TYPES._SOURCE]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.HISTOGRAM,filterable:!0,esTypes:[i.ES_FIELD_TYPES.HISTOGRAM]}),new n.KbnFieldType({name:i.KBN_FIELD_TYPES.CONFLICT}),l]},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(308);case"v8light":return a(310)}},function(e,t,a){var n=a(66),i=a(309);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(311);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex='0']:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(313);case"v8light":return a(315)}},function(e,t,a){var n=a(66),i=a(314);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(316);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(318);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#1D1E24;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#25262E;border-bottom:1px solid #343741}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:32px}.lnsIndexPatternDimensionEditor__operation{display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(320);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#fff;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#F5F7FA;border-bottom:1px solid #D3DAE6}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:32px}.lnsIndexPatternDimensionEditor__operation{display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(322);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #25262E}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(324);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #F5F7FA}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}\n",""]),e.exports=t},,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(333);case"v8light":return a(335)}},function(e,t,a){var n=a(66),i=a(334);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);scrollbar-color:rgba(152,162,179,0.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(336);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255,0,0,0.1) 0%,red 7.5px,red calc(100% - 7.5px),rgba(255,0,0,0.1) 100%);scrollbar-color:rgba(105,112,125,0.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(338);case"v8light":return a(340)}},function(e,t,a){var n=a(66),i=a(339);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{outline:none}.lnsFieldItem.kbnFieldButton:focus-within:focus-visible,.lnsFieldItem.kbnFieldButton-isActive:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:rgba(54,162,239,0.2);outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*='isActive']){cursor:grab}.lnsFieldItem:hover:not([class*='isActive']) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:#1D1E24;color:#98A2B3}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#25262E}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#25262E}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(341);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{outline:none}.lnsFieldItem.kbnFieldButton:focus-within:focus-visible,.lnsFieldItem.kbnFieldButton-isActive:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:rgba(0,119,204,0.1);outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*='isActive']){cursor:grab}.lnsFieldItem:hover:not([class*='isActive']) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:rgba(152,162,179,0.1);color:#69707D}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#F5F7FA}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#F5F7FA}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}\n",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(343);case"v8light":return a(345)}},function(e,t,a){var n=a(66),i=a(344);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #343741;border-radius:6px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #343741;background-color:rgba(84,179,153,0.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,0.25);border:1px dashed #54B399}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(346);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #D3DAE6;border-radius:6px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #D3DAE6;background-color:rgba(84,179,153,0.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,0.25);border:1px dashed #54B399}\n",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,i,l;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(i=n;0!=i--;)if(!e(t[i],a[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(l=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(a,l[i]))return!1;for(i=n;0!=i--;){var s=l[i];if(!e(t[s],a[s]))return!1}return!0}return t!=t&&a!=a}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(422);case"v8light":return a(424)}},function(e,t,a){var n=a(66),i=a(423);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp>.kbnTopNavMenu__wrapper{border-bottom:1px solid #343741}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#7a7f89}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54B399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#2a574a}.lensAnnotationIconNoFill{fill:none}.lensAnnotationIconFill{fill:#1D1E24}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack::after{border-right:1px solid #343741;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack::after{border-right:1px solid #343741;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack::after{border-right:1px solid #343741;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}\n",""]),e.exports=t},function(e,t,a){var n=a(66),i=a(425);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp>.kbnTopNavMenu__wrapper{border-bottom:1px solid #D3DAE6}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#69707D}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54B399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#9ed4c5}.lensAnnotationIconNoFill{fill:none}.lensAnnotationIconFill{fill:#fff}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width: 768px) and (max-width: 991px){.lnsNavItem__goBack::after{border-right:1px solid #D3DAE6;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 992px) and (max-width: 1199px){.lnsNavItem__goBack::after{border-right:1px solid #D3DAE6;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width: 1200px){.lnsNavItem__goBack::after{border-right:1px solid #D3DAE6;bottom:0;content:'';display:block;pointer-events:none;position:absolute;right:-8px;top:0}}\n",""]),e.exports=t},,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"getDatatableRenderer",(function(){return _})),a.d(t,"getDatatableVisualization",(function(){return B})),a.d(t,"DatatableVisualization",(function(){return DatatableVisualization})),a.d(t,"supportedTypes",(function(){return ie})),a.d(t,"getMetricVisualization",(function(){return re})),a.d(t,"MetricVisualization",(function(){return MetricVisualization})),a.d(t,"getPieVisualization",(function(){return Ve})),a.d(t,"PieVisualization",(function(){return PieVisualization})),a.d(t,"visualizationTypes",(function(){return Re.visualizationTypes})),a.d(t,"getXyVisualization",(function(){return an})),a.d(t,"XyVisualization",(function(){return xy_visualization_XyVisualization})),a.d(t,"isBucketed",(function(){return jn})),a.d(t,"filterOperationsAxis",(function(){return On})),a.d(t,"isCellValueSupported",(function(){return kn})),a.d(t,"getHeatmapVisualization",(function(){return Tn})),a.d(t,"HeatmapVisualization",(function(){return HeatmapVisualization})),a.d(t,"isNumericMetric",(function(){return zn})),a.d(t,"isNumericDynamicMetric",(function(){return Bn})),a.d(t,"CHART_NAMES",(function(){return Vn})),a.d(t,"getGaugeVisualization",(function(){return Gn})),a.d(t,"GaugeVisualization",(function(){return gauge_GaugeVisualization})),a.d(t,"deleteColumn",(function(){return ns})),a.d(t,"columnToOperation",(function(){return Bc})),a.d(t,"getSuffixFormatter",(function(){return nr})),a.d(t,"unitSuffixesLong",(function(){return tr})),a.d(t,"suffixFormatterId",(function(){return ar})),a.d(t,"getIndexPatternDatasource",(function(){return Vc})),a.d(t,"createFormulaPublicApi",(function(){return Hc})),a.d(t,"IndexPatternDatasource",(function(){return indexpattern_datasource_IndexPatternDatasource})),a.d(t,"EditorFrame",(function(){return qc.a})),a.d(t,"initializeDatasources",(function(){return qc.d})),a.d(t,"getDatasourceLayers",(function(){return qc.b})),a.d(t,"persistedStateToExpression",(function(){return qc.e})),a.d(t,"getMissingIndexPattern",(function(){return qc.c})),a.d(t,"validateDatasourceAndVisualization",(function(){return qc.f})),a.d(t,"EditorFrameService",(function(){return service_EditorFrameService})),a.d(t,"Embeddable",(function(){return embeddable_Embeddable})),a.d(t,"getLensServices",(function(){return Od})),a.d(t,"mountApp",(function(){return kd})),a.d(t,"getLensAttributeService",(function(){return Td})),a.d(t,"setReportManager",(function(){return Ya.b})),a.d(t,"stopReportManager",(function(){return Ya.c})),a.d(t,"trackUiEvent",(function(){return Ya.e})),a.d(t,"trackSuggestionEvent",(function(){return Ya.d})),a.d(t,"LensReportManager",(function(){return Ya.a})),a.d(t,"SaveModalContainer",(function(){return bd.SaveModalContainer})),a.d(t,"runSaveLensVisualization",(function(){return bd.runSaveLensVisualization})),a.d(t,"removePinnedFilters",(function(){return bd.removePinnedFilters}));var n=a(21),i=a.n(n),l=a(6),s=a.n(l),r=a(36),o=a.n(r),u=a(0),c=a(32),d=a(33),p=(a(151),a(186)),m=a.n(p),g=a(7),f=a(52),b=(a(156),a(34)),h=a.n(b),x=a(2);function v({children:e,className:t,...a}){return Object(x.jsx)("div",i()({"data-test-subj":"lnsVisualizationContainer",className:h()(t,"lnsVisualizationContainer")},a),e)}var y=a(68);const j=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M11 18a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V7a1 1 0 011-1h10zm18-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h28z",className:"lensChartIcon__subdued"}),Object(x.jsx)("path",{d:"M20 18a1 1 0 011 1v2a1 1 0 01-.883.993L20 22h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 16h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 10h-5a1 1 0 01-1-1V7a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1V7a1 1 0 011-1h5z",className:"lensChartIcon__accent"}));var O=a(24),k=a(74),I=a(76);const T=s.a.createContext({}),F={border:"horizontal",header:"underline"},M=[10,20,30,50,100],w=e=>{var t,a,n;const[i]=Object.values(e.data.tables),s=e.interactive,[r,o]=Object(l.useState)({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection}),[c,d]=Object(l.useState)(i),[p,b]=Object(l.useState)(void 0);Object(l.useEffect)((()=>{var t;b(e.args.pageSize?{pageIndex:0,pageSize:null!==(t=e.args.pageSize)&&void 0!==t?t:10}:void 0)}),[e.args.pageSize]),m()((()=>{o({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection})}),[e.args.columns,e.args.sortingColumnId,e.args.sortingDirection]),m()((()=>{d(i)}),[i]);const w=Object(l.useRef)(c);w.current=c;const _=Object(l.useRef)(e.untransposedData);_.current=e.untransposedData;const C=null===(t=e.rowHasRowClickTriggerActions)||void 0===t?void 0:t.some((e=>e)),{getType:E,dispatchEvent:S,renderMode:P,formatFactory:A}=e,L=Object(l.useMemo)((()=>c.columns.reduce(((e,t)=>{var a;return{...e,[t.id]:A(null===(a=t.meta)||void 0===a?void 0:a.params)}}),{})),[c,A]),D=Object(l.useCallback)((e=>{S({name:"filter",data:e})}),[S]),N=Object(l.useCallback)((e=>{S({name:"edit",data:e})}),[S]),z=Object(l.useCallback)((e=>N({action:"pagesize",size:e})),[N]),B=Object(l.useCallback)((e=>{b((t=>{if(t)return{pageSize:null==t?void 0:t.pageSize,pageIndex:e}}))}),[b]),V=Object(l.useCallback)((e=>{S({name:"tableRowContextMenuClick",data:e})}),[S]),R=Object(l.useMemo)((()=>s?((e,t)=>(a,n,i,l,s=!1)=>{const r={negate:s,data:[{row:l,column:i,value:n,table:e.current}]};t(r)})(w,D):void 0),[w,D,s]),H=Object(l.useMemo)((()=>s?((e,t)=>(a,n=!1)=>{if(!t.current)return;const i=Object.values(t.current.tables)[0],l={negate:n,data:a.map((({originalBucketColumn:e,value:t})=>{const a=i.columns.findIndex((t=>t.id===e.id));return{row:i.rows.findIndex((a=>a[e.id]===t)),column:a,value:t,table:i}}))};e(l)})(D,_):void 0),[D,_,s]),G=Object(l.useMemo)((()=>r.columns.filter(((e,t)=>{var a,n,i;const l=w.current.columns[t];return(null==l||null===(a=l.meta)||void 0===a||null===(n=a.sourceParams)||void 0===n?void 0:n.type)&&"buckets"===(null===(i=E(l.meta.sourceParams.type))||void 0===i?void 0:i.type)})).map((e=>e.columnId))),[w,r,E]),q=0===c.rows.length||G.length&&i.rows.every((e=>G.every((t=>null==e[t])))),$=Object(l.useMemo)((()=>r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>e.columnId))),[r]),{sortingColumnId:W,sortingDirection:U}=e.args,Y="edit"!==P,K=Object(l.useMemo)((()=>((e,t,a)=>n=>{const i=Object(O.c)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,width:n.width}:e))}),a({action:"resize",columnId:i,width:n.width})})(r,o,N)),[N,o,r]),X=Object(l.useMemo)((()=>s?((e,t,a)=>n=>{const i=Object(O.c)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,hidden:!0}:e))}),a({action:"toggle",columnId:i})})(r,o,N):void 0),[N,o,r,s]),Z=Object(l.useMemo)((()=>{const e={};for(const a of c.columns){var t;e[a.id]="number"===a.meta.type&&null!=a.meta.field||null==a.meta.field&&"number"==typeof(null===(t=c.rows.find((e=>null!=e[a.id])))||void 0===t?void 0:t[a.id])}return e}),[c]),Q=Object(l.useMemo)((()=>{const e={};return r.columns.forEach((t=>{t.alignment?e[t.columnId]=t.alignment:e[t.columnId]=Z[t.columnId]?"right":"left"})),e}),[r,Z]),J=Object(l.useMemo)((()=>Object(y.q)(r.columns.filter((({columnId:e})=>Z[e])).map((({columnId:e})=>e)),i,O.c)),[i,Z,r]),ee=null!==(a=e.args.headerRowHeight)&&void 0!==a?a:"single",te=null!==(n=e.args.headerRowHeightLines)&&void 0!==n?n:1,ae=Object(l.useMemo)((()=>((e,t,a,n,i,l,s,r,o,c,d,p,m)=>{const g=t.columns.reduce(((e,{id:t,name:a,meta:n},i)=>(e[t]={name:a,index:i,meta:n},e)),{}),f=new Set(e),b=({rowIndex:e,columnId:a})=>{var n;const i=t.rows[e][a],l=null==g?void 0:g[a];return{rowValue:i,contentsIsDefined:null!=i,cellContent:r(null==l||null===(n=l.meta)||void 0===n?void 0:n.params).convert(i)}};return s.map((e=>{const t=f.has(e),{name:r,index:h}=g[e],v=t&&a?[({rowIndex:t,columnId:n,Component:i,closePopover:l})=>{const{rowValue:s,contentsIsDefined:r,cellContent:o}=b({rowIndex:t,columnId:n}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueText",{defaultMessage:"Filter for value"}),d=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueAriaLabel",{defaultMessage:"Filter for value: {cellContent}",values:{cellContent:o}});return r&&Object(x.jsx)(i,{"aria-label":d,"data-test-subj":"lensDatatableFilterFor",onClick:()=>{a(e,s,h,t),null==l||l()},iconType:"plusInCircle"},c)},({rowIndex:t,columnId:n,Component:i,closePopover:l})=>{const{rowValue:s,contentsIsDefined:r,cellContent:o}=b({rowIndex:t,columnId:n}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueText",{defaultMessage:"Filter out value"}),d=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueAriaLabel",{defaultMessage:"Filter out value: {cellContent}",values:{cellContent:o}});return r&&Object(x.jsx)(i,{"data-test-subj":"lensDatatableFilterOut","aria-label":d,onClick:()=>{a(e,s,h,t,!0),null==l||l()},iconType:"minusInCircle"},c)}]:void 0,y=l.columns.find((({columnId:t})=>t===e)),j=Boolean(null==y?void 0:y.originalColumnId),O=null==y?void 0:y.width,k=null==y?void 0:y.hidden,I=null==y?void 0:y.originalColumnId,T=[];if(T.push({color:"text",size:"xs",onClick:()=>o({columnId:I||e,width:void 0}),iconType:"empty",label:u.i18n.translate("xpack.lens.table.resize.reset",{defaultMessage:"Reset width"}),"data-test-subj":"lensDatatableResetWidth",isDisabled:null==O}),!j&&c&&T.push({color:"text",size:"xs",onClick:()=>c({columnId:I||e}),iconType:"eyeClosed",label:u.i18n.translate("xpack.lens.table.hide.hideLabel",{defaultMessage:"Hide"}),"data-test-subj":"lensDatatableHide",isDisabled:!k&&s.length<=1}),!i&&j&&null!=y&&y.bucketValues&&n){const e=null==y?void 0:y.bucketValues;T.push({color:"text",size:"xs",onClick:()=>n(e,!1),iconType:"plusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterForValueText",{defaultMessage:"Filter for column"}),"data-test-subj":"lensDatatableHide"}),T.push({color:"text",size:"xs",onClick:()=>n(e,!0),iconType:"minusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterOutValueText",{defaultMessage:"Filter out column"}),"data-test-subj":"lensDatatableHide"})}const F=d&&d[e],M="auto"===p||"custom"===p,w=Object(x.css)({..."custom"===p&&{WebkitLineClamp:m},...M&&{whiteSpace:"normal",display:"-webkit-box",WebkitBoxOrient:"vertical"},textAlign:F},"",""),_={id:e,cellActions:v,display:Object(x.jsx)("div",{css:w},r),displayAsText:r,actions:{showHide:!1,showMoveLeft:!1,showMoveRight:!1,showSortAsc:{label:u.i18n.translate("xpack.lens.table.sort.ascLabel",{defaultMessage:"Sort ascending"})},showSortDesc:{label:u.i18n.translate("xpack.lens.table.sort.descLabel",{defaultMessage:"Sort descending"})},additional:T}};return O&&(_.initialWidth=O),_}))})(G,c,R,H,Y,r,$,A,K,X,Q,ee,te)),[G,c,R,H,Y,r,$,A,K,X,Q,ee,te]),ne=Object(l.useMemo)((()=>C&&V&&s?[{headerCellRender:()=>null,width:40,id:"trailingControlColumn",rowCellRender:function({rowIndex:e}){const{rowHasRowClickTriggerActions:t}=Object(l.useContext)(T);return Object(x.jsx)(g.EuiButtonIcon,{"aria-label":u.i18n.translate("xpack.lens.table.actionsLabel",{defaultMessage:"Show actions"}),iconType:t&&!t[e]?"empty":"boxesVertical",color:"text",onClick:()=>{V({rowIndex:e,table:w.current,columns:r.columns.map((e=>e.columnId))})}})}}]:[]),[w,V,r,C,s]),ie=Object(l.useMemo)((()=>((e,t,a,n,i,s)=>{const r=n.get("theme:darkMode");return({rowIndex:n,columnId:o,setCellProps:u})=>{var c,d;const{table:p,alignments:m,minMaxByColumnId:g,getColorForValue:f}=Object(l.useContext)(a),b=null==p||null===(c=p.rows[n])||void 0===c?void 0:c[o],v=null===(d=e[o])||void 0===d?void 0:d.convert(b,"html"),y=`lnsTableCell--${m&&m[o]}`,j=h()(y,{lnsTableCell:!i&&1===s}),{colorMode:I,palette:T}=t.columns.find((({columnId:e})=>e===o))||{};return Object(l.useEffect)((()=>{const e=Object(O.c)(o);if(null!=g&&g[e]&&"none"!==I&&null!=T&&T.params&&f){const t=f(Object(k.g)(b),T.params,g[e]);if(t){const e={["cell"===I?"backgroundColor":"color"]:t};"cell"===I&&t&&(e.color=Object(k.d)(t,r)),u({style:e})}}return()=>{null!=g&&g[e]&&u({style:{backgroundColor:void 0,color:void 0}})}}),[b,o,u,I,T,g,f]),Object(x.jsx)("div",{dangerouslySetInnerHTML:{__html:v},"data-test-subj":"lnsTableCellContent",className:j})}})(L,r,T,e.uiSettings,e.args.fitRowToContent,e.args.rowHeightLines)),[L,r,e.uiSettings,e.args.fitRowToContent,e.args.rowHeightLines]),le=Object(l.useMemo)((()=>({visibleColumns:$,setVisibleColumns:()=>{}})),[$]),se=Object(l.useMemo)((()=>((e,t,a)=>({columns:e&&"none"!==t?[{id:e,direction:t}]:[],onSort:t=>{const n=t.length<=1?t[0]:t[1],i=e!==((null==n?void 0:n.id)||""),l=n?n.direction:"none";return a({action:"sort",columnId:"none"!==l||i?null==n?void 0:n.id:void 0,direction:l})}}))(W,U,N)),[N,W,U]),re=Object(l.useMemo)((()=>{const e=r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>({columnId:e.columnId,summaryRowValue:e.summaryRowValue,...Object(O.b)(e.columnId,e,i)}))).filter((({summaryRow:e})=>"none"!==e));if(e.length){const t=Object.fromEntries(e.map((({summaryRowValue:e,summaryLabel:t,columnId:a})=>[a,""===t?`${e}`:`${t}: ${e}`])));return({columnId:e})=>{var a,n;const i=`lnsTableCell--${Q&&Q[e]}`,l=(null===(a=ae.find((({id:t})=>t===e)))||void 0===a||null===(n=a.displayAsText)||void 0===n?void 0:n.replace(/ /g,"-"))||e;return null!=t[e]?Object(x.jsx)("div",{className:`lnsTableCell ${i}`,"data-test-subj":`lnsDataTable-footer-${l}`},t[e]):null}}}),[r.columns,Q,i,ae]);if(q)return Object(x.jsx)(v,{className:"lnsDataTableContainer"},Object(x.jsx)(f.EmptyPlaceholder,{icon:j}));const oe=e.args.title||u.i18n.translate("xpack.lens.table.defaultAriaLabel",{defaultMessage:"Data table visualization"});return Object(x.jsx)(v,{className:"lnsDataTableContainer"},Object(x.jsx)(T.Provider,{value:{table:c,rowHasRowClickTriggerActions:e.rowHasRowClickTriggerActions,alignments:Q,minMaxByColumnId:J,getColorForValue:e.paletteService.get(I.a).getColorForValue}},Object(x.jsx)(g.EuiDataGrid,{"aria-label":oe,"data-test-subj":"lnsDataTable",rowHeightsOptions:{defaultHeight:e.args.fitRowToContent?"auto":e.args.rowHeightLines?{lineCount:e.args.rowHeightLines}:void 0},columns:ae,columnVisibility:le,trailingControlColumns:ne,rowCount:c.rows.length,renderCellValue:ie,gridStyle:F,sorting:se,pagination:p&&{...p,pageSizeOptions:M,onChangeItemsPerPage:z,onChangePage:B},onColumnResize:K,toolbarVisibility:!1,renderFooterCellValue:re})))},_=e=>({name:"lens_datatable_renderer",displayName:u.i18n.translate("xpack.lens.datatable.visualizationName",{defaultMessage:"Datatable"}),help:"",validate:()=>{},reuseDomNode:!0,render:async(t,a,n)=>{const l=await e.getType,{hasCompatibleActions:s,isInteractive:r}=n;let u=[];if(s){const e=Object.values(a.data.tables)[0];e&&(u=await Promise.all(e.rows.map((async(t,n)=>{try{return await s({name:"tableRowContextMenuClick",data:{rowIndex:n,table:e,columns:a.args.columns.map((e=>e.columnId))}})}catch{return!1}}))))}o.a.render(Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(w,i()({},a,{formatFactory:e.formatFactory,dispatchEvent:n.event,renderMode:n.getRenderMode(),paletteService:e.paletteService,getType:l,rowHasRowClickTriggerActions:u,interactive:r(),uiSettings:e.uiSettings})))),t,(()=>{n.done()})),n.onDestroy((()=>o.a.unmountComponentAtNode(t)))}});a(188);const C=Object(g.htmlIdGenerator)()();function E(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function S(e){var t,a;const{state:n,setState:i,frame:r,accessor:o}=e,c=n.columns.find((({columnId:e})=>o===e)),[d,p]=Object(l.useState)(!1),m=Object(l.useCallback)((e=>{i({...n,columns:E(n,o,{summaryLabel:e})})}),[o,i,n]),{inputValue:f,handleInputChange:b}=Object(y.t)({onChange:m,value:null==c?void 0:c.summaryLabel},{allowFalsyValue:!0});if(!c)return null;if(c.isTransposed)return null;const h=null===(t=r.activeData)||void 0===t?void 0:t[n.layerId],v=Object(O.e)(h,o),j=(null==c?void 0:c.alignment)||(v?"right":"left"),k=(null==c?void 0:c.colorMode)||"none",I="none"!==k,{summaryRow:T,summaryLabel:F}=Object(O.b)(o,c,h),M=r.datasourceLayers[n.layerId],w=Boolean(v&&!(null!=M&&null!==(a=M.getOperationForColumnId(o))&&void 0!==a&&a.isBucketed)),_=n.columns.filter((e=>!e.hidden)).length,S=n.columns.some((({isTransposed:e})=>e))?(null==h?void 0:h.columns.filter((({id:e})=>Object(O.c)(e)===o)).map((({id:e})=>e)))||[]:[o],P=Object(y.q)(S,h,O.c)[o],A=(null==c?void 0:c.palette)||{type:"palette",name:y.p.name},L=Object(y.o)(e.paletteService,A,P);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"})},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"}),"data-test-subj":"lnsDatatable_alignment_groups",name:"alignment",buttonSize:"compressed",options:[{id:`${C}left`,label:u.i18n.translate("xpack.lens.table.alignment.left",{defaultMessage:"Left"}),"data-test-subj":"lnsDatatable_alignment_groups_left"},{id:`${C}center`,label:u.i18n.translate("xpack.lens.table.alignment.center",{defaultMessage:"Center"}),"data-test-subj":"lnsDatatable_alignment_groups_center"},{id:`${C}right`,label:u.i18n.translate("xpack.lens.table.alignment.right",{defaultMessage:"Right"}),"data-test-subj":"lnsDatatable_alignment_groups_right"}],idSelected:`${C}${j}`,onChange:e=>{const t=e.replace(C,"");i({...n,columns:E(n,o,{alignment:t})})}})),!c.isTransposed&&Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),display:"columnCompressedSwitch"},Object(x.jsx)(g.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),showLabel:!1,"data-test-subj":"lns-table-column-hidden",checked:Boolean(null==c?void 0:c.hidden),disabled:!c.hidden&&_<=1,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===o?{...e,hidden:!c.hidden}:e))};i(e)}})),v&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.label",{defaultMessage:"Summary Row"}),display:"columnCompressed"},Object(x.jsx)(g.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lnsDatatable_summaryrow_function",placeholder:u.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:Object(O.d)(),selectedOptions:[{label:Object(O.a)(T),value:T}],singleSelection:{asPlainText:!0},onChange:e=>{const t=e[0].value;i({...n,columns:E(n,o,{summaryRow:t})})}})),"none"!==T&&Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.customlabel",{defaultMessage:"Summary label"})},Object(x.jsx)(g.EuiFieldText,{compressed:!0,"data-test-subj":"lnsDatatable_summaryrow_label",value:null!=f?f:F,onChange:e=>{b(e.target.value)}}))),w&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${C}none`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_none"},{id:`${C}cell`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.cell",{defaultMessage:"Cell"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_cell"},{id:`${C}text`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_text"}],idSelected:`${C}${k}`,onChange:e=>{const t=e.replace(C,""),a={colorMode:t};null!=c&&c.palette||"none"===t||(a.palette={...A,params:{...A.params,stops:L}}),null!=c&&c.palette&&"none"===t&&(a.palette=void 0),i({...n,columns:E(n,o,a)})}})),I&&Object(x.jsx)(g.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteTableGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiColorPaletteDisplay,{"data-test-subj":"lnsDatatable_dynamicColoring_palette",palette:L.map((({color:e})=>e)),type:y.e,onClick:()=>{p(!d)}})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonEmpty,{"data-test-subj":"lnsDatatable_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:()=>{p(!d)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(y.h,{siblingRef:e.panelRef,isOpen:d,handleClose:()=>p(!d)},Object(x.jsx)(y.c,{palettes:e.paletteService,activePalette:A,dataBounds:P,setPalette:e=>{i({...n,columns:E(n,o,{palette:e})})}})))))))}var P=a(11),A=a(8);const L=Object(g.htmlIdGenerator)()();function D(e){const{label:t,rowHeight:a,rowHeightLines:n,onChangeRowHeight:i,onChangeRowHeightLines:l,maxRowHeight:r}=e,o=[{id:`${L}single`,label:u.i18n.translate("xpack.lens.table.rowHeight.single",{defaultMessage:"Single"}),"data-test-subj":"lnsDatatable_rowHeight_single"},{id:`${L}auto`,label:u.i18n.translate("xpack.lens.table.rowHeight.auto",{defaultMessage:"Auto fit"}),"data-test-subj":"lnsDatatable_rowHeight_auto"},{id:`${L}custom`,label:u.i18n.translate("xpack.lens.table.rowHeight.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsDatatable_rowHeight_custom"}];return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{label:t,display:"columnCompressed","data-test-subj":e["data-test-subj"]},Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:t,name:"legendLocation",buttonSize:"compressed",options:o,idSelected:`${L}${null!=a?a:"single"}`,onChange:e=>{const t=e.replace(L,"");i(t)}}),"custom"===a?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSpacer,{size:"xs"}),Object(x.jsx)(g.EuiRange,{compressed:!0,fullWidth:!0,showInput:!0,min:1,max:null!=r?r:20,step:1,value:null!=n?n:2,onChange:e=>{const t=Number(e.currentTarget.value);l(t)},"data-test-subj":"lens-table-row-height-lineCountNumber"})):null)))}function N(e){var t;const{state:a,setState:n}=e,i=Object(l.useCallback)(((e,t,i)=>{const l="single"===e?1:"auto"!==e?2:void 0;n({...a,[t]:e,[i]:l})}),[n,a]),s=Object(l.useCallback)(((e,t)=>{n({...a,[t]:e})}),[n,a]),r=Object(l.useCallback)((()=>{var e;const t=null!==(e=a.paging)&&void 0!==e?e:{size:10,enabled:!1};n({...a,paging:{...t,enabled:!t.enabled}})}),[n,a]);return Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.table.valuesVisualOptions",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(x.jsx)(D,{rowHeight:a.headerRowHeight,rowHeightLines:a.headerRowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsHeaderRowHeightLabel",{defaultMessage:"Header row height"}),onChangeRowHeight:e=>i(e,"headerRowHeight","headerRowHeightLines"),onChangeRowHeightLines:e=>{s(e,"headerRowHeightLines")},"data-test-subj":"lnsHeaderHeightSettings",maxRowHeight:5}),Object(x.jsx)(D,{rowHeight:a.rowHeight,rowHeightLines:a.rowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsFitRowToContentLabel",{defaultMessage:"Cell row height"}),onChangeRowHeight:e=>i(e,"rowHeight","rowHeightLines"),onChangeRowHeightLines:e=>{s(e,"rowHeightLines")},"data-test-subj":"lnsRowHeightSettings"}),Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTable",{defaultMessage:"Paginate table"}),display:"columnCompressedSwitch"},Object(x.jsx)(g.EuiToolTip,{content:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTableTooltip",{defaultMessage:"Pagination is hidden if there are less than 10 items"}),position:"right"},Object(x.jsx)(g.EuiSwitch,{compressed:!0,"data-test-subj":"lens-table-pagination-switch",label:"",showLabel:!1,checked:Boolean(null===(t=a.paging)||void 0===t?void 0:t.enabled),onChange:r})))))}const z=u.i18n.translate("xpack.lens.datatable.label",{defaultMessage:"Table"}),B=({paletteService:e,theme:t})=>({id:"lnsDatatable",visualizationTypes:[{id:"lnsDatatable",icon:j,label:z,groupLabel:u.i18n.translate("xpack.lens.datatable.groupLabel",{defaultMessage:"Tabular"}),sortPriority:5}],getVisualizationTypeId:()=>"lnsDatatable",getLayerIds:e=>[e.layerId],clearLayer:e=>({...e,columns:[]}),getDescription:()=>({icon:j,label:z}),switchVisualizationType:(e,t)=>t,triggers:[A.VIS_EVENT_TO_TRIGGER.filter,A.VIS_EVENT_TO_TRIGGER.tableRowContextMenuClick],initialize:(e,t)=>t||{columns:[],layerId:e(),layerType:P.o.DATA},getSuggestions({table:e,state:t,keptLayerIds:a}){if(a.length>1||a.length&&e.layerId!==a[0]||t&&"unchanged"===e.changeType||e.columns.some((e=>e.operation.isStaticValue)))return[];const n={};t&&t.columns.forEach((e=>{n[e.columnId]=e}));const i=e.columns.findIndex((e=>{var t;return!(!n[e.columnId]||null!==(t=n[e.columnId])&&void 0!==t&&t.isTransposed)})),l=null==t?void 0:t.columns.some((e=>e.isTransposed));return[{title:"unchanged"===e.changeType?u.i18n.translate("xpack.lens.datatable.suggestionLabel",{defaultMessage:"As table"}):u.i18n.translate("xpack.lens.datatable.visualizationOf",{defaultMessage:"Table {operations}",values:{operations:e.label||e.columns.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.datatable.conjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."}))}}),score:Math.min(e.columns.length,10)/10*.4,state:{...t||{},layerId:e.layerId,layerType:P.o.DATA,columns:e.columns.map(((e,t)=>({...n[e.columnId]||{},isTransposed:l&&t<i,columnId:e.columnId})))},previewIcon:j,hide:!0}]},getConfiguration({state:e,frame:t,layerId:a}){const{sortedColumns:n,datasource:i}=V(e,t.datasourceLayers)||{},l={};return e.columns.forEach((e=>{l[e.columnId]=e})),n?{groups:[{groupId:"rows",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRows",{defaultMessage:"Rows"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownRows.description",{defaultMessage:"Split table rows by field. This is recommended for high cardinality breakdowns."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n;return(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&!(null!==(n=e.columns.find((e=>e.columnId===t)))&&void 0!==n&&n.isTransposed)})).map((e=>({columnId:e,triggerIcon:l[e].hidden?"invisible":void 0}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_rows",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:1},{groupId:"columns",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Columns"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownColumns.description",{defaultMessage:"Split metric columns by field. It's recommended to keep the number of columns low to avoid horizontal scrolling."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n;return(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&(null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.isTransposed)})).map((e=>({columnId:e}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_columns",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:0},{groupId:"metrics",groupLabel:u.i18n.translate("xpack.lens.datatable.metrics",{defaultMessage:"Metrics"}),layerId:e.layerId,accessors:n.filter((e=>{var t;return!(null!==(t=i.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).map((e=>{var t,a;const n=l[e],i=null===(t=n.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops,s=Boolean("none"!==n.colorMode&&i);return{columnId:e,triggerIcon:n.hidden?"invisible":s?"colorBy":void 0,palette:s&&i?i.map((({color:e})=>e)):void 0}})),supportsMoreColumns:!0,filterOperations:e=>!e.isBucketed,required:!0,dataTestSubj:"lnsDatatable_metrics",enableDimensionEditor:!0}]}:{groups:[]}},setDimension:({prevState:e,columnId:t,groupId:a,previousColumn:n})=>e.columns.some((e=>e.columnId===t||n&&e.columnId===n))?{...e,columns:e.columns.map((e=>e.columnId===t||e.columnId===n?{...e,columnId:t,isTransposed:"columns"===a}:e))}:{...e,columns:[...e.columns,{columnId:t,isTransposed:"columns"===a}]},removeDimension({prevState:e,columnId:t}){var a;return{...e,columns:e.columns.filter((e=>e.columnId!==t)),sorting:(null===(a=e.sorting)||void 0===a?void 0:a.columnId)===t?void 0:e.sorting}},renderDimensionEditor(a,n){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(S,i()({},n,{paletteService:e})))),a)},getSupportedLayers:()=>[{type:P.o.DATA,label:u.i18n.translate("xpack.lens.datatable.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,{title:n,description:i}={}){var l,s,r,o,u,c;const{sortedColumns:d,datasource:p}=V(t,a,t.layerId)||{};if(null!=d&&d.length&&0===d.filter((e=>{var t;return!(null!==(t=p.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).length)return null;const m={};return t.columns.forEach((e=>{m[e.columnId]=e})),{type:"expression",chain:[{type:"function",function:"lens_datatable",arguments:{title:[n||""],description:[i||""],columns:d.filter((e=>p.getOperationForColumnId(e))).map((e=>m[e])).map((t=>{var a,n,i,l,s,r,o,u,c,d;const m={...null===(a=t.palette)||void 0===a?void 0:a.params,colors:((null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null===(l=t.palette)||void 0===l||null===(s=l.params)||void 0===s?void 0:s.name)?((null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.stops)||[]).map((({stop:e})=>e)):[],reverse:!1},g=p.getOperationForColumnId(t.columnId).sortingHint,f=null==t.summaryRow||"none"===t.summaryRow,b="number"===(null===(u=p.getOperationForColumnId(t.columnId))||void 0===u?void 0:u.dataType);return{type:"expression",chain:[{type:"function",function:"lens_datatable_column",arguments:{columnId:[t.columnId],hidden:void 0===t.hidden?[]:[t.hidden],width:void 0===t.width?[]:[t.width],isTransposed:void 0===t.isTransposed?[]:[t.isTransposed],transposable:[!(null!==(c=p.getOperationForColumnId(t.columnId))&&void 0!==c&&c.isBucketed)],alignment:void 0===t.alignment?[]:[t.alignment],colorMode:[b&&t.colorMode?t.colorMode:"none"],palette:[e.get(I.a).toExpression(m)],summaryRow:f?[]:[t.summaryRow],summaryLabel:f?[]:[null!==(d=t.summaryLabel)&&void 0!==d?d:Object(O.a)(t.summaryRow)],sortingHint:g?[g]:[]}}]}})),sortingColumnId:[(null===(l=t.sorting)||void 0===l?void 0:l.columnId)||""],sortingDirection:[(null===(s=t.sorting)||void 0===s?void 0:s.direction)||"none"],fitRowToContent:["auto"===t.rowHeight],headerRowHeight:[null!==(r=t.headerRowHeight)&&void 0!==r?r:"single"],rowHeightLines:[t.rowHeight&&"single"!==t.rowHeight?null!==(o=t.rowHeightLines)&&void 0!==o?o:2:1],headerRowHeightLines:[t.headerRowHeight&&"single"!==t.headerRowHeight?null!==(u=t.headerRowHeightLines)&&void 0!==u?u:2:1],pageSize:null!==(c=t.paging)&&void 0!==c&&c.enabled?[t.paging.size]:[]}}]}},getErrorMessages(e){},renderToolbar(e,a){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(N,a))),e)},onEditAction(e,t){var a;switch(t.data.action){case"sort":return{...e,sorting:{columnId:t.data.columnId,direction:t.data.direction}};case"toggle":const n=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===n?{...e,hidden:!e.hidden}:e))};case"resize":const i=t.data.width,l=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===l?{...e,width:i}:e))};case"pagesize":return{...e,paging:{enabled:(null===(a=e.paging)||void 0===a?void 0:a.enabled)||!1,size:t.data.size}};default:return e}}});function V(e,t,a){const n=t[e.layerId],i=n.getTableSpec().map((({columnId:e})=>e));return{datasource:n,sortedColumns:Array.from(new Set(i.concat(e.columns.map((({columnId:e})=>e)))))}}class DatatableVisualization{setup(e,{expressions:t,formatFactory:n,editorFrame:i,charts:l}){i.registerVisualization((async()=>{const{getDatatableRenderer:i,getDatatableVisualization:s}=await Promise.resolve().then(a.bind(null,433)),r=await l.palettes.getPalettes();return t.registerRenderer((()=>i({formatFactory:n,theme:e.theme,getType:e.getStartServices().then((([e,{data:t}])=>t.search.aggs.types.get)),paletteService:r,uiSettings:e.uiSettings}))),s({paletteService:r,theme:e.theme})}))}}var R=a(40),H=a(39);const G=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M25 0a1 1 0 011 1v14a1 1 0 01-1 1H5a1 1 0 01-1-1V1a1 1 0 011-1h20zm-9.878 3c-1.887 0-3.265 1.107-3.26 2.61-.005 1.054.67 1.938 1.672 2.157v.067l-.155.03a2.453 2.453 0 00-1.879 2.394C11.495 11.84 12.997 13 15.122 13c2.105 0 3.612-1.16 3.617-2.742-.005-1.217-.903-2.234-2.035-2.424v-.067l.162-.042c.896-.275 1.507-1.12 1.511-2.116C18.373 4.112 16.994 3 15.122 3zm0 5.542c1.036 0 1.796.665 1.806 1.592-.01.898-.718 1.507-1.806 1.507-1.103 0-1.816-.609-1.806-1.507-.01-.932.755-1.592 1.806-1.592zm0-4.164c.908 0 1.53.561 1.54 1.398-.01.85-.651 1.43-1.54 1.43-.903 0-1.55-.584-1.54-1.43-.01-.837.618-1.398 1.54-1.398z",className:"lensChartIcon__accent"}),Object(x.jsx)("path",{d:"M1 18h28a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1z",className:"lensChartIcon__subdued"}));function q({table:e,state:t,keptLayerIds:a}){return e.isMultiRow||a.length>1||a.length&&e.layerId!==a[0]||1!==e.columns.length||e.columns[0].operation.isBucketed||!ie.has(e.columns[0].operation.dataType)||e.columns[0].operation.isStaticValue||t&&"unchanged"===e.changeType?[]:[$(e)]}function $(e){const t=e.columns[0];return{title:e.label||t.operation.label,score:.1,previewIcon:G,state:{layerId:e.layerId,accessor:t.columnId,layerType:P.o.DATA}}}const W={...y.p,maxSteps:5,name:"status",rangeType:"number",steps:3};a(193);const U=Object(g.htmlIdGenerator)()();function Y(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(l.useState)(!1),d=Object(l.useCallback)((()=>{c(!o)}),[o]),p=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[m]=(null==p?void 0:p.rows)||[];if(null==r||null==m||!Object(O.e)(p,r))return null;const f=(null==a?void 0:a.colorMode)||H.ColorMode.None,b=f!==H.ColorMode.None,h={min:Math.min(2*m[r],0===m[r]?-50:0),max:Math.max(2*m[r],0===m[r]?100:0)},v=(null==a?void 0:a.palette)||{type:"palette",name:W.name,params:{...W,stops:void 0,colorStops:void 0,rangeMin:h.min,rangeMax:3*h.max/4}},j=Object(y.o)(e.paletteService,v,h);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.metric.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsMetric_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${U}None`,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_dynamicColoring_groups_none"},{id:`${U}Background`,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.background",{defaultMessage:"Fill"}),"data-test-subj":"lnsMetric_dynamicColoring_groups_background"},{id:`${U}Labels`,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsMetric_dynamicColoring_groups_labels"}],idSelected:`${U}${f}`,onChange:e=>{const t=e.replace(U,""),i={colorMode:t};null!=a&&a.palette||t===H.ColorMode.None||(i.palette={...v,params:{...v.params,stops:j.map(((e,t,a)=>({...e,stop:h.min+(0===t?0:a[t-1].stop)})))}}),null!=a&&a.palette&&t===H.ColorMode.None&&(i.palette=void 0),n({...a,...i})}})),b&&Object(x.jsx)(g.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiColorPaletteDisplay,{"data-test-subj":"lnsMetric_dynamicColoring_palette",palette:j.map((({color:e})=>e)),type:y.e,onClick:d})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonEmpty,{"data-test-subj":"lnsMetric_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:d,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(y.h,{siblingRef:e.panelRef,isOpen:o,handleClose:d},Object(x.jsx)(y.c,{palettes:e.paletteService,activePalette:v,dataBounds:h,setPalette:e=>{e.name!==y.b&&e.params&&e.params.rangeMin!==h.min&&(e.params.rangeMin=h.min),n({...a,palette:e})},showRangeTypeSelector:!1}))))))}const K=[{id:"top",label:"Top"},{id:"bottom",label:"Bottom"}],X=({state:e,setState:t})=>{var a;return Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(x.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.metricChart.titlePositionLabel",{defaultMessage:"Title position"}))},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,"data-test-subj":"lnsMissingValuesSelect",legend:"This is a basic group",options:K,idSelected:null!==(a=e.titlePosition)&&void 0!==a?a:"bottom",onChange:a=>{t({...e,titlePosition:a})},buttonSize:"compressed"}))},Z=[{id:"xs",label:u.i18n.translate("xpack.lens.metricChart.metricSize.extraSmall",{defaultMessage:"XS"})},{id:"s",label:u.i18n.translate("xpack.lens.metricChart.metricSize.small",{defaultMessage:"S"})},{id:"m",label:u.i18n.translate("xpack.lens.metricChart.metricSize.medium",{defaultMessage:"M"})},{id:"l",label:u.i18n.translate("xpack.lens.metricChart.metricSize.large",{defaultMessage:"L"})},{id:"xl",label:u.i18n.translate("xpack.lens.metricChart.metricSize.extraLarge",{defaultMessage:"XL"})},{id:"xxl",label:u.i18n.translate("xpack.lens.metricChart.metricSize.xxl",{defaultMessage:"XXL"})}],Q=({state:e,setState:t})=>{var a;const n=Z.findIndex((t=>t.id===(e.size||"xl"))),i=a=>{t({...e,size:Z[n+a].id})};return Object(x.jsx)(g.EuiSuperSelect,{append:Object(x.jsx)(g.EuiButtonIcon,{iconType:"plus",onClick:()=>i(1),isDisabled:n===Z.length-1}),prepend:Object(x.jsx)(g.EuiButtonIcon,{iconType:"minus",onClick:()=>i(-1),isDisabled:0===n}),"data-test-subj":"lnsMetricSizeSelect",compressed:!0,options:Z.map((e=>({value:e.id,dropdownDisplay:e.label,inputDisplay:e.label}))),valueOfSelected:null!==(a=e.size)&&void 0!==a?a:"xl",onChange:a=>{t({...e,size:a})},itemLayoutAlign:"top",hasDividers:!0,fullWidth:!0})},J=[{id:"left",label:u.i18n.translate("xpack.lens.metricChart.alignLabel.left",{defaultMessage:"Align left"}),iconType:"editorAlignLeft"},{id:"center",label:u.i18n.translate("xpack.lens.metricChart.alignLabel.center",{defaultMessage:"Align center"}),iconType:"editorAlignCenter"},{id:"right",label:u.i18n.translate("xpack.lens.metricChart.alignLabel.right",{defaultMessage:"Align right"}),iconType:"editorAlignRight"}],ee=({state:e,setState:t})=>{var a;return Object(x.jsx)(g.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.metricChart.titleAlignLabel",{defaultMessage:"Align"}),options:J,idSelected:null!==(a=e.textAlign)&&void 0!==a?a:"center",onChange:a=>{t({...e,textAlign:a})},isIconOnly:!0,buttonSize:"compressed"})},te=({state:e,setState:t})=>Object(x.jsx)(g.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:Object(x.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.metricChart.textFormattingLabel",{defaultMessage:"Text formatting"}))},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",responsive:!1},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(Q,{state:e,setState:t})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(ee,{state:e,setState:t})))),ae=({state:e,setState:t})=>Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.shared.AppearanceLabel",{defaultMessage:"Appearance"}),condition:!0},Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.shared.metric.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsMetricAppearanceButton"},Object(x.jsx)(te,{state:e,setState:t}),Object(x.jsx)(X,{state:e,setState:t}))),ne=Object(l.memo)((function(e){const{state:t,setState:a,frame:n}=e;return Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"m",justifyContent:"spaceBetween",responsive:!1},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(x.jsx)(ae,{state:t,setState:a,datasourceLayers:n.datasourceLayers}))))})),ie=(Object(g.htmlIdGenerator)()(),new Set(["string","boolean","number","ip","date"])),le=e=>{const[t,a]=e.split(/(\d+)/).filter(Boolean);return{size:Number(t),sizeUnit:a}},se=(e,t,a,n)=>{var i,l,s,r,o,u,c,d,p;if(!t.accessor)return null;const[m]=Object.values(a),g=m&&m.getOperationForColumnId(t.accessor),f=(null===(i=t.palette)||void 0===i||null===(l=i.params)||void 0===l?void 0:l.stops)||[],b=(null===(s=t.palette)||void 0===s||null===(r=s.params)||void 0===r?void 0:r.name)===y.b,h="number"===(null==g?void 0:g.dataType),x={...null===(o=t.palette)||void 0===o?void 0:o.params,colors:f.map((({color:e})=>e)),stops:b||null==(null===(u=t.palette)||void 0===u||null===(c=u.params)||void 0===c?void 0:c.rangeMax)?f.map((({stop:e})=>e)):Object(y.r)(f,Math.max(null===(d=t.palette)||void 0===d||null===(p=d.params)||void 0===p?void 0:p.rangeMax,...f.map((({stop:e})=>e)))).map((({stop:e})=>e)),reverse:!1},v={xs:le(R.euiThemeVars.euiFontSizeXS),s:le(R.euiThemeVars.euiFontSizeS),m:le(R.euiThemeVars.euiFontSizeM),l:le(R.euiThemeVars.euiFontSizeL),xl:le(R.euiThemeVars.euiFontSizeXL),xxl:le(R.euiThemeVars.euiFontSizeXXL)},j=v[(null==t?void 0:t.size)||"xl"],O={xs:2*v.xs.size,s:2.5*v.m.size,m:2.5*v.l.size,l:2.5*v.xl.size,xl:2.5*v.xxl.size,xxl:3*v.xxl.size}[(null==t?void 0:t.size)||"xl"];return{type:"expression",chain:[{type:"function",function:"metricVis",arguments:{labelPosition:[(null==t?void 0:t.titlePosition)||"bottom"],font:[{type:"expression",chain:[{type:"function",function:"font",arguments:{align:[(null==t?void 0:t.textAlign)||"center"],size:[O],weight:["600"],lHeight:[1.5*O],sizeUnit:[j.sizeUnit]}}]}],labelFont:[{type:"expression",chain:[{type:"function",function:"font",arguments:{align:[(null==t?void 0:t.textAlign)||"center"],size:[j.size],lHeight:[1.5*j.size],sizeUnit:[j.sizeUnit]}}]}],metric:[{type:"expression",chain:[{type:"function",function:"visdimension",arguments:{accessor:[t.accessor]}}]}],showLabels:[!(null!=n&&n.mode)||"full"===(null==n?void 0:n.mode)],colorMode:h?[(null==t?void 0:t.colorMode)||H.ColorMode.None]:[H.ColorMode.None],autoScale:[!0],colorFullBackground:[!0],palette:null!=t&&t.colorMode&&(null==t?void 0:t.colorMode)!==H.ColorMode.None?[e.get(y.b).toExpression(x)]:[]}}]}},re=({paletteService:e,theme:t})=>({id:"lnsMetric",visualizationTypes:[{id:"lnsMetric",icon:G,label:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),groupLabel:u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),sortPriority:3}],getVisualizationTypeId:()=>"lnsMetric",clearLayer:e=>({...e,accessor:void 0}),getLayerIds:e=>[e.layerId],getDescription:()=>({icon:G,label:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"})}),getSuggestions:q,initialize:(e,t)=>t||{layerId:e(),accessor:void 0,layerType:P.o.DATA},getConfiguration(e){var t,a;const n=null!=e.state.palette,i=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return{groups:[{groupId:"metric",groupLabel:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),layerId:e.state.layerId,accessors:e.state.accessor?[{columnId:e.state.accessor,triggerIcon:n?"colorBy":void 0,palette:n?i.map((({color:e})=>e)):void 0}]:[],supportsMoreColumns:!e.state.accessor,filterOperations:e=>!e.isBucketed&&ie.has(e.dataType),enableDimensionEditor:!0,required:!0}]}},getSupportedLayers:()=>[{type:P.o.DATA,label:u.i18n.translate("xpack.lens.metric.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n)=>se(e,t,a,{...n}),toPreviewExpression:(t,a)=>se(e,t,a,{mode:"reduced"}),setDimension:({prevState:e,columnId:t})=>({...e,accessor:t}),removeDimension:({prevState:e})=>({...e,accessor:void 0,colorMode:H.ColorMode.None,palette:void 0}),renderToolbar(e,a){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(ne,{state:a.state,setState:a.setState,frame:a.frame}))),e)},renderDimensionEditor(a,n){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Y,i()({},n,{paletteService:e})))),a)},getErrorMessages(e){}});class MetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getMetricVisualization:t}=await Promise.resolve().then(a.bind(null,433));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var oe=a(38),ue=a(37);const ce=u.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"}),de=[{value:P.c.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showCategoriesLabel",{defaultMessage:"Inside or outside"})},{value:P.c.INSIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.fitInsideOnlyLabel",{defaultMessage:"Inside only"})},{value:P.c.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],pe=[{value:P.c.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showTreemapCategoriesLabel",{defaultMessage:"Show labels"})},{value:P.c.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],me=[{value:P.j.HIDDEN,inputDisplay:u.i18n.translate("xpack.lens.pieChart.hiddenNumbersLabel",{defaultMessage:"Hide from chart"})},{value:P.j.PERCENT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showPercentValuesLabel",{defaultMessage:"Show percent"})},{value:P.j.VALUE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showFormatterValuesLabel",{defaultMessage:"Show value"})}],ge=[{id:"emptySizeRatioOption-small",value:P.f.SMALL,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.small",{defaultMessage:"Small"})},{id:"emptySizeRatioOption-medium",value:P.f.MEDIUM,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.medium",{defaultMessage:"Medium"})},{id:"emptySizeRatioOption-large",value:P.f.LARGE,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.large",{defaultMessage:"Large"})}],fe={donut:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M19.21 21.119a11 11 0 006.595-8.1c.11-.577-.355-1.082-.942-1.082H20.75c-.477 0-.878.342-1.046.788a5.028 5.028 0 11-6.474-6.474c.447-.168.788-.569.788-1.046V1.094c0-.588-.505-1.053-1.082-.943a11 11 0 106.272 20.968h.002z",className:"lensChartIcon__subdued"}),Object(x.jsx)("path",{d:"M22.778 3.176A11 11 0 0017.084.154C16.507.042 16 .507 16 1.095v4.116c0 .475.34.875.784 1.044l.14.055A5.026 5.026 0 0119.7 9.17c.168.445.568.784 1.044.784h4.115c.588 0 1.053-.506.942-1.084a11 11 0 00-3.023-5.694z",className:"lensChartIcon__accent"})),label:u.i18n.translate("xpack.lens.pie.donutLabel",{defaultMessage:"Donut"}),groupLabel:ce,maxBuckets:3,toolbarPopover:{categoryOptions:de,numberOptions:me,emptySizeRatioOptions:ge},legend:{getShowLegendDefault:e=>e.length>1}},pie:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M17.827 21.189a10.001 10.001 0 005.952-7.148c.124-.578-.343-1.091-.935-1.091H14a1 1 0 01-1-1V3.106c0-.592-.513-1.059-1.092-.935a10 10 0 105.919 19.018z",className:"lensChartIcon__subdued"}),Object(x.jsx)("path",{d:"M22.462 3.538A12.29 12.29 0 0016.094.16C15.512.048 15 .514 15 1.106V10a1 1 0 001 1h8.895c.591 0 1.057-.512.945-1.094a12.288 12.288 0 00-3.378-6.368z",className:"lensChartIcon__accent"})),label:u.i18n.translate("xpack.lens.pie.pielabel",{defaultMessage:"Pie"}),groupLabel:ce,maxBuckets:3,toolbarPopover:{categoryOptions:de,numberOptions:me},legend:{getShowLegendDefault:e=>e.length>1}},treemap:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M0 1a1 1 0 011-1h13a1 1 0 011 1v20a1 1 0 01-1 1H1a1 1 0 01-1-1V1z",className:"lensChartIcon__subdued"}),Object(x.jsx)("path",{d:"M17 1a1 1 0 011-1h11a1 1 0 011 1v12a1 1 0 01-1 1H18a1 1 0 01-1-1V1z",className:"lensChartIcon__accent"}),Object(x.jsx)("path",{d:"M29 16H18a1 1 0 00-1 1v4a1 1 0 001 1h11a1 1 0 001-1v-4a1 1 0 00-1-1z",className:"lensChartIcon__subdued"})),label:u.i18n.translate("xpack.lens.pie.treemaplabel",{defaultMessage:"Treemap"}),groupLabel:ce,maxBuckets:2,toolbarPopover:{categoryOptions:pe,numberOptions:me},legend:{getShowLegendDefault:()=>!1}},mosaic:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t}):null,Object(x.jsx)("path",{className:"lensChartIcon__subdued",d:"M2 0a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1H2zM2 14a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1v-6a1 1 0 00-1-1H2zM11 13a1 1 0 011-1h6a1 1 0 011 1v8a1 1 0 01-1 1h-6a1 1 0 01-1-1v-8zM12 0a1 1 0 100 2h6a1 1 0 100-2h-6zM21 15a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1h-6a1 1 0 01-1-1v-6zM22 0a1 1 0 00-1 1v4a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1h-6z"}),Object(x.jsx)("path",{className:"lensChartIcon__accent",d:"M11 5a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1h-6a1 1 0 01-1-1V5zM1 7a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1H2a1 1 0 01-1-1V7zM22 8a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V9a1 1 0 00-1-1h-6z"})),label:u.i18n.translate("xpack.lens.pie.mosaiclabel",{defaultMessage:"Mosaic"}),groupLabel:ce,maxBuckets:2,isExperimental:!0,toolbarPopover:{categoryOptions:[],numberOptions:me},legend:{getShowLegendDefault:()=>!1},requiredMinDimensionCount:2},waffle:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t}):null,Object(x.jsx)("path",{className:"lensChartIcon__accent",d:"M16 1a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V1zM4 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM17 6a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V7a1 1 0 00-1-1h-2zM23 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM5 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1H5zM4 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V7zM11 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM10 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7zM11 12a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM22 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7z"}),Object(x.jsx)("path",{className:"lensChartIcon__subdued",d:"M22 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM4 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM16 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM11 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM23 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM16 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2z"})),label:u.i18n.translate("xpack.lens.pie.wafflelabel",{defaultMessage:"Waffle"}),groupLabel:ce,maxBuckets:1,isExperimental:!0,toolbarPopover:{isDisabled:!0,categoryOptions:[],numberOptions:[]},legend:{flat:!0,showValues:!0,hideNestedLegendSwitch:!0,getShowLegendDefault:()=>!0}}},be=(e,t)=>{var a,n,i,l,s;return"showValues"in(null===(a=fe[t])||void 0===a?void 0:a.legend)&&(null===(n=null!==(i=e.showValuesInLegend)&&void 0!==i?i:null===(l=fe[t])||void 0===l||null===(s=l.legend)||void 0===s?void 0:s.showValues)||void 0===n||n)},he=(e,t,a)=>{const n=e.rows.reduce(((e,a)=>Number(a[t])+e),0);return e.rows.some((e=>e[t]/n*100<a))};function xe(e,t,a){return 0===a?{...e,...t}:{...t,...e}}function ve(e,t){const a={truncateText:!0};return e?function(e){return"layerId"in e}(e)?Object.values((null===(n=t[e.layerId])||void 0===n?void 0:n.getVisualDefaults())||{}).reduce(xe,a):e.layers.flatMap((({layerId:e})=>{var a;return Object.values((null===(a=t[e])||void 0===a?void 0:a.getVisualDefaults())||{})})).reduce(xe,a):a;var n}const ye=(e,t)=>{const a=e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.groups.includes(e)));return Array.from(new Set(a.concat(t.groups)))},je=e=>{const t=Object(ue.buildExpressionFunction)("visdimension",{accessor:e});return Object(ue.buildExpression)([t]).toAst()},Oe=(e,t,a)=>{var n;return[{type:"expression",chain:[{type:"function",function:"partitionLabels",arguments:{show:[!t.isPreview&&a.categoryDisplay!==P.c.HIDE],position:a.categoryDisplay!==P.c.HIDE?[a.categoryDisplay]:[],values:[a.numberDisplay!==P.j.HIDDEN],valuesFormat:a.numberDisplay!==P.j.HIDDEN?[a.numberDisplay]:[],percentDecimals:[null!==(n=a.percentDecimals)&&void 0!==n?n:2]}}]}]},ke=(...e)=>{const[t]=Oe(...e),[a]=t.chain;return[{...t,chain:[{...a,percentDecimals:2}]}]},Ie=(e,t)=>t?[{type:"expression",chain:[{type:"function",function:"theme",arguments:{variable:["palette"],default:[e.get(t.name).toExpression(t.params)]}}]}]:[e.get("default").toExpression()],Te=(e,t,a,n,i,l)=>{var s,r;return{labels:Oe(0,t,n),buckets:a.map((e=>e.columnId)).map(je),metric:n.metric?[je(n.metric)]:[],legendDisplay:[t.isPreview?P.i.HIDE:n.legendDisplay],legendPosition:[n.legendPosition||oe.Position.Right],maxLegendLines:[null!==(s=n.legendMaxLines)&&void 0!==s?s:1],legendSize:n.legendSize?[n.legendSize]:[],nestedLegend:[!!n.nestedLegend],truncateLegend:[null!==(r=n.truncateLegend)&&void 0!==r?r:ve(e,i).truncateText],palette:Ie(l,e.palette)}};function Fe(e,t,a,n={isPreview:!1}){const i=e.layers[0],l=t[i.layerId],s=ye(l,i).map((e=>({columnId:e,operation:l.getOperationForColumnId(e)}))).filter((e=>!!e.operation));return i.metric&&s.length?((e,...t)=>({[P.l.PIE]:()=>((...e)=>({type:"expression",chain:[{type:"function",function:"pieVis",arguments:{...Te(...e),respectSourceOrder:[!1],startFromSecondLargestSlice:[!0]}}]}))(e,...t),[P.l.DONUT]:()=>((...e)=>{var t;const[,,,a]=e;return{type:"expression",chain:[{type:"function",function:"pieVis",arguments:{...Te(...e),respectSourceOrder:[!1],isDonut:[!0],startFromSecondLargestSlice:[!0],emptySizeRatio:[null!==(t=a.emptySizeRatio)&&void 0!==t?t:P.f.SMALL]}}]}})(e,...t),[P.l.TREEMAP]:()=>((...e)=>{const[,,,t]=e;return{type:"expression",chain:[{type:"function",function:"treemapVis",arguments:{...Te(...e),nestedLegend:[!!t.nestedLegend]}}]}})(e,...t),[P.l.MOSAIC]:()=>((...e)=>({type:"expression",chain:[{type:"function",function:"mosaicVis",arguments:Te(...e)}]}))(e,...t),[P.l.WAFFLE]:()=>((...e)=>{const{buckets:t,nestedLegend:a,...n}=Te(...e),[i,l,,s]=e;return{type:"expression",chain:[{type:"function",function:"waffleVis",arguments:{...n,bucket:t,labels:ke(i,l,s),showValuesInLegend:[be(s,i.shape)]}}]}})(e,...t)}[e.shape]()))(e,n,s,i,t,a):null}var Me=a(31);function we(e){return e.some((e=>"interval"===e.operation.scale))}function _e(e){const t=[P.l.TREEMAP,P.l.WAFFLE,P.l.MOSAIC];return!!e&&t.includes(e)}const Ce=Math.max(...Object.values(fe).map((({maxBuckets:e})=>e)));function Ee({table:e,state:t,keptLayerIds:a,mainPalette:n,subVisualizationId:i}){if(function({table:e,keptLayerIds:t,state:a}){const n=(null==a||!a.shape||(i=a.shape,!["donut","pie","treemap","mosaic","waffle"].includes(i)))&&we(e.columns);var i;return t.length>1||t.length&&e.layerId!==t[0]||"reorder"===e.changeType||n||e.columns.some((e=>e.operation.isStaticValue))}({table:e,state:t,keptLayerIds:a}))return[];const[l,s]=Object(Me.partition)(e.columns.filter((e=>e.operation.isBucketed||"number"===e.operation.dataType)),(e=>e.operation.isBucketed));if(0===l.length&&0===s.length)return[];if(s.length>1||l.length>Ce)return[];const r=0===s.length||0===l.length,o=s.length>0?s[0].columnId:void 0;if(r&&t&&!i)return[];const c=[];if(l.length<=fe.pie.maxBuckets&&!_e(i)){const a=function(e,t){var a;if(t)return t;let n;return 1===e.length||t||(n=P.l.PIE),null!==(a=n)&&void 0!==a?a:P.l.DONUT}(l,i),s={title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:fe[a].label},description:"chartName is already translated"}),score:t&&!_e(t.shape)?.6:.4,state:{shape:a,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,layerType:P.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:P.j.PERCENT,categoryDisplay:P.c.DEFAULT,legendDisplay:P.i.DEFAULT,nestedLegend:!1,layerType:P.o.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||we(l)||t&&!_e(t.shape)};c.push(s),c.push({...s,title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:fe[a===P.l.PIE?P.l.DONUT:P.l.PIE].label},description:"chartName is already translated"}),score:.1,state:{...s.state,shape:a===P.l.PIE?P.l.DONUT:P.l.PIE},hide:!0})}return l.length<=fe.treemap.maxBuckets&&(!i||"treemap"===i)&&c.push({title:u.i18n.translate("xpack.lens.pie.treemapSuggestionLabel",{defaultMessage:"As Treemap"}),score:(null==t?void 0:t.shape)===P.l.TREEMAP?.7:.5,state:{shape:P.l.TREEMAP,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,categoryDisplay:t.layers[0].categoryDisplay===P.c.INSIDE?P.c.DEFAULT:t.layers[0].categoryDisplay,layerType:P.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:P.j.PERCENT,categoryDisplay:P.c.DEFAULT,legendDisplay:P.i.DEFAULT,nestedLegend:!1,layerType:P.o.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||!t||we(l)||t&&t.shape===P.l.TREEMAP}),l.length<=fe.mosaic.maxBuckets&&(!i||i===P.l.MOSAIC)&&c.push({title:u.i18n.translate("xpack.lens.pie.mosaicSuggestionLabel",{defaultMessage:"As Mosaic"}),score:(null==t?void 0:t.shape)===P.l.MOSAIC?.7:.5,state:{shape:P.l.MOSAIC,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,categoryDisplay:P.c.DEFAULT,layerType:P.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:P.j.PERCENT,categoryDisplay:P.c.DEFAULT,legendDisplay:P.i.DEFAULT,nestedLegend:!1,layerType:P.o.DATA}]},previewIcon:"bullseye",hide:!0}),l.length<=fe.waffle.maxBuckets&&(!i||i===P.l.WAFFLE)&&c.push({title:u.i18n.translate("xpack.lens.pie.waffleSuggestionLabel",{defaultMessage:"As Waffle"}),score:(null==t?void 0:t.shape)===P.l.WAFFLE?.7:.5,state:{shape:P.l.WAFFLE,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,categoryDisplay:P.c.DEFAULT,layerType:P.o.DATA}:{layerId:e.layerId,groups:l.map((e=>e.columnId)),metric:o,numberDisplay:P.j.PERCENT,categoryDisplay:P.c.DEFAULT,legendDisplay:P.i.DEFAULT,nestedLegend:!1,layerType:P.o.DATA}]},previewIcon:"bullseye",hide:!0}),[...c].map((e=>({...e,score:e.score+.05*l.length}))).sort(((e,t)=>t.score-e.score)).map((e=>({...e,hide:r||e.hide})))}a(198);const Se=[{id:"pieLegendDisplay-default",value:P.i.DEFAULT,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"pieLegendDisplay-show",value:P.i.SHOW,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"pieLegendDisplay-hide",value:P.i.HIDE,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Pe=u.i18n.translate("xpack.lens.pieChart.emptySizeRatioLabel",{defaultMessage:"Inner area size"});function Ae(e){var t,a,n,i,s,r,o;const{state:c,setState:d,frame:p}=e,m=c.layers[0],{categoryOptions:f,numberOptions:b,emptySizeRatioOptions:h,isDisabled:v}=fe[c.shape].toolbarPopover,j=Object(l.useCallback)((e=>{d({...c,layers:[{...m,...e}]})}),[m,c,d]),O=Object(l.useCallback)((e=>j({categoryDisplay:e})),[j]),k=Object(l.useCallback)((e=>j({numberDisplay:e})),[j]),I=Object(l.useCallback)((e=>{j({percentDecimals:e})}),[j]),T=Object(l.useCallback)((e=>{j({legendDisplay:Se.find((({id:t})=>t===e)).value})}),[j]),F=Object(l.useCallback)((e=>j({legendPosition:e})),[j]),M=Object(l.useCallback)((e=>j({nestedLegend:!m.nestedLegend})),[m,j]),w=Object(l.useCallback)((()=>{var e;const t=null===(e=m.truncateLegend)||void 0===e||e;j({truncateLegend:!t})}),[m,j]),_=Object(l.useCallback)((e=>j({legendMaxLines:e})),[j]),C=Object(l.useCallback)((e=>j({legendSize:e})),[j]),E=Object(l.useCallback)((()=>{j({showValuesInLegend:!be(m,c.shape)})}),[m,c.shape,j]),S=Object(l.useCallback)((e=>{var t;const a=null==h||null===(t=h.find((({id:t})=>t===e)))||void 0===t?void 0:t.value;j({emptySizeRatio:a})}),[h,j]);if(!m)return null;const P=ve(c,p.datasourceLayers).truncateText;return Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.pieChart.valuesLabel",{defaultMessage:"Labels"}),isDisabled:Boolean(v),type:"labels",groupPosition:"left",buttonDataTestSubj:"lnsLabelsButton"},f.length?Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.labelPositionLabel",{defaultMessage:"Position"}),fullWidth:!0,display:"columnCompressed"},Object(x.jsx)(g.EuiSuperSelect,{compressed:!0,valueOfSelected:m.categoryDisplay,options:f,onChange:O})):null,b.length?Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.numberLabels",{defaultMessage:"Values"}),fullWidth:!0,display:"columnCompressed"},Object(x.jsx)(g.EuiSuperSelect,{compressed:!0,disabled:"hide"===m.categoryDisplay,valueOfSelected:"hide"===m.categoryDisplay?"hidden":m.numberDisplay,options:b,onChange:k})):null,b.length+f.length?Object(x.jsx)(g.EuiHorizontalRule,{margin:"s"}):null,Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.percentDecimalsLabel",{defaultMessage:"Maximum decimal places for percent"}),fullWidth:!0,display:"rowCompressed"},Object(x.jsx)(Le,{value:null!==(t=m.percentDecimals)&&void 0!==t?t:2,setValue:I}))),null!=h&&h.length?Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.pieChart.visualOptionsLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"center",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(x.jsx)(g.EuiFormRow,{label:Pe,display:"columnCompressed",fullWidth:!0},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,name:"emptySizeRatio",buttonSize:"compressed",legend:Pe,options:h,idSelected:null!==(a=null===(n=h.find((({value:e})=>e===m.emptySizeRatio)))||void 0===n?void 0:n.id)&&void 0!==a?a:"emptySizeRatioOption-small",onChange:S,"data-test-subj":"lnsEmptySizeRatioButtonGroup"}))):null,Object(x.jsx)(y.f,{legendOptions:Se,mode:m.legendDisplay,onDisplayChange:T,valueInLegend:be(m,c.shape),renderValueInLegendSwitch:null!==(i="showValues"in(null===(s=fe[c.shape])||void 0===s?void 0:s.legend))&&void 0!==i&&i,onValueInLegendChange:E,position:m.legendPosition,onPositionChange:F,renderNestedLegendSwitch:!(null!==(r=fe[c.shape])&&void 0!==r&&r.legend.hideNestedLegendSwitch),nestedLegend:Boolean(m.nestedLegend),onNestedLegendChange:M,shouldTruncate:null!==(o=m.truncateLegend)&&void 0!==o?o:P,onTruncateLegendChange:w,maxLines:null==m?void 0:m.legendMaxLines,onMaxLinesChange:_,legendSize:m.legendSize,onLegendSizeChange:C}))}const Le=({value:e,setValue:t})=>{const{inputValue:a,handleInputChange:n}=Object(y.t)({value:e,onChange:t},{allowFalsyValue:!0});return Object(x.jsx)(g.EuiRange,{"data-test-subj":"indexPattern-dimension-formatDecimals",value:a,min:0,max:10,showInput:!0,compressed:!0,onChange:e=>{n(Number(e.currentTarget.value))}})};function De(e){return Object(x.jsx)(y.i,{palettes:e.paletteService,activePalette:e.state.palette,setPalette:t=>{e.setState({...e.state,palette:t})}})}function Ne(e){return{layerId:e,groups:[],metric:void 0,numberDisplay:P.j.PERCENT,categoryDisplay:P.c.DEFAULT,legendDisplay:P.i.DEFAULT,nestedLegend:!1,layerType:P.o.DATA}}const ze=e=>e.isBucketed,Be=e=>!e.isBucketed&&"number"===e.dataType&&!e.isStaticValue,Ve=({paletteService:e,kibanaTheme:t})=>({id:"lnsPie",visualizationTypes:Object.entries(fe).map((([e,t])=>({id:e,icon:t.icon,label:t.label,groupLabel:t.groupLabel,showExperimentalBadge:t.isExperimental}))),getVisualizationTypeId:e=>e.shape,getLayerIds:e=>e.layers.map((e=>e.layerId)),clearLayer:e=>({shape:e.shape,layers:e.layers.map((e=>Ne(e.layerId)))}),getDescription(e){var t;return null!==(t=fe[e.shape])&&void 0!==t?t:fe.pie},switchVisualizationType:(e,t)=>({...t,shape:e}),triggers:[A.VIS_EVENT_TO_TRIGGER.filter],initialize:(e,t,a)=>t||{shape:P.l.DONUT,layers:[Ne(e())],palette:a},getMainPalette:e=>e?e.palette:void 0,getSuggestions:Ee,getConfiguration({state:t,frame:a,layerId:n}){const i=t.layers.find((e=>e.layerId===n));if(!i)return{groups:[]};const l=a.datasourceLayers[i.layerId],s=ye(l,i).map((e=>({columnId:e})));return s.length&&((e,{shape:t,palette:a},n)=>{const i="mosaic"===t?e.length-1:0;i>=0&&(e[i]={columnId:e[i].columnId,triggerIcon:"colorBy",palette:n.get((null==a?void 0:a.name)||"default").getCategoricalColors(10,null==a?void 0:a.params)})})(s,t,e),{groups:[(()=>{const e={required:!0,groupId:"groups",accessors:s,enableDimensionEditor:!0,filterOperations:ze};switch(t.shape){case"donut":case"pie":return{...e,groupLabel:u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),supportsMoreColumns:s.length<fe.pie.maxBuckets,dataTestSubj:"lnsPie_sliceByDimensionPanel"};default:return{...e,groupLabel:u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),supportsMoreColumns:s.length<fe[t.shape].maxBuckets,dataTestSubj:"lnsPie_groupByDimensionPanel",requiredMinDimensionCount:fe[t.shape].requiredMinDimensionCount}}})(),{groupId:"metric",groupLabel:u.i18n.translate("xpack.lens.pie.groupsizeLabel",{defaultMessage:"Size by"}),accessors:i.metric?[{columnId:i.metric}]:[],supportsMoreColumns:!i.metric,filterOperations:Be,required:!0,dataTestSubj:"lnsPie_sizeByDimensionPanel"}]}},setDimension:({prevState:e,layerId:t,columnId:a,groupId:n})=>({...e,layers:e.layers.map((e=>e.layerId!==t?e:"groups"===n?{...e,groups:[...e.groups.filter((e=>e!==a)),a]}:{...e,metric:a}))}),removeDimension:({prevState:e,layerId:t,columnId:a})=>({...e,layers:e.layers.map((e=>e.layerId!==t?e:e.metric===a?{...e,metric:void 0}:{...e,groups:e.groups.filter((e=>e!==a))}))}),renderDimensionEditor(a,n){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(De,i()({},n,{paletteService:e})))),a)},getSupportedLayers:()=>[{type:P.o.DATA,label:u.i18n.translate("xpack.lens.pie.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},toExpression:(t,a,n)=>function(e,t,a,n={}){return Fe(e,t,a,{...n,isPreview:!1})}(t,a,e,n),toPreviewExpression:(t,a)=>function(e,t,a){return Fe(e,t,a,{isPreview:!0})}(t,a,e),renderToolbar(e,a){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Ae,a))),e)},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const a=[];for(const s of e.layers){var n,i,l;const{layerId:r,metric:o}=s,u=null===(n=t.activeData[r])||void 0===n?void 0:n.rows,d=null===(i=t.activeData[r])||void 0===i?void 0:i.columns.find((({meta:e})=>"number"===(null==e?void 0:e.type)));if(!u||!o)break;d&&"waffle"===e.shape&&s.groups.length&&he(t.activeData[r],d.id,1)&&a.push(Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.pie.smallValuesWarningMessage",defaultMessage:"Waffle charts are unable to effectively display small field values. To display all field values, use the Data table or Treemap."}));const p=null===(l=t.datasourceLayers[r].getOperationForColumnId(o))||void 0===l?void 0:l.label;u.some((e=>Array.isArray(e[o])))&&a.push(Object(x.jsx)(c.FormattedMessage,{key:p||o,id:"xpack.lens.pie.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(x.jsx)("strong",null,p||o)}}))}return a},getErrorMessages(e){}});class PieVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getPieVisualization:t}=await Promise.resolve().then(a.bind(null,433));return t({paletteService:await n.palettes.getPalettes(),kibanaTheme:e.theme})}))}}var Re=a(78),He=a(28),Ge=a(88);const qe=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M24 16l.186-.002.345-.02.266-.03.334-.058.193-.043.25-.067.223-.07.215-.074.209-.079.305-.124c.166-.07.34-.148.524-.234l.285-.135 1.202-.588c.428-.203.728-.326.966-.396.146-.044.27-.067.384-.076L30 14v7a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-7.994 5.865-7.997L19.032 10l.541 1.205.272.595.29.612c.517 1.069.955 1.842 1.391 2.391.08.1.16.194.241.28.095.101.189.191.283.272l.143.114c.218.164.446.284.69.368.207.071.426.116.662.14l.14.012.154.008L24 16zm6-12v6l-.186.002-.345.02-.266.03-.331.057-.196.044-.25.067-.304.097-.134.047a9.492 9.492 0 00-.386.15l-.128.053c-.166.07-.34.148-.524.234l-.285.135-1.264.618-.352.159-.187.078-.256.095-.178.054a13.872 13.872 0 01-.38-.687l-.16-.311-.233-.47-.016-.472H24c1 0 3-6 6-6z",className:"lensChartIcon__accent"}),Object(x.jsx)("path",{d:"M30 13c-.507 0-.988.146-1.89.571l-1.209.592C25.621 14.78 24.924 15 24 15c-1.384 0-2.003-.865-3.516-4.206l-.637-1.42-.346-.749-.213-.445C18.572 6.698 18.127 6 18 6c-.466 0-.967.252-1.99.997l-.891.659-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.384 0 2.003.865 3.516 4.206l.637 1.42.346.749.213.445C23.428 12.302 23.873 13 24 13c.507 0 .988-.146 1.89-.571l1.209-.592C28.379 11.22 29.076 11 30 11v2z",className:"lensChartIcon__subdued"}),Object(x.jsx)("path",{d:"M6 13v7.889C6 21.503 5.552 22 5 22H1c-.552 0-1-.497-1-1.111V13a1 1 0 011-1h4a1 1 0 011 1zm8-1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4a1 1 0 011 1zm8 5v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 011-1h4a1 1 0 011 1zm8 2v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2a1 1 0 011-1h4a1 1 0 011 1z",className:"lensChartIcon__subdued"}));var $e=a(87);function We(e,{isHorizontal:t}){const a=u.i18n.translate("xpack.lens.xyChart.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n=u.i18n.translate("xpack.lens.xyChart.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});if("x"===e)return t?a:n;if("y"===e)return t?n:a;const i=u.i18n.translate("xpack.lens.xyChart.verticalLeftAxisLabel",{defaultMessage:"Vertical left axis"}),l=u.i18n.translate("xpack.lens.xyChart.verticalRightAxisLabel",{defaultMessage:"Vertical right axis"}),s=u.i18n.translate("xpack.lens.xyChart.horizontalLeftAxisLabel",{defaultMessage:"Horizontal top axis"}),r=u.i18n.translate("xpack.lens.xyChart.horizontalRightAxisLabel",{defaultMessage:"Horizontal bottom axis"});return"yLeft"===e?t?r:i:t?s:l}function Ue(e,t,a){return n=>{const i=a[n.layerId];if(!n.xAccessor)return!1;const l=null==i?void 0:i.getOperationForColumnId(n.xAccessor);return Boolean(l&&(!t||l.dataType===t)&&l.scale===e)}}const Ye=e=>e.layerType===He.layerTypes.DATA||!e.layerType,Ke=e=>(e||[]).filter((e=>Ye(e))),Xe=e=>e.layerType===He.layerTypes.REFERENCELINE,Ze=e=>(e||[]).filter((e=>Xe(e))),Qe=e=>e.layerType===He.layerTypes.ANNOTATIONS,Je=e=>(e||[]).filter((e=>Qe(e)));function et(e){var t;if(!e.layers.length)return null!==(t=Re.visualizationTypes.find((t=>t.id===e.preferredSeriesType)))&&void 0!==t?t:Re.visualizationTypes[0];const a=Ke(null==e?void 0:e.layers),n=Re.visualizationTypes.find((e=>e.id===(null==a?void 0:a[0].seriesType))),i=Object(Me.uniq)(a.map((e=>e.seriesType)));return n&&1===i.length?n:"mixed"}function tt(e){if(!e)return{icon:at,label:u.i18n.translate("xpack.lens.xyVisualization.xyLabel",{defaultMessage:"XY"})};const t=et(e);return"mixed"===t&&gt(e.layers)?{icon:Ge.a,label:u.i18n.translate("xpack.lens.xyVisualization.mixedBarHorizontalLabel",{defaultMessage:"Mixed bar horizontal"})}:"mixed"===t?{icon:qe,label:u.i18n.translate("xpack.lens.xyVisualization.mixedLabel",{defaultMessage:"Mixed XY"})}:{icon:t.icon||at,label:t.fullLabel||t.label}}const at=$e.a,nt="bar_stacked",it={type:He.layerTypes.DATA,label:u.i18n.translate("xpack.lens.xyChart.addDataLayerLabel",{defaultMessage:"Visualization"}),icon:qe};function lt(e,t,a){const n=t.map((e=>e+1)).join(", ");switch(e){case"Break down":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitShort",{defaultMessage:"Missing {axis}.",values:{axis:"Break down by axis"}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:"Break down by axis"}})};case"Y":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYShort",{defaultMessage:"Missing {axis}.",values:{axis:We("y",{isHorizontal:a})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:We("y",{isHorizontal:a})}})}}return{shortMessage:"",longMessage:""}}const st={[He.layerTypes.DATA]:({layerId:e,seriesType:t})=>({layerId:e,layerType:He.layerTypes.DATA,accessors:[],seriesType:t}),[He.layerTypes.REFERENCELINE]:({layerId:e})=>({layerId:e,layerType:He.layerTypes.REFERENCELINE,accessors:[]}),[He.layerTypes.ANNOTATIONS]:({layerId:e})=>({layerId:e,layerType:He.layerTypes.ANNOTATIONS,annotations:[]})};function rt({layerId:e,layerType:t=He.layerTypes.DATA,seriesType:a}){return st[t]({layerId:e,seriesType:a})}function ot(e,t){return e.layers.filter((({layerType:e=He.layerTypes.DATA})=>!t||e===t))}function ut(e,t,a){return t.every(a)||!t.some(a)?{valid:!0}:{valid:!1,payload:lt(e,t.reduce(((e,t,n)=>(a(t)&&e.push(n),e)),[]),gt(t))}}const ct=e=>!e.isBucketed&&"number"===e.dataType,dt=e=>ct(e)&&!e.isStaticValue,pt=e=>e.isBucketed;function mt(e){return"bar_horizontal"===e||"bar_horizontal_stacked"===e||"bar_horizontal_percentage_stacked"===e}function gt(e){return Ke(e).every((e=>mt(e.seriesType)))}function ft(e){const t=Re.visualizationTypes.find((t=>t.id===e));if(!t)throw new Error(`Unknown series type ${e}`);return t.icon||"empty"}const bt=(e,t)=>{const a={};return e.accessors.concat(Ye(e)&&e.splitAccessor?[e.splitAccessor]:[]).forEach((e=>{const n=t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a},ht={document:0,date:1,string:2,ip:3,boolean:4,number:5,histogram:6,geo_point:7,geo_shape:8};function xt({table:e,state:t,keptLayerIds:a,subVisualizationId:n,mainPalette:i,isFromContext:l}){const s=!e.isMultiRow||e.columns.length<=1||e.columns.every((e=>"number"!==e.operation.dataType))||e.columns.some((e=>!ht.hasOwnProperty(e.operation.dataType)));if(s&&"unchanged"===e.changeType&&t)return Re.visualizationTypes.map((e=>{const a=e.id;return{seriesType:a,score:0,state:{...t,preferredSeriesType:a,layers:t.layers.map((e=>({...e,seriesType:a})))},previewIcon:ft(a),title:e.label,hide:!0}}));if(s&&t&&!n||e.columns.some((e=>e.operation.isStaticValue&&!l))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];const r=function(e,t,a,n,i){const[l,s]=Object(Me.partition)(e.columns,(e=>e.operation.isBucketed));if(1===l.length||2===l.length){const[l,r]=function(e,t){const a=t&&Ke(t.layers).find((({layerId:t})=>t===e.layerId)),n=e.columns.filter((e=>e.operation.isBucketed)),i=yt([...n].reverse());if(!a||"initial"===e.changeType)return i;if("reorder"===e.changeType)return n;const l=i.findIndex((({columnId:e})=>e===a.xAccessor)),s=l>-1&&i[l].operation.scale;if(s&&("interval"===s||"interval"!==i[0].operation.scale)){const[e]=i.splice(l,1);i.unshift(e)}const r=i.findIndex((({columnId:e})=>e===a.splitAccessor));if(r>-1){const[e]=i.splice(r,1);i.push(e)}return i}(e,a);return jt({layerId:e.layerId,changeType:e.changeType,xValue:l,yValues:s,splitBy:r,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i})}if(0===l.length){const[l,[r,o]]=Object(Me.partition)(yt(s),(e=>"number"===e.operation.dataType&&!e.operation.isBucketed));return jt({layerId:e.layerId,changeType:e.changeType,xValue:r,yValues:l,splitBy:o,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i})}}(e,a,t,n,i);return r&&r instanceof Array?r:r?[r]:[]}function vt(e){switch(e){case"bar_horizontal":return"bar";case"bar_horizontal_stacked":return"bar_stacked";case"bar":default:return"bar_horizontal";case"bar_horizontal_percentage_stacked":return"bar_percentage_stacked";case"bar_percentage_stacked":return"bar_horizontal_percentage_stacked"}}function yt(e){return[...e].sort(((e,t)=>ht[e.operation.dataType]-ht[t.operation.dataType]))}function jt({layerId:e,changeType:t,xValue:a,yValues:n,splitBy:i,currentState:l,tableLabel:s,keptLayerIds:r,requestedSeriesType:o,mainPalette:c}){const d=function(e,t,a){const n=e.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.xySuggestions.yAxixConjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."})),i=(null==t?void 0:t.operation.label)||u.i18n.translate("xpack.lens.xySuggestions.emptyAxisTitle",{defaultMessage:"(empty)"});return a||("date"===(null==t?void 0:t.operation.dataType)?u.i18n.translate("xpack.lens.xySuggestions.dateSuggestion",{defaultMessage:"{yTitle} over {xTitle}",description:'Chart description for charts over time, like "Transfered bytes over log.timestamp"',values:{xTitle:i,yTitle:n}}):u.i18n.translate("xpack.lens.xySuggestions.nonDateSuggestion",{defaultMessage:"{yTitle} of {xTitle}",description:'Chart description for a value of some groups, like "Top URLs of top 5 countries"',values:{xTitle:i,yTitle:n}}))}(n,a,s),p=o||function(e,t,a){const n="bar_stacked",i=Ft(e,t),l=!(!i||!Ye(i))&&i.seriesType||e&&e.preferredSeriesType||n;return a&&a.operation.scale&&"ordinal"===a.operation.scale?l.startsWith("bar")?l:n:l}(l,e,a),m={currentState:l,seriesType:p,layerId:e,title:d,yValues:n,splitBy:i,changeType:t,xValue:a,keptLayerIds:r,mainPalette:i?c:void 0};if(!l&&"unchanged"===t)return Re.visualizationTypes.map((e=>({...It({...m,seriesType:e.id,hide:"bar_stacked"!==e.id||void 0}),title:e.label}))).sort(((e,t)=>"bar_stacked"===e.state.preferredSeriesType?-1:1));if(!l||"unchanged"!==t)return It(m);const g=[];if(!p.includes("bar")||a&&"ordinal"!==a.operation.scale){const e=function(e){switch(e){case"area":case"bar":case"bar_stacked":return"line";default:return"bar_stacked"}}(p);g.push(It({...m,seriesType:e,title:e.startsWith("bar")?u.i18n.translate("xpack.lens.xySuggestions.barChartTitle",{defaultMessage:"Bar chart"}):u.i18n.translate("xpack.lens.xySuggestions.lineChartTitle",{defaultMessage:"Line chart"})}))}else g.push(It({...m,title:u.i18n.translate("xpack.lens.xySuggestions.flipTitle",{defaultMessage:"Flip"}),seriesType:vt(p)}));if("line"!==p&&i&&!p.includes("percentage")&&g.push(It({...m,seriesType:Ot(p),title:p.endsWith("stacked")?u.i18n.translate("xpack.lens.xySuggestions.unstackedChartTitle",{defaultMessage:"Unstacked"}):u.i18n.translate("xpack.lens.xySuggestions.stackedChartTitle",{defaultMessage:"Stacked"})})),"line"!==p&&p.includes("stacked")&&!p.includes("percentage")){var f;const e={...m};"ordinal"!==(null===(f=e.xValue)||void 0===f?void 0:f.operation.scale)||e.splitBy||(e.splitBy=e.xValue,delete e.xValue),g.push(It({...m,hide:!e.splitBy,seriesType:kt(p),title:u.i18n.translate("xpack.lens.xySuggestions.asPercentageTitle",{defaultMessage:"Percentage"})}))}return g.concat(Re.visualizationTypes.filter((e=>!g.find((t=>t.state.preferredSeriesType===e.id)))).map((e=>({...It({...m,seriesType:e.id}),hide:!0}))))}function Ot(e){switch(e){case"area":return"area_stacked";case"area_stacked":return"area";case"bar":return"bar_stacked";case"bar_stacked":return"bar";default:return e}}function kt(e){switch(e){case"area_stacked":return"area_percentage_stacked";case"bar_stacked":return"bar_percentage_stacked";case"bar_horizontal_stacked":return"bar_horizontal_percentage_stacked";default:return e}}function It({currentState:e,seriesType:t,layerId:a,title:n,yValues:i,splitBy:l,changeType:s,xValue:r,keptLayerIds:o,hide:u,mainPalette:c}){var d,p,m;t.includes("percentage")&&"ordinal"===(null===(d=r)||void 0===d?void 0:d.operation.scale)&&!l&&(l=r,r=void 0);const g=Ft(e,a)||null,f=i.map((e=>e.columnId)),b={...g||{},palette:c||(g&&"palette"in g?g.palette:void 0),layerId:a,seriesType:t,xAccessor:null===(p=r)||void 0===p?void 0:p.columnId,splitAccessor:null===(m=l)||void 0===m?void 0:m.columnId,accessors:f,yConfig:g&&"yConfig"in g&&g.yConfig?g.yConfig.filter((({forAccessor:e})=>-1!==f.indexOf(e))):void 0,layerType:P.o.DATA},h=e?e.layers.filter((e=>o.includes(e.layerId)||e.layerType===P.o.ANNOTATIONS)).map((e=>e.layerId===a?b:e)).map((e=>({...e,seriesType:t}))):[],x={legend:e?e.legend:{isVisible:!0,position:oe.Position.Right},valueLabels:(null==e?void 0:e.valueLabels)||"hide",fittingFunction:(null==e?void 0:e.fittingFunction)||"None",curveType:null==e?void 0:e.curveType,fillOpacity:null==e?void 0:e.fillOpacity,xTitle:null==e?void 0:e.xTitle,yTitle:null==e?void 0:e.yTitle,yRightTitle:null==e?void 0:e.yRightTitle,hideEndzones:null==e?void 0:e.hideEndzones,valuesInLegend:null==e?void 0:e.valuesInLegend,yLeftExtent:null==e?void 0:e.yLeftExtent,yRightExtent:null==e?void 0:e.yRightExtent,axisTitlesVisibilitySettings:(null==e?void 0:e.axisTitlesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},tickLabelsVisibilitySettings:(null==e?void 0:e.tickLabelsVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},labelsOrientation:(null==e?void 0:e.labelsOrientation)||{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:(null==e?void 0:e.gridlinesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:t,layers:g&&Object.keys(g).length?h:[...h,b]};return{title:n,score:Tt(i,l,s),hide:null!=u?u:!e&&"unchanged"!==s&&"extended"!==s||e&&"reduced"===s||0===i.length||!r&&!l,state:x,previewIcon:ft(t)}}function Tt(e,t,a){const n="unchanged"===a?.5:1;return((e.length>1?2:1)+(t?1:0))/3*n}function Ft(e,t){return e&&e.layers.find((e=>e.layerId===t))}const Mt=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M5 1.5a.5.5 0 111 0v7a.5.5 0 01-1 0v-7zM15.39 11.39a1.5 1.5 0 010 2.12l-2.122 2.122a.5.5 0 11-.707-.707l2.121-2.122a.5.5 0 000-.707l-2.121-2.12a.5.5 0 11.707-.708l2.121 2.121zM3.439 9.269a.5.5 0 010 .707l-2.122 2.121a.5.5 0 000 .707l2.122 2.121a.5.5 0 01-.707.708L.61 13.51a1.5 1.5 0 010-2.121l2.122-2.121a.5.5 0 01.707 0zM8 3a.5.5 0 01.5.5v5a.5.5 0 01-1 0v-5A.5.5 0 018 3zM11 5.5a.5.5 0 00-1 0v3a.5.5 0 001 0v-3z"}),Object(x.jsx)("path",{d:"M3.5 12a.5.5 0 000 1h9a.5.5 0 000-1h-9z"})),wt=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M7.378 3.585a.5.5 0 00.353-.854L5.61.611a1.5 1.5 0 00-2.121 0L1.367 2.73a.5.5 0 00.708.707l2.12-2.12a.5.5 0 01.708 0l2.121 2.12a.5.5 0 00.354.147z"}),Object(x.jsx)("path",{d:"M5.046 3.088v4.129l.005.04v5.658a.5.5 0 01-.992.09l-.01-.09V8.786l-.004-.04V3.087a.5.5 0 01.992-.09l.01.09z"}),Object(x.jsx)("path",{d:"M4.55 15.829a1.5 1.5 0 001.06-.44l2.122-2.121a.5.5 0 10-.707-.707l-2.121 2.121a.5.5 0 01-.708 0l-2.12-2.121a.5.5 0 00-.708.707l2.121 2.121a1.5 1.5 0 001.061.44zM13.5 4a.5.5 0 01.5.5v7a.5.5 0 11-1 0v-7a.5.5 0 01.5-.5zM10.5 6.5a.5.5 0 011 0v5a.5.5 0 11-1 0v-5zM8.5 8a.5.5 0 00-.5.5v3a.5.5 0 101 0v-3a.5.5 0 00-.5-.5z"})),_t=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M8.622 3.585a.5.5 0 01-.353-.854L10.39.611a1.5 1.5 0 012.121 0l2.122 2.12a.5.5 0 11-.707.707l-2.122-2.12a.5.5 0 00-.707 0l-2.121 2.12a.5.5 0 01-.354.147z"}),Object(x.jsx)("path",{d:"M11.95 12.915V8.786l.005-.04V3.087a.5.5 0 00-.992-.09l-.01.09v4.129l-.004.04v5.658a.5.5 0 00.992.09l.01-.09z"}),Object(x.jsx)("path",{d:"M11.45 15.829a1.5 1.5 0 01-1.06-.44l-2.122-2.121a.5.5 0 11.707-.707l2.121 2.121a.5.5 0 00.707 0l2.122-2.121a.5.5 0 01.707.707l-2.121 2.121a1.5 1.5 0 01-1.061.44zM2.5 4a.5.5 0 00-.5.5v7a.5.5 0 101 0v-7a.5.5 0 00-.5-.5zM5.5 6.5a.5.5 0 00-1 0v5a.5.5 0 101 0v-5zM7.5 8a.5.5 0 01.5.5v3a.5.5 0 11-1 0v-3a.5.5 0 01.5-.5z"})),Ct=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M4.99991 7.49999C4.99991 7.22384 5.22376 6.99999 5.49991 6.99999C5.77605 6.99999 5.99991 7.22384 5.99991 7.49999V14.5C5.99991 14.7761 5.77605 15 5.49991 15C5.22376 15 4.99991 14.7761 4.99991 14.5V7.49999Z"}),Object(x.jsx)("path",{d:"M15.3893 2.38929C15.6706 2.67059 15.8287 3.05212 15.8287 3.44995C15.8287 3.84777 15.6706 4.2293 15.3893 4.51061L13.268 6.63193C13.1742 6.7257 13.0471 6.77838 12.9145 6.77838C12.7818 6.77838 12.6547 6.7257 12.5609 6.63193C12.4671 6.53816 12.4145 6.41098 12.4145 6.27838C12.4145 6.14577 12.4671 6.01859 12.5609 5.92482L14.6822 3.8035C14.776 3.70973 14.8287 3.58256 14.8287 3.44995C14.8287 3.31734 14.776 3.19016 14.6822 3.09639L12.5609 0.975075C12.4671 0.881307 12.4145 0.754129 12.4145 0.621522C12.4145 0.488914 12.4671 0.361736 12.5609 0.267968C12.6547 0.1742 12.7819 0.121521 12.9145 0.121521C13.0471 0.121521 13.1742 0.1742 13.268 0.267968L15.3893 2.38929Z"}),Object(x.jsx)("path",{d:"M3.43867 0.26864C3.53243 0.362408 3.58511 0.489585 3.58511 0.622193C3.58511 0.754801 3.53243 0.881978 3.43867 0.975746L1.31735 3.09707C1.22358 3.19083 1.1709 3.31801 1.1709 3.45062C1.1709 3.58323 1.22358 3.71041 1.31735 3.80417L3.43867 5.92549C3.53243 6.01926 3.58511 6.14644 3.58511 6.27905C3.58511 6.41166 3.53243 6.53883 3.43867 6.6326C3.3449 6.72637 3.21772 6.77905 3.08511 6.77905C2.9525 6.77905 2.82533 6.72637 2.73156 6.6326L0.610239 4.51128C0.328934 4.22998 0.170898 3.84844 0.170898 3.45062C0.170898 3.0528 0.328934 2.67126 0.610238 2.38996L2.73156 0.26864C2.82533 0.174871 2.9525 0.122192 3.08511 0.122192C3.21772 0.122192 3.3449 0.174871 3.43867 0.26864Z"}),Object(x.jsx)("path",{d:"M7.99991 6.99999C8.27605 6.99999 8.49991 7.22384 8.49991 7.49999V12.5C8.49991 12.7761 8.27605 13 7.99991 13C7.72377 13 7.49991 12.7761 7.49991 12.5V7.49999C7.49991 7.22384 7.72377 6.99999 7.99991 6.99999Z"}),Object(x.jsx)("path",{d:"M10.9999 7.49999C10.9999 7.22384 10.776 6.99999 10.4999 6.99999C10.2238 6.99999 9.99991 7.22384 9.99991 7.49999V10.5C9.99991 10.7761 10.2238 11 10.4999 11C10.776 11 10.9999 10.7761 10.9999 10.5V7.49999Z"}),Object(x.jsx)("path",{d:"M3.50015 2.99999C3.22401 2.99999 3.00015 3.22384 3.00015 3.49999C3.00015 3.77613 3.22401 3.99999 3.50015 3.99999H12.5002C12.7763 3.99999 13.0002 3.77613 13.0002 3.49999C13.0002 3.22384 12.7763 2.99999 12.5002 2.99999H3.50015Z"}));function Et(e,t){return e.id===t.id}function St(e,t){const a={auto:[],left:[],right:[],bottom:[]};return null==e||e.forEach((e=>{const n=null==t?void 0:t[e.layerId];e.accessors.forEach((t=>{var i,l,s,r;const o=(null===(i=e.yConfig)||void 0===i||null===(l=i.find((e=>e.forAccessor===t)))||void 0===l?void 0:l.axisMode)||"auto";let u=(null==n||null===(s=n.columns.find((e=>e.id===t)))||void 0===s||null===(r=s.meta)||void 0===r?void 0:r.params)||{id:"number"};e.seriesType.includes("percentage")&&"percent"!==u.id&&(u={id:"percent",params:{pattern:"0.[00]%"}}),a[o].push({layer:e.layerId,accessor:t,fieldFormat:u})}))})),a.auto.forEach((e=>{0===a.left.length||t&&a.left.every((t=>Et(t.fieldFormat,e.fieldFormat)))?a.left.push(e):0===a.right.length||t&&a.left.every((t=>Et(t.fieldFormat,e.fieldFormat)))?a.right.push(e):a.right.length>=a.left.length?a.left.push(e):a.right.push(e)})),a}a(203);const Pt=[{id:"xy_axis_orientation_horizontal",value:0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.horizontal",{defaultMessage:"Horizontal"})},{id:"xy_axis_orientation_vertical",value:-90,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.vertical",{defaultMessage:"Vertical"})},{id:"xy_axis_orientation_angled",value:-45,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.angled",{defaultMessage:"Angled"})}],At=()=>{},Lt=Object(g.htmlIdGenerator)()(),Dt=({layers:e,axis:t,axisTitle:a,updateTitleState:n,toggleTickLabelsVisibility:i,toggleGridlinesVisibility:s,isDisabled:r,areTickLabelsVisible:o,areGridlinesVisible:c,isAxisTitleVisible:d,orientation:p,setOrientation:m,toggleAxisTitleVisibility:f,setEndzoneVisibility:b,endzonesVisible:h,extent:v,setExtent:j,hasBarOrAreaOnAxis:O,hasPercentageAxis:k,dataBounds:I,useMultilayerTimeAxis:T})=>{var F,M;const w=!(null==e||!e.length)&&gt(e),_=((e,t)=>{switch(e){case"yLeft":return{icon:t?Mt:wt,groupPosition:"left",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}):u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}),buttonDataTestSubj:"lnsLeftAxisButton"};case"yRight":return{icon:t?Ct:_t,groupPosition:"right",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.topAxisLabel",{defaultMessage:"Top axis"}):u.i18n.translate("xpack.lens.xyChart.rightAxisLabel",{defaultMessage:"Right axis"}),buttonDataTestSubj:"lnsRightAxisButton"};default:return{icon:t?wt:Mt,groupPosition:"center",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}):u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}),buttonDataTestSubj:"lnsBottomAxisButton"}}})(t,w),{inputValue:C,handleInputChange:E}=Object(y.t)({value:v,onChange:j||At}),[S,P]=Object(l.useState)(C),{inclusiveZeroError:A,boundaryError:L}=function(e,t){return{inclusiveZeroError:t&&e&&(void 0!==t.lowerBound&&t.lowerBound>0||(void 0!==t.upperBound&&t.upperBound)<0),boundaryError:t&&void 0!==t.lowerBound&&void 0!==t.upperBound&&t.upperBound<=t.lowerBound}}(O,S);return Object(l.useEffect)((()=>{!j||A||L||!S||Object(Me.isEqual)(S,C)||E(S)}),[S,A,L,E,C,j]),Object(x.jsx)(y.k,{title:_.popoverTitle,type:_.icon,groupPosition:_.groupPosition,isDisabled:r,buttonDataTestSubj:_.buttonDataTestSubj,panelClassName:"lnsVisToolbarAxis__popover"},Object(x.jsx)(y.a,{axis:t,axisTitle:a,updateTitleState:n,isAxisTitleVisible:d,toggleAxisTitleVisibility:f}),Object(x.jsx)(g.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),fullWidth:!0},Object(x.jsx)(g.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisGridlines`,label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),onChange:()=>s(t),checked:c,showLabel:!1})),Object(x.jsx)(g.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.tickLabels",{defaultMessage:"Tick labels"}),fullWidth:!0},Object(x.jsx)(g.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisTickLabels`,label:u.i18n.translate("xpack.lens.xyChart.tickLabels",{defaultMessage:"Tick labels"}),onChange:()=>i(t),checked:o,showLabel:!1})),Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isDisabled:T,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"})},Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.xyChart.axisOrientationMultilayer.disabled",{defaultMessage:"These options can be configured only with non-time-based axes"}),condition:Boolean(T),display:"block"},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"}),"data-test-subj":"lnsXY_axisOrientation_groups",name:"axisOrientation",isDisabled:!o||Boolean(T),buttonSize:"compressed",options:Pt,idSelected:Pt.find((({value:e})=>e===p)).id,onChange:e=>{const a=Pt.find((({id:t})=>t===e)).value;m(t,a)}}))),b&&Object(x.jsx)(g.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),fullWidth:!0},Object(x.jsx)(g.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowEndzones",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),onChange:()=>b(!Boolean(h)),checked:Boolean(h),showLabel:!1})),S&&j&&Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),helpText:O?u.i18n.translate("xpack.lens.xyChart.axisExtent.disabledDataBoundsMessage",{defaultMessage:"Only line charts can be fit to the data bounds"}):void 0},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),"data-test-subj":"lnsXY_axisBounds_groups",name:"axisBounds",buttonSize:"compressed",options:[{id:`${Lt}full`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.full",{defaultMessage:"Full"}),"data-test-subj":"lnsXY_axisExtent_groups_full"},{id:`${Lt}dataBounds`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.dataBounds",{defaultMessage:"Data"}),"data-test-subj":"lnsXY_axisExtent_groups_DataBounds",isDisabled:O},{id:`${Lt}custom`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsXY_axisExtent_groups_custom",isDisabled:k}],idSelected:`${Lt}${O&&"dataBounds"===S.mode||k?"full":S.mode}`,onChange:e=>{const t=e.replace(Lt,"");P({...S,mode:t,lowerBound:"custom"===t&&I?Math.min(0,I.min):void 0,upperBound:"custom"===t&&I?I.max:void 0})}})),"custom"===(null==S?void 0:S.mode)&&!k&&Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isInvalid:A||L,label:" ",helpText:!O||A&&!L?void 0:u.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}),error:L?u.i18n.translate("xpack.lens.xyChart.boundaryError",{defaultMessage:"Lower bound has to be larger than upper bound"}):O&&A?u.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}):void 0},Object(x.jsx)(g.EuiFormControlLayoutDelimited,{"data-test-subj":"lnsXY_axisExtent_customBounds",startControl:Object(x.jsx)(g.EuiFieldNumber,{compressed:!0,value:null!==(F=S.lowerBound)&&void 0!==F?F:"",isInvalid:A||L,"data-test-subj":"lnsXY_axisExtent_lowerBound",onChange:e=>{const t=Number(e.target.value);""===e.target.value||Number.isNaN(Number(t))?P({...S,lowerBound:void 0}):P({...S,lowerBound:t})},onBlur:()=>{void 0===S.lowerBound&&I&&P({...S,lowerBound:Math.min(0,I.min)})},step:"any",controlOnly:!0}),endControl:Object(x.jsx)(g.EuiFieldNumber,{compressed:!0,value:null!==(M=S.upperBound)&&void 0!==M?M:"","data-test-subj":"lnsXY_axisExtent_upperBound",onChange:e=>{const t=Number(e.target.value);""===e.target.value||Number.isNaN(Number(t))?P({...S,upperBound:void 0}):P({...S,upperBound:t})},onBlur:()=>{void 0===S.upperBound&&I&&P({...S,upperBound:I.max})},step:"any",controlOnly:!0}),compressed:!0})))},Nt=[{id:"None",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.none",{defaultMessage:"Do not fill gaps"})},{id:"Zero",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.zero",{defaultMessage:"Fill gaps with zeros"})},{id:"Linear",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.linear",{defaultMessage:"Linear"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.linear",{defaultMessage:"Fill gaps with a line"})},{id:"Carry",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.carry",{defaultMessage:"Last"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.carry",{defaultMessage:"Fill gaps with the last value"})},{id:"Lookahead",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.lookahead",{defaultMessage:"Next"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.lookahead",{defaultMessage:"Fill gaps with the next value"})}],zt=[{id:"None",title:u.i18n.translate("xpack.lens.endValue.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.endValueDescription.none",{defaultMessage:"Do not extend series to the edge of the chart"})},{id:"Zero",title:u.i18n.translate("xpack.lens.endValue.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.endValueDescription.zero",{defaultMessage:"Extend series as zero to the edge of the chart"})},{id:"Nearest",title:u.i18n.translate("xpack.lens.endValue.nearest",{defaultMessage:"Nearest"}),description:u.i18n.translate("xpack.lens.endValueDescription.nearest",{defaultMessage:"Extend series with the first/last value to the edge of the chart"})}],Bt=({onFittingFnChange:e,fittingFunction:t,emphasizeFitting:a,onEmphasizeFittingChange:n,onEndValueChange:i,endValue:l,isFittingEnabled:r=!0})=>Object(x.jsx)(s.a.Fragment,null,r&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",label:Object(x.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.xyChart.missingValuesLabel",{defaultMessage:"Missing values"})," ",Object(x.jsx)(g.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.xyChart.missingValuesLabelHelpText",{defaultMessage:"By default, area and line charts hide the gaps in the data. To fill the gap, make a selection."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"}))},Object(x.jsx)(g.EuiSuperSelect,{"data-test-subj":"lnsMissingValuesSelect",compressed:!0,options:Nt.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("strong",null,t),Object(x.jsx)(g.EuiText,{size:"xs",color:"subdued"},Object(x.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:t||"None",onChange:t=>e(t),itemLayoutAlign:"top",hasDividers:!0})),t&&"None"!==t&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.endValuesLabel",{defaultMessage:"End values"})},Object(x.jsx)(g.EuiSuperSelect,{"data-test-subj":"lnsEndValuesSelect",compressed:!0,options:zt.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("strong",null,t),Object(x.jsx)(g.EuiText,{size:"xs",color:"subdued"},Object(x.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:l||"None",onChange:e=>i(e),itemLayoutAlign:"top",hasDividers:!0})),Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),display:"columnCompressedSwitch"},Object(x.jsx)(g.EuiSwitch,{showLabel:!1,label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),checked:!a,onChange:()=>{n(!a)},compressed:!0}))))),Vt=({onChange:e,value:t,isCurveTypeEnabled:a=!0})=>a?Object(x.jsx)(g.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.curveStyleLabel",{defaultMessage:"Curve lines"})},Object(x.jsx)(g.EuiSwitch,{showLabel:!1,label:"Curved",checked:"CURVE_MONOTONE_X"===t,compressed:!0,onChange:t=>{t.target.checked?e("CURVE_MONOTONE_X"):e("LINEAR")},"data-test-subj":"lnsCurveStyleToggle"})):null,Rt=({onChange:e,value:t,isFillOpacityEnabled:a=!0})=>{const{inputValue:n,handleInputChange:i}=Object(y.t)({value:t,onChange:e});return a?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.fillOpacityLabel",{defaultMessage:"Fill opacity"}),fullWidth:!0},Object(x.jsx)(g.EuiRange,{"data-test-subj":"lnsFillOpacity",value:n,min:.1,max:1,step:.1,showInput:!0,compressed:!0,fullWidth:!0,onChange:e=>{i(Number(e.currentTarget.value))}}))):null},Ht=({state:e,setState:t,datasourceLayers:a})=>{var n,i;const l=Ke(e.layers),s=l.some((({seriesType:e})=>"area_percentage_stacked"===e)),r=l.some((({seriesType:e})=>["area_stacked","area","line"].includes(e))),o=l.some((({seriesType:e})=>["bar","bar_horizontal"].includes(e))),c=l.some((({seriesType:e})=>["area_stacked","area","area_percentage_stacked"].includes(e))),d=Boolean(function(e=[],t){return!!t&&e.filter((({accessors:e})=>e.length)).some((({layerId:e,xAccessor:a})=>{const n=t[e].getOperationForColumnId(a);return n&&n.isBucketed&&n.scale&&"ordinal"!==n.scale}))}(l,a)),p=!r&&o&&!d,m=r,g=r||s,f=function({isAreaPercentage:e,isHistogramSeries:t}){return t?u.i18n.translate("xpack.lens.xyChart.valuesHistogramDisabledHelpText",{defaultMessage:"This setting cannot be changed on histograms."}):e?u.i18n.translate("xpack.lens.xyChart.valuesPercentageDisabledHelpText",{defaultMessage:"This setting cannot be changed on percentage area charts."}):u.i18n.translate("xpack.lens.xyChart.valuesStackedDisabledHelpText",{defaultMessage:"This setting cannot be changed on stacked or percentage bar charts"})}({isAreaPercentage:s,isHistogramSeries:d}),b=!p&&!m&&!g;return Object(x.jsx)(y.l,{tooltipContent:f,condition:b},Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton",isDisabled:b},Object(x.jsx)(Vt,{isCurveTypeEnabled:g,value:null==e?void 0:e.curveType,onChange:a=>{t({...e,curveType:a})}}),Object(x.jsx)(y.m,{isVisible:p,valueLabels:null!==(n=null==e?void 0:e.valueLabels)&&void 0!==n?n:"hide",onValueLabelChange:a=>{t({...e,valueLabels:a})}}),Object(x.jsx)(Bt,{isFittingEnabled:m,fittingFunction:null==e?void 0:e.fittingFunction,emphasizeFitting:null==e?void 0:e.emphasizeFitting,endValue:null==e?void 0:e.endValue,onFittingFnChange:a=>{t({...e,fittingFunction:a})},onEmphasizeFittingChange:a=>{t({...e,emphasizeFitting:a})},onEndValueChange:a=>{t({...e,endValue:a})}}),Object(x.jsx)(Rt,{isFillOpacityEnabled:c,value:null!==(i=null==e?void 0:e.fillOpacity)&&void 0!==i?i:.3,onChange:a=>{t({...e,fillOpacity:a})}})))};function Gt(e){return null!=e&&"empty"!==e}const qt=[{value:"empty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.noIconLabel",{defaultMessage:"None"})},{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})}],$t=e=>{var t;return e.value?Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiIcon,{type:null!==(t=e.icon)&&void 0!==t?t:e.value})),Object(x.jsx)(g.EuiFlexItem,null,e.label)):null},Wt=({value:e,onChange:t,customIconSet:a=qt})=>{var n;const i=a.find((t=>e===t.value))||a.find((e=>"empty"===e.value));return Object(x.jsx)(g.EuiComboBox,{isClearable:!1,options:a,selectedOptions:[i],onChange:e=>{t(e[0].value)},singleSelection:{asPlainText:!0},renderOption:$t,compressed:!0,prepend:Gt(i.value)?Object(x.jsx)(g.EuiIcon,{type:null!==(n=i.icon)&&void 0!==n?n:i.value}):void 0})};var Ut=a(42),Yt=a.n(Ut);const Kt=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("g",null,Object(x.jsx)("path",{className:"lensChartIcon__subdued",d:"M16 8a1 1 0 011-1h4a1 1 0 011 1v13a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zM1 9a1 1 0 00-1 1v11a1 1 0 001 1h4a1 1 0 001-1V10a1 1 0 00-1-1H1zM9 16a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1H9zM25 11a1 1 0 00-1 1v9a1 1 0 001 1h4a1 1 0 001-1v-9a1 1 0 00-1-1h-4z"}),Object(x.jsx)("path",{className:"lensChartIcon__accent",d:"M10 1a1 1 0 011-1h3a1 1 0 011 1h3v4h-3a1 1 0 01-1-1h-2v9a1 1 0 11-2 0V1z"})));var Xt=a(77),Zt=a(46);const Qt=u.i18n.translate("xpack.lens.xyChart.defaultAnnotationLabel",{defaultMessage:"Event"});function Jt(e,t){const a=e.map((({layerId:e})=>e)),{activeData:n,dateRange:i}=t,l=Yt()(i.fromDate).valueOf(),s=Yt()(i.toDate).valueOf(),r=Yt()((l+s)/2).toISOString();if(!n||Object.entries(n).filter((([e])=>a.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return r;const o=(a.reduce(((t,a)=>{var i,l,s,r;const o=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,u=null===(l=n[a])||void 0===l||null===(s=l.rows)||void 0===s||null===(r=s[0])||void 0===r?void 0:r[o];return u&&u<t?u:t}),864e13)+a.reduce(((t,a)=>{var i,l,s,r,o,u;const c=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,d=null===(l=n[a])||void 0===l||null===(s=l.rows)||void 0===s||null===(r=s[(null==n||null===(o=n[a])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)-1])||void 0===r?void 0:r[c];return d&&d>t?d:t}),-864e13))/2;return l<o&&s>o?Yt()(o).toISOString():r}const ea=(e,t)=>{const a=Ke((null==e?void 0:e.layers)||[]),n=Boolean(a.length&&a.every((e=>e.xAccessor&&Ue("interval","date",(null==t?void 0:t.datasourceLayers)||{})(e)))),i=e&&n?[{groupId:"xAnnotations",columnId:Object(Xt.a)()}]:void 0;return{type:P.o.ANNOTATIONS,label:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabel",{defaultMessage:"Annotations"}),icon:Kt,disabled:!n,toolTipContent:n?void 0:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),initialDimensions:i,noDatasource:!0}},ta=e=>e.annotations.map((e=>({columnId:e.id,triggerIcon:e.isHidden?"invisible":"color",color:(null==e?void 0:e.color)||Zt.defaultAnnotationColor}))),aa=e=>{const t=Je(e),a={},n={};return t.forEach((e=>{e.annotations&&e.annotations.forEach((e=>{a[e.id]=(e=>{let t=e;for(;n[t]>=0;){const a=++n[t];t=u.i18n.translate("xpack.lens.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:a}})}return n[t]=0,t})(e.label)}))})),a},na=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 16 12",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("g",null,Object(x.jsx)("path",{className:"lensChartIcon__subdued",d:"M3.2 4.79997C3.2 4.50542 2.96122 4.26663 2.66667 4.26663H0.533333C0.238784 4.26663 0 4.50542 0 4.79997V6.39997H3.2V4.79997ZM3.2 9.59997H0V13.3333C0 13.6279 0.238784 13.8666 0.533333 13.8666H2.66667C2.96122 13.8666 3.2 13.6279 3.2 13.3333V9.59997ZM8.53333 9.59997H11.7333V13.3333C11.7333 13.6279 11.4946 13.8666 11.2 13.8666H9.06667C8.77211 13.8666 8.53333 13.6279 8.53333 13.3333V9.59997ZM11.7333 6.39997H8.53333V2.66663C8.53333 2.37208 8.77211 2.1333 9.06667 2.1333H11.2C11.4946 2.1333 11.7333 2.37208 11.7333 2.66663V6.39997ZM12.8 9.59997V13.3333C12.8 13.6279 13.0388 13.8666 13.3333 13.8666H15.4667C15.7612 13.8666 16 13.6279 16 13.3333V9.59997H12.8ZM16 6.39997V5.86663C16 5.57208 15.7612 5.3333 15.4667 5.3333H13.3333C13.0388 5.3333 12.8 5.57208 12.8 5.86663V6.39997H16ZM7.46667 11.2C7.46667 10.9054 7.22789 10.6666 6.93333 10.6666H4.8C4.50544 10.6666 4.26667 10.9054 4.26667 11.2V13.3333C4.26667 13.6279 4.50544 13.8666 4.8 13.8666H6.93333C7.22789 13.8666 7.46667 13.6279 7.46667 13.3333V11.2Z"}),Object(x.jsx)("rect",{y:"7.4668",width:"16",height:"1.06667",rx:"0.533334",className:"lensChartIcon__accent"})));function ia(e,t,a){const n=e.some(Ue("interval","number",t)),{right:i,left:l}=St(e,a);return{x:e.some((({xAccessor:e})=>null!=e))&&n,yLeft:l.length>0,yRight:i.length>0}}function la(e,t,{activeData:a},n){if(!a)return 100;const{dataLayers:i,untouchedDataLayers:l,accessors:s}=function(e,t,a){switch(e){case"x":{const e=t.filter((({xAccessor:e})=>e));return{dataLayers:e.map((({accessors:e,xAccessor:t,...a})=>({...a,accessors:[t]}))),untouchedDataLayers:e,accessors:e.map((({xAccessor:e})=>e))}}case"yLeft":case"yRight":{const n="yLeft"===e?"left":"right",{[n]:i}=St(t,a),l=new Set(i.map((({layer:e})=>e))),s=t.filter((({layerId:e})=>l.has(e)));return{dataLayers:s,untouchedDataLayers:s,accessors:i.map((({accessor:e})=>e))}}}}(t,e,a);if("x"===t&&i.length&&!l.some(n))return 100;const r=function(e,t,a,n=!0,i=!0){if(e.length&&t.length){if(e.some((({seriesType:e})=>function(e){return"bar_percentage_stacked"===e||"bar_horizontal_percentage_stacked"===e||"area_percentage_stacked"===e}(e))))return.75;const{min:l,max:s}=function(e,t,a,n=!0){const i=new Set(t);let l,s;const[r,o]=Object(Me.partition)(e,(({seriesType:e})=>function(e){return e.includes("stacked")}(e)&&n));for(const{layerId:e,accessors:t}of o){const n=a[e];if(n)for(const e of t)if(i.has(e))for(const t of n.rows){const a=t[e];"number"==typeof a&&(s=null!=s?Math.max(a,s):a,l=null!=l?Math.min(a,l):a)}}const u={};for(const{layerId:e,accessors:t,xAccessor:n}of r){const l=a[e];if(l)for(const e of t)if(i.has(e))for(const t of l.rows){const a=t[e];let i="shared";var c;n&&(i=t[n]),"number"==typeof a&&(u[i]=null!==(c=u[i])&&void 0!==c?c:0,u[i]+=a)}}for(const e of Object.values(u))s=Math.max(e,s||0,0),l=Math.min(e,l||0,0);return{min:l,max:s}}(e,t,a,i);if(null!=l&&null!=s&&isFinite(l)&&isFinite(s)){const e=n?Math.min(0,l):l;return Number((e+.75*(s-e)).toFixed(2))}}}(i,s,a,"x"!==t,"x"!==t);return null!=r?r:100}const sa=(e,t)=>{const a=function(e,t,a,n){if(!t)return[];const i=ia(Ke(t.layers),a,n);return[{id:"yReferenceLineLeft",label:"yLeft"},{id:"yReferenceLineRight",label:"yRight"},{id:"xReferenceLine",label:"x"}].filter((({label:e})=>i[e]))}(0,e,(null==t?void 0:t.datasourceLayers)||{},null==t?void 0:t.activeData),n=Ke((null==e?void 0:e.layers)||[]),i=n.filter((({accessors:e,xAccessor:t})=>e.length||t)),l=Ue("interval","number",(null==t?void 0:t.datasourceLayers)||{}),s=e?a.map((({id:a,label:i})=>({groupId:a,columnId:Object(Xt.a)(),dataType:"number",label:We(i,{isHorizontal:gt((null==e?void 0:e.layers)||[])}),staticValue:la(n,i,{activeData:null==t?void 0:t.activeData},l)}))):void 0;return{type:P.o.REFERENCELINE,label:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabel",{defaultMessage:"Reference lines"}),icon:na,disabled:!i.length||!n.some(l)&&n.every((({accessors:e})=>!e.length)),toolTipContent:i.length?void 0:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabelDisabledHelp",{defaultMessage:"Add some data to enable reference layer"}),initialDimensions:s}},ra=(e,t=ua)=>({columnId:e,triggerIcon:"color",color:t}),oa=({state:e,frame:t,layer:a,sortedAccessors:n})=>{const i=n.reduce(((e,t,a)=>(e[t]=a,e)),{}),{bottom:l,left:s,right:r}=Object(Me.groupBy)([...a.yConfig||[]].sort((({forAccessor:e},{forAccessor:t})=>i[e]-i[t])),(({axisMode:e})=>e)),o=function(e,t,a,n){if(!t)return[];const i=ia(Ke(t.layers),a,n);return e.filter((({label:e,config:t})=>i[e]||(null==t?void 0:t.length))).map((e=>({...e,valid:i[e.label]})))}([{config:s,id:"yReferenceLineLeft",label:"yLeft",dataTestSubj:"lnsXY_yReferenceLineLeftPanel"},{config:r,id:"yReferenceLineRight",label:"yRight",dataTestSubj:"lnsXY_yReferenceLineRightPanel"},{config:l,id:"xReferenceLine",label:"x",dataTestSubj:"lnsXY_xReferenceLinePanel"}],e,t.datasourceLayers,null==t?void 0:t.activeData),c=gt(e.layers);return{groups:o.map((({config:e=[],id:t,label:a,dataTestSubj:n,valid:i})=>({groupId:t,groupLabel:We(a,{isHorizontal:c}),accessors:e.map((({forAccessor:e,color:t})=>ra(e,t))),filterOperations:ct,supportsMoreColumns:!0,required:!1,enableDimensionEditor:!0,supportStaticValue:!0,paramEditorCustomProps:{label:u.i18n.translate("xpack.lens.indexPattern.staticValue.label",{defaultMessage:"Reference line value"})},supportFieldFormat:!1,dataTestSubj:n,invalid:!i,invalidMessage:"x"===a?u.i18n.translate("xpack.lens.configure.invalidBottomReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists or is no longer valid. You may move this reference line to another available axis or remove it."}):u.i18n.translate("xpack.lens.configure.invalidReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists. You may move this reference line to another available axis or remove it."}),requiresPreviousColumnOnDuplicate:!0})))}},ua=R.euiLightVars.euiColorDarkShade;function ca(e,t,a){const n={};return e.filter((e=>Ye(e))).forEach((e=>{var t;const a=(null===(t=e.palette)||void 0===t?void 0:t.name)||"default";n[a]||(n[a]=[]),n[a].push(e)})),Object(Me.mapValues)(n,(e=>{const n=e.map(((e,n)=>{var i;if(!e.splitAccessor)return{numberOfSeries:e.accessors.length,splits:[]};const l=e.splitAccessor,s=null===(i=t.tables[e.layerId])||void 0===i?void 0:i.columns.find((({id:e})=>e===l)),r=s&&a(s.meta.params),o=s&&t.tables[e.layerId]?Object(Me.uniq)(t.tables[e.layerId].rows.map((e=>{let t=e[l];var a;return t=t&&!(e=>null!=e&&"object"!=typeof e)(t)?null!==(a=null==r?void 0:r.convert(t))&&void 0!==a?a:t:String(t),t}))):[];return{numberOfSeries:(o.length||1)*e.accessors.length,splits:o}}));return{totalSeriesCount:n.reduce(((e,t)=>e+t.numberOfSeries),0),getRank(t,a,i){const l=e.findIndex((e=>t.layerId===e.layerId)),s=n[l].splits.indexOf(a);return(0===l?0:n.slice(0,l).reduce(((e,t)=>e+t.numberOfSeries),0))+(t.splitAccessor&&-1!==s?s*t.accessors.length:0)+t.accessors.indexOf(i)}}}))}function da(e,t,a,n){var i;if(Xe(a))return(e=>e.accessors.map((t=>{var a;const n=null===(a=e.yConfig)||void 0===a?void 0:a.find((e=>e.forAccessor===t));return ra(t,null==n?void 0:n.color)})))(a);if(Qe(a))return ta(a);const l=Boolean(a.splitAccessor),s=a.palette||{type:"palette",name:"default"},r=null===(i=e[s.name])||void 0===i?void 0:i.totalSeriesCount;return a.accessors.map((i=>{var o;const u=null===(o=a.yConfig)||void 0===o?void 0:o.find((e=>e.forAccessor===i));if(l)return{columnId:i,triggerIcon:"disabled"};const c=bt(a,t.datasourceLayers[a.layerId]),d=e[s.name].getRank(a,c[i]||i,i),p=(null==u?void 0:u.color)||(null!=r?n.get(s.name).getCategoricalColor([{name:c[i]||i,rankAtDepth:d,totalSeriesAtDepth:r}],{maxDepth:1,totalSeries:r},s.params):void 0);return{columnId:i,triggerIcon:p?"color":"disabled",color:null!=p?p:void 0}}))}const pa=(e,t)=>{const a=e?e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.accessors.includes(e))):t.accessors;return Array.from(new Set(a.concat(t.accessors)))},ma=(e,t,a,n={},i)=>{if(!e||!e.layers.length)return null;const l={};return e.layers.forEach((e=>{l[e.layerId]={};const a=t[e.layerId];a&&a.getTableSpec().forEach((a=>{const n=t[e.layerId].getOperationForColumnId(a.columnId);l[e.layerId][a.columnId]=n}))})),ba(e,l,t,a,n,i)},ga={[P.o.DATA]:e=>({...e,hide:!0}),[P.o.REFERENCELINE]:e=>{var t;return{...e,hide:!0,yConfig:null===(t=e.yConfig)||void 0===t?void 0:t.map((({lineWidth:e,...t})=>({...t,lineWidth:1,icon:void 0,textVisibility:!1})))}},[P.o.ANNOTATIONS]:e=>{var t;return{...e,hide:!0,annotations:null===(t=e.annotations)||void 0===t?void 0:t.map((({lineWidth:e,...t})=>({...t,lineWidth:1,icon:void 0,textVisibility:!1})))}}};function fa(e,t){if(!e)return t;if("ordinal"===e.scale)return oe.ScaleType.Ordinal;if("interval"===e.scale||"ratio"===e.scale)return"date"===e.dataType?oe.ScaleType.Time:oe.ScaleType.Linear;switch(e.dataType){case"boolean":case"string":case"ip":return oe.ScaleType.Ordinal;case"date":return oe.ScaleType.Time;default:return oe.ScaleType.Linear}}const ba=(e,t,a,n,i={},l)=>{var s,r,o,u,c,d,p,m,g,f,b,h,x,v,y,j,O,k,I,T,F,M,w,_,C,E,S,P,A,L,D,N,z,B,V;const R=Ke(e.layers).filter((e=>Boolean(e.accessors.length))).map((e=>({...e,accessors:pa(a[e.layerId],e)}))),H=Ze(e.layers).filter((e=>Boolean(e.accessors.length))),G=aa(e.layers),q=Je(e.layers).filter((e=>Boolean(e.annotations.length))).map((e=>({...e,annotations:e.annotations.map((e=>({...e,label:G[e.id]})))})));return R.length?{type:"expression",chain:[{type:"function",function:"xyVis",arguments:{title:[(null==i?void 0:i.title)||""],description:[(null==i?void 0:i.description)||""],xTitle:[e.xTitle||""],yTitle:[e.yTitle||""],yRightTitle:[e.yRightTitle||""],legend:[{type:"expression",chain:[{type:"function",function:"legendConfig",arguments:{isVisible:[e.legend.isVisible],showSingleSeries:e.legend.showSingleSeries?[e.legend.showSingleSeries]:[],position:[e.legend.position],isInside:e.legend.isInside?[e.legend.isInside]:[],legendSize:e.legend.legendSize?[e.legend.legendSize]:[],horizontalAlignment:e.legend.horizontalAlignment?[e.legend.horizontalAlignment]:[],verticalAlignment:e.legend.verticalAlignment?[e.legend.verticalAlignment]:[],floatingColumns:e.legend.floatingColumns?[Math.min(5,e.legend.floatingColumns)]:[],maxLines:e.legend.maxLines?[e.legend.maxLines]:[],shouldTruncate:[null!==(s=e.legend.shouldTruncate)&&void 0!==s?s:ve(e,a).truncateText]}}]}],fittingFunction:[e.fittingFunction||"None"],endValue:[e.endValue||"None"],emphasizeFitting:[e.emphasizeFitting||!1],curveType:[e.curveType||"LINEAR"],fillOpacity:[e.fillOpacity||.3],yLeftExtent:[{type:"expression",chain:[{type:"function",function:"axisExtentConfig",arguments:{mode:[(null==e||null===(r=e.yLeftExtent)||void 0===r?void 0:r.mode)||"full"],lowerBound:void 0!==(null==e||null===(o=e.yLeftExtent)||void 0===o?void 0:o.lowerBound)?[null==e||null===(u=e.yLeftExtent)||void 0===u?void 0:u.lowerBound]:[],upperBound:void 0!==(null==e||null===(c=e.yLeftExtent)||void 0===c?void 0:c.upperBound)?[null==e||null===(d=e.yLeftExtent)||void 0===d?void 0:d.upperBound]:[]}}]}],yRightExtent:[{type:"expression",chain:[{type:"function",function:"axisExtentConfig",arguments:{mode:[(null==e||null===(p=e.yRightExtent)||void 0===p?void 0:p.mode)||"full"],lowerBound:void 0!==(null==e||null===(m=e.yRightExtent)||void 0===m?void 0:m.lowerBound)?[null==e||null===(g=e.yRightExtent)||void 0===g?void 0:g.lowerBound]:[],upperBound:void 0!==(null==e||null===(f=e.yRightExtent)||void 0===f?void 0:f.upperBound)?[null==e||null===(b=e.yRightExtent)||void 0===b?void 0:b.upperBound]:[]}}]}],axisTitlesVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"axisTitlesVisibilityConfig",arguments:{x:[null===(h=null==e||null===(x=e.axisTitlesVisibilitySettings)||void 0===x?void 0:x.x)||void 0===h||h],yLeft:[null===(v=null==e||null===(y=e.axisTitlesVisibilitySettings)||void 0===y?void 0:y.yLeft)||void 0===v||v],yRight:[null===(j=null==e||null===(O=e.axisTitlesVisibilitySettings)||void 0===O?void 0:O.yRight)||void 0===j||j]}}]}],tickLabelsVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"tickLabelsConfig",arguments:{x:[null===(k=null==e||null===(I=e.tickLabelsVisibilitySettings)||void 0===I?void 0:I.x)||void 0===k||k],yLeft:[null===(T=null==e||null===(F=e.tickLabelsVisibilitySettings)||void 0===F?void 0:F.yLeft)||void 0===T||T],yRight:[null===(M=null==e||null===(w=e.tickLabelsVisibilitySettings)||void 0===w?void 0:w.yRight)||void 0===M||M]}}]}],gridlinesVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"gridlinesConfig",arguments:{x:[null===(_=null==e||null===(C=e.gridlinesVisibilitySettings)||void 0===C?void 0:C.x)||void 0===_||_],yLeft:[null===(E=null==e||null===(S=e.gridlinesVisibilitySettings)||void 0===S?void 0:S.yLeft)||void 0===E||E],yRight:[null===(P=null==e||null===(A=e.gridlinesVisibilitySettings)||void 0===A?void 0:A.yRight)||void 0===P||P]}}]}],labelsOrientation:[{type:"expression",chain:[{type:"function",function:"labelsOrientationConfig",arguments:{x:[null!==(L=null==e||null===(D=e.labelsOrientation)||void 0===D?void 0:D.x)&&void 0!==L?L:0],yLeft:[null!==(N=null==e||null===(z=e.labelsOrientation)||void 0===z?void 0:z.yLeft)&&void 0!==N?N:0],yRight:[null!==(B=null==e||null===(V=e.labelsOrientation)||void 0===V?void 0:V.yRight)&&void 0!==B?B:0]}}]}],valueLabels:[(null==e?void 0:e.valueLabels)||"hide"],hideEndzones:[(null==e?void 0:e.hideEndzones)||!1],valuesInLegend:[(null==e?void 0:e.valuesInLegend)||!1],layers:[...R.map((e=>va(e,a[e.layerId],t,n))),...H.map((e=>ha(e,a[e.layerId]))),...q.map((e=>xa(e,l)))]}}]}:null},ha=(e,t)=>({type:"expression",chain:[{type:"function",function:"referenceLineLayer",arguments:{layerId:[e.layerId],yConfig:e.yConfig?e.yConfig.map((e=>ya(e,ua))):[],accessors:e.accessors,columnToLabel:[JSON.stringify(bt(e,t))]}}]}),xa=(e,t)=>({type:"expression",chain:[{type:"function",function:"annotationLayer",arguments:{hide:[Boolean(e.hide)],layerId:[e.layerId],annotations:e.annotations?e.annotations.map((e=>t.toExpression({time:e.key.timestamp,label:e.label||Qt,textVisibility:e.textVisibility,icon:e.icon,lineStyle:e.lineStyle,lineWidth:e.lineWidth,color:e.color,isHidden:Boolean(e.isHidden)}))):[]}}]}),va=(e,t,a,n)=>{const i=bt(e,t),l=null==t?void 0:t.getOperationForColumnId(e.xAccessor),s=Boolean(l&&l.isBucketed&&l.scale&&"ordinal"!==l.scale);return{type:"expression",chain:[{type:"function",function:"dataLayer",arguments:{layerId:[e.layerId],hide:[Boolean(e.hide)],xAccessor:e.xAccessor?[e.xAccessor]:[],yScaleType:[fa(a[e.layerId][e.accessors[0]],oe.ScaleType.Ordinal)],xScaleType:[fa(a[e.layerId][e.xAccessor],oe.ScaleType.Linear)],isHistogram:[s],splitAccessor:e.splitAccessor?[e.splitAccessor]:[],yConfig:e.yConfig?e.yConfig.map((e=>ya(e))):[],seriesType:[e.seriesType],accessors:e.accessors,columnToLabel:[JSON.stringify(i)],palette:[{type:"expression",chain:[e.palette?{type:"function",function:"theme",arguments:{variable:["palette"],default:[n.get(e.palette.name).toExpression(e.palette.params)]}}:{type:"function",function:"system_palette",arguments:{name:["default"]}}]}]}}]}},ya=(e,t)=>({type:"expression",chain:[{type:"function",function:"yConfig",arguments:{forAccessor:[e.forAccessor],axisMode:e.axisMode?[e.axisMode]:[],color:e.color?[e.color]:t?[t]:[],lineStyle:[e.lineStyle||"solid"],lineWidth:[e.lineWidth||1],fill:[e.fill||"none"],icon:Gt(e.icon)?[e.icon]:[],iconPosition:Gt(e.icon)||e.textVisibility?[e.iconPosition||"auto"]:["auto"],textVisibility:[e.textVisibility||!1]}}]});function ja(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const Oa=[{id:"xy_legend_auto",value:"auto",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"xy_legend_show",value:"show",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"xy_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.hide",{defaultMessage:"Hide"})}];function ka(e,t,a){var n;return Boolean(null===(n=e.find((e=>e.groupId===t)))||void 0===n?void 0:n.series.some((({layer:e})=>Ke(null==a?void 0:a.layers).find((t=>t.layerId===e&&t.seriesType.includes("percentage"))))))}const Ia=Object(l.memo)((function(e){var t,a,n,i,s,r,o,c,d,p,m,f,b,h,v,j,O,k,I,T,F,M,w,_,C,E,S,P,A;const{state:L,setState:D,frame:N,useLegacyTimeAxis:z}=e,B=Ke(null==L?void 0:L.layers),V=!(null==L||!L.layers.length)&&gt(L.layers),R=function(e,t,a,n){const i=St(e,a),l=[];return i.left.length>0&&l.push({groupId:"left",position:t?"bottom":"left",formatter:void 0,series:i.left.map((({fieldFormat:e,...t})=>t))}),i.right.length>0&&l.push({groupId:"right",position:t?"top":"right",formatter:void 0,series:i.right.map((({fieldFormat:e,...t})=>t))}),l}(B,V,N.activeData),H=function(e,t){const a={};return t.forEach((t=>{let n=Number.MAX_VALUE,i=Number.MIN_VALUE;t.series.forEach((t=>{var a;null==e||null===(a=e[t.layer])||void 0===a||a.rows.forEach((e=>{const a=e[t.accessor];Number.isNaN(a)||(a<n&&(n=a),a>i&&(i=a))}))})),n!==Number.MAX_VALUE&&i!==Number.MIN_VALUE&&(a[t.groupId]={min:Math.round(100*(n+Number.EPSILON))/100,max:Math.round(100*(i+Number.EPSILON))/100})})),a}(N.activeData,R),G={x:null===(t=null==L||null===(a=L.tickLabelsVisibilitySettings)||void 0===a?void 0:a.x)||void 0===t||t,yLeft:null===(n=null==L||null===(i=L.tickLabelsVisibilitySettings)||void 0===i?void 0:i.yLeft)||void 0===n||n,yRight:null===(s=null==L||null===(r=L.tickLabelsVisibilitySettings)||void 0===r?void 0:r.yRight)||void 0===s||s},q=e=>{const t={...G,[e]:!G[e]};D({...L,tickLabelsVisibilitySettings:t})},$={x:null===(o=null==L||null===(c=L.gridlinesVisibilitySettings)||void 0===c?void 0:c.x)||void 0===o||o,yLeft:null===(d=null==L||null===(p=L.gridlinesVisibilitySettings)||void 0===p?void 0:p.yLeft)||void 0===d||d,yRight:null===(m=null==L||null===(f=L.gridlinesVisibilitySettings)||void 0===f?void 0:f.yRight)||void 0===m||m},W=e=>{const t={...$,[e]:!$[e]};D({...L,gridlinesVisibilitySettings:t})},U={x:null!==(b=null==L||null===(h=L.labelsOrientation)||void 0===h?void 0:h.x)&&void 0!==b?b:0,yLeft:null!==(v=null==L||null===(j=L.labelsOrientation)||void 0===j?void 0:j.yLeft)&&void 0!==v?v:0,yRight:null!==(O=null==L||null===(k=L.labelsOrientation)||void 0===k?void 0:k.yRight)&&void 0!==O?O:0},Y=(e,t)=>{const a={...U,[e]:t};D({...L,labelsOrientation:a})},K={x:null===(I=null==L||null===(T=L.axisTitlesVisibilitySettings)||void 0===T?void 0:T.x)||void 0===I||I,yLeft:null===(F=null==L||null===(M=L.axisTitlesVisibilitySettings)||void 0===M?void 0:M.yLeft)||void 0===F||F,yRight:null===(w=null==L||null===(_=L.axisTitlesVisibilitySettings)||void 0===_?void 0:_.yRight)||void 0===w||w},X=(e,t)=>{const a={...K,[e]:t};D({...L,axisTitlesVisibilitySettings:a})},Z=B.every((t=>!t.xAccessor||"ordinal"!==fa(e.frame.datasourceLayers[t.layerId].getOperationForColumnId(t.xAccessor),oe.ScaleType.Linear))),Q=B.every((t=>t.xAccessor&&"time"===fa(e.frame.datasourceLayers[t.layerId].getOperationForColumnId(t.xAccessor),oe.ScaleType.Linear)))?e=>{D({...L,hideEndzones:!e})}:void 0,J=null==L||!L.legend.isVisible||null!=L&&L.legend.showSingleSeries?null!=L&&L.legend.isVisible?"show":"hide":"auto",ee=Boolean(null===(C=R.find((e=>"left"===e.groupId)))||void 0===C||null===(E=C.series)||void 0===E?void 0:E.some((e=>{var t;const a=null===(t=B.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),te=Object(l.useCallback)((e=>{D({...L,yLeftExtent:e})}),[D,L]),ae=Boolean(null===(S=R.find((e=>"right"===e.groupId)))||void 0===S||null===(P=S.series)||void 0===P?void 0:P.some((e=>{var t;const a=null===(t=B.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),ne=Object(l.useCallback)((e=>{D({...L,yRightExtent:e})}),[D,L]),ie=B.filter((e=>e.seriesType.includes("bar"))),le=ie.length>1||ie.some((e=>e.accessors.length>1||e.splitAccessor)),se=B.some((({xAccessor:t,layerId:a,seriesType:n,splitAccessor:i})=>{if(!t)return!1;const l=e.frame.datasourceLayers[a].getOperationForColumnId(t);return fa(l,oe.ScaleType.Linear)===oe.ScaleType.Time&&(null==l?void 0:l.isBucketed)&&(n.includes("stacked")||!i)&&(n.includes("stacked")||!n.includes("bar")||!le)})),re=ve(L,e.frame.datasourceLayers).truncateText;return Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(Ht,{state:L,setState:D,datasourceLayers:N.datasourceLayers}),Object(x.jsx)(y.f,{legendOptions:Oa,mode:J,location:null!=L&&L.legend.isInside?"inside":"outside",onLocationChange:e=>{D({...L,legend:{...L.legend,isInside:"inside"===e}})},onDisplayChange:e=>{const t=Oa.find((({id:t})=>t===e)).value;"auto"===t?D({...L,legend:{...L.legend,isVisible:!0,showSingleSeries:!1}}):"show"===t?D({...L,legend:{...L.legend,isVisible:!0,showSingleSeries:!0}}):"hide"===t&&D({...L,legend:{...L.legend,isVisible:!1,showSingleSeries:!1}})},position:null==L?void 0:L.legend.position,horizontalAlignment:null==L?void 0:L.legend.horizontalAlignment,verticalAlignment:null==L?void 0:L.legend.verticalAlignment,floatingColumns:null==L?void 0:L.legend.floatingColumns,onFloatingColumnsChange:e=>{D({...L,legend:{...L.legend,floatingColumns:e}})},maxLines:null==L?void 0:L.legend.maxLines,onMaxLinesChange:e=>{D({...L,legend:{...L.legend,maxLines:e}})},shouldTruncate:null!==(A=null==L?void 0:L.legend.shouldTruncate)&&void 0!==A?A:re,onTruncateLegendChange:()=>{var e;const t=null!==(e=null==L?void 0:L.legend.shouldTruncate)&&void 0!==e?e:re;D({...L,legend:{...L.legend,shouldTruncate:!t}})},onPositionChange:e=>{D({...L,legend:{...L.legend,position:e}})},onAlignmentChange:e=>{const[t,a]=e.split("_"),n=t,i=a;D({...L,legend:{...L.legend,verticalAlignment:n,horizontalAlignment:i}})},renderValueInLegendSwitch:Z,valueInLegend:null==L?void 0:L.valuesInLegend,onValueInLegendChange:()=>{D({...L,valuesInLegend:!L.valuesInLegend})},legendSize:L.legend.legendSize,onLegendSizeChange:e=>{D({...L,legend:{...L.legend,legendSize:e}})}}))),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(y.l,{tooltipContent:V?u.i18n.translate("xpack.lens.xyChart.bottomAxisDisabledHelpText",{defaultMessage:"This setting only applies when bottom axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.leftAxisDisabledHelpText",{defaultMessage:"This setting only applies when left axis is enabled."}),condition:0===Object.keys(R.find((e=>"left"===e.groupId))||{}).length},Object(x.jsx)(Dt,{axis:"yLeft",layers:null==L?void 0:L.layers,axisTitle:null==L?void 0:L.yTitle,updateTitleState:e=>D({...L,yTitle:e}),areTickLabelsVisible:G.yLeft,toggleTickLabelsVisibility:q,areGridlinesVisible:$.yLeft,toggleGridlinesVisibility:W,isDisabled:0===Object.keys(R.find((e=>"left"===e.groupId))||{}).length,orientation:U.yLeft,setOrientation:Y,isAxisTitleVisible:K.yLeft,toggleAxisTitleVisibility:X,extent:(null==L?void 0:L.yLeftExtent)||{mode:"full"},setExtent:te,hasBarOrAreaOnAxis:ee,dataBounds:H.left,hasPercentageAxis:ka(R,"left",L)})),Object(x.jsx)(Dt,{axis:"x",layers:null==L?void 0:L.layers,axisTitle:null==L?void 0:L.xTitle,updateTitleState:e=>D({...L,xTitle:e}),areTickLabelsVisible:G.x,toggleTickLabelsVisibility:q,areGridlinesVisible:$.x,toggleGridlinesVisibility:W,orientation:U.x,setOrientation:Y,isAxisTitleVisible:K.x,toggleAxisTitleVisibility:X,endzonesVisible:!(null!=L&&L.hideEndzones),setEndzoneVisibility:Q,hasBarOrAreaOnAxis:!1,hasPercentageAxis:!1,useMultilayerTimeAxis:se&&!z&&!V}),Object(x.jsx)(y.l,{tooltipContent:V?u.i18n.translate("xpack.lens.xyChart.topAxisDisabledHelpText",{defaultMessage:"This setting only applies when top axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.rightAxisDisabledHelpText",{defaultMessage:"This setting only applies when right axis is enabled."}),condition:0===Object.keys(R.find((e=>"right"===e.groupId))||{}).length},Object(x.jsx)(Dt,{axis:"yRight",layers:null==L?void 0:L.layers,axisTitle:null==L?void 0:L.yRightTitle,updateTitleState:e=>D({...L,yRightTitle:e}),areTickLabelsVisible:G.yRight,toggleTickLabelsVisibility:q,areGridlinesVisible:$.yRight,toggleGridlinesVisibility:W,isDisabled:0===Object.keys(R.find((e=>"right"===e.groupId))||{}).length,orientation:U.yRight,setOrientation:Y,hasPercentageAxis:ka(R,"right",L),isAxisTitleVisible:K.yRight,toggleAxisTitleVisibility:X,extent:(null==L?void 0:L.yRightExtent)||{mode:"full"},setExtent:ne,hasBarOrAreaOnAxis:ae,dataBounds:H.right})))))})),Ta={auto:u.i18n.translate("xpack.lens.configPanel.color.tooltip.auto",{defaultMessage:"Lens automatically picks colors for you unless you specify a custom color."}),custom:u.i18n.translate("xpack.lens.configPanel.color.tooltip.custom",{defaultMessage:"Clear the custom color to return to Auto mode."}),disabled:u.i18n.translate("xpack.lens.configPanel.color.tooltip.disabled",{defaultMessage:"Individual series cannot be custom colored when the layer includes a Break down by."})},Fa=({state:e,layerId:t,accessor:a,frame:n,formatFactory:i,paletteService:r,label:o,disableHelpTooltip:c,disabled:d,setConfig:p})=>{const m=e.layers.findIndex((e=>e.layerId===t)),f=e.layers[m],b=((e,t)=>{var a,n,i,l;return Qe(e)?(null==e||null===(i=e.annotations)||void 0===i||null===(l=i.find((e=>e.id===t)))||void 0===l?void 0:l.color)||null:Ye(e)&&e.splitAccessor?null:(null==e||null===(a=e.yConfig)||void 0===a||null===(n=a.find((e=>e.forAccessor===t)))||void 0===n?void 0:n.color)||null})(f,a),h=Object(l.useMemo)((()=>{var t,l;if(b||!n.activeData)return b;if(Xe(f))return ua;if(Qe(f))return Zt.defaultAnnotationColor;const s=f,o=pa(null!==(t=n.datasourceLayers[f.layerId])&&void 0!==t?t:f.accessors,f);return(null===(l=da(ca(Ke(e.layers),{tables:n.activeData},i),n,{...s,accessors:o.filter((e=>s.accessors.includes(e)))},r).find((e=>e.columnId===a)))||void 0===l?void 0:l.color)||null}),[b,n,r,e.layers,a,i,f]),[v,j]=Object(l.useState)(h),O=null!=o?o:u.i18n.translate("xpack.lens.xyChart.seriesColor.label",{defaultMessage:"Series color"}),k=Object(x.jsx)(g.EuiColorPicker,{"data-test-subj":"indexPattern-dimension-colorPicker",compressed:!0,isClearable:Boolean(b),onChange:(e,t)=>{if(j(e),t.isValid||""===e){const a=""===e?void 0:t.hex;p({color:a})}},color:d?"":v||h,disabled:d,placeholder:u.i18n.translate("xpack.lens.xyChart.seriesColor.auto",{defaultMessage:"Auto"}),"aria-label":O});return Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(x.jsx)(y.l,{delay:"long",position:"top",tooltipContent:v&&!d?Ta.custom:Ta.auto,condition:!c},Object(x.jsx)("span",null,O,!c&&Object(x.jsx)(s.a.Fragment,null,"",Object(x.jsx)(g.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))))},d?Object(x.jsx)(g.EuiToolTip,{position:"top",content:Ta.disabled,delay:"long",anchorClassName:"eui-displayBlock"},k):k)},Ma=u.i18n.translate("xpack.lens.xyChart.markerPosition.above",{defaultMessage:"Top"}),wa=u.i18n.translate("xpack.lens.xyChart.markerPosition.below",{defaultMessage:"Bottom"}),_a=u.i18n.translate("xpack.lens.xyChart.markerPosition.left",{defaultMessage:"Left"}),Ca=u.i18n.translate("xpack.lens.xyChart.markerPosition.right",{defaultMessage:"Right"});function Ea({isHorizontal:e,axisMode:t}){const a={id:`${Wa}auto`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_markerPosition_auto"};return"bottom"===t?[{id:`${Wa}below`,label:e?_a:wa,"data-test-subj":"lnsXY_markerPosition_below"},a,{id:`${Wa}above`,label:e?Ca:Ma,"data-test-subj":"lnsXY_markerPosition_above"}]:[{id:`${Wa}left`,label:e?wa:_a,"data-test-subj":"lnsXY_markerPosition_left"},a,{id:`${Wa}right`,label:e?Ma:Ca,"data-test-subj":"lnsXY_markerPosition_right"}]}const Sa=({currentConfig:e,setConfig:t,customIconSet:a})=>Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),display:"columnCompressed",fullWidth:!0},Object(x.jsx)(g.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),"data-test-subj":"lns-lineMarker-text-visibility",name:"textVisibilityStyle",buttonSize:"compressed",options:[{id:`${Wa}none`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.textVisibility.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_textVisibility_none"},{id:`${Wa}name`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.textVisibility.name",{defaultMessage:"Name"}),"data-test-subj":"lnsXY_textVisibility_name"}],idSelected:`${Wa}${Boolean(null==e?void 0:e.textVisibility)?"name":"none"}`,onChange:e=>{t({textVisibility:e===`${Wa}name`})},isFullWidth:!0})),Pa=({currentConfig:e,setConfig:t,customIconSet:a})=>Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.icon",{defaultMessage:"Icon decoration"})},Object(x.jsx)(Wt,{customIconSet:a,value:null==e?void 0:e.icon,onChange:e=>{t({icon:e})}})),Aa=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(x.jsx)(s.a.Fragment,null,Gt(null==e?void 0:e.icon)||null!=e&&e.textVisibility?Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isDisabled:!(Gt(null==e?void 0:e.icon)||null!=e&&e.textVisibility),label:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"})},Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.lineMarker.positionRequirementTooltip",{defaultMessage:"You must select an icon or show the name in order to alter its position"}),condition:!(Gt(null==e?void 0:e.icon)||null!=e&&e.textVisibility),position:"top",delay:"regular",display:"block"},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"}),"data-test-subj":"lnsXY_markerPosition",name:"markerPosition",isDisabled:!(Gt(null==e?void 0:e.icon)||null!=e&&e.textVisibility),buttonSize:"compressed",options:Ea({isHorizontal:a,axisMode:e.axisMode}),idSelected:`${Wa}${(null==e?void 0:e.iconPosition)||"auto"}`,onChange:e=>{const a=e.replace(Wa,"");t({iconPosition:a})}}))):null),La=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.label",{defaultMessage:"Line"})},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween",responsive:!1},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(Na,{value:(null==e?void 0:e.lineWidth)||1,onChange:e=>{t({lineWidth:e})}})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.xyChart.lineStyle.label",{defaultMessage:"Line"}),"data-test-subj":"lnsXY_line_style",name:"lineStyle",buttonSize:"compressed",options:[{id:`${Wa}solid`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.solid",{defaultMessage:"Solid"}),"data-test-subj":"lnsXY_line_style_solid",iconType:"lineSolid"},{id:`${Wa}dashed`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.dashed",{defaultMessage:"Dashed"}),"data-test-subj":"lnsXY_line_style_dashed",iconType:"lineDashed"},{id:`${Wa}dotted`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.dotted",{defaultMessage:"Dotted"}),"data-test-subj":"lnsXY_line_style_dotted",iconType:"lineDotted"}],idSelected:`${Wa}${(null==e?void 0:e.lineStyle)||"solid"}`,onChange:e=>{const a=e.replace(Wa,"");t({lineStyle:a})},isIconOnly:!0})))));function Da(e,t,a,n){return""===e?t:Math.max(1,Math.min(e,10))}const Na=({value:e,onChange:t})=>{const[a,n]=Object(l.useState)(String(e));return Object(x.jsx)(g.EuiFieldNumber,{"data-test-subj":"lnsXYThickness",value:a,fullWidth:!0,min:1,max:10,step:1,append:"px",compressed:!0,onChange:({currentTarget:{value:e}})=>{n(e);const a=""===e?"":Number(e),i=Da(Number(e),Number(e));a===i&&t(i)},onBlur:()=>{if(a!==String(e)){const i=Da(""===a?a:Number(a),e);t(i),n(String(i))}}})},za=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=gt(a.layers),d=a.layers.findIndex((e=>e.layerId===r)),{inputValue:p,handleInputChange:m}=Object(y.t)({value:a,onChange:n}),g=p.layers.find((e=>e.layerId===r)),f=null==g||null===(t=g.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),b=Object(l.useCallback)((e=>{if(null==e)return;const t=[...g.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m(ja(p,{...g,yConfig:t},d))}),[o,d,p,g,m]);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(Sa,{setConfig:b,currentConfig:f}),Object(x.jsx)(Pa,{setConfig:b,currentConfig:f}),Object(x.jsx)(Aa,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(x.jsx)(La,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(x.jsx)(Va,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(x.jsx)(Fa,i()({},e,{setConfig:b,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})))};function Ba({isHorizontal:e,axisMode:t}){const a=u.i18n.translate("xpack.lens.xyChart.fill.above",{defaultMessage:"Above"}),n=u.i18n.translate("xpack.lens.xyChart.fill.below",{defaultMessage:"Below"}),i=u.i18n.translate("xpack.lens.xyChart.fill.before",{defaultMessage:"Before"}),l=u.i18n.translate("xpack.lens.xyChart.fill.after",{defaultMessage:"After"}),s="bottom"===t||e?l:a,r="bottom"===t||e?i:n;return[{id:`${Wa}none`,label:u.i18n.translate("xpack.lens.xyChart.fill.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_fill_none"},{id:`${Wa}above`,label:s,"data-test-subj":"lnsXY_fill_above"},{id:`${Wa}below`,label:r,"data-test-subj":"lnsXY_fill_below"}]}const Va=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"})},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"}),"data-test-subj":"lnsXY_fill",name:"fill",buttonSize:"compressed",options:Ba({isHorizontal:a,axisMode:null==e?void 0:e.axisMode}),idSelected:`${Wa}${(null==e?void 0:e.fill)||"none"}`,onChange:e=>{const a=e.replace(Wa,"");t({fill:a})}})),Ra=[{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"circle",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.circleIconLabel",{defaultMessage:"Circle"}),icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("circle",{strokeWidth:"1",stroke:"currentColor",cx:"8",cy:"8",className:h()("lensAnnotationIconNoFill",a.className),r:"7"})),canFill:!0},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"heart",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.heartLabel",{defaultMessage:"Heart"})},{value:"mapMarker",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.mapMarkerLabel",{defaultMessage:"Map Marker"})},{value:"pinFilled",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.mapPinLabel",{defaultMessage:"Map Pin"})},{value:"starEmpty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.starLabel",{defaultMessage:"Star"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})},{value:"triangle",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.triangleIconLabel",{defaultMessage:"Triangle"}),icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{strokeWidth:"1",stroke:"currentColor",d:"M 6.9 11.612 C 7.64533 12.7953 8.39067 12.7953 9.136 11.612 L 13.11 5.3 C 13.8553 4.11667 13.4827 3.525 11.992 3.525 L 4.044 3.525 C 2.55333 3.525 2.18067 4.11667 2.926 5.3 Z",className:h()("lensAnnotationIconNoFill",a.className)})),shouldRotate:!0,canFill:!0}],Ha=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=gt(a.layers),{inputValue:d,handleInputChange:p}=Object(y.t)({value:a,onChange:n}),m=d.layers.findIndex((e=>e.layerId===r)),g=d.layers.find((e=>e.layerId===r)),f=null===(t=g.annotations)||void 0===t?void 0:t.find((e=>e.id===o)),b=Object(l.useCallback)((e=>{if(null==e)return;const t=[...g.annotations||[]],a=t.findIndex((e=>e.id===o));-1!==a&&(t[a]={...t[a],...e},p(ja(d,{...g,annotations:t},m)))}),[o,m,d,g,p]);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(y.d,{title:u.i18n.translate("xpack.lens.xyChart.placement",{defaultMessage:"Placement"})},Object(x.jsx)(Ga,{value:Yt()(null==f?void 0:f.key.timestamp),onChange:e=>{e&&b({key:{...(null==f?void 0:f.key)||{type:"point_in_time"},timestamp:e.toISOString()}})},label:u.i18n.translate("xpack.lens.xyChart.annotationDate",{defaultMessage:"Annotation date"})})),Object(x.jsx)(y.d,{title:u.i18n.translate("xpack.lens.xyChart.appearance",{defaultMessage:"Appearance"})},Object(x.jsx)(y.g,{value:(null==f?void 0:f.label)||Qt,defaultValue:Qt,onChange:e=>{b({label:e})}}),Object(x.jsx)(Pa,{setConfig:b,currentConfig:{axisMode:"bottom",...f},customIconSet:Ra}),Object(x.jsx)(Sa,{setConfig:b,currentConfig:{axisMode:"bottom",...f}}),Object(x.jsx)(La,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(x.jsx)(Fa,i()({},e,{setConfig:b,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})),Object(x.jsx)(qa,{value:Boolean(null==f?void 0:f.isHidden),onChange:e=>b({isHidden:e.target.checked})})))},Ga=({value:e,label:t,onChange:a})=>Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:t},Object(x.jsx)(g.EuiDatePicker,{fullWidth:!0,showTimeSelect:!0,selected:e,onChange:a,dateFormat:"MMM D, YYYY @ HH:mm:ss.SSS","data-test-subj":"lnsXY_annotation_date_picker"})),qa=({value:e,onChange:t})=>Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.annotation.name",{defaultMessage:"Hide annotation"}),display:"columnCompressedSwitch",fullWidth:!0},Object(x.jsx)(g.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.xyChart.annotation.name",{defaultMessage:"Hide annotation"}),showLabel:!1,"data-test-subj":"lns-annotations-hide-annotation",checked:e,onChange:t}));function $a(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const Wa=Object(g.htmlIdGenerator)()();function Ua(e){var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=a.layers.findIndex((e=>e.layerId===r)),d=a.layers[c],{inputValue:p,handleInputChange:m}=Object(y.t)({value:e.state,onChange:e.setState}),f=null==d||null===(t=d.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),b=(null==f?void 0:f.axisMode)||"auto",h=Object(l.useCallback)((e=>{if(null==e)return;const t=[...d.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m($a(p,{...d,yConfig:t},c))}),[o,c,p,d,m]);if(Qe(d))return Object(x.jsx)(Ha,e);if(Xe(d))return Object(x.jsx)(za,e);const v=d;if("breakdown"===e.groupId)return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(y.i,{palettes:e.paletteService,activePalette:null==v?void 0:v.palette,setPalette:e=>{n($a(p,{...v,palette:e},c))}}));const j=gt(a.layers);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(Fa,i()({},e,{disabled:Boolean(v.splitAccessor),setConfig:h})),Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"})},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"}),"data-test-subj":"lnsXY_axisSide_groups",name:"axisSide",buttonSize:"compressed",options:[{id:`${Wa}left`,label:j?u.i18n.translate("xpack.lens.xyChart.axisSide.bottom",{defaultMessage:"Bottom"}):u.i18n.translate("xpack.lens.xyChart.axisSide.left",{defaultMessage:"Left"}),"data-test-subj":"lnsXY_axisSide_groups_left"},{id:`${Wa}auto`,label:u.i18n.translate("xpack.lens.xyChart.axisSide.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_axisSide_groups_auto"},{id:`${Wa}right`,label:j?u.i18n.translate("xpack.lens.xyChart.axisSide.top",{defaultMessage:"Top"}):u.i18n.translate("xpack.lens.xyChart.axisSide.right",{defaultMessage:"Right"}),"data-test-subj":"lnsXY_axisSide_groups_right"}],idSelected:`${Wa}${b}`,onChange:e=>{const t=e.replace(Wa,"");h({axisMode:t})}})))}var Ya=a(69);function Ka(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));return t?Xe(t)?Object(x.jsx)(Xa,null):Qe(t)?Object(x.jsx)(Za,null):Object(x.jsx)(Qa,e):null}function Xa(){return Object(x.jsx)(y.j,{icon:na,label:u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"})})}function Za(){return Object(x.jsx)(y.j,{icon:Kt,label:u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"})})}function Qa(e){const[t,a]=Object(l.useState)(!1),{state:n,layerId:i}=e,r=n.layers,o=r.findIndex((e=>e.layerId===i)),c=r[o],d=Re.visualizationTypes.find((({id:e})=>e===c.seriesType)),p=gt(n.layers);return Object(x.jsx)(g.EuiPopover,{panelClassName:"lnsChangeIndexPatternPopover",button:Object(x.jsx)(Ja,{onClick:()=>a(!t),currentVisType:d}),isOpen:t,closePopover:()=>a(!1),display:"block",panelPaddingSize:"s",ownFocus:!0},Object(x.jsx)(g.EuiPopoverTitle,null,u.i18n.translate("xpack.lens.layerPanel.layerVisualizationType",{defaultMessage:"Layer visualization type"})),Object(x.jsx)("div",null,Object(x.jsx)(g.EuiSelectable,{singleSelection:"always",options:Re.visualizationTypes.filter((e=>mt(e.id)===p)).map((e=>({value:e.id,key:e.id,checked:e.id===d.id?"on":void 0,prepend:Object(x.jsx)(g.EuiIcon,{type:e.icon}),label:e.fullLabel||e.label,"data-test-subj":`lnsXY_seriesType-${e.id}`}))),onChange:t=>{const i=t.find((({checked:e})=>"on"===e));if(!i)return;const l=i.value;Object(Ya.e)("xy_change_layer_display"),e.setState(ja(n,{...c,seriesType:l},o)),a(!1)}},(e=>Object(x.jsx)(s.a.Fragment,null,e)))))}const Ja=function({currentVisType:e,onClick:t}){return Object(x.jsx)(d.ToolbarButton,{"data-test-subj":"lns_layer_settings",title:e.fullLabel||e.label,onClick:t,fullWidth:!0,size:"s"},Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiIcon,{type:e.icon}),Object(x.jsx)(g.EuiText,{size:"s",className:"lnsLayerPanelChartSwitch_title"},e.fullLabel||e.label)))},en=Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.configure.invalidConfigTooltip",{defaultMessage:"Invalid configuration."}),Object(x.jsx)("br",null),u.i18n.translate("xpack.lens.configure.invalidConfigTooltipClick",{defaultMessage:"Click for more details."})),tn=({id:e,label:t,isInvalid:a,hideTooltip:n,invalidMessage:i=en})=>a?Object(x.jsx)(g.EuiToolTip,{content:n?null:i,anchorClassName:"eui-displayBlock"},Object(x.jsx)(g.EuiText,{size:"s",color:"danger",id:e,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiIcon,{size:"s",type:"alert"})),Object(x.jsx)(g.EuiFlexItem,{grow:!0},t)))):Object(x.jsx)(g.EuiText,{size:"s",id:e,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(x.jsx)(g.EuiFlexItem,{grow:!0},Object(x.jsx)("span",null,Object(x.jsx)("span",{className:"lnsLayerPanel__triggerTextLabel"},t)))),an=({paletteService:e,fieldFormats:t,useLegacyTimeAxis:a,kibanaTheme:n,eventAnnotationService:l})=>({id:"lnsXY",visualizationTypes:Re.visualizationTypes,getVisualizationTypeId(e){const t=et(e);return"mixed"===t?t:t.id},getLayerIds:e=>ot(e).map((e=>e.layerId)),getRemoveOperation(e,t){const a=ot(e,P.o.DATA).map((e=>e.layerId));return a.includes(t)&&1===a.length?"clear":"remove"},removeLayer:(e,t)=>({...e,layers:e.layers.filter((e=>e.layerId!==t))}),appendLayer(e,t,a){var n,i;const l=null===(n=Ke(e.layers))||void 0===n||null===(i=n[0])||void 0===i?void 0:i.seriesType;return{...e,layers:[...e.layers,rt({seriesType:l||e.preferredSeriesType,layerId:t,layerType:a})]}},clearLayer:(e,t)=>({...e,layers:e.layers.map((a=>a.layerId!==t?a:rt({seriesType:e.preferredSeriesType,layerId:t})))}),getDescription:tt,switchVisualizationType:(e,t)=>({...t,preferredSeriesType:e,layers:t.layers.map((t=>({...t,seriesType:e})))}),getSuggestions:xt,triggers:[A.VIS_EVENT_TO_TRIGGER.filter,A.VIS_EVENT_TO_TRIGGER.brush],initialize:(e,t)=>t||{title:"Empty XY chart",legend:{isVisible:!0,position:oe.Position.Right},valueLabels:"hide",preferredSeriesType:nt,layers:[{layerId:e(),accessors:[],position:oe.Position.Top,seriesType:nt,showGridlines:!1,layerType:P.o.DATA}]},getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},getSupportedLayers:(e,t)=>[it,ea(e,t),sa(e,t)],getConfiguration({state:a,frame:n,layerId:i}){var l,s;const r=a.layers.find((e=>e.layerId===i));if(!r)return{groups:[]};if(Qe(r))return(({state:e,frame:t,layer:a})=>{const n=Ke(e.layers),i=Boolean(n.length&&n.every((e=>e.xAccessor&&Ue("interval","date",(null==t?void 0:t.datasourceLayers)||{})(e)))),l=We("x",{isHorizontal:gt(e.layers)}),s={buttonAriaLabel:u.i18n.translate("xpack.lens.indexPattern.addColumnAriaLabelClick",{defaultMessage:"Add an annotation to {groupLabel}",values:{groupLabel:l}}),buttonLabel:u.i18n.translate("xpack.lens.configure.emptyConfigClick",{defaultMessage:"Add an annotation"})};return{groups:[{groupId:"xAnnotations",groupLabel:l,accessors:ta(a),dataTestSubj:"lnsXY_xAnnotationsPanel",invalid:!i,invalidMessage:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),required:!1,requiresPreviousColumnOnDuplicate:!0,supportsMoreColumns:!0,supportFieldFormat:!1,enableDimensionEditor:!0,filterOperations:()=>!1,labels:s}]}})({state:a,frame:n,layer:r});const o=pa(n.datasourceLayers[r.layerId],r);if(Xe(r))return oa({state:a,frame:n,layer:r,sortedAccessors:o});const c=nn({state:a,frame:n,layer:r,fieldFormats:t,paletteService:e,accessors:o});if(Xe(r))return oa({state:a,frame:n,layer:r,sortedAccessors:o});const d=r,p=Ke(a.layers),m=gt(a.layers),{left:g,right:f}=St([r],n.activeData),b=Boolean(d.accessors.length<2||g.length&&g.length<2||f.length&&f.length<2)&&p.filter((e=>{if(Ye(e)&&e.seriesType===d.seriesType&&Boolean(e.xAccessor)===Boolean(d.xAccessor)&&Boolean(e.splitAccessor)===Boolean(d.splitAccessor)){const{left:t,right:a}=St([e],n.activeData);return e.accessors.length&&(Boolean(t.length)===Boolean(g.length)||Boolean(a.length)===Boolean(f.length))}return!1})).length<2;return{groups:[{groupId:"x",groupLabel:We("x",{isHorizontal:m}),accessors:d.xAccessor?[{columnId:d.xAccessor}]:[],filterOperations:pt,supportsMoreColumns:!d.xAccessor,dataTestSubj:"lnsXY_xDimensionPanel"},{groupId:"y",groupLabel:We("y",{isHorizontal:m}),accessors:c,filterOperations:dt,supportsMoreColumns:!0,required:!0,dataTestSubj:"lnsXY_yDimensionPanel",enableDimensionEditor:!0},{groupId:"breakdown",groupLabel:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Break down by"}),accessors:d.splitAccessor?[{columnId:d.splitAccessor,triggerIcon:"colorBy",palette:e.get((null===(l=d.palette)||void 0===l?void 0:l.name)||"default").getCategoricalColors(10,null===(s=d.palette)||void 0===s?void 0:s.params)}]:[],filterOperations:pt,supportsMoreColumns:!d.splitAccessor,dataTestSubj:"lnsXY_splitDimensionPanel",required:d.seriesType.includes("percentage")&&b,enableDimensionEditor:!0}]}},getMainPalette:e=>{var t;if(e&&0!==e.layers.length)return null===(t=(e.layers||[]).find((e=>Ye(e))))||void 0===t?void 0:t.palette},setDimension(e){const{prevState:t,layerId:a,columnId:n,groupId:i}=e,l=t.layers.find((e=>e.layerId===a));if(!l)return t;if(Xe(l))return(({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i})=>{var l,s;const r=e.layers.find((e=>e.layerId===t));if(!r||!Xe(r))return e;const o={...r};o.accessors=[...o.accessors.filter((e=>e!==a)),a];const u=null===(l=o.yConfig)||void 0===l?void 0:l.some((({forAccessor:e})=>e===a)),c=!!i&&(null===(s=o.yConfig)||void 0===s?void 0:s.find((({forAccessor:e})=>e===i)));if(!u){const e="xReferenceLine"===n?"bottom":"yReferenceLineRight"===n?"right":"left";o.yConfig=[...o.yConfig||[],{...c,forAccessor:a,axisMode:e}]}return{...e,layers:e.layers.map((e=>e.layerId===t?o:e))}})(e);if(Qe(l))return(({prevState:e,layerId:t,columnId:a,previousColumn:n,frame:i})=>{const l=e.layers.find((e=>e.layerId===t));if(!l||!Qe(l))return e;const s=l.annotations,r=null==s?void 0:s.find((({id:e})=>e===a)),o=n?null==s?void 0:s.find((({id:e})=>e===n)):void 0;let u=[...s];if(r){if(r&&o){u=s.filter((e=>e.id!==o.id));const e=u.findIndex((e=>e.id===r.id)),t=s.indexOf(o),a=s.indexOf(r);u.splice(t<a?e+1:e,0,o)}}else u.push({label:Qt,key:{type:"point_in_time",timestamp:Jt(Ke(e.layers),i)},icon:"triangle",...o,id:a});return{...e,layers:e.layers.map((e=>e.layerId===t?{...l,annotations:u}:e))}})(e);const s=Object.assign({},l);return"x"===i&&(s.xAccessor=n),"y"===i&&(s.accessors=[...s.accessors.filter((e=>e!==n)),n]),"breakdown"===i&&(s.splitAccessor=n),{...t,layers:t.layers.map((e=>e.layerId===a?s:e))}},updateLayersConfigurationFromContext({prevState:e,layerId:t,context:a}){const{chartType:n,axisPosition:i,palette:l,metrics:s}=a,r=null==e?void 0:e.layers.find((e=>e.layerId===t));if(!r||!Ye(r))return e;const o=s.some((e=>"static_value"===e.agg)),u=i,c=s.map(((e,t)=>{var a;return{color:e.color,forAccessor:null!==(a=e.accessor)&&void 0!==a?a:r.accessors[t],...u&&{axisMode:u},...o&&{fill:"area"===n?"below":"none"}}})),d={...r,...n&&{seriesType:n},...l&&{palette:l},yConfig:c,layerType:o?P.o.REFERENCELINE:P.o.DATA},p=e.layers.map((e=>e.layerId===t?d:e));return{...e,layers:p}},getVisualizationSuggestionFromContext({suggestions:e,context:t}){var a,n;const i=[];let l={};const s=t.configuration.fill?Number(t.configuration.fill):void 0;for(let a=0;a<e.length;a++){const n=e[a],s=n.visualizationState.layers,r=t.layers.find((e=>e.layerId===Object.keys(n.datasourceState.layers)[0]));if(this.updateLayersConfigurationFromContext&&r){const e=this.updateLayersConfigurationFromContext({prevState:n.visualizationState,layerId:s[0].layerId,context:r});i.push(...e.layers),l={...l,...n.datasourceState.layers}}}let r=e[0];return r={...r,datasourceState:{...r.datasourceState,layers:{...r.datasourceState.layers,...l}},visualizationState:{...r.visualizationState,fillOpacity:s,yRightExtent:null===(a=t.configuration.extents)||void 0===a?void 0:a.yRightExtent,yLeftExtent:null===(n=t.configuration.extents)||void 0===n?void 0:n.yLeftExtent,legend:t.configuration.legend,gridlinesVisibilitySettings:t.configuration.gridLinesVisibility,valuesInLegend:!0,layers:i}},r},removeDimension({prevState:e,layerId:t,columnId:a,frame:n}){const i=e.layers.find((e=>e.layerId===t));if(!i)return e;if(Qe(i)){const n={...i};n.annotations=n.annotations.filter((({id:e})=>e!==a));const l=e.layers.map((e=>e.layerId===t?n:e));return{...e,layers:l}}const l={...i};var s;Ye(l)&&(l.xAccessor===a?delete l.xAccessor:l.splitAccessor===a&&(delete l.splitAccessor,delete l.palette)),l.accessors.includes(a)&&(l.accessors=l.accessors.filter((e=>e!==a))),"yConfig"in l&&(l.yConfig=null===(s=l.yConfig)||void 0===s?void 0:s.filter((({forAccessor:e})=>e!==a)));let r=e.layers.map((e=>e.layerId===t?l:e));const o=ia(Ke(e.layers),n.datasourceLayers,null==n?void 0:n.activeData);return Object.keys(o).every((e=>!o[e]))&&(r=r.filter((e=>Ye(e)||"accessors"in e&&e.accessors.length))),{...e,layers:r}},renderLayerHeader(e,t){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:n.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Ka,t))),e)},renderToolbar(e,t){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:n.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Ia,i()({},t,{useLegacyTimeAxis:a})))),e)},renderDimensionEditor(a,i){const l={...i,formatFactory:t.deserialize,paletteService:e},s=i.state.layers.find((e=>e.layerId===i.layerId)),o=Xe(s)?Object(x.jsx)(za,l):Qe(s)?Object(x.jsx)(Ha,l):Object(x.jsx)(Ua,l);Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:n.theme$},Object(x.jsx)(c.I18nProvider,null,o)),a)},toExpression:(t,a,n)=>ma(t,a,e,n,l),toPreviewExpression:(t,a)=>function(e,t,a,n){return ma({...e,layers:e.layers.map((e=>((e,t)=>Ye(e)?t[He.layerTypes.DATA](e):Xe(e)?t[He.layerTypes.REFERENCELINE](e):t[He.layerTypes.ANNOTATIONS](e))(e,ga))),legend:{...e.legend,isVisible:!1},valueLabels:"hide"},t,a,{},n)}(t,a,e,l),getErrorMessages(e,t){const a=({accessors:e})=>null==e||0===e.length,n=Ke(e.layers),i=({splitAccessor:e,seriesType:t})=>t.includes("percentage")&&null==e,l=[];if(e&&e.layers.length>1){const e=[["Y",a],["Break down",i]],t=n.filter((({accessors:e,xAccessor:t,splitAccessor:a,layerType:n})=>e.length>0||null!=t||null!=a));for(const[a,n]of e){const e=ut(a,t,n);e.valid||l.push(e.payload)}}if(t&&e){l.push(...function(e,t){const a=Ke(e.layers),n=[],i=a.some(Ue("interval","date",t)),l=a.some(Ue("interval","number",t)),s=a.some(Ue("ordinal",void 0,t));return e.layers.length>1&&i&&l&&n.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:We("x",{isHorizontal:gt(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXLong",{defaultMessage:"Data type mismatch for the {axis}. Cannot mix date and number interval types.",values:{axis:We("x",{isHorizontal:gt(e.layers)})}})}),e.layers.length>1&&(i||l)&&s&&n.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:We("x",{isHorizontal:gt(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXOrdinalLong",{defaultMessage:"Data type mismatch for the {axis}, use a different function.",values:{axis:We("x",{isHorizontal:gt(e.layers)})}})}),n}(e,t));for(const a of Ke(e.layers)){const n=t[a.layerId];if(n)for(const t of a.accessors){const a=n.getOperationForColumnId(t);a&&"number"!==a.dataType&&l.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:We("y",{isHorizontal:gt(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYLong",{defaultMessage:"The dimension {label} provided for the {axis} has the wrong data type. Expected number but have {dataType}",values:{label:a.label,dataType:a.dataType,axis:We("y",{isHorizontal:gt(e.layers)})}})})}}}return l.length?l:void 0},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const a=[...Ke(e.layers),...Ze(e.layers)].filter((({accessors:e})=>e.length>0)),n=[];for(const e of a){const{layerId:a,accessors:i}=e,l=t.activeData[a]&&t.activeData[a].rows;if(!l)break;const s=bt(e,t.datasourceLayers[a]);for(const e of i)l.some((t=>Array.isArray(t[e])))&&n.push(s[e])}return n.map((e=>Object(x.jsx)(c.FormattedMessage,{key:e,id:"xpack.lens.xyVisualization.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(x.jsx)("strong",null,e)}})))},getUniqueLabels:e=>aa(e.layers),renderDimensionTrigger:({columnId:e,label:t,hideTooltip:a,invalid:n,invalidMessage:i})=>t?Object(x.jsx)(tn,{id:e,hideTooltip:a,isInvalid:n,invalidMessage:i,label:t||Qt}):null}),nn=({accessors:e,frame:t,fieldFormats:a,paletteService:n,state:i,layer:l})=>{let s=e.map((e=>({columnId:e})));return t.activeData&&(s=da(ca(Ke(i.layers),{tables:t.activeData},a.deserialize),t,{...l,accessors:e.filter((e=>l.accessors.includes(e)))},n)),s};class xy_visualization_XyVisualization{setup(e,{editorFrame:t}){t.registerVisualization((async()=>{const{getXyVisualization:t}=await Promise.resolve().then(a.bind(null,433)),[,{charts:n,fieldFormats:i,eventAnnotation:l}]=await e.getStartServices();return t({paletteService:await n.palettes.getPalettes(),eventAnnotationService:await l.getService(),fieldFormats:i,useLegacyTimeAxis:e.uiSettings.get(H.LEGACY_TIME_AXIS),kibanaTheme:e.theme})}))}}var ln=a(47);const sn="temperature",rn=u.i18n.translate("xpack.lens.heatmap.groupLabel",{defaultMessage:"Heatmap"}),on="heatmap",un={heatmap:{shapeType:on,icon:ln.HeatmapIcon,label:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:rn}},cn="cell",dn="heatmap",pn="heatmap_legend",mn="heatmap_grid",gn=({table:e,state:t,keptLayerIds:a})=>{var n,i,l,s,r,o,c,d,p,m,g,f,b,h,x;if((null==t?void 0:t.shape)===on&&(t.xAccessor||t.yAccessor||t.valueAccessor)&&"extended"!==e.changeType||e.columns.some((e=>e.operation.isStaticValue))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];if(t&&"unchanged"===e.changeType||a.length>1||a.length&&e.layerId!==a[0])return[];let v=0;const[y,j]=Object(Me.partition)(e.columns,(e=>e.operation.isBucketed));if(0===y.length&&0===j.length)return[];if(y.length>=3)return[];if(j.length>1)return[];const O=1===y.length&&0===j.length,k=1===j.length&&y.length>0&&y.every((e=>"date"===e.operation.dataType)),I="reduced"===e.changeType||"reorder"===e.changeType||O||k,T={shape:on,layerId:e.layerId,layerType:P.o.DATA,legend:{isVisible:null===(n=null==t||null===(i=t.legend)||void 0===i?void 0:i.isVisible)||void 0===n||n,position:null!==(l=null==t||null===(s=t.legend)||void 0===s?void 0:s.position)&&void 0!==l?l:oe.Position.Right,type:pn},gridConfig:{type:mn,isCellLabelVisible:!1,isYAxisLabelVisible:null===(r=null==t||null===(o=t.gridConfig)||void 0===o?void 0:o.isYAxisLabelVisible)||void 0===r||r,isXAxisLabelVisible:null===(c=null==t||null===(d=t.gridConfig)||void 0===d?void 0:d.isXAxisLabelVisible)||void 0===c||c,isYAxisTitleVisible:null!==(p=null==t||null===(m=t.gridConfig)||void 0===m?void 0:m.isYAxisTitleVisible)&&void 0!==p&&p,isXAxisTitleVisible:null!==(g=null==t||null===(f=t.gridConfig)||void 0===f?void 0:f.isXAxisTitleVisible)&&void 0!==g&&g}},F=j.find((e=>"number"===e.operation.dataType));F&&(v+=.3,T.valueAccessor=F.columnId);const[M,w]=Object(Me.partition)(y,(e=>"interval"===e.operation.scale));return T.xAccessor=(null===(b=M[0])||void 0===b?void 0:b.columnId)||(null===(h=w[0])||void 0===h?void 0:h.columnId),T.yAccessor=null===(x=y.find((e=>e.columnId!==T.xAccessor)))||void 0===x?void 0:x.columnId,y.some((e=>"date"===e.operation.dataType))||(T.xAccessor&&(v+=.3),T.yAccessor&&(v+=.3)),[{state:T,title:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),hide:I,previewIcon:"empty",score:Number(v.toFixed(1))}]};a(211);const fn=[{id:"heatmap_legend_show",value:"show",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"heatmap_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.hide",{defaultMessage:"Hide"})}],bn=Object(l.memo)((e=>{var t;const{state:a,setState:n,frame:i}=e,l=a.legend.isVisible?"show":"hide",s=ve(a,i.datasourceLayers).truncateText;return Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(x.jsx)(y.m,{valueLabels:null!=a&&a.gridConfig.isCellLabelVisible?"inside":"hide",onValueLabelChange:e=>{n({...a,gridConfig:{...a.gridConfig,isCellLabelVisible:"inside"===e}})}})),Object(x.jsx)(y.f,{groupPosition:"right",legendOptions:fn,mode:l,onDisplayChange:e=>{const t=fn.find((({id:t})=>t===e)).value;"show"===t?n({...a,legend:{...a.legend,isVisible:!0}}):"hide"===t&&n({...a,legend:{...a.legend,isVisible:!1}})},position:null==a?void 0:a.legend.position,onPositionChange:e=>{n({...a,legend:{...a.legend,position:e}})},maxLines:null==a?void 0:a.legend.maxLines,onMaxLinesChange:e=>{n({...a,legend:{...a.legend,maxLines:e}})},shouldTruncate:null!==(t=null==a?void 0:a.legend.shouldTruncate)&&void 0!==t?t:s,onTruncateLegendChange:()=>{var e;const t=null!==(e=a.legend.shouldTruncate)&&void 0!==e?e:s;n({...a,legend:{...a.legend,shouldTruncate:!t}})},legendSize:null==a?void 0:a.legend.legendSize,onLegendSizeChange:e=>{n({...a,legend:{...a.legend,legendSize:e}})}}))),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.verticalAxisDisabledHelpText",{defaultMessage:"This setting only applies when vertical axis is enabled."}),condition:!Boolean(null==a?void 0:a.yAccessor)},Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),type:wt,groupPosition:"left",isDisabled:!Boolean(null==a?void 0:a.yAccessor),buttonDataTestSubj:"lnsHeatmapVerticalAxisButton",panelClassName:"lnsVisToolbarAxis__popover"},Object(x.jsx)(y.a,{axis:"yLeft",axisTitle:null==a?void 0:a.gridConfig.yTitle,updateTitleState:e=>n({...a,gridConfig:{...a.gridConfig,yTitle:e}}),isAxisTitleVisible:null==a?void 0:a.gridConfig.isYAxisTitleVisible,toggleAxisTitleVisibility:(e,t)=>n({...a,gridConfig:{...a.gridConfig,isYAxisTitleVisible:t}})}))),Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.horizontalAxisDisabledHelpText",{defaultMessage:"This setting only applies when horizontal axis is enabled."}),condition:!Boolean(null==a?void 0:a.xAccessor)},Object(x.jsx)(y.k,{title:u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),type:Mt,groupPosition:"center",isDisabled:!Boolean(null==a?void 0:a.xAccessor),buttonDataTestSubj:"lnsHeatmapHorizontalAxisButton"},Object(x.jsx)(y.a,{axis:"x",axisTitle:null==a?void 0:a.gridConfig.xTitle,updateTitleState:e=>n({...a,gridConfig:{...a.gridConfig,xTitle:e}}),isAxisTitleVisible:null==a?void 0:a.gridConfig.isXAxisTitleVisible,toggleAxisTitleVisibility:(e,t)=>n({...a,gridConfig:{...a.gridConfig,isXAxisTitleVisible:t}})}))))))}));function hn(e,t,a,n){if(null==t||null==a)return{displayStops:[],activePalette:n};const i=null!=n?n:{type:"palette",name:sn,accessor:a},l=Object(y.q)([a],t)[a];return{displayStops:Object(y.o)(e,i,l),currentMinMax:l,activePalette:i}}function xn(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(l.useState)(!1);if((null==a?void 0:a.valueAccessor)!==r)return null;const d=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],{displayStops:p,activePalette:m,currentMinMax:f}=hn(e.paletteService,d,r,null!=a&&a.palette&&a.palette.accessor===r?a.palette:void 0);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteHeatmapGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiColorPaletteDisplay,{"data-test-subj":"lnsHeatmap_dynamicColoring_palette",palette:p.map((({color:e})=>e)),type:y.e,onClick:()=>{c(!o)}})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonEmpty,{"data-test-subj":"lnsHeatmap_dynamicColoring_trigger","aria-label":u.i18n.translate("xpack.lens.paletteHeatmapGradient.customizeLong",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{c(!o)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteHeatmapGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(y.h,{siblingRef:e.panelRef,isOpen:o,handleClose:()=>c(!o)},m&&Object(x.jsx)(y.c,{palettes:e.paletteService,activePalette:m,dataBounds:f,setPalette:e=>{e.params&&!e.params.stops&&(e.params.stops=p),e.accessor=r,n({...a,palette:e})}}))))))}a(216);const vn=u.i18n.translate("xpack.lens.heatmapVisualization.heatmapGroupLabel",{defaultMessage:"Magnitude"});function yn(e){const t=u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),a=u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});return"x"===e?a:t}const jn=e=>e.isBucketed&&"ordinal"===e.scale,On=e=>jn(e)||"interval"===e.scale,kn=e=>!jn(e)&&("ordinal"===e.scale||"ratio"===e.scale)&&(e=>"number"===e.dataType&&!e.isStaticValue)(e);function In(e){return{...e,colors:((null==e?void 0:e.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==e?void 0:e.name)?((null==e?void 0:e.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}}const Tn=({paletteService:e,theme:t})=>({id:"lnsHeatmap",visualizationTypes:[{id:"heatmap",icon:ln.HeatmapIcon,label:u.i18n.translate("xpack.lens.heatmapVisualization.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:vn,showExperimentalBadge:!1,sortPriority:1}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.valueAccessor,delete t.xAccessor,delete t.yAccessor,t},switchVisualizationType:(e,t)=>({...t,shape:e}),getDescription:e=>un.heatmap,initialize:(e,t,a)=>t||{layerId:e(),layerType:P.o.DATA,title:"Empty Heatmap chart",shape:on,legend:{isVisible:!0,position:oe.Position.Right,maxLines:1,type:pn},gridConfig:{type:mn,isCellLabelVisible:!1,isYAxisLabelVisible:!0,isXAxisLabelVisible:!0,isYAxisTitleVisible:!0,isXAxisTitleVisible:!0}},getSuggestions:gn,getConfiguration({state:t,frame:a,layerId:n}){var i,l;if(!a.datasourceLayers[n].getTableSpec().map((({columnId:e})=>e)))return{groups:[]};const{displayStops:s,activePalette:r}=hn(e,null===(i=a.activeData)||void 0===i?void 0:i[t.layerId],t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{groups:[{layerId:t.layerId,groupId:"x",groupLabel:yn("x"),accessors:t.xAccessor?[{columnId:t.xAccessor}]:[],filterOperations:On,supportsMoreColumns:!t.xAccessor,required:!0,dataTestSubj:"lnsHeatmap_xDimensionPanel"},{layerId:t.layerId,groupId:"y",groupLabel:yn("y"),accessors:t.yAccessor?[{columnId:t.yAccessor}]:[],filterOperations:On,supportsMoreColumns:!t.yAccessor,required:!1,dataTestSubj:"lnsHeatmap_yDimensionPanel"},{layerId:t.layerId,groupId:cn,groupLabel:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),accessors:t.valueAccessor?[s.length&&(a.activeData||"number"!==(null==r||null===(l=r.params)||void 0===l?void 0:l.rangeType))?{columnId:t.valueAccessor,triggerIcon:"colorBy",palette:s.map((({color:e})=>e))}:{columnId:t.valueAccessor,triggerIcon:"none"}]:[],filterOperations:kn,supportsMoreColumns:!t.valueAccessor,enableDimensionEditor:!0,required:!0,dataTestSubj:"lnsHeatmap_cellPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const l={};return"x"===n&&(l.xAccessor=a),"y"===n&&(l.yAccessor=a),n===cn&&(l.valueAccessor=a),{...e,...l}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.valueAccessor===a&&delete n.valueAccessor,e.xAccessor===a&&delete n.xAccessor,e.yAccessor===a&&delete n.yAccessor,n},renderDimensionEditor(a,n){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(xn,i()({},n,{paletteService:e})))),a)},renderToolbar(e,a){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(bn,a))),e)},getSupportedLayers:()=>[{type:P.o.DATA,label:u.i18n.translate("xpack.lens.heatmap.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,n){var i,l,s,r,o,u,c,d,p;return a[t.layerId].getTableSpec().map((({columnId:e})=>e))&&t.valueAccessor?{type:"expression",chain:[{type:"function",function:dn,arguments:{xAccessor:[null!==(i=t.xAccessor)&&void 0!==i?i:""],yAccessor:[null!==(l=t.yAccessor)&&void 0!==l?l:""],valueAccessor:[null!==(s=t.valueAccessor)&&void 0!==s?s:""],lastRangeIsRightOpen:[null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o||!o.continuity||["above","all"].includes(t.palette.params.continuity)],palette:null!==(u=t.palette)&&void 0!==u&&u.params?[e.get(y.b).toExpression(In((null===(c=t.palette)||void 0===c?void 0:c.params)||{}))]:[e.get(sn).toExpression()],legend:[{type:"expression",chain:[{type:"function",function:pn,arguments:{isVisible:[t.legend.isVisible],position:[t.legend.position],legendSize:t.legend.legendSize?[t.legend.legendSize]:[]}}]}],gridConfig:[{type:"expression",chain:[{type:"function",function:mn,arguments:{strokeWidth:t.gridConfig.strokeWidth?[t.gridConfig.strokeWidth]:[],strokeColor:t.gridConfig.strokeColor?[t.gridConfig.strokeColor]:[],isCellLabelVisible:[t.gridConfig.isCellLabelVisible],isYAxisLabelVisible:[t.gridConfig.isYAxisLabelVisible],isYAxisTitleVisible:[null!==(d=t.gridConfig.isYAxisTitleVisible)&&void 0!==d&&d],yTitle:t.gridConfig.yTitle?[t.gridConfig.yTitle]:[],isXAxisLabelVisible:t.gridConfig.isXAxisLabelVisible?[t.gridConfig.isXAxisLabelVisible]:[],isXAxisTitleVisible:[null!==(p=t.gridConfig.isXAxisTitleVisible)&&void 0!==p&&p],xTitle:t.gridConfig.xTitle?[t.gridConfig.xTitle]:[]}}]}]}}]}:null},toPreviewExpression(t,a){var n,i,l,s,r,o,u;return a[t.layerId].getTableSpec().map((({columnId:e})=>e))?{type:"expression",chain:[{type:"function",function:dn,arguments:{xAccessor:[null!==(n=t.xAccessor)&&void 0!==n?n:""],yAccessor:[null!==(i=t.yAccessor)&&void 0!==i?i:""],valueAccessor:[null!==(l=t.valueAccessor)&&void 0!==l?l:""],legend:[{type:"expression",chain:[{type:"function",function:pn,arguments:{isVisible:[!1],position:[]}}]}],palette:null!==(s=t.palette)&&void 0!==s&&s.params?[e.get(y.b).toExpression(In((null===(r=t.palette)||void 0===r?void 0:r.params)||{}))]:[e.get(sn).toExpression()],gridConfig:[{type:"expression",chain:[{type:"function",function:mn,arguments:{strokeWidth:[1],isCellLabelVisible:[!1],isYAxisLabelVisible:[!1],isYAxisTitleVisible:[t.gridConfig.isYAxisTitleVisible],yTitle:[null!==(o=t.gridConfig.yTitle)&&void 0!==o?o:""],isXAxisLabelVisible:[!1],isXAxisTitleVisible:[t.gridConfig.isXAxisTitleVisible],xTitle:[null!==(u=t.gridConfig.xTitle)&&void 0!==u?u:""]}}]}]}}]}:null},getErrorMessages(e){if(!e.yAccessor&&!e.xAccessor&&!e.valueAccessor)return;const t=[];return e.xAccessor||t.push({shortMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorShortMessage",{defaultMessage:"Missing Horizontal axis."}),longMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorLongMessage",{defaultMessage:"Configuration for the horizontal axis is missing."})}),t.length?t:void 0},getWarningMessages(e,t){if(null==e||!e.layerId||!t.activeData||!e.valueAccessor)return;const a=t.activeData[e.layerId]&&t.activeData[e.layerId].rows;if(!a)return;const n=a.some((t=>Array.isArray(t[e.valueAccessor]))),i=t.datasourceLayers[e.layerId].getOperationForColumnId(e.valueAccessor);return n?[Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.heatmapVisualization.arrayValuesWarningMessage",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(x.jsx)("strong",null,null==i?void 0:i.label)}})]:void 0}});class HeatmapVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getHeatmapVisualization:t}=await Promise.resolve().then(a.bind(null,433));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var Fn=a(44),Mn=a(48);const wn=({table:e,state:t,keptLayerIds:a,subVisualizationId:n})=>{const i=Boolean(t&&(t.minAccessor||t.maxAccessor||t.goalAccessor||t.metricAccessor)),l=t&&[t.minAccessor,t.maxAccessor,t.goalAccessor,t.metricAccessor].filter(Boolean).length;if(((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||(e=>{var t,a;return"number"!==(null===(t=e.columns)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.operation.dataType)||e.columns.some((e=>e.operation.isBucketed))})(e)||!i&&e.columns.length>1||i&&(l!==e.columns.length||"initial"===e.changeType))return[];const s=(null==t?void 0:t.shape)===Fn.GaugeShapes.VERTICAL_BULLET?Fn.GaugeShapes.VERTICAL_BULLET:Fn.GaugeShapes.HORIZONTAL_BULLET,r={state:{...t,shape:s,layerId:e.layerId,layerType:P.o.DATA,ticksPosition:Fn.GaugeTicksPositions.AUTO,labelMajorMode:Fn.GaugeLabelMajorModes.AUTO},title:u.i18n.translate("xpack.lens.gauge.gaugeLabel",{defaultMessage:"Gauge"}),previewIcon:"empty",score:.5,hide:!i||void 0===(null==t?void 0:t.metricAccessor)};return i?[{...r,state:{...r.state,...t,shape:(null==t?void 0:t.shape)===Fn.GaugeShapes.VERTICAL_BULLET?Fn.GaugeShapes.HORIZONTAL_BULLET:Fn.GaugeShapes.VERTICAL_BULLET}}]:[{...r,state:{...r.state,metricAccessor:e.columns[0].columnId}},{...r,state:{...r.state,metricAccessor:e.columns[0].columnId,shape:(null==t?void 0:t.shape)===Fn.GaugeShapes.VERTICAL_BULLET?Fn.GaugeShapes.HORIZONTAL_BULLET:Fn.GaugeShapes.VERTICAL_BULLET}}]},_n="metric",Cn="goal";a(221);const En=Object(l.memo)((e=>{var t,a,n;const{state:i,setState:s,frame:r}=e,o=i.layerId&&(null===(t=r.activeData)||void 0===t||null===(a=t[i.layerId])||void 0===a||null===(n=a.columns.find((e=>e.id===i.metricAccessor)))||void 0===n?void 0:n.name),[c,d]=Object(l.useState)((()=>i.labelMinor?"custom":"none")),{inputValue:p,handleInputChange:m}=Object(y.t)({onChange:s,value:i});return Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(y.k,{handleClose:()=>{d(p.labelMinor?"custom":"none")},title:u.i18n.translate("xpack.lens.gauge.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",buttonDataTestSubj:"lnsVisualOptionsButton",panelClassName:"lnsGaugeToolbar__popover"},Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),fullWidth:!0},Object(x.jsx)(y.n,{header:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),dataTestSubj:"lnsToolbarGaugeLabelMajor",label:p.labelMajor||"",mode:p.labelMajorMode,placeholder:o||"",hasAutoOption:!0,handleChange:e=>{m({...p,labelMajor:e.label,labelMajorMode:e.mode})}})),Object(x.jsx)(g.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"})},Object(x.jsx)(y.n,{header:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"}),dataTestSubj:"lnsToolbarGaugeLabelMinor",label:p.labelMinor||"",mode:c,handleChange:e=>{m({...p,labelMinor:e.label}),d(e.mode)}}))))))}));a(226);var Sn=a(231),Pn=a.n(Sn);const An={...y.p,rangeMin:0,rangeMax:100,name:"gray",steps:3,maxSteps:5},Ln=e=>{const{minAccessor:t,maxAccessor:a,goalAccessor:n,metricAccessor:i}=null!=e?e:{};if(i||a||n||i)return{min:t,max:a,goal:n,metric:i}};function Dn(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(l.useState)(!1);if((null==a?void 0:a.metricAccessor)!==r)return null;const d=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[p]=(null==d?void 0:d.rows)||[];if(null==r||null==p||!Object(O.e)(d,r))return null;const m=Ln(a),f="palette"===(null==a?void 0:a.colorMode),b={min:Object(Mn.getMinValue)(p,m),max:Object(Mn.getMaxValue)(p,m)},h=(null==a?void 0:a.palette)||{type:"palette",name:An.name,params:{...An,continuity:"all",colorStops:void 0,stops:void 0,rangeMin:b.min,rangeMax:3*b.max/4}},v=Object(y.o)(e.paletteService,h,b),j=()=>c(!o);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.gauge.dynamicColoring.label",{defaultMessage:"Band colors"}),className:"lnsDynamicColoringRow"},Object(x.jsx)(g.EuiSwitch,{"data-test-subj":"lnsDynamicColoringGaugeSwitch",compressed:!0,label:"",showLabel:!1,checked:f,onChange:e=>{const{checked:t}=e.target,i=t?{palette:{...h,params:{...h.params,stops:v}},ticksPosition:Fn.GaugeTicksPositions.BANDS,colorMode:Fn.GaugeColorModes.PALETTE}:{ticksPosition:Fn.GaugeTicksPositions.AUTO,colorMode:Fn.GaugeColorModes.NONE};n({...a,...i})}})),f&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiColorPaletteDisplay,{"data-test-subj":"lnsGauge_dynamicColoring_palette",palette:v.map((({color:e})=>e)),type:y.e,onClick:j})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonEmpty,{"data-test-subj":"lnsGauge_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:j,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(y.h,{siblingRef:e.panelRef,isOpen:o,handleClose:j},Object(x.jsx)(y.c,{palettes:e.paletteService,activePalette:h,dataBounds:b,setPalette:e=>{e.name!==y.b&&e.params&&e.params.rangeMin!==b.min&&(e.params.rangeMin=b.min),n({...a,palette:e})}}))))),Object(x.jsx)(g.EuiFormRow,{display:"columnCompressedSwitch",fullWidth:!0,label:Object(x.jsx)(y.l,{position:"top",tooltipContent:u.i18n.translate("xpack.lens.shared.ticksPositionOptionsTooltip",{defaultMessage:"Places ticks on each band border instead of distributing them evenly"}),condition:!0,delay:"regular"},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),Object(x.jsx)(g.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(x.jsx)(g.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),"data-test-subj":"lens-toolbar-gauge-ticks-position-switch",showLabel:!1,checked:a.ticksPosition===Fn.GaugeTicksPositions.BANDS,onChange:()=>{n({...a,ticksPosition:a.ticksPosition===Fn.GaugeTicksPositions.BANDS?Fn.GaugeTicksPositions.AUTO:Fn.GaugeTicksPositions.BANDS})}}))))}const Nn=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),zn=e=>!e.isBucketed&&"number"===e.dataType,Bn=e=>zn(e)&&!e.isStaticValue,Vn={horizontalBullet:{icon:Mn.HorizontalBulletIcon,label:u.i18n.translate("xpack.lens.gaugeHorizontal.gaugeLabel",{defaultMessage:"Gauge horizontal"}),groupLabel:Nn},verticalBullet:{icon:Mn.VerticalBulletIcon,label:u.i18n.translate("xpack.lens.gaugeVertical.gaugeLabel",{defaultMessage:"Gauge vertical"}),groupLabel:Nn}},Rn=(e,t)=>{if(!e||!t)return;const a=null==t?void 0:t.minAccessor,n=null==t?void 0:t.maxAccessor,i=a?Object(Mn.getValueFromAccessor)(a,e):void 0,l=n?Object(Mn.getValueFromAccessor)(n,e):void 0;if(null!=l&&null!=i&&void 0!==i){if(l<i)return{invalid:!0,invalidMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderMinGreaterMax",{defaultMessage:"Minimum value may not be greater than maximum value"})};if(l===i)return{invalid:!0,invalidMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderEqual",{defaultMessage:"Minimum and maximum values may not be equal"})}}},Hn=(e,t,a,n)=>{var i,l,s,r,o;return a[t.layerId].getTableSpec().map((({columnId:e})=>e))&&t.metricAccessor?{type:"expression",chain:[{type:"function",function:Fn.EXPRESSION_GAUGE_NAME,arguments:{metric:t.metricAccessor?[t.metricAccessor]:[],min:t.minAccessor?[t.minAccessor]:[],max:t.maxAccessor?[t.maxAccessor]:[],goal:t.goalAccessor?[t.goalAccessor]:[],shape:[null!==(i=t.shape)&&void 0!==i?i:Fn.GaugeShapes.HORIZONTAL_BULLET],colorMode:[null!==(l=null==t?void 0:t.colorMode)&&void 0!==l?l:"none"],palette:null!==(s=t.palette)&&void 0!==s&&s.params?[e.get(y.b).toExpression((o=(null===(r=t.palette)||void 0===r?void 0:r.params)||{},{...o,colors:((null==o?void 0:o.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==o?void 0:o.name)?((null==o?void 0:o.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}))]:[],ticksPosition:t.ticksPosition?[t.ticksPosition]:["auto"],labelMinor:t.labelMinor?[t.labelMinor]:[],labelMajor:t.labelMajor?[t.labelMajor]:[],labelMajorMode:t.labelMajorMode?[t.labelMajorMode]:["auto"]}}]}:null},Gn=({paletteService:e})=>({id:"lnsGauge",visualizationTypes:[{...Vn.horizontalBullet,id:Fn.GaugeShapes.HORIZONTAL_BULLET,showExperimentalBadge:!0},{...Vn.verticalBullet,id:Fn.GaugeShapes.VERTICAL_BULLET,showExperimentalBadge:!0}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.metricAccessor,delete t.minAccessor,delete t.maxAccessor,delete t.goalAccessor,delete t.palette,delete t.colorMode,t},getDescription:e=>e.shape===Fn.GaugeShapes.HORIZONTAL_BULLET?Vn.horizontalBullet:Vn.verticalBullet,switchVisualizationType:(e,t)=>({...t,shape:e===Fn.GaugeShapes.HORIZONTAL_BULLET?Fn.GaugeShapes.HORIZONTAL_BULLET:Fn.GaugeShapes.VERTICAL_BULLET}),initialize:(e,t,a)=>t||{layerId:e(),layerType:P.o.DATA,shape:Fn.GaugeShapes.HORIZONTAL_BULLET,palette:a,ticksPosition:"auto",labelMajorMode:"auto"},getSuggestions:wn,getConfiguration({state:t,frame:a}){var n,i,l,s,r;const o=Boolean("none"!==t.colorMode&&(null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)),c=null!=t&&t.layerId?null==a||null===(l=a.activeData)||void 0===l||null===(s=l[null==t?void 0:t.layerId])||void 0===s||null===(r=s.rows)||void 0===r?void 0:r[0]:void 0,{metricAccessor:d}=null!=t?t:{},p=Ln(t);let m;if(null!=c&&null!=d&&null!=(null==t?void 0:t.palette)&&o){const a={min:Object(Mn.getMinValue)(c,p),max:Object(Mn.getMaxValue)(c,p)};m=Object(y.o)(e,null==t?void 0:t.palette,a).map((({color:e})=>e))}const g=Rn(c,t)||{};return{groups:[{supportFieldFormat:!0,layerId:t.layerId,groupId:_n,groupLabel:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"}),accessors:d?[m?{columnId:d,triggerIcon:"colorBy",palette:m}:{columnId:d,triggerIcon:"none"}]:[],filterOperations:Bn,supportsMoreColumns:!d,required:!0,dataTestSubj:"lnsGauge_metricDimensionPanel",enableDimensionEditor:!0},{supportStaticValue:!0,supportFieldFormat:!1,layerId:t.layerId,groupId:"min",groupLabel:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"}),accessors:t.minAccessor?[{columnId:t.minAccessor}]:[],filterOperations:zn,supportsMoreColumns:!t.minAccessor,dataTestSubj:"lnsGauge_minDimensionPanel",prioritizedOperation:"min",suggestedValue:()=>t.metricAccessor?Object(Mn.getMinValue)(c,p):void 0,...g},{supportStaticValue:!0,supportFieldFormat:!1,layerId:t.layerId,groupId:"max",groupLabel:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"}),accessors:t.maxAccessor?[{columnId:t.maxAccessor}]:[],filterOperations:zn,supportsMoreColumns:!t.maxAccessor,dataTestSubj:"lnsGauge_maxDimensionPanel",prioritizedOperation:"max",suggestedValue:()=>t.metricAccessor?Object(Mn.getMaxValue)(c,p):void 0,...g},{supportStaticValue:!0,supportFieldFormat:!1,layerId:t.layerId,groupId:Cn,groupLabel:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"}),accessors:t.goalAccessor?[{columnId:t.goalAccessor}]:[],filterOperations:zn,supportsMoreColumns:!t.goalAccessor,required:!1,dataTestSubj:"lnsGauge_goalDimensionPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const l={};return"min"===n&&(l.minAccessor=a),"max"===n&&(l.maxAccessor=a),n===Cn&&(l.goalAccessor=a),n===_n&&(l.metricAccessor=a),{...e,...l}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.goalAccessor===a&&delete n.goalAccessor,e.minAccessor===a&&delete n.minAccessor,e.maxAccessor===a&&delete n.maxAccessor,e.metricAccessor===a&&(delete n.metricAccessor,delete n.palette,delete n.colorMode,n.ticksPosition="auto"),n},renderDimensionEditor(t,a){Object(r.render)(Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Dn,i()({},a,{paletteService:e}))),t)},renderToolbar(e,t){Object(r.render)(Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(En,t)),e)},getSupportedLayers(e,t){var a,n,i;const l=null!=e&&e.layerId?null==t||null===(a=t.activeData)||void 0===a||null===(n=a[null==e?void 0:e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0]:void 0,s=Ln(e),r=Object(Mn.getMinValue)(l,s),o=Object(Mn.getMaxValue)(l,s),c=Object(Mn.getGoalValue)(l,s);return[{type:P.o.DATA,label:u.i18n.translate("xpack.lens.gauge.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"min",columnId:Object(Xt.a)(),staticValue:r},{groupId:"max",columnId:Object(Xt.a)(),staticValue:o},{groupId:"goal",columnId:Object(Xt.a)(),staticValue:c}]:void 0}]},getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n)=>Hn(e,t,a),toPreviewExpression:(t,a)=>Hn(e,t,a),getErrorMessages(e){},getWarningMessages(e,t){var a,n,i;const{maxAccessor:l,minAccessor:s,goalAccessor:r,metricAccessor:o}=e;if(!(l||s||r||o))return;if(!o)return[];const u=null==t||null===(a=t.activeData)||void 0===a||null===(n=a[e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0];if(!u||Rn(u,e))return[];const d=u[o],p=l&&u[l],m=s&&u[s],g=r&&u[r],f=[];return"number"==typeof m&&(m>d&&f.push([Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minValueGreaterMetricShortMessage",defaultMessage:"Minimum value is greater than metric value."})]),m>g&&f.push([Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minimumValueGreaterGoalShortMessage",defaultMessage:"Minimum value is greater than goal value."})])),"number"==typeof p&&(d>p&&f.push([Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.metricValueGreaterMaximumShortMessage",defaultMessage:"Metric value is greater than maximum value."})]),"number"==typeof g&&g>p&&f.push([Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.goalValueGreaterMaximumShortMessage",defaultMessage:"Goal value is greater than maximum value."})])),f}});class gauge_GaugeVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getGaugeVisualization:e}=await Promise.resolve().then(a.bind(null,433));return e({paletteService:(e=>{const t=e=>e?new Pn.a(e).hex()+"80":"000000",a=e=>({...e,getCategoricalColor:(a,n,i)=>t(e.getCategoricalColor(a,n,i)),getCategoricalColors:(a,n)=>e.getCategoricalColors(a,n).map(t)});return{...e,get:t=>a(e.get(t)),getAll:()=>e.getAll().map((e=>a(e)))}})(await n.palettes.getPalettes())})}))}}var qn=a(81),$n=a.n(qn),Wn=a(119),Un=a(80);const Yn=/[^0-9A-Za-z._@\[\]/]/;function Kn(e){const{namedArgument:t,variable:a,function:n}=Object(Me.groupBy)(e,(e=>Object(Me.isObject)(e)?e.type:"variable"));return{namedArguments:t||[],variables:a||[],functions:n||[]}}function Xn(e){return Object(Me.isObject)(e)?"function"!==e.type?e.value:e.name:e}function Zn(e,t,a){if(a&&e.filterable){const e="kql"in t?"kql":"lucene";t[e]?a.query&&(t[e]=`(${a.query}) AND (${t[e]})`):t["kuery"===a.language?"kql":a.language]=a.query}return t}function Qn(e,t=[]){const a=(e.operationParams||[]).reduce(((e,{name:t,type:a})=>(e[t]=a,e)),{});return t.reduce(((t,{name:n,value:i})=>(a[n]&&(t[n]=i),!e.filterable||"kql"!==n&&"lucene"!==n||(t[n]=i),e.shiftable&&"shift"===n&&(t[n]=i),t)),{})}function Jn(e){return"number"===e?u.i18n.translate("xpack.lens.formula.number",{defaultMessage:"number"}):"string"===e?u.i18n.translate("xpack.lens.formula.string",{defaultMessage:"string"}):""}const ei={add:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.addFunction.markdown",{defaultMessage:"\nAdds up two numbers.\nAlso works with + symbol\n\nExample: Calculate the sum of two fields\n\n`sum(price) + sum(tax)`\n\nExample: Offset count by a static value\n\n`add(count(), 5)`\n    "})},subtract:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.subtractFunction.markdown",{defaultMessage:"\nSubtracts the first number from the second number.\nAlso works with `-` symbol\n\nExample: Calculate the range of a field\n`subtract(max(bytes), min(bytes))`\n    "})},multiply:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.multiplyFunction.markdown",{defaultMessage:"\nMultiplies two numbers.\nAlso works with `*` symbol.\n\nExample: Calculate price after current tax rate\n`sum(bytes) * last_value(tax_rate)`\n\nExample: Calculate price after constant tax rate\n`multiply(sum(price), 1.2)`\n    "})},divide:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.divideFunction.markdown",{defaultMessage:"\nDivides the first number by the second number.\nAlso works with `/` symbol\n\nExample: Calculate profit margin\n`sum(profit) / sum(revenue)`\n\nExample: `divide(sum(bytes), 2)`\n    "})},abs:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.absFunction.markdown",{defaultMessage:"\nCalculates absolute value. A negative value is multiplied by -1, a positive value stays the same.\n\nExample: Calculate average distance to sea level `abs(average(altitude))`\n    "})},cbrt:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.cbrtFunction.markdown",{defaultMessage:"\nCube root of value.\n\nExample: Calculate side length from volume\n`cbrt(last_value(volume))`\n    "})},ceil:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.ceilFunction.markdown",{defaultMessage:"\nCeiling of value, rounds up.\n\nExample: Round up price to the next dollar\n`ceil(sum(price))`\n    "})},clamp:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.min",{defaultMessage:"min"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.max",{defaultMessage:"max"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.clampFunction.markdown",{defaultMessage:"\nLimits the value from a minimum to maximum.\n\nExample: Make sure to catch outliers\n```\nclamp(\n  average(bytes),\n  percentile(bytes, percentile=5),\n  percentile(bytes, percentile=95)\n)\n```\n"})},cube:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.cubeFunction.markdown",{defaultMessage:"\nCalculates the cube of a number.\n\nExample: Calculate volume from side length\n`cube(last_value(length))`\n    "})},exp:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.expFunction.markdown",{defaultMessage:"\nRaises *e* to the nth power.\n\nExample: Calculate the natural exponential function\n\n`exp(last_value(duration))`\n    "})},fix:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.fixFunction.markdown",{defaultMessage:"\nFor positive values, takes the floor. For negative values, takes the ceiling.\n\nExample: Rounding towards zero\n`fix(sum(profit))`\n    "})},floor:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.floorFunction.markdown",{defaultMessage:"\nRound down to nearest integer value\n\nExample: Round down a price\n`floor(sum(price))`\n    "})},log:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),optional:!0,defaultValue:"e",type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.logFunction.markdown",{defaultMessage:"\nLogarithm with optional base. The natural base *e* is used as default.\n\nExample: Calculate number of bits required to store values\n```\nlog(sum(bytes))\nlog(sum(bytes), 2)\n```\n    "})},mod:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.modFunction.markdown",{defaultMessage:"\nRemainder after dividing the function by a number\n\nExample: Calculate last three digits of a value\n`mod(sum(price), 1000)`\n    "})},pow:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.powFunction.markdown",{defaultMessage:"\nRaises the value to a certain power. The second argument is required\n\nExample: Calculate volume based on side length\n`pow(last_value(length), 3)`\n    "})},round:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")},{name:u.i18n.translate("xpack.lens.formula.decimals",{defaultMessage:"decimals"}),optional:!0,defaultValue:0,type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.roundFunction.markdown",{defaultMessage:"\nRounds to a specific number of decimal places, default of 0\n\nExamples: Round to the cent\n```\nround(sum(bytes))\nround(sum(bytes), 2)\n```\n    "})},sqrt:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.sqrtFunction.markdown",{defaultMessage:"\nSquare root of a positive value only\n\nExample: Calculate side length based on area\n`sqrt(last_value(area))`\n    "})},square:{positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Jn("number")}],help:u.i18n.translate("xpack.lens.formula.squareFunction.markdown",{defaultMessage:"\nRaise the value to the 2nd power\n\nExample: Calculate area based on side length\n`square(last_value(length))`\n    "})}};function ti(e){return Object(Me.isObject)(e)&&"function"===e.type&&ei[e.name]}function ai(e){return"string"==typeof e?[{type:"variable",value:e,text:e,location:{min:0,max:0}}]:null==e||"number"==typeof e||"namedArgument"===e.type?[]:"variable"===e.type?[e]:e.args.flatMap(ai)}function ni(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>!e.hidden)))}var ii=a(23);const li=(e,t)=>{const[,...a]=e.split("="),n=(a||[""]).join(""),i=n.trim();if(i.length&&("'"!==i[0]||!/'\s*([^']+?)\s*'/.test(n))&&"''"!==i)return u.i18n.translate("xpack.lens.indexPattern.formulaOperationQueryError",{defaultMessage:"Single quotes are required for {language}='' at {rawQuery}",values:{language:t,rawQuery:e}})};function si({messageId:e,values:t,locations:a}){let n;const i=t;switch(e){case"wrongFirstArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongFirstArgument",{defaultMessage:"The first argument for {operation} should be a {type} name. Found {argument}",values:{operation:i.operation,type:i.type,argument:i.argument}});break;case"shouldNotHaveField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotRequired",{defaultMessage:"The operation {operation} does not accept any field as argument",values:{operation:i.operation}});break;case"cannotAcceptParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaParameterNotRequired",{defaultMessage:"The operation {operation} does not accept any parameter",values:{operation:i.operation}});break;case"missingParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionNotHandled",{defaultMessage:"The operation {operation} in the Formula is missing the following parameters: {params}",values:{operation:i.operation,params:i.params}});break;case"wrongTypeParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongType",{defaultMessage:"The parameters for the operation {operation} in the Formula are of the wrong type: {params}",values:{operation:i.operation,params:i.params}});break;case"duplicateArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDuplicateParams",{defaultMessage:"The parameters for the operation {operation} have been declared multiple times: {params}",values:{operation:i.operation,params:i.params}});break;case"missingField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotFound",{defaultMessage:"{variablesLength, plural, one {Field} other {Fields}} {variablesList} not found",values:{variablesLength:i.variablesLength,variablesList:i.variablesList}});break;case"missingOperation":n=u.i18n.translate("xpack.lens.indexPattern.operationsNotFound",{defaultMessage:"{operationLength, plural, one {Operation} other {Operations}} {operationsList} not found",values:{operationLength:i.operationLength,operationsList:i.operationsList}});break;case"fieldWithNoOperation":n=u.i18n.translate("xpack.lens.indexPattern.fieldNoOperation",{defaultMessage:"The field {field} cannot be used without operation",values:{field:i.field}});break;case"failedParsing":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionParseError",{defaultMessage:"The Formula {expression} cannot be parsed",values:{expression:i.expression}});break;case"tooManyArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaWithTooManyArguments",{defaultMessage:"The operation {operation} has too many arguments",values:{operation:i.operation}});break;case"missingMathArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaMathMissingArgument",{defaultMessage:"The operation {operation} in the Formula is missing {count} arguments: {params}",values:{operation:i.operation,count:i.count,params:i.params}});break;case"tooManyQueries":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDoubleQueryError",{defaultMessage:"Use only one of kql= or lucene=, not both"});break;case"tooManyFirstArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationTooManyFirstArguments",{defaultMessage:"The operation {operation} in the Formula requires a {supported, plural, one {single} other {supported}} {type}, found: {text}",values:{operation:i.operation,text:i.text,type:i.type,supported:i.supported||1}});break;case"wrongArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationwrongArgument",{defaultMessage:"The operation {operation} in the Formula does not support {type} parameters, found: {text}",values:{operation:i.operation,text:i.text,type:i.type}});break;case"wrongReturnedType":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongReturnedType",{defaultMessage:"The return value type of the operation {text} is not supported in Formula.",values:{text:i.text}});break;case"filtersTypeConflict":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationFiltersTypeConflicts",{defaultMessage:'The Formula filter of type "{outerType}" is not compatible with the inner filter of type "{innerType}" from the {operation} operation.',values:{operation:i.operation,outerType:i.outerType,innerType:i.innerType}});break;default:n="no Error found"}return{message:n,locations:a}}function ri(e,t){let a;try{a=Object(Wn.parse)(e)}catch(a){const n=((e,t)=>{const a=e.split("\n").join(""),n=a.split(",").filter((e=>/(kql|lucene)/.test(e))),i=Object.keys(t).some((e=>a.includes(e)));if(0===n.length||!i)return;const l=n.flatMap((e=>e.split("count").filter((e=>/(kql|lucene)/.test(e))))),[s,r]=Object(Me.partition)(l,(e=>/kql/.test(e))),o=[];for(const e of s){const t=li(e,"kql");t&&o.push(t)}for(const e of r){const t=li(e,"lucene");t&&o.push(t)}return o.length?o:void 0})(e,t);return n?{root:null,error:{message:n[0],locations:[]}}:{root:null,error:si({messageId:"failedParsing",values:{expression:e},locations:[]})}}return{root:a,error:null}}function oi(e,t,a,n,i){return[...ui(e,t,a,n),...pi(e,t,a,n,i)]}function ui(e,t,a,n){const i=[],l=function(e,t){const a=(n=e,function e(t){return Object(Me.isObject)(t)&&"function"===t.type?[t,...t.args.flatMap(e)].filter(Boolean):[]}(n)).filter((e=>!ti(e)&&!t[e.name]));var n;return{names:Array.from(new Set(a.map((({name:e})=>e)))),locations:a.map((({location:e})=>e)).filter((e=>e))}}(e,n);l.names.length&&i.push(si({messageId:"missingOperation",values:{operationLength:l.names.length,operationsList:l.names.join(", ")},locations:l.locations}));const s=ai(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e]));s.length&&i.push(si({messageId:"missingField",values:{variablesLength:s.length,variablesList:s.map((({value:e})=>e)).join(", ")},locations:s.map((({location:e})=>e))}));const r=function(e,t){const a=[];return Object(Me.isObject)(e)&&"variable"===e.type&&!t.has(e.value)&&a.push(si({messageId:"fieldWithNoOperation",values:{field:e.value},locations:[e.location]})),a}(e,new Set(s.map((({value:e})=>e))));return[...i,...r]}function ci(e,t,a,n){const i=[],{conflicts:l,innerType:s,outerType:r}=function(e,t=[],a){const n=Qn(e,t);if(!e.filterable||!a||!n.kql&&!n.lucene)return{conflicts:!1};const i="kuery"===a.language?"kql":a.language;return{conflicts:!(i in n),innerType:n.lucene?"lucene":"kql",outerType:i}}(t,a,n);return l&&s&&r&&i.push(si({messageId:"filtersTypeConflict",values:{operation:e.name,innerType:s,outerType:r},locations:e.location?[e.location]:[]})),i}function di(e,t,a,n){const i=[],l=function(e,t=[]){return fi(e,t).filter((({isMissing:e,isRequired:t})=>e&&t))}(t,a);l.length&&i.push(si({messageId:"missingParameter",values:{operation:e.name,params:l.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}));const s=function(e,t=[]){return fi(e,t).filter((({isCorrectType:e,isMissing:t})=>!e&&!t))}(t,a);s.length&&i.push(si({messageId:"wrongTypeParameter",values:{operation:e.name,params:s.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}));const r=function(e=[]){const t=Object.create(null);for(const{name:a}of e){const e=t[a]||0;t[a]=e+1}const a=Object.keys(t);return e.length>a.length?a.filter((e=>t[e]>1)):[]}(a);r.length&&i.push(si({messageId:"duplicateArgument",values:{operation:e.name,params:r.join(", ")},locations:e.location?[e.location]:[]}));const o=function(e,t){const a=[];return(null!=e?e:[]).forEach((e=>{if("kql"===e.name||"lucene"===e.name){const n=(({value:e,name:t,text:a},n)=>{const i=li(a,t);if(i)return i;try{return void("kql"===t?Object(Un.g)(Object(Un.d)(e),n):Object(Un.f)(e))}catch(e){return e.message}})(e,t);n&&a.push({message:n,locations:[e.location]})}"shift"===e.name&&"invalid"===Object(ii.parseTimeShift)(e.value)&&a.push({message:u.i18n.translate("xpack.lens.indexPattern.invalidTimeShift",{defaultMessage:"Invalid time shift. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"}),locations:[e.location]})})),a}(a,n);o.length&&i.push(...o);const c=function(e){return e?e.filter((e=>"kql"===e.name||"lucene"===e.name)).length>1:void 0}(a);return c&&i.push(si({messageId:"tooManyQueries",values:{},locations:e.location?[e.location]:[]})),i}function pi(e,t,a,n,i){const l=ai(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e])),s=new Set(l.map((({value:e})=>e))),r=null==i?void 0:i.filter;return function e(t){if(!Object(Me.isObject)(t)||"function"!==t.type)return[];const i=n[t.name],l=[],{namedArguments:o,functions:c,variables:d}=Kn(t.args),[p]=(null==t?void 0:t.args)||[];if(i){if("field"===i.input){if(bi(t)){if(xi(p,"variable")){const e=yi(t,d,{isFieldOperation:!0,firstArg:p,returnedType:gi(i,a,p)});e.length&&l.push(...e)}else ti(p)?l.push(si({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:"math operation"},locations:t.location?[t.location]:[]})):l.push(si({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:Xn(p)||u.i18n.translate("xpack.lens.indexPattern.formulaNoFieldForOperation",{defaultMessage:"no field"})},locations:t.location?[t.location]:[]}));const e=ji(t,c,0,{isFieldOperation:!0,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),firstArgValidation:!1});e.length&&l.push(...e)}else(null!=c&&c.length||null!=d&&d.length)&&l.push(si({messageId:"shouldNotHaveField",values:{operation:t.name},locations:t.location?[t.location]:[]}));if(!mi(i)&&o.length)l.push(si({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:t.location?[t.location]:[]}));else{const e=di(t,i,o,a),n=ci(t,i,o,r);l.push(...e,...n)}return l}if("fullReference"===i.input){const e=Boolean(!xi(p,"function")||ti(p)&&vi(p,s).length);e&&l.push(si({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaOperationValue",{defaultMessage:"operation"}),argument:Xn(p)||u.i18n.translate("xpack.lens.indexPattern.formulaNoOperation",{defaultMessage:"no operation"})},locations:t.location?[t.location]:[]}));const n=ji(t,c,i.requiredReferences?i.requiredReferences.length:1,{isFieldOperation:!1,firstArgValidation:e,type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})});if(n.length&&l.push(...n),!mi(i)&&o.length)l.push(si({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:t.location?[t.location]:[]}));else{const e=yi(t,d,{isFieldOperation:!1,firstArg:p,returnedType:void 0}),n=di(t,i,o,a),s=ci(t,i,o,r);l.push(...e,...n,...s)}}return l.concat(e(c[0]))}return l.push(...vi(t,s)),null!=c&&c.length?l.concat(c.flatMap((t=>e(t)))):l}(e)}function mi(e){return Boolean((e.operationParams||[]).length)||e.filterable}function gi(e,t,a){var n;const i=ai(a);if(1!==i.length)return;const l=t.getFieldByName(Xn(i[0]));return l?null===(n=e.getPossibleOperationForField(l))||void 0===n?void 0:n.scale:void 0}function fi(e,t=[]){var a;const n=Qn(e,t),i=[...null!==(a=e.operationParams)&&void 0!==a?a:[]];return e.filterable&&i.push({name:"kql",type:"string",required:!1},{name:"lucene",type:"string",required:!1}),i.map((({name:e,type:t,required:a})=>({name:e,isMissing:!(e in n),isCorrectType:typeof n[e]===t,isRequired:a})))}function bi(e){return hi(e.name)}function hi(e){return!["count"].includes(e)}function xi(e,t){return Object(Me.isObject)(e)&&e.type===t}function vi(e,t){const a=function(e){return function e(t){return Object(Me.isObject)(t)&&"function"===t.type&&ti(t)?[t,...t.args.flatMap(e)].filter(Boolean):[]}(e)}(e),n=[];return a.forEach((e=>{const{positionalArguments:a}=ei[e.name];if(!e.args.length)return n.push(si({messageId:"wrongFirstArgument",values:{operation:e.name,type:"operation",argument:"()"},locations:e.location?[e.location]:[]}));e.args.length>a.length&&n.push(si({messageId:"tooManyArguments",values:{operation:e.name},locations:e.location?[e.location]:[]})),a.some(((a,n)=>{const i=e.args[n];if(null!=i&&"number"!=typeof i)return"variable"===i.type&&!t.has(i.value)}))&&n.push(si({messageId:"shouldNotHaveField",values:{operation:e.name},locations:e.location?[e.location]:[]}));const i=a.filter((({optional:e})=>!e));if(i.length>1&&e.args.length<i.length){const t=a.filter((({name:t,optional:a},n)=>!a&&null==e.args[n]));n.push(si({messageId:"missingMathArgument",values:{operation:e.name,count:i.length-e.args.length,params:t.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}))}})),n}function yi(e,t,{isFieldOperation:a,firstArg:n,returnedType:i}){const l=t.filter((e=>xi(e,"variable")&&!ti(e))),s=[];var r;return a&&(l.length>1||1===l.length&&l[0]!==n)&&s.push(si({messageId:"tooManyFirstArguments",values:{operation:e.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),supported:1,text:l.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]})),a&&1===l.length&&l[0]===n&&"ordinal"===i&&s.push(si({messageId:"wrongReturnedType",values:{text:null!==(r=e.text)&&void 0!==r?r:`${e.name}(${Xn(n)})`},locations:e.location?[e.location]:[]})),!a&&l.length&&s.push(si({messageId:"wrongArgument",values:{operation:e.name,text:l.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"})},locations:e.location?[e.location]:[]})),s}function ji(e,t,a=0,{isFieldOperation:n,firstArgValidation:i,type:l}){const s=[],[r,o]=Object(Me.partition)(t,(e=>!ti(e)));return r.length>a&&(n?s.push(si({messageId:"wrongArgument",values:{operation:e.name,text:r.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})},locations:e.location?[e.location]:[]})):s.push(si({messageId:"tooManyFirstArguments",values:{operation:e.name,type:l,supported:a,text:r.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}))),n&&(!i&&o.length||o.length>1)&&s.push(si({messageId:"wrongArgument",values:{operation:e.name,type:l,text:o.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]})),s}var Oi=a(283),ki=a.n(Oi),Ii=a(45);function Ti({indexPattern:e,operationDefinitionMap:t,isFullscreen:a}){const[n,i]=Object(l.useState)(),r=Object(l.useRef)({});Object(l.useEffect)((()=>{n&&r.current[n]&&r.current[n].scrollIntoView()}),[n]);const o=[];o.push({label:u.i18n.translate("xpack.lens.formulaDocumentationHeading",{defaultMessage:"How it works"}),items:[]}),o.push({label:u.i18n.translate("xpack.lens.formulaFrequentlyUsedHeading",{defaultMessage:"Common formulas"}),description:u.i18n.translate("xpack.lens.formulaCommonFormulaDocumentation",{defaultMessage:'The most common formulas are dividing two values to produce a percent. To display accurately, set "value format" to "percent".'}),items:[{label:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatio",{defaultMessage:"Filter ratio"}),description:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatioDescription.markdown",{defaultMessage:"### Filter ratio:\n\nUse `kql=''` to filter one set of documents and compare it to other documents within the same grouping.\nFor example, to see how the error rate changes over time:\n\n```\ncount(kql='response.status_code > 400') / count()\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeek",{defaultMessage:"Week over week"}),description:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeekDescription.markdown",{defaultMessage:"### Week over week:\n\nUse `shift='1w'` to get the value of each grouping from\nthe previous week. Time shift should not be used with the *Top values* function.\n\n```\npercentile(system.network.in.bytes, percentile=99) /\npercentile(system.network.in.bytes, percentile=99, shift='1w')\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotal",{defaultMessage:"Percent of total"}),description:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotalDescription.markdown",{defaultMessage:"### Percent of total\n\nFormulas can calculate `overall_sum` for all the groupings,\nwhich lets you convert each grouping into a percent of total:\n\n```\nsum(products.base_price) / overall_sum(sum(products.base_price))\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})}]}),o.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSection",{defaultMessage:"Elasticsearch"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSectionDescription",{defaultMessage:"These functions will be executed on the raw documents for each row of the resulting table, aggregating all documents matching the break down dimensions into a single value."}),items:[]});const c=Hi(e);o[2].items.push(...c.filter((e=>{var a;return e in t&&"elasticsearch"===(null===(a=t[e].documentation)||void 0===a?void 0:a.section)})).sort().map((e=>{var a,n;return{label:e,description:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("h3",null,e,"(",null===(a=t[e].documentation)||void 0===a?void 0:a.signature,")"),null!==(n=t[e].documentation)&&void 0!==n&&n.description?Object(x.jsx)(d.Markdown,{markdown:t[e].documentation.description}):null)}}))),o.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSection",{defaultMessage:"Column calculations"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSectionDescription",{defaultMessage:"These functions are executed for each row, but are provided with the whole column as context. This is also known as a window function."}),items:[]}),o[3].items.push(...c.filter((e=>{var a;return e in t&&"calculation"===(null===(a=t[e].documentation)||void 0===a?void 0:a.section)})).sort().map((e=>{var a,i;return{label:e,description:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("h3",null,e,"(",null===(a=t[e].documentation)||void 0===a?void 0:a.signature,")"),null!==(i=t[e].documentation)&&void 0!==i&&i.description?Object(x.jsx)(d.Markdown,{markdown:t[e].documentation.description}):null),checked:n===`${e}: ${t[e].displayName}`?"on":void 0}}))),o.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.mathSection",{defaultMessage:"Math"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.mathSectionDescription",{defaultMessage:"These functions will be executed for reach row of the resulting table using single values from the same row calculated using other functions."}),items:[]});const p=Object(l.useMemo)((()=>Hi(e).filter((e=>e in ei)).sort().map((e=>{const[t,a]=ei[e].help.split("```");return{label:e,description:t.replace(/\n/g,"\n\n"),examples:a?`\`\`\`${a}\`\`\``:""}}))),[e]);o[4].items.push(...p.map((({label:e,description:a,examples:n})=>({label:e,description:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("h3",null,Mi(e,t)),Object(x.jsx)(d.Markdown,{markdown:`${a}${n}`}))}))));const[m,f]=Object(l.useState)(""),b=m.trim().toLocaleLowerCase(),h=o.map((e=>{const t=e.items.filter((e=>!b||e.label.toLocaleLowerCase().includes(b)));return{...e,items:t}})).filter((e=>e.items.length>0||!b||e.label.toLocaleLowerCase().includes(b)));return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiPopoverTitle,{className:"lnsFormula__docsHeader",paddingSize:"m"},u.i18n.translate("xpack.lens.formulaDocumentation.header",{defaultMessage:"Formula reference"})),Object(x.jsx)(g.EuiFlexGroup,{className:"lnsFormula__docsContent",gutterSize:"none",responsive:!1,alignItems:"stretch"},Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__docsSidebar",grow:1},Object(x.jsx)(g.EuiFlexGroup,{className:"lnsFormula__docsSidebarInner",direction:"column",gutterSize:"none",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__docsSearch",grow:!1},Object(x.jsx)(g.EuiFieldSearch,{value:m,onChange:e=>{f(e.target.value)},placeholder:u.i18n.translate("xpack.lens.formulaSearchPlaceholder",{defaultMessage:"Search functions"})})),Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__docsNav"},h.map(((e,t)=>Object(x.jsx)("nav",{className:"lnsFormula__docsNavGroup",key:e.label},Object(x.jsx)(g.EuiTitle,{size:"xxs"},Object(x.jsx)("h6",null,Object(x.jsx)(g.EuiLink,{className:"lnsFormula__docsNavGroupLink",color:"text",onClick:()=>{i(e.label)}},Object(x.jsx)(g.EuiHighlight,{search:m},e.label)))),e.items.length?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(g.EuiListGroup,{gutterSize:"none"},e.items.map((e=>Object(x.jsx)(g.EuiListGroupItem,{key:e.label,label:Object(x.jsx)(g.EuiHighlight,{search:m},e.label),size:"s",onClick:()=>{i(e.label)}}))))):null)))))),Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__docsText",grow:2},Object(x.jsx)(g.EuiText,{size:"s"},Object(x.jsx)("section",{className:"lnsFormula__docsTextIntro",ref:e=>{e&&(r.current[o[0].label]=e)}},Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.markdown",{defaultMessage:"## How it works\n\nLens formulas let you do math using a combination of Elasticsearch aggregations and\nmath functions. There are three main types of functions:\n\n* Elasticsearch metrics, like `sum(bytes)`\n* Time series functions use Elasticsearch metrics as input, like `cumulative_sum()`\n* Math functions like `round()`\n\nAn example formula that uses all of these:\n\n```\nround(100 * moving_average(\n  average(cpu.load.pct),\n  window=10,\n  kql='datacenter.name: east*'\n))\n```\n\nElasticsearch functions take a field name, which can be in quotes. `sum(bytes)` is the same\nas `sum('bytes')`.\n\nSome functions take named arguments, like `moving_average(count(), window=5)`.\n\nElasticsearch metrics can be filtered using KQL or Lucene syntax. To add a filter, use the named\nparameter `kql='field: value'` or `lucene=''`. Always use single quotes when writing KQL or Lucene\nqueries. If your search has a single quote in it, use a backslash to escape, like: `kql='Women's''\n\nMath functions can take positional arguments, like pow(count(), 3) is the same as count() * count() * count()\n\nUse the symbols +, -, /, and * to perform basic math.\n                  ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})),o.slice(1).map(((e,t)=>Object(x.jsx)("section",{className:"lnsFormula__docsTextGroup",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},Object(x.jsx)("h2",null,e.label),Object(x.jsx)("p",null,e.description),o[t+1].items.map((e=>Object(x.jsx)("article",{className:"lnsFormula__docsTextItem",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},e.description))))))))))}const Fi=s.a.memo(Ti);function Mi(e,t,a){if(ei[e])return`${e}(${ei[e].positionalArguments.map((({name:e,optional:t,type:a})=>`[${e}]${t?"?":""}: ${a}`)).join(", ")})`;if(t[e]){var n;const a=t[e];let i="";return a.filterable&&(i+=hi(e)||"operationParams"in a?",":"",i+=u.i18n.translate("xpack.lens.formula.kqlExtraArguments",{defaultMessage:"[kql]?: string, [lucene]?: string"})),a.filterable&&a.shiftable&&(i+=", "),a.shiftable&&(i+=u.i18n.translate("xpack.lens.formula.shiftExtraArguments",{defaultMessage:"[shift]?: string"})),`${e}(${null===(n=a.documentation)||void 0===n?void 0:n.signature}${i})`}return""}function wi(e){return e.map((({name:e,type:t,defaultValue:a=5})=>`${e}=${"string"===t?`"${a}"`:a}`)).join(", ")}var _i=a(35);const Ci=[{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.hour",{defaultMessage:"1 hour ago (1h)"}),value:"1h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3hours",{defaultMessage:"3 hours ago (3h)"}),value:"3h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6hours",{defaultMessage:"6 hours ago (6h)"}),value:"6h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.12hours",{defaultMessage:"12 hours ago (12h)"}),value:"12h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.day",{defaultMessage:"1 day ago (1d)"}),value:"1d"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.week",{defaultMessage:"1 week ago (1w)"}),value:"1w"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.month",{defaultMessage:"1 month ago (1M)"}),value:"1M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3months",{defaultMessage:"3 months ago (3M)"}),value:"3M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6months",{defaultMessage:"6 months ago (6M)"}),value:"6M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.year",{defaultMessage:"1 year ago (1y)"}),value:"1y"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.previous",{defaultMessage:"Previous time range"}),value:"previous"}],Ei=Ci.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function Si(e,t,a,n){const i=e.columnOrder.find((t=>"date_histogram"===e.columns[t].operationType));if(!i&&!t.timeFieldName)return{canShift:!1,hasDateHistogram:!1};if(i&&a&&a[n]&&a[n]){const e=a[n].columns.find((e=>e.id===i));if(e){var l;const t=(null===(l=_i.search.aggs.getDateHistogramMetaDataByDatatableColumn(e))||void 0===l?void 0:l.interval)||"";return{interval:_i.search.aggs.parseInterval(t),expression:t,canShift:!0,hasDateHistogram:!0}}}return{canShift:!0,hasDateHistogram:Boolean(i)}}function Pi({interval:e,hasDateHistogram:t,canShift:a}){return{canShift:a,isValueTooSmall:t=>e&&t&&"object"==typeof t&&t.asMilliseconds()<e.asMilliseconds(),isValueNotMultiple:t=>e&&t&&"object"==typeof t&&!Number.isInteger(t.asMilliseconds()/e.asMilliseconds()),isInvalid:e=>Boolean("invalid"===e||t&&e&&"previous"===e)}}function Ai(e,t){const a=e.columns[t];if(a.timeShift&&"previous"===Object(ii.parseTimeShift)(a.timeShift))return Object.values(e.columns).some((e=>"date_histogram"===e.operationType))?[u.i18n.translate("xpack.lens.indexPattern.dateHistogramTimeShift",{defaultMessage:'In a single layer, you are unable to combine previous time range shift with date histograms. Either use an explicit time shift duration in "{column}" or replace the date histogram.',values:{column:a.label}})]:void 0}function Li(e,{activeData:t}){if(!e)return;const a=[];return Object.entries(e.layers).forEach((([n,i])=>{const l=e.indexPatterns[i.indexPatternId];if(!l)return;const s=Si(i,l,t,n);if(!s.interval)return;const r=s.expression,o=s.interval.asMilliseconds();let u=[];const d={};Object.entries(i.columns).forEach((([e,t])=>{if(t.isBucketed)return;let a=0;if(t.timeShift){const e=Object(ii.parseTimeShift)(t.timeShift);if("previous"===e||"invalid"===e)return;a=e.asMilliseconds()}u.push(a),d[a]||(d[a]=[]),d[a].push(e)})),u=Object(Me.uniq)(u),u.length<2||u.forEach((e=>{0!==e&&(e<o?d[e].forEach((e=>{a.push(Object(x.jsx)(c.FormattedMessage,{key:`small-${e}`,id:"xpack.lens.indexPattern.timeShiftSmallWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is smaller than the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(x.jsx)("strong",null,i.columns[e].label),interval:Object(x.jsx)("strong",null,r),columnTimeShift:Object(x.jsx)("strong",null,i.columns[e].timeShift)}}))})):Number.isInteger(e/o)||d[e].forEach((e=>{a.push(Object(x.jsx)(c.FormattedMessage,{key:`multiple-${e}`,id:"xpack.lens.indexPattern.timeShiftMultipleWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is not a multiple of the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(x.jsx)("strong",null,i.columns[e].label),interval:Object(x.jsx)("strong",null,r),columnTimeShift:Object(x.jsx)("strong",null,i.columns[e].timeShift)}}))})))}))})),a}let Di;!function(e){e.FIELD="field",e.NAMED_ARGUMENT="named_argument",e.FUNCTIONS="functions",e.KQL="kql",e.SHIFTS="shifts"}(Di||(Di={}));const Ni="LENS_MATH_MARKER";function zi(e,t,a){if("number"!=typeof e&&(!e.location||(n=t)>=(i=e.location).min&&n<i.max)){var n,i;if("function"===e.type){const[a]=e.args.map((a=>zi(a,t,e))).filter((e=>e));return a||(e.location?{ast:e}:void 0)}return{ast:e,parent:a}}}function Bi(e,t){const a=e.split(/\n/);let n=t,i=1;for(const e of a){if(e.length>=n)return new Ii.monaco.Position(i,n+1);n-=e.length+1,i++}throw new Error("Algorithm failure")}function Vi(e,t){return e.split(/\n/).slice(0,t.lineNumber).reduce(((e,a,n)=>e+(n===t.lineNumber-1?t.column-1:a.length+1)),0)}async function Ri({expression:e,zeroIndexedOffset:t,context:a,indexPattern:n,operationDefinitionMap:i,data:l,dateHistogramInterval:s}){const r=e.substr(0,t)+Ni+e.substr(t);try{const e=zi(Object(Wn.parse)(r),t),o=null==e?void 0:e.ast,u=(null==e?void 0:e.parent)&&"number"!=typeof o&&o&&"type"in o&&"namedArgument"===o.type;if(null!=e&&e.parent&&("="===a.triggerCharacter||u))return await async function({ast:e,data:t,indexPattern:a,dateHistogramInterval:n}){if("shift"===e.name)return{list:Ci.filter((({value:e})=>{if(void 0===n)return!0;const t=Object(ii.parseTimeShift)(e);return"previous"!==t&&("invalid"===t||Number.isInteger(t.asMilliseconds()/n))})).map((({value:e})=>e)),type:Di.SHIFTS};if("kql"!==e.name&&"lucene"!==e.name)return{list:[],type:Di.KQL};if(!t.autocomplete.hasQuerySuggestions("kql"===e.name?"kuery":"lucene"))return{list:[],type:Di.KQL};const i=e.value.split(Ni)[0],l=e.value.indexOf(Ni)+1,s=await t.autocomplete.getQuerySuggestions({language:"kql"===e.name?"kuery":"lucene",query:i,selectionStart:l,selectionEnd:l,indexPatterns:[a],boolFilter:[]});return{list:null!=s?s:[],type:Di.KQL}}({ast:o,data:l,indexPattern:n,dateHistogramInterval:s});if(null!=e&&e.parent)return function(e,t,a,n,i){const{name:l}=e,s=i[l];if(!s&&!ei[l])return{list:[],type:Di.FIELD};const r=ei[l];if(r)return r.positionalArguments[t]?{list:Object(Me.uniq)(Hi(n,i)).map((e=>({type:"math",label:e}))),type:Di.FUNCTIONS}:{list:[],type:Di.FIELD};if(t>0||!hi(s.type)){const{namedArguments:t}=Kn(e.args),a=[];return s.filterable&&(t.find((e=>"kql"===e.name||"lucene"===e.name))||(a.push("kql"),a.push("lucene"))),s.shiftable&&(t.find((e=>"shift"===e.name))||a.push("shift")),"operationParams"in s&&a.push(...s.operationParams.filter((e=>!t.find((t=>t.name===e.name)))).map((e=>e.name))),{list:a,type:Di.NAMED_ARGUMENT}}if("field"===s.input&&0===t){const t=zo(n,i).find((({operationMetaData:e})=>"number"===e.dataType&&!e.isBucketed));if(t){const n=t.operations.filter((e=>e.operationType===s.type)).map((e=>"field"in e?e.field:void 0)).filter((e=>e)),i=e.args[0],l="string"!=typeof i&&i.location;let r;if(l){const e=Bi(a,l.min),t=Bi(a,l.max-Ni.length);r=Ii.monaco.Range.fromPositions(e,t)}return{list:n,type:Di.FIELD,range:r}}return{list:[],type:Di.FIELD}}if("fullReference"===s.input){const e=zo(n,i),t=[];return e.forEach((e=>{s.requiredReferences.some((t=>t.validateMetadata(e.operationMetaData)))&&t.push(...e.operations.filter((e=>s.requiredReferences.some((t=>t.input.includes(e.type))))).map((e=>e.operationType)))})),{list:Object(Me.uniq)(t).map((e=>({label:e,type:"operation"}))),type:Di.FUNCTIONS}}return{list:[],type:Di.FIELD}}(e.parent,e.parent.args.findIndex((e=>e===o)),r,n,i);if("object"==typeof o&&Boolean("variable"===o.type||"function"===o.type))return function(e,t,a){return{list:Object(Me.uniq)(Hi(t,a).filter((t=>Object(Me.startsWith)(t,e)))).map((e=>({label:e,type:"operation"}))),type:Di.FUNCTIONS}}(("function"===o.type?o.name:o.value).split(Ni)[0],n,i)}catch(e){}return{list:[],type:Di.FIELD}}function Hi(e,t){const a=zo(e,t),n=[];return a.forEach((e=>{"number"!==e.operationMetaData.dataType||e.operationMetaData.isBucketed||n.push(...e.operations.filter((e=>"managedReference"!==e.type)).map((e=>e.operationType)))})),[...Object(Me.uniq)(n),...Object.keys(ei)]}const Gi={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"};function qi(e,t){if(ei[e])return[{label:Mi(e,t),documentation:{value:ei[e].help.replace(/\n/g,"\n\n")},parameters:ei[e].positionalArguments.map((e=>({label:e.name,documentation:e.optional?u.i18n.translate("xpack.lens.formula.optionalArgument",{defaultMessage:"Optional. Default value is {defaultValue}",values:{defaultValue:e.defaultValue}}):""})))}];if(t[e]){const a=t[e],n=hi(e)?{label:"field"===a.input?"field":"fullReference"===a.input?"function":""}:null,i=Mi(e,t),l=function(e,t){const{description:a,examples:n}=function(e,t){var a,n;const i=t[e],l=null!==(a=null===(n=i.documentation)||void 0===n?void 0:n.description)&&void 0!==a?a:"",s=[];if(!/Example/.test(l)){if(!hi(e))return s.push(`${e}()`),{description:l,examples:s};if("field"===i.input){var r;const t=(null===(r=i.operationParams)||void 0===r?void 0:r.filter((({required:e})=>e)))||[];if(0===t.length&&s.push(`${e}(bytes)`),t.length){const a=wi(t);s.push(`${e}(bytes, ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=wi(i.operationParams);s.push(`${e}(bytes, ${t})`)}}if("fullReference"===i.input){var o;const t=(null===(o=i.operationParams)||void 0===o?void 0:o.filter((({required:e})=>e)))||[];if(0===t.length&&s.push(`${e}(sum(bytes))`),t.length){const a=wi(t);s.push(`${e}(sum(bytes), ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=wi(i.operationParams);s.push(`${e}(sum(bytes), ${t})`)}}}return{description:l,examples:s}}(e,t);return{value:`${a}${n.length?`\n\n**${u.i18n.translate("xpack.lens.formulaExampleMarkdown",{defaultMessage:"Examples"})}**\n\n  ${n.map((e=>`\`${e}\``)).join("\n\n")}`:""}`}}(e,t);return"operationParams"in a&&a.operationParams?[{label:i,parameters:[...n?[n]:[],...a.operationParams.map((e=>({label:`${e.name}=${e.type}`,documentation:e.required?u.i18n.translate("xpack.lens.formula.requiredArgument",{defaultMessage:"Required"}):""})))],documentation:l}]:[{label:i,parameters:n?[n]:[],documentation:l}]}return[]}function $i(e,t){const a=e.substr(0,t)+Ni+e.substr(t);try{return zi(Object(Wn.parse)(a),t)}catch(e){return}}const Wi="lens_math";Ii.monaco.languages.register({id:Wi});Ii.monaco.languages.setMonarchTokensProvider(Wi,{defaultToken:"invalid",tokenPostfix:"",ignoreCase:!0,brackets:[{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[\\"'])/,tokenizer:{root:[[/\s+/,"whitespace"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?/,"number"],[/[a-zA-Z0-9][a-zA-Z0-9_\-\.]*/,"keyword"],[/[,=:]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_dq"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/'/,"string","@string_sq"],[/\+|\-|\*|\//,"keyword.operator"],[/[\(]/,"delimiter"],[/[\)]/,"delimiter"]],string_dq:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_sq:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]]}}),Ii.monaco.languages.setLanguageConfiguration(Wi,{wordPattern:/[^()'"\s]+/g,brackets:[["(",")"]],autoClosingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}]}),a(278);const Ui={type:"math",displayName:"Math",hidden:!0,getDefaultLabel:(e,t)=>"Math",input:"managedReference",getDisabledStatus(e){},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{const a=e.columns[t];return[{type:"function",function:"mathColumn",arguments:{id:[t],name:[a.label],expression:[Yi(a.params.tinymathAst)],onError:["null"]}}]},buildColumn:()=>({label:"Math",dataType:"number",operationType:"math",isBucketed:!1,scale:"ratio",params:{tinymathAst:""},references:[]}),isTransferable:(e,t)=>!0,createCopy:e=>({...e})};function Yi(e){return"number"==typeof e?e:"string"==typeof e?`"${e}"`:"variable"===e.type?e.value:"namedArgument"===e.type?"kql"===e.name||"lucene"===e.name?`${e.name}='${e.value}'`:`${e.name}=${e.value}`:`${e.name}(${e.args.map(Yi).join(",")})`}const Ki={displayName:u.i18n.translate("xpack.lens.indexPattern.records",{defaultMessage:"Records"}),name:P.d,type:"document",aggregatable:!0,searchable:!0};function Xi(e,t){return`${e}X${t}`}function Zi(e,t,a,n){const i={...a,columns:{...a.columns,[e]:{...t}}},{columns:l,meta:s}=Object.entries(i.columns).reduce(((t,[a,l])=>{if(a.startsWith(e)){if(a===e&&function(e){return"params"in e&&"formula"in e.params}(l)){const e=function(e,t,a,{indexPattern:n,operations:i=Co}){const{columns:l,meta:s}={columns:{},meta:{locations:{}}},r=t.params.formula||"",{extracted:o,isValid:c}=function(e,t,a,n,i,l){const{root:s,error:r}=ri(e,i);if(r||null==s)return{extracted:[],isValid:!1};if(oi(s,t,n,i,t.columns[a]).length)return{extracted:[],isValid:!1};const o=function(e,t,a,n,i,l){const s=[],r=n.columns[e].filter,o=function a(o){if("number"==typeof o||"function"!==o.type)return o;const u=t[o.name];if(!u){const e=o.args.map(a).filter((e=>null!=e));return{...o,args:e}}const{namedArguments:c,variables:d,functions:p}=Kn(o.args);if("field"===u.input){const[t]=d.filter((e=>Object(Me.isObject)(e))),a=bi(o)?i.getFieldByName(t.value):Ki,p={...Zn(u,Qn(u,c||[]),r),usedInMath:!0},m=u.buildColumn({layer:n,indexPattern:i,field:a},p),g=Xi(e,s.length);return m.customLabel=!0,m.label=l,s.push({column:m,location:o.location}),g}if("fullReference"===u.input){const[t]=p,d=a(t),m="string"!=typeof d;if(m){const e=d?ai(d):[],t=Ui.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=d,s.push({column:t}),t.customLabel=!0,t.label=l}const g=Zn(u,Qn(u,c||[]),r),f=u.buildColumn({layer:n,indexPattern:i,referenceIds:[m?Xi(e,s.length-1):d]},g),b=Xi(e,s.length);return f.customLabel=!0,f.label=l,s.push({column:f,location:o.location}),b}}(a);if(void 0===o)return[];if("string"!=typeof o){const e=ai(o),t=Ui.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=o,t.customLabel=!0,t.label=l,s.push({column:t})}return s}(a,i,s,t,n,u.i18n.translate("xpack.lens.indexPattern.formulaPartLabel",{defaultMessage:"Part of {label}",values:{label:l||e}}));return{extracted:o,isValid:!0}}(r,a,e,n,ni(i),t.customLabel?t.label:void 0);return o.forEach((({column:t,location:a},n)=>{const i=Xi(e,n);l[i]=t,a&&(s.locations[i]=a)})),l[e]={...t,label:t.customLabel?t.label:null!=r?r:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),references:c?[Xi(e,o.length-1)]:[],params:{...t.params,formula:r,isFormulaBroken:!c}},{columns:l,meta:s}}(a,l,i,n);t.columns={...t.columns,...e.columns},t.meta={...t.meta,...e.meta}}}else t.columns[a]={...l};return t}),{columns:{},meta:{locations:{}}});return{layer:{...i,columns:l,columnOrder:is({...i,columns:l})},meta:s}}function Qi(e,t,a){const n=null==e?void 0:e[t];return!(!n||0===n.rows.length)&&n.rows.some((e=>null!=e[a]))}const Ji=s.a.memo(el);function el({layer:e,updateLayer:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,data:c,toggleFullscreen:p,isFullscreen:m,setIsCloseable:f,dateHistogramInterval:b,hasData:v}){var j;const[O,k]=Object(l.useState)(a.params.formula),[I,T]=Object(l.useState)([]),[F,M]=Object(l.useState)(m),[w,_]=Object(l.useState)(!1),[C,E]=Object(l.useState)(!0),S=s.a.useRef(),P=s.a.useRef(),A=s.a.useRef([]),L=s.a.useRef(),D=Object(l.useMemo)((()=>ni(o)),[o]),N="interval"in b?null===(j=b.interval)||void 0===j?void 0:j.asMilliseconds():void 0,z=Object(l.useRef)(N);if(z.current=N,null==P||!P.current){const e=P.current=document.createElement("div");e.setAttribute("data-test-subj","lnsFormulaWidget"),e.classList.add("lnsFormulaOverflow","monaco-editor"),document.body.appendChild(e)}Object(l.useEffect)((()=>{const e=S,t=A,a=L;return()=>{var n,i,l,s,r;null===(n=e.current)||void 0===n||n.dispose(),null===(i=P.current)||void 0===i||null===(l=i.parentNode)||void 0===l||l.removeChild(P.current),null===(s=a.current)||void 0===s||s.dispose(),null===(r=t.current)||void 0===r||r.forEach((e=>e.dispose()))}}),[]),ki()((()=>{f(!0),O!==a.params.formula&&t((e=>Zi(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o}).layer))})),Object(y.s)((()=>{if(!S.current)return;if(!O)return T([]),Ii.monaco.editor.setModelMarkers(S.current,"LENS",[]),void(a.params.formula&&t(Zi(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o}).layer));let i=[];const{root:l,error:s}=ri(O,D);if(s)i=[s];else if(l){const t=oi(l,e,r,D,a);t.length&&(i=t)}if(i.length){const l=a.params.isFormulaBroken,s=!a.params.isFormulaBroken&&!v;(l||s)&&a.params.formula!==O&&t(Zi(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o}).layer);const u=i.flatMap((e=>{if(e.locations.length)return e.locations.map((t=>{const a=Bi(O,t.min),n=Bi(O,t.max);return{message:e.message,startColumn:a.column+1,startLineNumber:a.lineNumber,endColumn:n.column+1,endLineNumber:n.lineNumber,severity:"warning"===e.severity?Ii.monaco.MarkerSeverity.Warning:Ii.monaco.MarkerSeverity.Error}}));{const t=Bi(O,0),a=Bi(O,O.length-1);return[{message:e.message,startColumn:t.column+1,startLineNumber:t.lineNumber,endColumn:a.column+1,endLineNumber:a.lineNumber,severity:"warning"===e.severity?Ii.monaco.MarkerSeverity.Warning:Ii.monaco.MarkerSeverity.Error}]}}));Ii.monaco.editor.setModelMarkers(S.current,"LENS",u),T(u.map((({severity:e,message:t})=>({severity:e,message:t}))))}else{Ii.monaco.editor.setModelMarkers(S.current,"LENS",[]);const{layer:i,meta:{locations:l}}=Zi(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o});t(i);const s=bs(n,i.columns).flatMap((([e,t])=>{const a=[];if(l[e]){const n=D[t.operationType];if(n.getErrorMessage){const t=n.getErrorMessage(i,e,r,D);if(t){const n=Bi(O,l[e].min),i=Bi(O,l[e].max);a.push({message:t.join(", "),startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:Ii.monaco.MarkerSeverity.Warning})}}if(n.shiftable&&t.timeShift){const n=Bi(O,l[e].min),i=Bi(O,l[e].max);a.push(...function(e,t){const{isValueTooSmall:a,isValueNotMultiple:n}=Pi(e),i=[],l=t.timeShift&&Object(ii.parseTimeShift)(t.timeShift),s=l&&a(l),r=l&&n(l);return s?i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})):r&&i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})),i}(b,t).map((e=>({message:e,startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:Ii.monaco.MarkerSeverity.Warning}))))}}return a})).filter((e=>e));T(s.map((({severity:e,message:t})=>({severity:e,message:t})))),Ii.monaco.editor.setModelMarkers(S.current,"LENS",s)}}),{skipFirstRender:!1},256,[O,a.filter]);const B=I.filter((e=>e.severity===Ii.monaco.MarkerSeverity.Error)).length,V=I.filter((e=>e.severity===Ii.monaco.MarkerSeverity.Warning)).length,R=Object(l.useCallback)((async(e,t,a)=>{const n=e.getValue();let i={list:[],type:Di.FIELD};const l=Vi(n,t);return"("===a.triggerCharacter?("()"===n.slice(l-1,l+1)&&(t=t.delta(0,-1)),e.getWordAtPosition(t.delta(0,-3))&&(i=await Ri({expression:n,zeroIndexedOffset:l,context:a,indexPattern:r,operationDefinitionMap:D,data:c,dateHistogramInterval:z.current}))):i=await Ri({expression:n,zeroIndexedOffset:l,context:a,indexPattern:r,operationDefinitionMap:D,data:c,dateHistogramInterval:z.current}),{suggestions:i.list.map((e=>function(e,t,a,n,i){var l;let s,r,o,u=Ii.monaco.languages.CompletionItemKind.Method,c="string"==typeof e?e:"label"in e?e.label:e.text,d="",p="";const m=c;switch(t){case Di.SHIFTS:p=String(Ei[c]).padStart(4,"0");break;case Di.FIELD:u=Ii.monaco.languages.CompletionItemKind.Value,Yn.test(c)&&(s=`'${c.replaceAll("'","\\'")}'`);break;case Di.FUNCTIONS:if(s=`${c}($0)`,r=Ii.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,"string"!=typeof e){if("text"in e)break;c=Mi(e.label,a),ei[e.label]?(d="TinyMath",u=Ii.monaco.languages.CompletionItemKind.Method):(u=Ii.monaco.languages.CompletionItemKind.Constant,d="Elasticsearch",p=`0${c}`,o=Gi)}break;case Di.NAMED_ARGUMENT:u=Ii.monaco.languages.CompletionItemKind.Keyword,"kql"!==c&&"lucene"!==c&&"shift"!==c||(o=Gi,s=`${c}='$0'`,r=Ii.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,p=`zzz${c}`),c=`${c}=`,d="";break;case Di.KQL:":"===n?s=`${n} ${c}`:o=Gi,c.includes("'")&&(s=(s||c).replaceAll("'","\\'"))}return{detail:d,kind:u,label:c,insertText:null!==(l=s)&&void 0!==l?l:c,insertTextRules:r,command:o,additionalTextEdits:[],range:i,sortText:p,filterText:m}}(e,i.type,D,a.triggerCharacter,i.range)))}}),[r,D,c,z]),H=Object(l.useCallback)((async(e,t,a,n)=>{const i=e.getValue(),l=e.getFullModelRange(),s=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:l.endLineNumber,endColumn:l.endColumn});return function(e,t,a){const n=e.substr(0,t)+Ni+e.substr(t);try{const e=zi(Object(Wn.parse)(n),t);let i=[],l=0;if(null!=e&&e.parent){const t=e.parent.name;l=e.parent.args.findIndex((t=>t===e.ast)),i=qi(t,a)}else"object"==typeof(null==e?void 0:e.ast)&&"function"===e.ast.type&&(i=qi(e.ast.name,a));if(i.length)return{value:{signatures:i.map((({documentation:e,...t})=>({...t,documentation:{value:e.value.split("\n\n")[0]}}))),activeParameter:l,activeSignature:0},dispose:()=>{}}}catch(e){}return{value:{signatures:[],activeParameter:0,activeSignature:0},dispose:()=>{}}}(e.getValue(),i.length-s,D)}),[D]),G=Object(l.useCallback)((async(e,t,a)=>{const n=e.getValue(),i=e.getFullModelRange(),l=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:i.endLineNumber,endColumn:i.endColumn});return function(e,t,a){try{const n=zi(Object(Wn.parse)(e),t);if(!n||"number"==typeof n.ast||!("name"in n.ast))return{contents:[]};const i=qi(n.ast.name,a);if(i.length){const{label:e}=i[0];return{contents:[{value:e}]}}}catch(e){}return{contents:[]}}(e.getValue(),n.length-l,D)}),[D]),q=Object(l.useCallback)(((e,t)=>{if(!(e.isFlush||e.isRedoing||e.isUndoing)&&1===e.changes.length){const a=e.changes[0].text;if("="!==a&&"'"!==a)return;const n=e.changes[0].range;if(n){const e=t.getValue(),i=Vi(e,new Ii.monaco.Position(n.startLineNumber,n.startColumn));let l=$i(e,i+1);if(!l&&"'"===a){const t=e;l=$i(t.substring(0,i)+"\\'"+t.substring(i+1),i+2)}const s=/'LENS_MATH_MARKER/;if(!l||"number"==typeof l.ast||"namedArgument"!==l.ast.type||"kql"!==l.ast.name&&"lucene"!==l.ast.name&&"shift"!==l.ast.name||"LENS_MATH_MARKER"!==l.ast.value&&!s.test(l.ast.value))return;let r=null;const o=2;"="===a&&(r={range:{...n,startColumn:n.startColumn+1,endColumn:n.startColumn+1},text:"''"}),"'"===a&&"shift"!==l.ast.name&&(r={range:{...n,startColumn:n.startColumn,endColumn:n.startColumn+1},text:"\\'"}),r&&setTimeout((()=>{t.executeEdits("LENS",[r],[new Ii.monaco.Selection(n.startLineNumber,n.startColumn+o,n.startLineNumber,n.startColumn+o)]),t.setPosition({column:n.startColumn+o,lineNumber:n.startLineNumber}),t.trigger("lens","editor.action.triggerSuggest",{})}),0)}}}),[]),$={languageId:Wi,value:null!=O?O:"",onChange:k,options:{automaticLayout:!1,fontSize:14,folding:!1,lineNumbers:"off",scrollBeyondLastLine:!1,minimap:{enabled:!1},wordWrap:C?"on":"off",wordBasedSuggestions:!1,autoIndent:"brackets",wrappingIndent:"none",dimension:{width:320,height:200},fixedOverflowWidgets:!0,matchBrackets:"always",lineDecorationsWidth:16}};return Object(l.useEffect)((()=>{const{dispose:e}=Ii.monaco.languages.registerCompletionItemProvider(Wi,{triggerCharacters:[".","(","="," ",":","'"],provideCompletionItems:R}),{dispose:t}=Ii.monaco.languages.registerSignatureHelpProvider(Wi,{signatureHelpTriggerCharacters:["(","="],provideSignatureHelp:H}),{dispose:a}=Ii.monaco.languages.registerHoverProvider(Wi,{provideHover:G});return()=>{e(),t(),a()}}),[R,H,G]),Object(x.jsx)("div",{className:h()({lnsIndexPatternDimensionEditor:!0,"lnsIndexPatternDimensionEditor-isFullscreen":m})},Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--shaded"},Object(x.jsx)("div",{className:"lnsFormula"},Object(x.jsx)("div",{className:"lnsFormula__editor"},Object(x.jsx)("div",{className:"lnsFormula__editorHeader"},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup"},Object(x.jsx)(g.EuiToolTip,{content:C?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),position:"top"},Object(x.jsx)(g.EuiButtonIcon,{iconType:C?"wordWrap":"wordWrapDisabled",display:C?void 0:"fill",color:"text","aria-label":C?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),isSelected:!C,onClick:()=>{var e;null===(e=L.current)||void 0===e||e.updateOptions({wordWrap:C?"off":"on"}),E(!C)}}))),Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup",grow:!1},Object(x.jsx)(g.EuiButtonEmpty,{onClick:()=>{p(),M(!m),Object(Ya.e)("toggle_formula_fullscreen")},iconType:m?"fullScreenExit":"fullScreen",size:"xs",color:"text",flush:"right","data-test-subj":"lnsFormula-fullscreen"},m?u.i18n.translate("xpack.lens.formula.fullScreenExitLabel",{defaultMessage:"Collapse"}):u.i18n.translate("xpack.lens.formula.fullScreenEnterLabel",{defaultMessage:"Expand"}))))),Object(x.jsx)("div",{className:"lnsFormula__editorContent"},Object(x.jsx)(d.CodeEditor,i()({},$,{options:{...$.options,overflowWidgetsDomNode:P.current},editorDidMount:e=>{L.current=e;const t=e.getModel();t&&(S.current=t),A.current.push(e.onDidFocusEditorWidget((()=>{setTimeout((()=>{f(!1)}))}))),A.current.push(e.onDidBlurEditorWidget((()=>{setTimeout((()=>{f(!0)}))}))),A.current.push(e.onDidChangeModelContent((t=>{q(t,e)})))}})),O?null:Object(x.jsx)("div",{className:"lnsFormula__editorPlaceholder"},Object(x.jsx)(g.EuiText,{color:"subdued",size:"s"},u.i18n.translate("xpack.lens.formulaPlaceholderText",{defaultMessage:"Type a formula by combining functions with math, like:"})),Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)("pre",null,"count() + 1"))),Object(x.jsx)("div",{className:"lnsFormula__editorFooter"},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__editorFooterGroup"},m?Object(x.jsx)(g.EuiToolTip,{content:F?u.i18n.translate("xpack.lens.formula.editorHelpInlineHideToolTip",{defaultMessage:"Hide function reference"}):u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"}),delay:"long",position:"top"},Object(x.jsx)(g.EuiLink,{"aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineHideLabel",{defaultMessage:"Hide function reference"}),className:"lnsFormula__editorHelp lnsFormula__editorHelp--inline",color:"text",onClick:()=>M(!F)},Object(x.jsx)(g.EuiIcon,{type:"documentation"}),Object(x.jsx)(g.EuiIcon,{type:F?"arrowDown":"arrowUp"}))):Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.formula.editorHelpOverlayToolTip",{defaultMessage:"Function reference"}),condition:!F,position:"top",delay:"regular"},Object(x.jsx)(g.EuiPopover,{panelClassName:"lnsFormula__docs lnsFormula__docs--overlay",panelPaddingSize:"none",anchorPosition:"leftCenter",isOpen:F,closePopover:()=>M(!1),ownFocus:!1,button:Object(x.jsx)(g.EuiButtonIcon,{className:"lnsFormula__editorHelp lnsFormula__editorHelp--overlay",onClick:()=>{F||Object(Ya.e)("open_formula_popover"),M(!F)},iconType:"documentation",color:"text","aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"})})},Object(x.jsx)(Fi,{isFullscreen:m,indexPattern:r,operationDefinitionMap:D})))),B||V?Object(x.jsx)(g.EuiFlexItem,{className:"lnsFormula__editorFooterGroup",grow:!1},Object(x.jsx)(g.EuiPopover,{ownFocus:!1,isOpen:w,closePopover:()=>_(!1),button:Object(x.jsx)(g.EuiButtonEmpty,{color:B?"danger":"warning",className:"lnsFormula__editorError",iconType:"alert",size:"xs",flush:"right",onClick:()=>{_(!w)}},B?u.i18n.translate("xpack.lens.formulaErrorCount",{defaultMessage:"{count} {count, plural, one {error} other {errors}}",values:{count:B}}):null,V?u.i18n.translate("xpack.lens.formulaWarningCount",{defaultMessage:"{count} {count, plural, one {warning} other {warnings}}",values:{count:V}}):null)},I.map((({message:e,severity:t},a)=>Object(x.jsx)("div",{key:a,className:"lnsFormula__warningText"},Object(x.jsx)(g.EuiText,{size:"s",color:t===Ii.monaco.MarkerSeverity.Warning?"warning":"danger"},e)))))):null))),m&&F?Object(x.jsx)("div",{className:"lnsFormula__docs lnsFormula__docs--inline"},Object(x.jsx)(Fi,{isFullscreen:m,indexPattern:r,operationDefinitionMap:D})):null)))}function tl(e){return"histogram"===e||"document"===e?"number":e}function al(e){return"sourceField"in e}function nl(e){return"object"==typeof e&&null!==e&&["id","field","indexPatternId"].every((t=>t in e))}function il(e,t){var a,n;if(!t)return;const{operationType:i}=e,l=i?Co[i]:void 0,s=al(e)&&l?null!==(a=null==l||null===(n=l.getCurrentFields)||void 0===n?void 0:n.call(l,e))&&void 0!==a?a:[e.sourceField]:[],r=s.map((e=>t.getFieldByName(e))),o=r.filter(Boolean),c=Boolean(r.length>o.length||!("field"===(null==l?void 0:l.input)&&o.every((e=>null!=l.getPossibleOperationForField(e))))),d=Boolean(o.length&&!(null!=l&&l.isTransferable(e,t,Co)));if(c){const a=r.map(((e,t)=>e?null:s[t])).filter(Boolean);if(a.length)return[u.i18n.translate("xpack.lens.indexPattern.fieldsNotFound",{defaultMessage:"{count, plural, one {Field} other {Fields}} {missingFields} {count, plural, one {was} other {were}} not found",values:{count:a.length,missingFields:a.join(", ")}})];if(d){var p,m;const a=null!==(p=null==l||null===(m=l.getNonTransferableFields)||void 0===m?void 0:m.call(l,e,t))&&void 0!==p?p:s;return[u.i18n.translate("xpack.lens.indexPattern.fieldsWrongType",{defaultMessage:"{count, plural, one {Field} other {Fields}} {invalidFields} {count, plural, one {is} other {are}} of the wrong type",values:{count:a.length,invalidFields:a.join(", ")}})]}}}function ll(e){const t=e.filter(Boolean).flat();return t.length?t:void 0}function sl(e,t){const a=t.getFieldByName(e);return a?a.displayName:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})}function rl(e,t,a,n){const i=Number(e);return""!==e&&null!=e&&!Number.isNaN(i)&&Number.isFinite(i)&&(!t||Number.isInteger(i))&&(void 0===a||i<=a)&&(void 0===n||i>=n)}function ol(e,t){return t.operationType===e}function ul(e){return Boolean("params"in e&&e.params&&"format"in e.params)}function cl(e){return"number"===(null==e?void 0:e.dataType)&&ul(e)&&e.params?{format:e.params.format}:void 0}function dl(e,t){let a=null==e?void 0:e.filter;var n;if(t)if("kql"in t)a={query:null!==(n=t.kql)&&void 0!==n?n:"",language:"kuery"};else if("lucene"in t){var i;a={query:null!==(i=t.lucene)&&void 0!==i?i:"",language:"lucene"}}return a}function pl({sourceField:e,operationType:t}){return e&&"count"!==t?Yn.test(e)?`'${e.replaceAll("'","\\'")}'`:e:""}const ml=u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),gl={type:"formula",displayName:ml,getDefaultLabel:(e,t)=>{var a;return null!==(a=e.params.formula)&&void 0!==a?a:ml},input:"managedReference",hidden:!0,filterable:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaFilterableHelpText",{defaultMessage:"The provided filter will be applied to the entire formula."})},getDisabledStatus(e){},getErrorMessage(e,t,a,n){const i=e.columns[t];if(!i.params.formula||!n)return;const l=ni(n),{root:s,error:r}=ri(i.params.formula,l);if(r||null==s)return null!=r&&r.message?[r.message]:[];const o=oi(s,e,a,l,i);if(o.length)return o.map((({message:e})=>e));const c=bs(t,e.columns).flatMap((([t,n])=>{const i=l[n.operationType];if(null!=i&&i.getErrorMessage){const n=i.getErrorMessage(e,t,a,l);return n?{message:n.join(", ")}:[]}return[]})).filter((e=>e)),d=e.columnOrder.some((t=>e.columns[t].isBucketed)),p=e.columnOrder.some((t=>{const a=e.columns[t];return!a.isBucketed&&!a.isStaticValue&&"math"!==a.operationType&&"formula"!==a.operationType}));return d&&!p&&c.push({message:u.i18n.translate("xpack.lens.indexPattern.noRealMetricError",{defaultMessage:"A layer with only static values will not show results, use at least one dynamic metric"})}),c.length?c.map((({message:e})=>e)):void 0},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,l=n.label!==ml,s=null!=i&&i.isFormulaBroken?ml:l?n.label:null!==(a=null==i?void 0:i.formula)&&void 0!==a?a:ml;return[{type:"function",function:n.references.length?"mathColumn":"mapColumn",arguments:{id:[t],name:[s||ml],expression:[n.references.length?`"${n.references[0]}"`:""]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){let l="";e&&(l=function(e,t,a,n){if(ol("static_value",e)&&e.params&&"value"in e.params)return String(e.params.value);if("references"in e){const n=t.columns[e.references[0]];if(n&&"sourceField"in n&&"number"===n.dataType){const t=pl(n);a+=`${e.operationType}(${n.operationType}(${t})`}}else e&&"sourceField"in e&&"number"===e.dataType&&(a+=`${e.operationType}(${pl(e)}`);const i=function(e,t){if(!t)return[];const a=t[e.operationType];return"operationParams"in a&&(n=e,Boolean("params"in n&&n.params))?(a.operationParams||[]).flatMap((({name:t,required:a})=>{const n=e.params[t];return Object(Me.isObject)(n)?Object.keys(n).map((e=>({name:`${t}-${e}`,value:n[e],required:a}))):{name:t,value:n,required:a}})):[];var n}(e,n);return i.length&&(a+=", "+i.map((({name:e,value:t})=>`${e}=${t}`)).join(", ")),e.filter&&("count"!==e.operationType&&(a+=", "),a+=("kuery"===e.filter.language?"kql=":"lucene=")+`'${e.filter.query.replace(/'/g,"\\'")}'`),e.timeShift&&(("count"!==e.operationType||e.filter)&&(a+=", "),a+=`shift='${e.timeShift}'`),a&&(a+=")"),a}(e,t,l,i));let s={};var r;return e&&ul(e)&&(s={format:null===(r=e.params)||void 0===r?void 0:r.format}),{label:l||ml,dataType:"number",operationType:"formula",isBucketed:!1,scale:"ratio",params:l?{formula:l,isFormulaBroken:!1,...s}:{...s},references:[],filter:"formula"===(null==e?void 0:e.operationType)?dl(e,{}):void 0,timeScale:null==e?void 0:e.timeScale}},isTransferable:()=>!0,createCopy:(e,t,a,n,i)=>Zi(a,e.columns[t],e,{indexPattern:n,operations:i}).layer,timeScalingMode:"optional",paramEditor:({activeData:e,...t})=>{const a=Si(t.layer,t.indexPattern,e,t.layerId);return Object(x.jsx)(Ji,i()({},t,{dateHistogramInterval:a,hasData:Qi(e,t.layerId,t.columnId)}))}};a(284),a(289);const fl=({value:e,onChange:t,placeholder:a,inputRef:n,onSubmit:i,dataTestSubj:s,compressed:r})=>{const{inputValue:o,handleInputChange:c}=Object(y.t)({value:e,onChange:t}),d=Object(l.useRef)(!1);return Object(x.jsx)(g.EuiFieldText,{"data-test-subj":s||"lens-labelInput",value:o,onChange:e=>c(e.target.value),fullWidth:!0,placeholder:a||"",inputRef:e=>{n&&e&&(n.current=e)},onKeyDown:()=>{d.current=!0},onKeyUp:({key:e})=>{d.current&&g.keys.ENTER===e&&i&&i(),d.current=!1},prepend:u.i18n.translate("xpack.lens.labelInput.label",{defaultMessage:"Label"}),compressed:r})},bl=({label:e,onClick:t,"data-test-subj":a,isDisabled:n})=>Object(x.jsx)(g.EuiButtonEmpty,{"data-test-subj":null!=a?a:"lns-newBucket-add",size:"xs",iconType:"plusInCircle",onClick:t,isDisabled:n},e),hl=({isInvalid:e,invalidMessage:t,onRemoveClick:a,removeTitle:n,children:i,dataTestSubj:l,isNotRemovable:s})=>Object(x.jsx)(g.EuiPanel,{paddingSize:"none","data-test-subj":l,hasShadow:!1,hasBorder:!0},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1}),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiIcon,{size:"s",color:e?"danger":"subdued",type:e?"alert":"grab",title:e?t:u.i18n.translate("xpack.lens.customBucketContainer.dragToReorder",{defaultMessage:"Drag to reorder"})})),Object(x.jsx)(g.EuiFlexItem,{grow:!0},i),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonIcon,{iconSize:"s",iconType:"cross",color:"danger","data-test-subj":"lns-customBucketContainer-remove",onClick:a,"aria-label":n,title:n,disabled:s})))),xl=({id:e,idx:t,children:a,...n})=>Object(x.jsx)(g.EuiDraggable,{style:{marginBottom:4},spacing:"none",index:t,draggableId:e,disableInteractiveElementBlocking:!0},(e=>Object(x.jsx)(hl,n,a))),vl=({items:e,onDragStart:t,onDragEnd:a,droppableId:n,children:i})=>Object(x.jsx)(g.EuiDragDropContext,{onDragEnd:({source:t,destination:n})=>{if(t&&n){const i=Object(g.euiDragDropReorder)(e,t.index,n.index);a(i)}},onDragStart:t},Object(x.jsx)(g.EuiDroppable,{droppableId:n,spacing:"none"},i)),yl=({value:e,onChange:t,indexPatternTitle:a,isInvalid:n,onSubmit:i,disableAutoFocus:l,"data-test-subj":s})=>{const{inputValue:r,handleInputChange:o}=Object(y.t)({value:e,onChange:t});return Object(x.jsx)(_i.QueryStringInput,{dataTestSubj:null!=s?s:"indexPattern-filters-queryStringInput",size:"s",disableAutoFocus:l,isInvalid:n,bubbleSubmitEvent:!1,indexPatterns:[a],query:r,onChange:e=>{Object(Me.isEqual)(e,r)||o(e)},onSubmit:()=>{r.query&&i()},placeholder:"kuery"===r.language?u.i18n.translate("xpack.lens.indexPattern.filters.queryPlaceholderKql",{defaultMessage:"{example}",values:{example:'method : "GET" or status : "404"'}}):u.i18n.translate("xpack.lens.indexPattern.filters.queryPlaceholderLucene",{defaultMessage:"{example}",values:{example:"method:GET OR status:404"}}),languageSwitcherPopoverAnchorPosition:"rightDown"})},jl=({filter:e,setFilter:t,indexPattern:a,button:n,isOpen:i,triggerClose:l})=>{const r=s.a.useRef(),o=s.a.useRef(null);let u;return Object(x.jsx)(g.EuiPopover,{ref:o,panelRef:e=>{const t=e=>{var a;"Escape"===e.key&&(e.stopPropagation(),u.removeEventListener("keydown",t),null===(a=o.current)||void 0===a||a.closePopover())};e&&(u=e,u.addEventListener("keydown",t))},"data-test-subj":"indexPattern-filters-existingFilterContainer",anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",isOpen:i,ownFocus:!0,closePopover:()=>l(),button:n},Object(x.jsx)(yl,{isInvalid:!wl(e.input,a),value:e.input,indexPatternTitle:a.title,disableAutoFocus:!0,onChange:a=>t({...e,input:a}),onSubmit:()=>{r.current&&r.current.focus()}}),Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(fl,{value:e.label||"",onChange:a=>t({...e,label:a}),placeholder:(c=e.input.query,""===c?Tl:"object"===c?JSON.stringify(c):String(c)),inputRef:r,onSubmit:()=>l(),dataTestSubj:"indexPattern-filters-label"}));var c},Ol=Object(g.htmlIdGenerator)(),kl="filters",Il=u.i18n.translate("xpack.lens.indexPattern.filters",{defaultMessage:"Filters"}),Tl=u.i18n.translate("xpack.lens.indexPattern.filters.label.placeholder",{defaultMessage:"All records"}),Fl={input:{query:"",language:"kuery"},label:""},Ml=(e,t)=>{let a,n=!0;try{"kuery"===e.language?Object(Un.g)(Object(Un.d)(e.query),t):Object(Un.f)(e.query)}catch(e){n=!1,a=e.message}return{isValid:n,error:a}},wl=(e,t)=>Ml(e,t).isValid,_l={type:kl,displayName:Il,priority:3,input:"none",isTransferable:()=>!0,getDefaultLabel:()=>Il,buildColumn({previousColumn:e}){let t={filters:[Fl]};var a,n,i;return"terms"===(null==e?void 0:e.operationType)&&"sourceField"in e&&(t={filters:[{label:"",input:{query:`${e.sourceField} : *`,language:"kuery"}},...null!==(a=null===(n=e.params)||void 0===n||null===(i=n.secondaryFields)||void 0===i?void 0:i.map((e=>({label:"",input:{query:`${e} : *`,language:"kuery"}}))))&&void 0!==a?a:[]]}),{label:Il,dataType:"string",operationType:kl,scale:"ordinal",isBucketed:!0,params:t}},getPossibleOperation:()=>({dataType:"string",isBucketed:!0,scale:"ordinal"}),toEsAggsFn:(e,t,a)=>{var n;const i=null===(n=e.params.filters)||void 0===n?void 0:n.filter((e=>wl(e.input,a)));return Object(ue.buildExpressionFunction)("aggFilters",{id:t,enabled:!0,schema:"segment",filters:((null==i?void 0:i.length)>0?i:[Fl]).map(ii.queryFilterToAst)}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,indexPattern:n,updateLayer:i,data:l})=>{const s=a.params.filters;return Object(x.jsx)(g.EuiFormRow,null,Object(x.jsx)(Cl,{filters:s,setFilters:a=>i(ts({layer:e,columnId:t,paramName:kl,value:a})),indexPattern:n,defaultQuery:Fl}))}},Cl=({filters:e,setFilters:t,indexPattern:a,defaultQuery:n})=>{const[i,r]=Object(l.useState)(""),[o,c]=Object(l.useState)((()=>e.map((e=>({...e,id:Ol()}))))),d=e=>{t(e.map((e=>Object(Me.omit)(e,"id")))),c(e)},p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(vl,{onDragEnd:d,onDragStart:()=>{},droppableId:"FILTERS_DROPPABLE_AREA",items:o},null==o?void 0:o.map(((e,t)=>{const n=!wl(e.input,a);return Object(x.jsx)(xl,{id:e.id,key:e.id,idx:t,isInvalid:n,invalidMessage:u.i18n.translate("xpack.lens.indexPattern.filters.isInvalid",{defaultMessage:"This query is invalid"}),onRemoveClick:()=>{return t=e.id,d(o.filter((e=>e.id!==t)));var t},removeTitle:u.i18n.translate("xpack.lens.indexPattern.filters.removeFilter",{defaultMessage:"Remove a filter"}),isNotRemovable:1===o.length},Object(x.jsx)(jl,{"data-test-subj":"indexPattern-filters-existingFilterContainer",isOpen:e.id===i,triggerClose:()=>p(""),indexPattern:a,filter:e,setFilter:e=>{var t,a,n;t=e.id,a=e.input,n=e.label,d(o.map((e=>e.id===t?{...e,input:a,label:n}:e)))},button:Object(x.jsx)(g.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>p(e.id),color:n?"danger":"text",title:u.i18n.translate("xpack.lens.indexPattern.filters.clickToEdit",{defaultMessage:"Click to edit"})},e.label||e.input.query||Tl)}))}))),Object(x.jsx)(bl,{onClick:()=>{(()=>{const e=Ol();d([...o,{...n,id:e}]),r(e)})()},label:u.i18n.translate("xpack.lens.indexPattern.filters.addaFilter",{defaultMessage:"Add a filter"})}))},El=new Set(["string","boolean","number","ip"]),Sl="  ";function Pl(e,t,a){var n;const i=e.columns[t],l=[i.sourceField,...null!==(n=i.params.secondaryFields)&&void 0!==n?n:[]],s=l.filter((e=>{var t;return null===(t=a.getFieldByName(e))||void 0===t?void 0:t.scripted}));if(!(l.length<2)&&s.length)return u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleTermsAndScriptedFields",{defaultMessage:"Scripted fields are not supported when using multiple fields, found {fields}",values:{fields:s.join(", ")}})}function Al(e,t){const a=t.split(Sl);return e.map(((e,t)=>`${e}: ${"*"!==a[t]?`"${a[t]}"`:a[t]}`)).join(" AND ")}function Ll(e,t){return 1===e.length?t:t.split(Sl).map(((t,a)=>null==t?u.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}):`${e[a]}: ${t}`)).join(Sl)}function Dl(e){return"object"==typeof e&&null!=e&&"keys"in e&&Array.isArray(e.keys)}function Nl(e,t,a){if(Object(Me.uniq)(Object.values(e.columns).filter((e=>Co[e.operationType].shiftable)).map((e=>e.timeShift||""))).length>1)return{message:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShifts",{defaultMessage:"In a single layer, you are unable to combine metrics with different time shifts and dynamic top values. Use the same time shift value for all metrics, or use filters instead of top values."}),fixAction:{label:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShiftsFixActionLabel",{defaultMessage:"Use filters"}),newState:async(n,i,l)=>{var s,r,o,c,d;const p=e.columns[t],m=[p.sourceField,...null!==(s=null===(r=p.params)||void 0===r?void 0:r.secondaryFields)&&void 0!==s?s:[]],g=(null===(o=i.activeData)||void 0===o||null===(c=o[l].columns.find((({id:e})=>e===t)))||void 0===c?void 0:c.meta.field)===m[0];let f=Object(Me.uniq)((null===(d=i.activeData)||void 0===d?void 0:d[l].rows.map((e=>e[t])).filter((e=>m.length>1?Dl(e)&&"__other__"!==e.keys[0]:"string"==typeof e&&"__other__"!==e)).map((e=>Dl(e)?e.keys.join(Sl):e)))||[]);var b;g&&0!==f.length||1!==m.length||(f=(null===(b=(await n.http.post(`/api/lens/index_stats/${a.id}/field`,{body:JSON.stringify({fieldName:m[0],dslQuery:Object(Un.c)(a,i.query,i.filters,Object(_i.getEsQueryConfig)(n.uiSettings)),fromDate:i.dateRange.fromDate,toDate:i.dateRange.toDate,size:p.params.size})})).topValues)||void 0===b?void 0:b.buckets.map((({key:e})=>String(e))))||[]);return m.length>1&&0===f.length&&(f=[Array(m.length).fill("*").join(Sl)]),{...e,columns:{...e.columns,[t]:{label:u.i18n.translate("xpack.lens.indexPattern.pinnedTopValuesLabel",{defaultMessage:"Filters of {field}",values:{field:m.length>1?m.join(Sl):m[0]}}),customLabel:!0,isBucketed:e.columns[t].isBucketed,dataType:"string",operationType:"filters",params:{filters:f.length>0?f.map((e=>({input:{query:1===m.length?`${m[0]}: "${e}"`:Al(m,e),language:"kuery"},label:Ll(m,e)}))):[{input:{query:"*",language:"kuery"},label:Tl}]}}}}}}}}function zl(e,t){const a=e.columns[t];return a&&!a.isBucketed&&function(e){return"last_value"!==e.operationType||["number","date"].includes(e.dataType)&&!e.params.showArrayValues}(a)&&!("references"in a)&&!os(e,t)}function Bl(e,t){if("string"==typeof e){const a=null==t?void 0:t.getFieldByName(e);return a&&a.scripted}return e.scripted}function Vl(e,t,a){const n=[];var i,l;t&&"sourceField"in t&&(t.sourceField&&n.push(t.sourceField),ol("terms",t)&&n.push(...null!==(i=null===(l=t.params)||void 0===l?void 0:l.secondaryFields)&&void 0!==i?i:[])),a&&n.push("string"==typeof a?a:a.name||a.displayName);const s=n.map((t=>e.getFieldByName(t))),r=[],o=[],u=Boolean(t&&1===s.length);return n.forEach(((e,t)=>{const a=s[t];(!(a&&El.has(a.type)&&a.aggregatable)||a.aggregationRestrictions&&!a.aggregationRestrictions.terms||!u&&Bl(a)?o:r).push(e)})),{allFields:s,validFields:r,invalidFields:o}}function Rl({layer:e,targetId:t,sourceColumn:a,shouldDeleteSource:n,indexPattern:i,sourceColumnId:l}){let s=Hl(e,a,l,t,i);return n&&(s=ns({layer:s,columnId:l,indexPattern:i})),s}function Hl(e,t,a,n,i){let l={...e.columns};if("references"in t){if(l[n])return e;const s=Co[t.operationType];if("createCopy"in s)return s.createCopy(e,a,n,i,Co);null==t||t.references.forEach(((s,r)=>{const o=Object(Xt.a)(),u={...l[s]},c="references"in u?Hl(e,u,a,o,i).columns:{[o]:u},d=l[n];let p=[o];d&&"references"in d&&(p=d.references,p[r]=o),l={...l,...c,[n]:{...t,references:p}}}))}else l={...l,[n]:t};return{...e,columns:l,columnOrder:is({...e,columns:l})}}function Gl(e){return e.layer.columns[e.columnId]?Wl(e):$l(e)}function ql(e,t,a){const n={...e};return t.filterable&&(n.filter=a.filter),t.shiftable&&(n.timeShift=a.timeShift),"disabled"!==t.timeScalingMode&&(n.timeScale=a.timeScale),n}function $l({op:e,layer:t,columnId:a,field:n,indexPattern:i,visualizationGroups:l,targetGroup:s,shouldResetLabel:r,incompleteParams:o,incompleteFieldName:u,incompleteFieldOperation:c,columnParams:d,initialParams:p}){var m,g;const f=Co[e];if(!f)throw new Error("No suitable operation found for given parameters");if(t.columns[a])throw new Error("Can't insert a column with an ID that is already in use");const b={indexPattern:i,previousColumn:{...o,...p,...t.columns[a]}};if("none"===f.input||"managedReference"===f.input){if(n)throw new Error(`Can't create operation ${e} with the provided field ${n.name}`);f.input;const r=f.getPossibleOperation();return ms((Boolean(null==r?void 0:r.isBucketed)?Xl:Ql)(t,d?f.buildColumn({...b,layer:t},d):f.buildColumn({...b,layer:t}),a,l,s),i)}if("fullReference"===f.input){if(n)throw new Error("Reference-based operations can't take a field as input when creating");let r={...t};const o=f.requiredReferences.map((t=>{const a=Object.values(Co).filter((({type:e})=>ps({validation:t,operationType:e,indexPattern:i})));if(!a.length)throw new Error(`Can't create reference, ${e} has a validation function which doesn't allow any operations`);const n=Object(Xt.a)();if(c&&u){var o;const e=i.fields.filter((e=>e.name===u));r=$l({layer:r,columnId:n,op:c,indexPattern:i,field:null!==(o=e[0])&&void 0!==o?o:Ki,visualizationGroups:l,columnParams:d,targetGroup:s})}if(1===a.length){const e=a[0];let t="field"===e.input?i.fields.filter(e.getPossibleOperationForField):[];u&&(t=t.filter((e=>e.name===u))),r="none"===e.input?$l({layer:r,columnId:n,op:e.type,indexPattern:i,visualizationGroups:l,targetGroup:s}):1===t.length?$l({layer:r,columnId:n,op:e.type,indexPattern:i,field:t[0],visualizationGroups:l,targetGroup:s}):{...r,incompleteColumns:{...r.incompleteColumns,[n]:{operationType:e.type}}}}return n})),p=f.getPossibleOperation(i);if(!p)throw new Error(`Can't create operation ${e} because it's incompatible with the data view`);const m=Boolean(p.isBucketed)?Xl:Ql,g=d?f.buildColumn({...b,layer:r,referenceIds:o},d):f.buildColumn({...b,layer:r,referenceIds:o});return ms(m(r,g,a,l,s),i)}const h=null===(m=(null!==(g=t.incompleteColumns)&&void 0!==g?g:{})[a])||void 0===m?void 0:m.sourceField,x=h?i.getFieldByName(h):void 0;if(!n&&x){const e=f.getPossibleOperationForField(x);if(!e)throw new Error(`Tried to create an invalid operation ${f.type} using previously selected field ${x.name}`);return ms(Boolean(e.isBucketed)?Xl(t,f.buildColumn({...b,layer:t,field:x}),a,l,s):Ql(t,f.buildColumn({...b,layer:t,field:x}),a),i)}var v;if(!n)return{...t,incompleteColumns:{...null!==(v=t.incompleteColumns)&&void 0!==v?v:{},[a]:{operationType:e}}};const y=f.getPossibleOperationForField(n);var j;if(!y)return{...t,incompleteColumns:{...null!==(j=t.incompleteColumns)&&void 0!==j?j:{},[a]:{operationType:e,sourceField:n.name}}};const O=f.buildColumn({...b,layer:t,field:n},d);return ms((Boolean(y.isBucketed)?Xl:Ql)(t,O,a,l,s),i)}function Wl({layer:e,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:l,initialParams:s,shouldResetLabel:r,shouldCombineField:o}){const u=e.columns[t];if(!u)throw new Error("Can't replace column because there is no prior column");const c=n!==u.operationType,d=Co[n],p=Co[u.operationType];if(!d)throw new Error("No suitable operation found for given parameters");const m={columns:e.columns,indexPattern:a,previousColumn:u};if(c){let s={...e};if(s=gs(s,t),"managedReference"===p.input&&d.input!==p.input){s=Ul(p,u,s,a);const o=$l({layer:s,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:l,incompleteParams:u});return!r&&u.customLabel&&u.label!==p.getDefaultLabel(u,a,s.columns)&&(o.columns[t].customLabel=!0,o.columns[t].label=u.label),o.incompleteColumns&&o.incompleteColumns[t]?{...e,incompleteColumns:o.incompleteColumns}:o}if("fullReference"===d.input)return function({layer:e,columnId:t,previousColumn:a,op:n,indexPattern:i,visualizationGroups:l}){const s=Co[n];if("fullReference"!==s.input)throw new Error("Requirements for transitioning are not met");let r=!1,o=!1;const u="references"in a?[...a.references]:[],c=s.requiredReferences.map((t=>{const n=Object(Xt.a)();if(u.length){const a=e.columns[u[0]];if(fs({validation:t,column:a}))return u.shift()}if(!r&&fs({validation:t,column:a})){r=!0;const t={...e,columns:{...e.columns,[n]:{...a,filter:s.filterable?void 0:a.filter,timeShift:s.shiftable?void 0:a.timeShift}}};return e={...e,columnOrder:is(t),columns:as(t,n)},n}if(t.input.includes("none")){const a=_o.filter((e=>{if("none"===e.input)return ps({validation:t,operationType:e.type,indexPattern:i})}));if(1===a.length)return e=$l({layer:e,columnId:n,op:a[0].type,indexPattern:i,visualizationGroups:l}),n}if(!o&&"sourceField"in a&&t.input.includes("field")){const s=_o.filter((e=>"field"===e.input&&ps({validation:t,operationType:e.type,indexPattern:i}))).sort(Po),r=s.filter((e=>{const n=i.getFieldByName(a.sourceField);if(n)return ps({validation:t,operationType:e.type,field:n,indexPattern:i})}));if(r.length>0)return o=!0,e=$l({layer:e,columnId:n,op:r[0].type,indexPattern:i,field:i.getFieldByName(a.sourceField),visualizationGroups:l}),n;if(1===s.length)return o=!0,e={...e,incompleteColumns:{...e.incompleteColumns,[n]:{operationType:s[0].type}}},n}if(u.length){const a=e.columns[u[0]];if(a&&"sourceField"in a&&t.input.includes("field")){const s=i.getFieldByName(a.sourceField);if(s){const a=_o.filter((e=>"field"===e.input&&ps({validation:t,operationType:e.type,field:s,indexPattern:i}))).sort(Po);if(a.length>0)return e=$l({layer:e,columnId:n,op:a[0].type,indexPattern:i,field:s,visualizationGroups:l}),n}}}return n}));return u.length&&u.forEach((t=>{e=ns({layer:e,columnId:t,indexPattern:i})})),e={...e,columns:{...e.columns,[t]:s.buildColumn({indexPattern:i,layer:e,referenceIds:c,previousColumn:a})}},ms({...e,columnOrder:is(e),columns:as(e,t)},i)}({layer:s,columnId:t,previousColumn:u,op:n,indexPattern:a,visualizationGroups:l});if("fullReference"===p.input&&1===u.references.length){const l=u.references[0],r=e.columns[l];if(r){const e=Co[r.operationType];if(e.type===n){s=ns({layer:s,columnId:l,indexPattern:a});const n=ql(Kl({...r},u),e,u);return s={...s,columns:{...s.columns,[t]:n}},ms({...s,columnOrder:is(s),columns:as(s,t)},a)}if(!i&&"sourceField"in r&&"field"===e.input&&"field"===d.input){const e=a.getFieldByName(r.sourceField);e&&d.getPossibleOperationForField(e)&&(i=e)}}}if("managedReference"===d.input){const e=d.buildColumn({...m,layer:s},"params"in u?u.params:void 0,Co);"fullReference"===p.input&&u.references.forEach((e=>{s=ns({layer:s,columnId:e,indexPattern:a})}));const n={...s,columns:{...s.columns,[t]:e}};let i;try{i=e.params.formula?Zi(t,e,n,{indexPattern:a}).layer:n}catch(e){i=n}const l=i.columns[t];return!r&&l.operationType!==u.operationType&&u.customLabel&&(l.customLabel=!0,l.label=u.label),ms({...s,columnOrder:is(i),columns:as(i,t)},a)}if("none"===d.input){let e=d.buildColumn({...m,layer:s});e=Kl(e,u),s=Ul(p,u,s,a);const n={...s,columns:{...s.columns,[t]:e}};return ms({...s,columnOrder:is(n),columns:as(n,t)},a)}if(!i){var g;let a={operationType:n};if("fullReference"===p.input){const t=u.references[0],n=e.columns[t];n&&(a=ql(a,Co[n.operationType],u))}return{...s,incompleteColumns:{...null!==(g=s.incompleteColumns)&&void 0!==g?g:{},[t]:a}}}var f;if(!d.getPossibleOperationForField(i))return{...s,incompleteColumns:{...null!==(f=s.incompleteColumns)&&void 0!==f?f:{},[t]:{operationType:n}}};s=Ul(p,u,s,a);let o=d.buildColumn({...m,layer:s,field:i});r||(o=Kl(o,u));const c={...s,columns:{...s.columns,[t]:o}};return ms({...s,columnOrder:is(c),columns:as(c,t)},a)}if("field"===d.input&&i&&"sourceField"in u&&(u.sourceField!==i.name||null!=d&&d.getParamsForMultipleFields)){let a=d.onFieldChange(u,i,o?null==s?void 0:s.params:void 0);r||(a=Kl(a,u));const n=gs({...e,columns:{...e.columns,[t]:a}},t);return{...n,columnOrder:is(n),columns:as(n,t)}}throw new Error("nothing changed")}function Ul(e,t,a,n){let i=a;if("managedReference"===e.input){const[e]=Object.entries(a.columns).find((([e,a])=>a===t))||[];null!=e&&(i=ns({layer:a,columnId:e,indexPattern:n}))}return"fullReference"===e.input&&t.references.forEach((e=>{i=ns({layer:a,columnId:e,indexPattern:n})})),i}function Yl({layer:e,columnId:t,op:a,field:n,indexPattern:i,filterOperations:l,visualizationGroups:s}){const r=e.columns[t];if(!r)return!0;if(r.operationType===a)return!0;try{var o,u,c;const r=Wl({layer:e,columnId:t,op:a,field:n,indexPattern:i,visualizationGroups:s}),d=Co[a],p=r.columns[t];return Boolean(p)&&!(null!==(o=r.incompleteColumns)&&void 0!==o&&o[t])&&l(p)&&!(null!==(u=d.getErrorMessage)&&void 0!==u&&null!==(c=u.call(d,r,t,i))&&void 0!==c&&c.length)}catch(e){return!1}}function Kl(e,t){const a={...e},n=e.operationType!==t.operationType,i=("sourceField"in e&&e.sourceField)!==("sourceField"in t&&t.sourceField);return!t.customLabel||n&&i||(a.customLabel=!0,a.label=t.label),a}function Xl(e,t,a,n,i){const[l,s]=Object(Me.partition)(e.columnOrder,(t=>e.columns[t].isBucketed)),r=e.columnOrder.findIndex((t=>"date_histogram"===e.columns[t].operationType));let o=[];o=r>-1&&"terms"===t.operationType?[...l.slice(0,r),a,...l.slice(r,l.length),...s]:[...l,a,...s],o=Zl(n,i,o,a);const u={...gs(e,a),columns:{...e.columns,[a]:t},columnOrder:o};return{...u,columns:as(u,a),columnOrder:is(u)}}function Zl(e,t,a,n){var i;if(t&&(null===(i=e.find((e=>e.groupId===t)))||void 0===i?void 0:i.hideGrouping)){const i=[...e];i.sort(((e,t)=>void 0===typeof e.nestingOrder?-1:void 0===typeof t.nestingOrder?1:e.nestingOrder-t.nestingOrder));const l={};return a.forEach((e=>{const s=i.findIndex((a=>e===n&&a.groupId===t||a.accessors.some((t=>t.columnId===e))));l[e]=-1!==s?s:a.length})),[...a].sort(((e,t)=>l[e]-l[t]))}return a}function Ql(e,t,a){const n={...gs(e,a),columns:{...e.columns,[a]:t}};return{...n,columnOrder:is(n),columns:as(n,a)}}function Jl(e){return _o.sort(Po).filter((t=>{if("field"!==t.input)return;const a=t.getPossibleOperationForField(e);return a&&!a.isBucketed&&"number"===a.dataType}))}function es({layer:e,columnId:t,customLabel:a}){const n=e.columns[t];return{...e,columns:{...e.columns,[t]:{...n,label:a||n.label,customLabel:Boolean(a)}}}}function ts({layer:e,columnId:t,paramName:a,value:n}){const i=e.columns[t];return{...e,columns:{...e.columns,[t]:{...i,params:{..."params"in i?i.params:{},[a]:n}}}}}function as(e,t){const a={...e.columns};return Object.keys(a).forEach((n=>{if(n!==t){const i=a[n],l=Co[i.operationType];a[n]=l.onOtherColumnChanged?l.onOtherColumnChanged({...e,columns:a},n,t):i}})),a}function ns({layer:e,columnId:t,indexPattern:a}){const n=e.columns[t];if(!n){const a={...e.incompleteColumns||{}};return delete a[t],{...e,columnOrder:e.columnOrder.filter((e=>e!==t)),incompleteColumns:a}}const i="references"in n?n.references:[],l={...e.columns};delete l[t];let s={...e,columns:as({...e,columns:l},t)};i.forEach((e=>{s=ns({layer:s,columnId:e,indexPattern:a})}));const r={...s.incompleteColumns||{}};return delete r[t],ms({...s,columnOrder:is(s),incompleteColumns:r},a)}function is(e){const t=Object.entries(e.columns);t.sort((([t],[a])=>{const n=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(a);return n>-1&&i>-1?n-i:n>-1?-1:1}));const[a,n]=Object(Me.partition)(t,(([,e])=>e.isBucketed));return a.map((([e])=>e)).concat(n.map((([e])=>e)))}function ls(e){const[t,a]=Object(Me.partition)(e.columnOrder,(t=>e.columns[t]&&!("references"in e.columns[t])));return[...Object(Me.partition)(t,(t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.isBucketed})),a]}function ss(e,t,a){return Co[e.operationType].isTransferable(e,t,Co)&&(!("references"in e)||e.references.every((e=>ss(a.columns[e],t,a))))}function rs(e,t){const a=Object(Me.pickBy)(e.columns,(a=>ss(a,t,e))),n=Object(Me.mapValues)(a,(e=>{const a=Co[e.operationType];return a.transfer?a.transfer(e,t):e})),i=e.columnOrder.filter((e=>n[e]));return{...e,indexPatternId:t.id,columns:n,columnOrder:i}}function os(e,t){return Object.values(e.columns).flatMap((e=>"references"in e?e.references:[])).includes(t)}const us=$n()((e=>{const t={};for(const[a,n]of Object.entries(e.columns))if("references"in n)for(const e of n.references)t[e]=a;return t}));function cs(e,t){const a=[];return function t(n){const i=e.columns[n];if(i&&"references"in i){const n=i.references.filter((t=>Boolean(e.columns[t])));a.push(...n),n.forEach(t)}}(t),a}function ds(e){return e.columnOrder.some((t=>{const a=e.columns[t];if(a)return ol("terms",a)&&a.params.size>5}))}function ps({operationType:e,validation:t,field:a,indexPattern:n}){const i=Co[e];let l=!0;if(a&&"field"===i.input){const e=i.getPossibleOperationForField(a);l=Boolean(e)&&t.validateMetadata(e)}else if("none"===i.input){const e=i.getPossibleOperation();l=Boolean(e)&&t.validateMetadata(e)}else if("fullReference"===i.input){const e=i.getPossibleOperation(n);l=Boolean(e)&&t.validateMetadata(e)}return t.input.includes(i.input)&&(!t.specificOperations||t.specificOperations.includes(e))&&l}function ms(e,t){const a={...e.columns};return e.columnOrder.forEach((e=>{const n=a[e];n.customLabel||(a[e]={...n,label:Co[n.operationType].getDefaultLabel(n,t,a)})})),{...e,columns:a}}function gs(e,t){var a;const n={...null!==(a=e.incompleteColumns)&&void 0!==a?a:{}};return delete n[t],{...e,incompleteColumns:n}}function fs({column:e,validation:t}){if(!e)return!1;const a=e.operationType,n=Co[a];return t.input.includes(n.input)&&function({column:e,validation:t}){return!t.specificOperations||"managedReference"===Co[e.operationType].input||t.specificOperations.includes(e.operationType)}({column:e,validation:t})&&t.validateMetadata(e)}function bs(e,t){const a={};Object.entries(t).forEach((([e,t])=>{a[e]="references"in t?[...t.references]:[]}));const n=a[e],i=[];for(;n.length>0;){const e=n.shift();i.push([e,t[e]]),n.push(...a[e])}return i.filter((([,e])=>e))}function hs(e,t,a,n,i){let l={indexPatternId:a.id,columns:{},columnOrder:[]};if(Object(Me.isArray)(t)){var s;const n=t.shift(),i=n&&null!==(s=a.getFieldByName(n.fieldName))&&void 0!==s?s:Ki,g=null==n?void 0:n.agg;if("formula"===g){var r,o,u,c;const e=Co.formula,t={indexPatternId:a.id,columns:{},columnOrder:[]};let i=e.buildColumn({indexPattern:a,layer:t}),s=null!=n&&null!==(r=n.params)&&void 0!==r&&r.kql?{query:null==n||null===(o=n.params)||void 0===o?void 0:o.kql,language:"kuery"}:void 0;var d,p;null!=n&&null!==(u=n.params)&&void 0!==u&&u.lucene&&(s=null!=n&&null!==(d=n.params)&&void 0!==d&&d.lucene?{query:null==n||null===(p=n.params)||void 0===p?void 0:p.lucene,language:"lucene"}:void 0),i={...i,...s&&{filter:s},params:{...i.params,...null==n?void 0:n.params}},l=null!=n&&null!==(c=n.params)&&void 0!==c&&c.formula?Zi(Object(Xt.a)(),i,t,{indexPattern:a}).layer:t}else{var m;const s=Object(Xt.a)();l=$l({op:g,layer:e?{indexPatternId:a.id,columns:{},columnOrder:[]}:hs(1===t.length,t,a),columnId:s,field:null!=n&&n.isFullReference?void 0:null!=i?i:Ki,columnParams:null!==(m=null==n?void 0:n.params)&&void 0!==m?m:void 0,incompleteFieldName:null!=n&&n.isFullReference?null==i?void 0:i.name:void 0,incompleteFieldOperation:null!=n&&n.isFullReference?null==n?void 0:n.pipelineAggType:void 0,indexPattern:a,visualizationGroups:[]}),n&&(n.accessor=s)}}let g=0;for(const[e,t]of Object.entries(l.columns))n&&(l=ts({layer:l,columnId:e,paramName:"format",value:{id:n,params:{decimals:0}}})),(i&&"percentile"===t.operationType||i&&g===Object.keys(l.columns).length-1)&&(l=es({layer:l,columnId:e,customLabel:i})),g++;return l}const xs=({value:e,onChange:t,minValue:a=1,maxValue:n=1e3,label:i=u.i18n.translate("xpack.lens.indexPattern.terms.size",{defaultMessage:"Number of values"}),disabled:s})=>{const[r,o]=Object(l.useState)(String(e));Object(y.s)((()=>{if(""===r)return;const e=Number(r);t(Math.min(n,Math.max(e,a)))}),{skipFirstRender:!0},256,[r]);const c=""===r,d=!c&&Number(r)>n,p=!c&&Number(r)<a;return Object(x.jsx)(g.EuiFormRow,{label:i,display:"rowCompressed",fullWidth:!0,isInvalid:d||p,error:d?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMax",{defaultMessage:"Value is higher than the maximum {max}, the maximum value is used instead.",values:{max:n}})]:p?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMin",{defaultMessage:"Value is lower than the minimum {min}, the minimum value is used instead.",values:{min:a}})]:null},Object(x.jsx)(g.EuiFieldNumber,{min:a,max:n,step:1,value:r,compressed:!0,isInvalid:d||p,disabled:s,onChange:({currentTarget:e})=>o(e.value),"aria-label":i,onBlur:()=>{if(""===r)return o(String(e));const t=Number(r);o(String(Math.min(n,Math.max(t,a))))}}))};a(294);var vs=a(129),ys=a.n(vs),js=a(130),Os=a.n(js),ks=["type","label","size","scripted","className"],Is={iconType:"questionInCircle",color:"gray"},Ts={boolean:{iconType:"tokenBoolean"},conflict:{iconType:"alert",color:"euiColorVis9",shape:"square"},date:{iconType:"tokenDate"},date_range:{iconType:"tokenDate"},geo_point:{iconType:"tokenGeo"},geo_shape:{iconType:"tokenGeo"},ip:{iconType:"tokenIP"},ip_range:{iconType:"tokenIP"},murmur3:{iconType:"tokenFile"},number:{iconType:"tokenNumber"},number_range:{iconType:"tokenNumber"},histogram:{iconType:"tokenHistogram"},_source:{iconType:"editorCodeBlock",color:"gray"},string:{iconType:"tokenString"},text:{iconType:"tokenString"},keyword:{iconType:"tokenKeyword"},nested:{iconType:"tokenNested"},version:{iconType:"tokenTag"}};function Fs(e){var t=e.type,a=e.label,n=e.size,l=void 0===n?"s":n,s=e.scripted,r=e.className,o=Os()(e,ks),u=Ts[t]||Is;return Object(x.jsx)(g.EuiToken,i()({},u,{className:h()("kbnFieldIcon",r),"aria-label":a||t,title:a||t,size:l,fill:s?"dark":void 0},o))}a(299);var Ms=["size","isActive","fieldIcon","fieldName","fieldInfoIcon","fieldAction","className","isDraggable","onClick","dataTestSubj","buttonProps"],ws={s:"kbnFieldButton--small",m:null};function _s(e){var t=e.size,a=void 0===t?"m":t,n=e.isActive,l=void 0!==n&&n,r=e.fieldIcon,o=e.fieldName,u=e.fieldInfoIcon,c=e.fieldAction,d=e.className,p=e.isDraggable,m=void 0!==p&&p,g=e.onClick,f=e.dataTestSubj,b=e.buttonProps,v=Os()(e,Ms),y=h()("kbnFieldButton",a?ws[a]:null,{"kbnFieldButton-isActive":l},{"kbnFieldButton--isDraggable":m},d),j=h()("kbn-resetFocusState","kbnFieldButton__button"),O=Object(x.jsx)(s.a.Fragment,null,r&&Object(x.jsx)("span",{className:"kbnFieldButton__fieldIcon"},r),o&&Object(x.jsx)("span",{className:"kbnFieldButton__name"},o),u&&Object(x.jsx)("div",{className:"kbnFieldButton__infoIcon"},u));return Object(x.jsx)("div",i()({className:y},v),g?Object(x.jsx)("button",i()({onClick:function(e){"click"===e.type&&e.currentTarget.focus(),g()},"data-test-subj":f,className:j},b),O):Object(x.jsx)("div",{className:j,"data-test-subj":f},O),c&&Object(x.jsx)("div",{className:"kbnFieldButton__fieldAction"},c))}function Cs({type:e,...t}){return Object(x.jsx)(Fs,i()({className:"lnsFieldListPanel__fieldIcon",type:tl(e)},t))}function Es(e,t,a){return e[t]&&e[t][a]}function Ss(e){const t=Object(Me.keyBy)(e,"name");return e=>t[e]}Object.keys(ws);const Ps=()=>document.createElement("canvas").getContext("2d"),As=Ps(),Ls=(e,t)=>{const a=null!=As?As:Ps();return a.font=t,a.measureText(e).width},Ds=s.a.memo((function({label:e,width:t,search:a,font:n}){const i=Object(l.useMemo)((()=>Ls(e,n)),[e,n]);if(i<t)return Object(x.jsx)(g.EuiHighlight,{search:a},e);const s=e.indexOf(a),r=Math.round(t*e.length/i);let o,u="".length;a&&-1!==s?0===s?o=(e,t)=>`${e.substr(0,t)}`:r>e.length-s?o=(e,t)=>`${e.substr(e.length-t)}`:(o=(e,t)=>`${e.substr(s,t)}`,u=2*"".length):o=(e,t)=>`${e.substr(0,8)}${e.substr(e.length-(t-8))}`;const c=((e,t,a,n,i)=>{let l=i(a,n);for(;Ls(l,t)>e;)l=i(a,n-=1);return l})(t,n,e,r,o);return a.length<c.length-u?Object(x.jsx)(g.EuiHighlight,{search:a},c):Object(x.jsx)(g.EuiMark,null,c)}));function Ns({currentIndexPattern:e,incompleteOperation:t,selectedOperationType:a,selectedField:n,operationByField:r,onChoose:o,onDeleteColumn:c,existingFields:d,fieldIsInvalid:p,markAllFieldsCompatible:m,"data-test-subj":f,...b}){var v,y;const j=Object(l.useMemo)((()=>{const n=Object.keys(r).sort(),i=null!=t?t:a;function l(e){return!i||r[e].has(i)}const[s,o]=Object(Me.partition)(n,(t=>{var a;return"document"===(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type)})),c=t=>{var a;return"document"===(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type)||Es(d,e.title,t)};function p(t){return t.filter((t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName})).map((t=>{var a,n;const s=m||l(t)?1:0,o=c(t);return{label:null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName,value:{type:"field",field:t,dataType:null===(n=e.getFieldByName(t))||void 0===n?void 0:n.type,operationType:i&&l(t)?i:r[t].values().next().value},exists:o,compatible:s,className:h()({"lnFieldSelect__option--incompatible":!s,"lnFieldSelect__option--nonExistant":!o}),"data-test-subj":`lns-fieldOption${s?"":"Incompatible"}-${t}`}})).sort(((e,t)=>t.compatible-e.compatible))}const[g,f]=Object(Me.partition)(o,(t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.meta})),[b,x]=Object(Me.partition)(f,c),v=(e,t)=>e.length>0&&{label:t,options:p(e)},y=v(b,u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"})),j=v(x,u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"})),O=v(g,u.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}));return[...p(s),y,j,O].filter(Boolean)}),[t,a,e,r,d,m]),O=Object(l.useRef)(null),[k,I]=s.a.useState({width:215,font:"14px Inter"}),T=(e,t=!1)=>{if(O.current){var a;const e={...k,width:(null===(a=O.current)||void 0===a?void 0:a.clientWidth)-90};t&&(e.font=window.getComputedStyle(O.current).font),I(e)}};return ys()((()=>{O.current&&T(0,!0),window.addEventListener("resize",T)})),Object(x.jsx)("div",{ref:O},Object(x.jsx)(g.EuiComboBox,i()({fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":null!=f?f:"indexPattern-dimension-field",placeholder:u.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:j,isInvalid:Boolean(t||p),selectedOptions:a&&n?[{label:p?n:null!==(v=null===(y=e.getFieldByName(n))||void 0===y?void 0:y.displayName)&&void 0!==v?v:n,value:{type:"field",field:n}}]:[],singleSelection:{asPlainText:!0},onChange:e=>{if(0===e.length)return void(null==c||c());const t=e[0].value;t.field!==n&&(Object(Ya.e)("indexpattern_dimension_field_changed"),o(t))},renderOption:(e,t)=>Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:null},Object(x.jsx)(Cs,{type:e.value.dataType,fill:"none"})),Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(Ds,i()({},k,{label:e.label,search:t}))))},b)))}const zs=Object(g.htmlIdGenerator)();function Bs(e){return null!=e.value}function Vs({column:e,onChange:t,indexPattern:a,existingFields:n,operationSupportMatrix:i,invalidFields:r}){const o=Object(l.useCallback)((e=>t(e.filter(Bs).map((({value:e})=>e)))),[t]),{wrappedValues:c,rawValuesLookup:d}=Object(l.useMemo)((()=>{var t;const a=e?[e.sourceField,...(null===(t=e.params)||void 0===t?void 0:t.secondaryFields)||[]]:[];return{wrappedValues:a.map((e=>({id:zs(),value:e}))),rawValuesLookup:new Set(a)}}),[e]),{inputValue:p,handleInputChange:m}=Object(y.t)({onChange:o,value:c}),f=Object(l.useCallback)(((e,t=0)=>{const n=[...p];a.getFieldByName(e.field)&&(n[t]={id:zs(),value:e.field},m(n))}),[p,a,m]);if(1===p.length){const[{value:t}]=p;return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(Ns,{fieldIsInvalid:Boolean(null==r?void 0:r[0]),currentIndexPattern:a,existingFields:n,operationByField:i.operationByField,selectedOperationType:null==e?void 0:e.operationType,selectedField:t,onChoose:f}),Object(x.jsx)(bl,{"data-test-subj":"indexPattern-terms-add-field",onClick:()=>{m([...p,{id:zs(),value:void 0,isNew:!0}])},label:u.i18n.translate("xpack.lens.indexPattern.terms.addField",{defaultMessage:"Add field"}),isDisabled:"rare"===e.params.orderBy.type}))}const b=2===p.length&&p.some((({isNew:e})=>e)),h=p.filter((({isNew:e})=>!e));return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(vl,{onDragEnd:e=>{m(e)},onDragStart:()=>{},droppableId:"TOP_TERMS_DROPPABLE_AREA",items:p},p.map((({id:t,value:l,isNew:s},o)=>{var c;const v=Object.keys(i.operationByField).filter((e=>{if(e===l)return!0;const t=a.getFieldByName(e);return!d.has(e)&&t&&!t.scripted&&El.has(t.type)})).reduce(((e,t)=>(e[t]=i.operationByField[t],e)),{}),j=Boolean(l&&((null===(c=a.getFieldByName(l))||void 0===c?void 0:c.scripted)&&h.length>1||(null==r?void 0:r.includes(l))));return Object(x.jsx)(g.EuiDraggable,{style:{marginBottom:4},spacing:"none",index:o,draggableId:l||"newField",key:t,disableInteractiveElementBlocking:!0},(t=>Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1}),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiIcon,{size:"s",color:"subdued",type:"grab",title:u.i18n.translate("xpack.lens.indexPattern.terms.dragToReorder",{defaultMessage:"Drag to reorder"}),"data-test-subj":`indexPattern-terms-dragToReorder-${o}`})),Object(x.jsx)(g.EuiFlexItem,{grow:!0,style:{minWidth:0}},Object(x.jsx)(Ns,{fieldIsInvalid:j,currentIndexPattern:a,existingFields:n,operationByField:v,selectedOperationType:e.operationType,selectedField:l,autoFocus:s,onChoose:e=>{f(e,o)},isInvalid:j,"data-test-subj":`indexPattern-dimension-field-${o}`})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonDisabled",{defaultMessage:"This function requires a minimum of one field defined"}),condition:b},Object(x.jsx)(g.EuiButtonIcon,{iconType:"trash",color:"danger","aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonAriaLabel",{defaultMessage:"Delete"}),title:u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonLabel",{defaultMessage:"Delete"}),onClick:()=>{m(p.filter(((e,t)=>t!==o)))},"data-test-subj":`indexPattern-terms-removeField-${o}`,isDisabled:b&&!s}))))))}))),Object(x.jsx)(bl,{onClick:()=>{m([...p,{id:zs(),value:void 0,isNew:!0}])},"data-test-subj":"indexPattern-terms-add-field",label:u.i18n.translate("xpack.lens.indexPattern.terms.addaFilter",{defaultMessage:"Add field"}),isDisabled:p.length>3}))}function Rs(e,t){return e?u.i18n.translate("xpack.lens.indexPattern.terms.scriptedFieldErrorShort",{defaultMessage:"Scripted fields are not supported when using multiple fields"}):t.length?u.i18n.translate("xpack.lens.indexPattern.terms.invalidFieldsErrorShort",{defaultMessage:"Invalid {invalidFieldsCount, plural, one {field} other {fields}}: {invalidFields}. Check your data view or pick another field.",values:{invalidFieldsCount:t.length,invalidFields:t.map((e=>`"${e}"`)).join(", ")}}):void 0}function Hs({layer:e,selectedColumn:t,columnId:a,indexPattern:n,existingFields:i,operationSupportMatrix:l,updateLayer:s,onDeleteColumn:r,incompleteField:o,incompleteOperation:c,incompleteParams:d,currentFieldIsInvalid:p,helpMessage:m,groupId:f,dimensionGroups:b,operationDefinitionMap:h}){const v=t&&h[t.operationType],y=("fullReference"!==(null==v?void 0:v.input)&&"managedReference"!==(null==v?void 0:v.input)||c&&"field"===h[c].input)&&Gs(t,Boolean(c),null==v?void 0:v.input,p);return Object(x.jsx)(g.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:Boolean(c||p),error:y,labelAppend:!y&&m},Object(x.jsx)(Ns,{fieldIsInvalid:p,currentIndexPattern:n,existingFields:i,operationByField:l.operationByField,selectedOperationType:t?t.operationType:c,selectedField:null!=o?o:null==t?void 0:t.sourceField,incompleteOperation:c,onDeleteColumn:r,onChoose:t=>s(Gl({layer:e,columnId:a,indexPattern:n,op:t.operationType,field:n.getFieldByName(t.field),visualizationGroups:b,targetGroup:f,incompleteParams:d}))}))}function Gs(e,t,a,n){return e&&t?"field"===a?u.i18n.translate("xpack.lens.indexPattern.invalidOperationLabel",{defaultMessage:"This field does not work with the selected function."}):u.i18n.translate("xpack.lens.indexPattern.chooseFieldLabel",{defaultMessage:"To use this function, select a field."}):n?u.i18n.translate("xpack.lens.indexPattern.invalidFieldLabel",{defaultMessage:"Invalid field. Check your data view or pick another field."}):void 0}function qs(e){var t;return!(null!=e&&null!==(t=e.esTypes)&&void 0!==t&&t.some((e=>["double","float","half_float","scaled_float"].includes(e))))}const $s=u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"});function Ws(e,t=0,a=!1,n=0){return a?u.i18n.translate("xpack.lens.indexPattern.rareTermsOf",{defaultMessage:"Rare values of {name}",values:{name:null!=e?e:$s}}):t?u.i18n.translate("xpack.lens.indexPattern.multipleTermsOf",{defaultMessage:"Top values of {name} + {count} {count, plural, one {other} other {others}}",values:{name:null!=e?e:$s,count:t}}):u.i18n.translate("xpack.lens.indexPattern.termsOf",{defaultMessage:"Top {numberOfTermsLabel}{termsCount, plural, one {value} other {values}} of {name}",values:{name:null!=e?e:$s,termsCount:n,numberOfTermsLabel:n>1?`${n} `:""}})}function Us(e){var t;return{id:null!==(t=e.secondaryFields)&&void 0!==t&&t.length?"multi_terms":"terms"}}const Ys=Object(g.htmlIdGenerator)()(),Ks={type:"terms",displayName:u.i18n.translate("xpack.lens.indexPattern.terms",{defaultMessage:"Top values"}),priority:3,input:"field",getCurrentFields:e=>{var t,a;return[e.sourceField,...null!==(t=null==e||null===(a=e.params)||void 0===a?void 0:a.secondaryFields)&&void 0!==t?t:[]]},getParamsForMultipleFields:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{const i=new Set(Vl(n,e).validFields),l=Vl(n,t,a).validFields;for(const e of l)i.add(e);i.delete(e.sourceField);const s=[...i];return{secondaryFields:s,parentFormat:Us({...e.params,secondaryFields:s})}},canAddNewField:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{var i,l,s;if("rare"===e.params.orderBy.type)return!1;const r=new Set(Vl(n,e).validFields),{validFields:o}=Vl(n,t,a),u=o.filter((e=>!r.has(e))).length;return!!u&&u+(null!==(i=null===(l=e.params)||void 0===l||null===(s=l.secondaryFields)||void 0===s?void 0:s.length)&&void 0!==i?i:0)<=3},getDefaultVisualSettings:e=>{var t,a;return{truncateText:Boolean(!(null!==(t=e.params)&&void 0!==t&&null!==(a=t.secondaryFields)&&void 0!==a&&a.length))}},getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(El.has(a)&&t&&(!e||e.terms))return{dataType:a,isBucketed:!0,scale:"ordinal"}},getErrorMessage:(e,t,a)=>{const n=[...il(e.columns[t],a)||[],Nl(e,t,a)||"",Pl(e,t,a)||""].filter(Boolean);return n.length?n:void 0},getNonTransferableFields:(e,t)=>Vl(t,e).invalidFields,isTransferable:(e,t)=>{const{allFields:a,invalidFields:n}=Vl(t,e);return Boolean(a.length&&0===n.length&&(!e.params.otherBucket||!t.hasRestrictions))},buildColumn({layer:e,field:t,indexPattern:a}){const n=Object.entries(e.columns).filter((([t])=>zl(e,t))).map((([e])=>e))[0],i=Object.values(e.columns).filter((e=>e&&e.isBucketed)).length;return{label:Ws(t.displayName),dataType:t.type,operationType:"terms",scale:"ordinal",sourceField:t.name,isBucketed:!0,params:{size:0===i?5:3,orderBy:n?{type:"column",columnId:n}:{type:"alphabetical",fallback:!0},orderDirection:n?"desc":"asc",otherBucket:!a.hasRestrictions,missingBucket:!1,parentFormat:{id:"terms"}}}},toEsAggsFn:(e,t,a,n,i,l)=>{var s,r,o;return"rare"===(null===(s=e.params)||void 0===s?void 0:s.orderBy.type)?Object(ue.buildExpressionFunction)("aggRareTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,max_doc_count:e.params.orderBy.maxDocCount}).toAst():null!==(r=e.params)&&void 0!==r&&null!==(o=r.secondaryFields)&&void 0!==o&&o.length?Object(ue.buildExpressionFunction)("aggMultiTerms",{id:t,enabled:!0,schema:"segment",fields:[e.sourceField,...e.params.secondaryFields],orderBy:"alphabetical"===e.params.orderBy.type?"_key":String(l.indexOf(e.params.orderBy.columnId)),order:e.params.orderDirection,size:e.params.size,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"})}).toAst():Object(ue.buildExpressionFunction)("aggTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,orderBy:"alphabetical"===e.params.orderBy.type?"_key":String(l.indexOf(e.params.orderBy.columnId)),order:e.params.orderDirection,size:e.params.size,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"}),missingBucket:e.params.otherBucket&&e.params.missingBucket,missingBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.missingLabel",{defaultMessage:"(missing value)"})}).toAst()},getDefaultLabel:(e,t)=>{var a,n;return Ws(null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.displayName,null===(n=e.params.secondaryFields)||void 0===n?void 0:n.length,"rare"===e.params.orderBy.type,e.params.size)},onFieldChange:(e,t,a)=>{var n;const i={...e.params,secondaryFields:void 0,...a};return"format"in i&&"number"!==t.type&&delete i.format,i.parentFormat=Us(i),qs(t)||"rare"!==i.orderBy.type||(i.orderBy={type:"alphabetical"}),{...e,dataType:t.type,label:e.customLabel?e.label:Ws(t.displayName,null===(n=i.secondaryFields)||void 0===n?void 0:n.length,"rare"===i.orderBy.type,i.size),sourceField:t.name,params:i}},onOtherColumnChanged:(e,t,a)=>{const n=e.columns,i=n[t];if(("column"===i.params.orderBy.type||"alphabetical"===i.params.orderBy.type&&i.params.orderBy.fallback)&&(!("column"===i.params.orderBy.type?n[i.params.orderBy.columnId]:void 0)||"column"===i.params.orderBy.type&&!zl(e,i.params.orderBy.columnId))){const t=Object.entries(e.columns).filter((([t])=>zl(e,t))).map((([e])=>e))[0];return{...i,params:{...i.params,orderBy:t?{type:"column",columnId:t}:{type:"alphabetical",fallback:!0},orderDirection:t?"desc":"asc"}}}return i},renderFieldInput:function(e){var t,a,n,i;const{layer:s,selectedColumn:r,columnId:o,indexPattern:c,existingFields:d,operationSupportMatrix:p,updateLayer:m,dimensionGroups:f,groupId:b,incompleteParams:h}=e,v=Object(l.useCallback)((e=>{const t=s.columns[o],[a,...n]=e,i=Object(Me.uniq)(e.map((e=>{var t;return null===(t=c.getFieldByName(e))||void 0===t?void 0:t.type}))),l=(1===i.length?i[0]:"string")||t.dataType,r={...t.params};"format"in r&&"number"!==l&&delete r.format;const u=c.getFieldByName(a);if(qs(u)||"rare"!==r.orderBy.type||(r.orderBy={type:"alphabetical"}),1===e.length){const e=p.operationByField[a];if(!(null==e?void 0:e.has("terms"))){const t=null==e?void 0:e.values().next().value;return m(Gl({layer:s,columnId:o,indexPattern:c,op:t,field:u,visualizationGroups:f,targetGroup:b,incompleteParams:h}))}}m({...s,columns:{...s.columns,[o]:{...t,dataType:l,sourceField:a,label:t.customLabel?t.label:Ws(null==u?void 0:u.displayName,e.length-1,"rare"===r.orderBy.type,r.size),params:{...r,secondaryFields:n,parentFormat:Us({...r,secondaryFields:n})}}}})}),[o,f,b,h,c,s,p.operationByField,m]),y=s.columns[o],j=Gs(r,Boolean(e.incompleteOperation),"field",e.currentFieldIsInvalid);if(!y||!r||e.incompleteOperation||j&&(null===(t=r.params)||void 0===t||null===(a=t.secondaryFields)||void 0===a||!a.length))return Object(x.jsx)(Hs,e);const O=Boolean(Pl(s,o,c)),{invalidFields:k}=Vl(c,r);return Object(x.jsx)(g.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.terms.chooseFields",{defaultMessage:"{count, plural, zero {Field} other {Fields}}",values:{count:(null===(n=r.params)||void 0===n||null===(i=n.secondaryFields)||void 0===i?void 0:i.length)||0}}),fullWidth:!0,isInvalid:Boolean(O||k.length),error:Rs(O,k)},Object(x.jsx)(Vs,{column:r,indexPattern:c,existingFields:d,operationSupportMatrix:p,onChange:v,invalidFields:k}))},paramEditor:function({layer:e,updateLayer:t,currentColumn:a,columnId:n,indexPattern:i}){var l,r;const o=i.hasRestrictions;function c(e){return"column"!==e.type?e.type:`${e.type}$$$${e.columnId}`}const d=Object.entries(e.columns).filter((([t])=>zl(e,t))).map((([e,t])=>({value:c({type:"column",columnId:e}),text:t.label})));d.push({value:c({type:"alphabetical"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderAlphabetical",{defaultMessage:"Alphabetical"})}),null!==(l=a.params.secondaryFields)&&void 0!==l&&l.length||!qs(i.getFieldByName(a.sourceField))||d.push({value:c({type:"rare",maxDocCount:1}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderRare",{defaultMessage:"Rarity"})});const p=a.params.secondaryFields?a.params.secondaryFields.length:0;return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(xs,{value:a.params.size,disabled:"rare"===a.params.orderBy.type,onChange:l=>{var s;t({...e,columns:{...e.columns,[n]:{...a,label:a.customLabel?a.label:Ws(null===(s=i.getFieldByName(a.sourceField))||void 0===s?void 0:s.displayName,p,"rare"===a.params.orderBy.type,l),params:{...a.params,size:l}}}})}}),"rare"===a.params.orderBy.type&&Object(x.jsx)(xs,{value:a.params.orderBy.maxDocCount,label:u.i18n.translate("xpack.lens.indexPattern.terms.maxDocCount",{defaultMessage:"Max doc count per term"}),maxValue:100,onChange:i=>{t(ts({layer:e,columnId:n,paramName:"orderBy",value:{...a.params.orderBy,maxDocCount:i}}))}}),Object(x.jsx)(g.EuiFormRow,{label:Object(x.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})," ",Object(x.jsx)(g.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.orderByHelp",{defaultMessage:"Specifies the dimension the top values are ranked by."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),display:"rowCompressed",fullWidth:!0},Object(x.jsx)(g.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-terms-orderBy",options:d,value:c(a.params.orderBy),onChange:a=>{const l="alphabetical"===(s=a.target.value)?{type:"alphabetical",fallback:!1}:"rare"===s?{type:"rare",maxDocCount:1}:{type:"column",columnId:s.split("$$$")[1]};var s;const r=ms(ts({layer:e,columnId:n,paramName:"orderBy",value:l}),i);t(ts({layer:r,columnId:n,paramName:"orderDirection",value:"alphabetical"===l.type?"asc":"desc"}))},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})})),Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),display:"rowCompressed",fullWidth:!0},Object(x.jsx)(g.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),"data-test-subj":"indexPattern-terms-orderDirection-groups",name:"orderDirection",buttonSize:"compressed","aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),isDisabled:"rare"===a.params.orderBy.type,options:[{id:`${Ys}asc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-asc",value:"asc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderAscending",{defaultMessage:"Ascending"})},{id:`${Ys}desc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-desc",value:"desc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDescending",{defaultMessage:"Descending"})}],idSelected:`${Ys}${a.params.orderDirection}`,onChange:a=>{const i=a.replace(Ys,"");t(ts({layer:e,columnId:n,paramName:"orderDirection",value:i}))}})),!o&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(g.EuiAccordion,{id:"lnsTermsAdvanced",buttonContent:u.i18n.translate("xpack.lens.indexPattern.terms.advancedSettings",{defaultMessage:"Advanced"}),"data-test-subj":"indexPattern-terms-advanced"},Object(x.jsx)(g.EuiSpacer,{size:"m"}),Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.terms.otherBucketDescription",{defaultMessage:'Group other values as "Other"'}),compressed:!0,"data-test-subj":"indexPattern-terms-other-bucket",checked:Boolean(a.params.otherBucket),disabled:"rare"===a.params.orderBy.type,onChange:a=>t(ts({layer:e,columnId:n,paramName:"otherBucket",value:a.target.checked}))}),Object(x.jsx)(g.EuiSpacer,{size:"m"}),Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.terms.missingBucketDescription",{defaultMessage:"Include documents without this field"}),compressed:!0,disabled:!a.params.otherBucket||"string"!==(null===(r=i.getFieldByName(a.sourceField))||void 0===r?void 0:r.type)||"rare"===a.params.orderBy.type,"data-test-subj":"indexPattern-terms-missing-bucket",checked:Boolean(a.params.missingBucket),onChange:a=>t(ts({layer:e,columnId:n,paramName:"missingBucket",value:a.target.checked}))}))))}};var Xs=a(1),Zs=a.n(Xs),Qs=a(304),Js=a(53);const er={s:u.i18n.translate("xpack.lens.fieldFormats.suffix.s",{defaultMessage:"/s"}),m:u.i18n.translate("xpack.lens.fieldFormats.suffix.m",{defaultMessage:"/m"}),h:u.i18n.translate("xpack.lens.fieldFormats.suffix.h",{defaultMessage:"/h"}),d:u.i18n.translate("xpack.lens.fieldFormats.suffix.d",{defaultMessage:"/d"})},tr={s:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.s",{defaultMessage:"per second"}),m:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.m",{defaultMessage:"per minute"}),h:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.h",{defaultMessage:"per hour"}),d:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.d",{defaultMessage:"per day"})},ar="suffix";function nr(e){var t;return t=class SuffixFormatter extends Js.FieldFormat{constructor(...t){super(...t),Zs()(this,"allowsNumericalAggregations",!0),Zs()(this,"textConvert",(t=>{const a=this.param("unit"),n=a?er[a]:this.param("suffixString"),i=this.param("id"),l=this.param("params"),s=e()({id:i,params:l}).convert(t);return""===s?"":n?`${s}${n}`:s}))}getParamDefaults(){return{unit:void 0,nestedParams:{}}}},Zs()(t,"id",ar),Zs()(t,"hidden",!0),Zs()(t,"title",u.i18n.translate("xpack.lens.fieldFormats.suffix.title",{defaultMessage:"Suffix"})),Zs()(t,"fieldType",Qs.KBN_FIELD_TYPES.NUMBER),t}function ir(e,t){return(t||e?" ":"")+(e?tr[e]:"")+(t&&e?" ":"")+(t?`-${t}`:"")}function lr(e,t,a,n,i){let l=e;if(t||n){const a=ir(t,n),i=e.lastIndexOf(a);-1!==i&&(l=e.substring(0,i))}return a||i?`${l}${ir(a,i)}`:l}function sr(e,t,a){const n=e.columns,i=n[t];return i.timeScale?Object.values(n).some((e=>"date_histogram"===(null==e?void 0:e.operationType)))||i.customLabel?i:{...i,timeScale:void 0,label:lr(i.label,i.timeScale,void 0,i.timeShift,i.timeShift)}:i}const rr=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range"]),or="ratio",ur="unique_count";function cr(e,t){return lr(u.i18n.translate("xpack.lens.indexPattern.cardinalityOf",{defaultMessage:"Unique count of {name}",values:{name:e}}),void 0,void 0,void 0,t)}const dr={type:ur,displayName:u.i18n.translate("xpack.lens.indexPattern.cardinality",{defaultMessage:"Unique count"}),input:"field",getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(rr.has(a)&&t&&(!e||e.cardinality))return{dataType:"number",isBucketed:!1,scale:or}},getErrorMessage:(e,t,a)=>ll([il(e.columns[t],a),Ai(e,t)]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&rr.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality))},filterable:!0,shiftable:!0,getDefaultLabel:(e,t)=>cr(sl(e.sourceField,t),e.timeShift),buildColumn({field:e,previousColumn:t},a){var n;return{label:cr(e.displayName,null==t?void 0:t.timeShift),dataType:"number",operationType:ur,scale:or,sourceField:e.name,isBucketed:!1,filter:dl(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),params:{...cl(t),emptyAsNull:t&&ol("unique_count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,updateLayer:n})=>{var i;return[{dataTestSubj:"hide-zero-values",optionElement:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"}),labelProps:{style:{fontWeight:R.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(ts({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})),title:"",showInPopover:!0,inlineElement:null,onClick:()=>{}}]},toEsAggsFn:(e,t)=>{var a;return Object(ue.buildExpressionFunction)("aggCardinality",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter?void 0:e.timeShift,emptyAsNull:null===(a=e.params)||void 0===a?void 0:a.emptyAsNull}).toAst()},onFieldChange:(e,t)=>({...e,label:cr(t.displayName,e.timeShift),sourceField:t.name}),documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.cardinality.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.markdown",{defaultMessage:"\nCalculates the number of unique values of a specified field. Works for number, string, date and boolean values.\n\nExample: Calculate the number of different products:\n`unique_count(product.name)`\n\nExample: Calculate the number of different products from the \"clothes\" group:\n`unique_count(product.name, kql='product.group=clothes')`\n      "})}};function pr(e,t,a){return lr(u.i18n.translate("xpack.lens.indexPattern.percentileOf",{defaultMessage:"{percentile, selectordinal, one {#st} two {#nd} few {#rd} other {#th}} percentile of {name}",values:{name:e,percentile:t}}),void 0,void 0,void 0,a)}const mr=["number","histogram"],gr={type:"percentile",displayName:u.i18n.translate("xpack.lens.indexPattern.percentile",{defaultMessage:"Percentile"}),input:"field",operationParams:[{name:"percentile",type:"number",required:!1,defaultValue:95}],filterable:!0,shiftable:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(mr.includes(a)&&t&&!e)return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&mr.includes(a.type)&&a.aggregatable&&!a.aggregationRestrictions)},getDefaultLabel:(e,t,a)=>pr(sl(e.sourceField,t),e.params.percentile,e.timeShift),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const l=t&&ol("percentile",t)&&t.params.percentile,s=null!==(i=null==n?void 0:n.percentile)&&void 0!==i?i:l||95;return{label:pr(sl(e.name,a),s,null==t?void 0:t.timeShift),dataType:"number",operationType:"percentile",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:dl(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:{percentile:s,...cl(t)}}},onFieldChange:(e,t)=>({...e,label:pr(t.displayName,e.params.percentile,e.timeShift),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(ue.buildExpressionFunction)("aggSinglePercentile",{id:t,enabled:!0,schema:"metric",field:e.sourceField,percentile:e.params.percentile,timeShift:e.filter?void 0:e.timeShift}).toAst(),getErrorMessage:(e,t,a)=>ll([il(e.columns[t],a),Ai(e,t)]),paramEditor:function({layer:e,updateLayer:t,currentColumn:a,columnId:n,indexPattern:i}){const s=Object(l.useCallback)((l=>{var s;rl(l,!0,99,1)&&Number(l)!==a.params.percentile&&t({...e,columns:{...e.columns,[n]:{...a,label:a.customLabel?a.label:pr((null===(s=i.getFieldByName(a.sourceField))||void 0===s?void 0:s.displayName)||a.sourceField,Number(l),a.timeShift),params:{...a.params,percentile:Number(l)}}}})}),[t,e,n,a,i]),{inputValue:r,handleInputChange:o}=Object(y.t)({onChange:s,value:String(a.params.percentile)}),c=rl(r,!0,99,1),d=Object(l.useCallback)((e=>o(String(e.currentTarget.value))),[o]);return Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"}),"data-test-subj":"lns-indexPattern-percentile-form",display:"rowCompressed",fullWidth:!0,isInvalid:!c,error:!c&&u.i18n.translate("xpack.lens.indexPattern.percentile.errorMessage",{defaultMessage:"Percentile has to be an integer between 1 and 99"})},Object(x.jsx)(g.EuiRange,{"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=r?r:"",min:1,max:99,step:1,onChange:d,showInput:!0,"aria-label":u.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"})}))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.percentile.signature",{defaultMessage:"field: string, [percentile]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.percentile.documentation.markdown",{defaultMessage:"\nReturns the specified percentile of the values of a field. This is the value n percent of the values occuring in documents are smaller.\n\nExample: Get the number of bytes larger than 95 % of values:\n`percentile(bytes, percentile=95)`\n      "})}},fr={min:"aggMin",max:"aggMax",average:"aggAvg",sum:"aggSum",median:"aggMedian"},br=["number","histogram"];function hr({type:e,displayName:t,description:a,ofName:n,priority:i,optionalTimeScaling:l,supportsDate:r,hideZeroOption:o}){const c=(e,t)=>lr(n(e),void 0,l?null==t?void 0:t.timeScale:void 0,void 0,null==t?void 0:t.timeShift);return{type:e,priority:i,displayName:t,description:a,input:"field",timeScalingMode:l?"optional":void 0,getPossibleOperationForField:({aggregationRestrictions:t,aggregatable:a,type:n})=>{if((br.includes(n)||r&&"date"===n)&&a&&(!t||t[e]))return{dataType:"date"===n?"date":"number",isBucketed:!1,scale:"ratio"}},isTransferable:(t,a)=>{const n=a.getFieldByName(t.sourceField);return Boolean(n&&br.includes(n.type)&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions[e]))},onOtherColumnChanged:(e,t,a)=>l?sr(e,t):e.columns[t],getDefaultLabel:(e,t,a)=>c(sl(e.sourceField,t),e),buildColumn:({field:t,previousColumn:a},n)=>{var i;return{label:c(t.displayName,a),dataType:r&&"date"===t.type?"date":"number",operationType:e,sourceField:t.name,isBucketed:!1,scale:"ratio",timeScale:l?null==a?void 0:a.timeScale:void 0,filter:dl(a,n),timeShift:(null==n?void 0:n.shift)||(null==a?void 0:a.timeShift),params:{...cl(a),emptyAsNull:o&&a&&ol(e,a)?null===(i=a.params)||void 0===i?void 0:i.emptyAsNull:!(null!=n&&n.usedInMath)}}},onFieldChange:(e,t)=>({...e,label:c(t.displayName,e),dataType:t.type,sourceField:t.name}),getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,updateLayer:n})=>{var i;return o?[{dataTestSubj:"hide-zero-values",optionElement:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"}),labelProps:{style:{fontWeight:R.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(ts({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})),title:"",showInPopover:!0,inlineElement:null,onClick:()=>{}}]:[]},toEsAggsFn:(t,a,n)=>{var i;return Object(ue.buildExpressionFunction)(fr[e],{id:a,enabled:!0,schema:"metric",field:t.sourceField,timeShift:t.filter?void 0:t.timeShift,emptyAsNull:o?null===(i=t.params)||void 0===i?void 0:i.emptyAsNull:void 0}).toAst()},getErrorMessage:(e,t,a)=>ll([il(e.columns[t],a),Ai(e,t)]),filterable:!0,documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.metric.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.metric.documentation.markdown",{defaultMessage:"\nReturns the {metric} of a field. This function only works for number fields.\n\nExample: Get the {metric} of price:\n`{metric}(price)`\n\nExample: Get the {metric} of price for orders from the UK:\n`{metric}(price, kql='location:UK')`\n      ",values:{metric:e}})},shiftable:!0}}const xr=hr({type:"min",displayName:u.i18n.translate("xpack.lens.indexPattern.min",{defaultMessage:"Minimum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.minOf",{defaultMessage:"Minimum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.min.description",{defaultMessage:"A single-value metrics aggregation that returns the minimum value among the numeric values extracted from the aggregated documents."}),supportsDate:!0}),vr=hr({type:"max",displayName:u.i18n.translate("xpack.lens.indexPattern.max",{defaultMessage:"Maximum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.maxOf",{defaultMessage:"Maximum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.max.description",{defaultMessage:"A single-value metrics aggregation that returns the maximum value among the numeric values extracted from the aggregated documents."}),supportsDate:!0}),yr=hr({type:"average",priority:2,displayName:u.i18n.translate("xpack.lens.indexPattern.avg",{defaultMessage:"Average"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.avgOf",{defaultMessage:"Average of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.avg.description",{defaultMessage:"A single-value metric aggregation that computes the average of numeric values that are extracted from the aggregated documents"})}),jr=hr({type:"sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.sum",{defaultMessage:"Sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.sumOf",{defaultMessage:"Sum of {name}",values:{name:e}}),optionalTimeScaling:!0,description:u.i18n.translate("xpack.lens.indexPattern.sum.description",{defaultMessage:"A single-value metrics aggregation that sums up numeric values that are extracted from the aggregated documents."}),hideZeroOption:!0}),Or=hr({type:"median",priority:3,displayName:u.i18n.translate("xpack.lens.indexPattern.median",{defaultMessage:"Median"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.medianOf",{defaultMessage:"Median of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.median.description",{defaultMessage:"A single-value metrics aggregation that computes the median value that are extracted from the aggregated documents."})});a(307);const kr=({children:e,onClick:t})=>Object(x.jsx)(g.EuiText,{size:"xs"},Object(x.jsx)(g.EuiLink,{onClick:t},Object(x.jsx)(g.EuiIcon,{className:"lnsHelpPopover__buttonIcon",size:"s",type:"help"}),e)),Ir=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s})=>(Object(l.useEffect)((()=>{i&&Object(Ya.e)("open_help_popover")}),[i]),Object(x.jsx)(g.EuiPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(x.jsx)(g.EuiPopoverTitle,{paddingSize:"m"},s),Object(x.jsx)(g.EuiText,{className:"lnsHelpPopover__content",size:"s"},a))),{isValidInterval:Tr}=_i.search.aggs,Fr="auto",Mr=new Set(["w","M","q","y"]);function wr(e,t){if(Object.values(e.columns).some((e=>e.timeShift&&""!==e.timeShift)))return e.columnOrder.filter((t=>"date_histogram"===e.columns[t].operationType)).length<2?void 0:u.i18n.translate("xpack.lens.indexPattern.multipleDateHistogramsError",{defaultMessage:'"{dimensionLabel}" is not the only date histogram. When using time shifts, make sure to only use one date histogram.',values:{dimensionLabel:e.columns[t].label}})}const _r={type:"date_histogram",displayName:u.i18n.translate("xpack.lens.indexPattern.dateHistogram",{defaultMessage:"Date histogram"}),input:"field",priority:5,operationParams:[{name:"interval",type:"string",required:!1}],getErrorMessage:(e,t,a)=>[...il(e.columns[t],a)||[],wr(e,t)||""].filter(Boolean),getHelpMessage:e=>Object(x.jsx)(Er,e),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(("date"===a||"date_range"===a)&&t&&(!e||e.date_histogram))return{dataType:"date",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>sl(e.sourceField,t),buildColumn({field:e},t){var a;return{label:e.displayName,dataType:"date",operationType:"date_histogram",sourceField:e.name,isBucketed:!0,scale:"interval",params:{interval:null!==(a=null==t?void 0:t.interval)&&void 0!==a?a:Fr,includeEmptyRows:!0,dropPartials:Boolean(null==t?void 0:t.dropPartials)}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"date"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.date_histogram))},onFieldChange:(e,t)=>({...e,label:t.displayName,sourceField:t.name}),toEsAggsFn:(e,t,a)=>{var n,i,l,s,r,o,u;const c=a.getFieldByName(e.sourceField);let d,p=null!==(n=null===(i=e.params)||void 0===i?void 0:i.interval)&&void 0!==n?n:Fr;const m=Boolean((null===(l=e.params)||void 0===l?void 0:l.dropPartials)&&(a.timeFieldName===(null==c?void 0:c.name)||!(null!==(s=e.params)&&void 0!==s&&s.ignoreTimeRange)));return c&&c.aggregationRestrictions&&c.aggregationRestrictions.date_histogram&&(p=Cr(c.aggregationRestrictions),d=c.aggregationRestrictions.date_histogram.time_zone),Object(ue.buildExpressionFunction)("aggDateHistogram",{id:t,enabled:!0,schema:"segment",field:e.sourceField,time_zone:d,useNormalizedEsInterval:!(null!=c&&null!==(r=c.aggregationRestrictions)&&void 0!==r&&r.date_histogram),interval:p,drop_partials:m,min_doc_count:null!==(o=e.params)&&void 0!==o&&o.includeEmptyRows?0:1,extended_bounds:Object(ii.extendedBoundsToAst)({}),extendToTimeRange:null===(u=e.params)||void 0===u?void 0:u.includeEmptyRows}).toAst()},paramEditor:function({layer:e,columnId:t,currentColumn:a,updateLayer:n,dateRange:i,data:r,indexPattern:o}){const d=a&&o.getFieldByName(a.sourceField),p=d.aggregationRestrictions&&d.aggregationRestrictions.date_histogram,m=function(e){const t=e||"",a=t.match(/[\d]+/)||[],n=t.match(/[\D]+/)||[],i=parseInt(a[0]||"",10);return{value:isNaN(i)?"":i,unit:n[0]||"h"}}(a.params.interval),f=Tr(`${""===m.value?"1":m.value}${m.unit}`,Cr(d.aggregationRestrictions)),b=Object(l.useCallback)((a=>{const{fromDate:l,toDate:s}=i,o=a.target.checked?r.search.aggs.calculateAutoTimeExpression({from:l,to:s})||"1h":Fr;n(ts({layer:ts({layer:e,columnId:t,paramName:"interval",value:o}),columnId:t,paramName:"ignoreTimeRange",value:!1}))}),[i,r.search.aggs,n,e,t]),h=Object(l.useCallback)((a=>{n(ts({layer:e,columnId:t,paramName:"dropPartials",value:a.target.checked}))}),[t,e,n]),v=a=>{const i=`${Mr.has(a.unit)?"1":a.value}${a.unit||"d"}`;n(ts({layer:e,columnId:t,paramName:"interval",value:i}))},j=o.timeFieldName===(null==d?void 0:d.name)||!a.params.ignoreTimeRange;return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(y.l,{tooltipContent:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBucketsHelp",{defaultMessage:"Drop partial buckets is disabled as these can be computed only for a time field bound to global time picker in the top right."}),condition:!j},Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBuckets",{defaultMessage:"Drop partial buckets"}),checked:Boolean(a.params.dropPartials),onChange:h,compressed:!0,disabled:!j}))),!p&&Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoInterval",{defaultMessage:"Customize time interval"}),checked:a.params.interval!==Fr,onChange:b,compressed:!0})),a.params.interval!==Fr&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.minimumInterval",{defaultMessage:"Minimum interval"}),fullWidth:!0,display:"rowCompressed"},p?Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.restrictedInterval",defaultMessage:"Interval fixed to {intervalValue} due to aggregation restrictions.",values:{intervalValue:Cr(d.aggregationRestrictions)}}):Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFlexGroup,{responsive:!1,gutterSize:"s"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiFieldNumber,{compressed:!0,"data-test-subj":"lensDateHistogramValue",value:"number"==typeof m.value||""===m.value?m.value:parseInt(m.value,10),disabled:Mr.has(m.unit),isInvalid:!f,onChange:e=>{const t={...m,value:e.target.value};v(t)},step:1})),Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiSelect,{compressed:!0,"data-test-subj":"lensDateHistogramUnit",value:m.unit,onChange:e=>{const t={...m,unit:e.target.value};v(t)},isInvalid:!f,options:[{value:"ms",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.milliseconds",{defaultMessage:"milliseconds"})},{value:"s",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.seconds",{defaultMessage:"seconds"})},{value:"m",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.minutes",{defaultMessage:"minutes"})},{value:"h",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.hours",{defaultMessage:"hours"})},{value:"d",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.days",{defaultMessage:"days"})},{value:"w",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.week",{defaultMessage:"week"})},{value:"M",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.month",{defaultMessage:"month"})},{value:"y",text:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.year",{defaultMessage:"year"})}]}))),!f&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(g.EuiTextColor,{color:"danger","data-test-subj":"lensDateHistogramError"},u.i18n.translate("xpack.lens.indexPattern.invalidInterval",{defaultMessage:"Invalid interval value"}))))),Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(g.EuiSwitch,{label:Object(x.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.bindToGlobalTimePicker",{defaultMessage:"Bind to global time picker"})," ",Object(x.jsx)(g.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.globalTimePickerHelp",{defaultMessage:"Filter the selected field by the global time picker in the top right. This setting can't be turned off for the default time field of the current data view."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),disabled:o.timeFieldName===(null==d?void 0:d.name),checked:j,onChange:()=>{n(ts({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!a.params.ignoreTimeRange}))},compressed:!0}))),Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.includeEmptyRows",{defaultMessage:"Include empty rows"}),checked:Boolean(a.params.includeEmptyRows),"data-test-subj":"indexPattern-include-empty-rows",onChange:()=>{n(ts({layer:e,columnId:t,paramName:"includeEmptyRows",value:!a.params.includeEmptyRows}))},compressed:!0})))}};function Cr(e){if(e&&e.date_histogram)return e.date_histogram.calendar_interval||e.date_histogram.fixed_interval}const Er=({data:e})=>{const[t,a]=Object(l.useState)(!1),n=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.moreThanYear",{defaultMessage:"More than a year"}),i=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.upTo",{defaultMessage:"Up to"});return Object(x.jsx)(Ir,{anchorPosition:"upCenter",button:Object(x.jsx)(kr,{onClick:()=>{a(!t)}},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoHelpText",{defaultMessage:"How it works"})),closePopover:()=>a(!1),isOpen:t,title:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.titleHelp",{defaultMessage:"How auto date histogram works"})},Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBasicExplanation",{defaultMessage:"The auto date histogram splits a data field into buckets by interval."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.autoLongerExplanation",defaultMessage:"To choose the interval, Lens divides the specified time range by the {targetBarSetting} setting. Lens calculates the best interval for your data. For example 30m, 1h, and 12. The maximum number of bars is set by the {maxBarSetting} value.",values:{maxBarSetting:Object(x.jsx)(g.EuiCode,null,_i.UI_SETTINGS.HISTOGRAM_MAX_BARS),targetBarSetting:Object(x.jsx)(g.EuiCode,null,_i.UI_SETTINGS.HISTOGRAM_BAR_TARGET)}})),Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoAdvancedExplanation",{defaultMessage:"The interval follows this logic:"})),Object(x.jsx)(g.EuiBasicTable,{items:_i.search.aggs.boundsDescendingRaw.map((({bound:e,boundLabel:t,intervalLabel:a})=>({bound:"number"==typeof e?n:`${i} ${t}`,interval:a}))),columns:[{field:"bound",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBoundHeader",{defaultMessage:"Target interval measured"})},{field:"interval",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoIntervalHeader",{defaultMessage:"Interval used"})}]}))},Sr=e=>(t,a,n)=>lr(e(t),void 0,a,void 0,n);function Pr(e,t){if(e===P.o.REFERENCELINE)return[u.i18n.translate("xpack.lens.indexPattern.calculations.layerDataType",{defaultMessage:"{name} is disabled for this type of layer.",values:{name:t}})]}function Ar(e,t){if(!e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>"date_histogram"===e.columns[t].operationType)))return[u.i18n.translate("xpack.lens.indexPattern.calculations.dateHistogramErrorMessage",{defaultMessage:"{name} requires a date histogram to work. Add a date histogram or select a different function.",values:{name:t}})]}const Lr=$n()((e=>{const t=new Set;return Object.entries(e.columns).forEach((([a,n])=>{"references"in n&&"managedReference"===Co[n.operationType].input&&(t.add(a),bs(a,e.columns).map((([e])=>{t.add(e)})))})),t}));function Dr(e,t,a){var n,i;const l=null!==(n=Ar(e,a))&&void 0!==n?n:[],s=null!==(i=function(e,t){const a=e.columns[t],n=[];return a.references.forEach(((i,l)=>{if(e.columns[i]){const s=e.columns[i],r=Co[a.operationType];if("fullReference"!==r.input)throw new Error("inconsistent state - column is not a reference operation");fs({validation:r.requiredReferences[l],column:s})||Lr(e).has(t)||n.push(u.i18n.translate("xpack.lens.indexPattern.invalidReferenceConfiguration",{defaultMessage:'Dimension "{dimensionLabel}" is configured incorrectly',values:{dimensionLabel:a.label}}))}else n.push(u.i18n.translate("xpack.lens.indexPattern.missingReferenceError",{defaultMessage:'"{dimensionLabel}" is not fully configured',values:{dimensionLabel:a.label}}))})),n.length?n:void 0}(e,t))&&void 0!==i?i:[];if(l.length||s.length)return[...l,...s]}function Nr(e){return e.fields.some((e=>"date"===e.type))}function zr(e,t,a,n={}){const i=e.columns[t],l=e.columnOrder.filter((t=>e.columns[t].isBucketed)),s=l.findIndex((t=>"date_histogram"===e.columns[t].operationType));return l.splice(s,1),[{type:"function",function:a,arguments:{by:l,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}const Br=Sr((e=>u.i18n.translate("xpack.lens.indexPattern.CounterRateOf",{defaultMessage:"Counter rate of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Vr={type:"counter_rate",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["max"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(Nr(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=a[e.references[0]];return Br(i&&"sourceField"in i?null===(n=t.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,e.timeScale,e.timeShift)},toExpression:(e,t)=>zr(e,t,"lens_counter_rate"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var l;const s=a.columns[e[0]],r=i,o=(null==t?void 0:t.timeScale)||(null==r?void 0:r.timeScale)||"s";return{label:Br(s&&"sourceField"in s?null===(l=n.getFieldByName(s.sourceField))||void 0===l?void 0:l.displayName:void 0,o,null==t?void 0:t.timeShift),dataType:"number",operationType:"counter_rate",isBucketed:!1,scale:"ratio",references:e,timeScale:o,timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:dl(t,i),params:cl(t)}},isTransferable:(e,t)=>Nr(t),getErrorMessage:(e,t)=>ll([Dr(e,t,u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"})),Ai(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"});if(a){const e=Pr(a,i);if(e)return e.join(", ")}return null===(n=Ar(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"mandatory",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.counterRate.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.markdown",{defaultMessage:"\nCalculates the rate of an ever increasing counter. This function will only yield helpful results on counter metric fields which contain a measurement of some kind monotonically growing over time.\nIf the value does get smaller, it will interpret this as a counter reset. To get most precise results, `counter_rate` should be calculated on the `max` of a field.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\nIt uses the current interval when used in Formula.\n\nExample: Visualize the rate of bytes received over time by a memcached server:\n`counter_rate(max(memcached.stats.read.bytes))`\n      "})},shiftable:!0},Rr=Sr((e=>u.i18n.translate("xpack.lens.indexPattern.cumulativeSumOf",{defaultMessage:"Cumulative sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Hr={type:"cumulative_sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["count","sum"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(Nr(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=a[e.references[0]];return Rr(i&&"sourceField"in i?null===(n=t.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,void 0,e.timeShift)},toExpression:(e,t)=>zr(e,t,"cumulative_sum"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var l;const s=a.columns[e[0]];return{label:Rr(s&&"sourceField"in s?null===(l=n.getFieldByName(s.sourceField))||void 0===l?void 0:l.displayName:void 0,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"cumulative_sum",isBucketed:!1,scale:"ratio",timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:dl(t,i),references:e,params:cl(t)}},isTransferable:()=>!0,getErrorMessage:(e,t)=>ll([Dr(e,t,u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"})),Ai(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"});if(a){const e=Pr(a,i);if(e)return e.join(", ")}return null===(n=Ar(t,i))||void 0===n?void 0:n.join(", ")},filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.cumulative_sum.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.markdown",{defaultMessage:"\nCalculates the cumulative sum of a metric over time, adding all previous values of a series to each value. To use this function, you need to configure a date histogram dimension as well.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the received bytes accumulated over time:\n`cumulative_sum(sum(bytes))`\n      "})},shiftable:!0},Gr="differences",qr=Sr((e=>u.i18n.translate("xpack.lens.indexPattern.derivativeOf",{defaultMessage:"Differences of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),$r={type:Gr,priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(Nr(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return qr(null===(n=a[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>zr(e,t,"derivative"),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const l=a.columns[e[0]],s=null!==(i=null==n?void 0:n.timeScale)&&void 0!==i?i:null==t?void 0:t.timeScale;return{label:qr(null==l?void 0:l.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:Gr,isBucketed:!1,scale:"ratio",references:e,timeScale:s,filter:dl(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:cl(t)}},isTransferable:(e,t)=>Nr(t),onOtherColumnChanged:sr,getErrorMessage:(e,t)=>ll([Dr(e,t,u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"})),Ai(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"});if(a){const e=Pr(a,i);if(e)return e.join(", ")}return null===(n=Ar(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.differences.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.differences.documentation.markdown",{defaultMessage:"\nCalculates the difference to the last value of a metric over time. To use this function, you need to configure a date histogram dimension as well.\nDifferences requires the data to be sequential. If your data is empty when using differences, try increasing the date histogram interval.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the change in bytes received over time:\n`differences(sum(bytes))`\n      "})},shiftable:!0},Wr=Sr((e=>u.i18n.translate("xpack.lens.indexPattern.movingAverageOf",{defaultMessage:"Moving average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Ur={type:"moving_average",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"window",type:"number",required:!1,defaultValue:5}],getPossibleOperation:e=>{if(Nr(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return Wr(null===(n=a[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>zr(e,t,"moving_average",{window:[e.columns[t].params.window]}),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const l=a.columns[e[0]],s=null!==(i=null==n?void 0:n.window)&&void 0!==i?i:5;return{label:Wr(null==l?void 0:l.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:"moving_average",isBucketed:!1,scale:"ratio",references:e,timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),filter:dl(t,n),timeScale:null==t?void 0:t.timeScale,params:{window:s,...cl(t)}}},paramEditor:function({layer:e,updateLayer:t,currentColumn:a,columnId:n}){const[i,s]=Object(l.useState)(String(a.params.window));return Object(y.s)((()=>{if(!rl(i,!0,void 0,1))return;const a=parseInt(i,10);t(ts({layer:e,columnId:n,paramName:"window",value:a}))}),{skipFirstRender:!0},256,[i]),Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.movingAverage.window",{defaultMessage:"Window size"}),display:"rowCompressed",fullWidth:!0,isInvalid:!rl(i)},Object(x.jsx)(g.EuiFieldNumber,{compressed:!0,value:i,onChange:e=>s(e.target.value),min:1,step:1,isInvalid:!rl(i)}))},isTransferable:(e,t)=>Nr(t),onOtherColumnChanged:sr,getErrorMessage:(e,t)=>ll([Dr(e,t,u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"})),Ai(e,t)]),getHelpMessage:()=>Object(x.jsx)(Yr,null),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"});if(a){const e=Pr(a,i);if(e)return e.join(", ")}return null===(n=Ar(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.moving_average.signature",{defaultMessage:"metric: number, [window]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.markdown",{defaultMessage:"\nCalculates the moving average of a metric over time, averaging the last n-th values to calculate the current value. To use this function, you need to configure a date histogram dimension as well.\nThe default window value is {defaultValue}.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nTakes a named parameter `window` which specifies how many last values to include in the average calculation for the current value.\n\nExample: Smooth a line of measurements:\n`moving_average(sum(bytes), window=5)`\n      ",values:{defaultValue:5}})},shiftable:!0},Yr=()=>{const[e,t]=Object(l.useState)(!1);return Object(x.jsx)(Ir,{anchorPosition:"upCenter",button:Object(x.jsx)(kr,{onClick:()=>{t(!e)}},u.i18n.translate("xpack.lens.indexPattern.movingAverage.helpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:u.i18n.translate("xpack.lens.indexPattern.movingAverage.titleHelp",{defaultMessage:"How moving average works"})},Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.basicExplanation",defaultMessage:"Moving average slides a window across the data and displays the average value. Moving average is supported only by date histograms."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.longerExplanation",defaultMessage:"To calculate the moving average, Lens uses the mean of the window and applies a skip policy for gaps.  For missing values, the bucket is skipped, and the calculation is performed on the next value."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.tableExplanation",defaultMessage:"For example, given the data [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], you can calculate a simple moving average with a window size of 5:"})),Object(x.jsx)("ul",null,Object(x.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3"),Object(x.jsx)("li",null,"(2 + 3 + 4 + 5 + 6) / 5 = 4"),Object(x.jsx)("li",null,"..."),Object(x.jsx)("li",null,"(5 + 6 + 7 + 8 + 9) / 5 = 7")),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowLimitations",defaultMessage:"The window does not include the current value."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowInitialPartial",defaultMessage:"The window is partial until it reaches the requested number of items.  For example, with a window size of 5:"})),Object(x.jsx)("ul",null,Object(x.jsx)("li",null,"(1 + 2) / 2 = 1.5"),Object(x.jsx)("li",null,"(1 + 2 + 3) / 3 = 2"),Object(x.jsx)("li",null,"(1 + 2 + 3 + 4) / 4 = 2.5"),Object(x.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3")),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.limitations",defaultMessage:"The first moving average value starts at the second item."})))};function Kr({type:e,displayName:t,ofName:a,description:n,metric:i}){return{type:e,priority:1,displayName:t,input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,n)=>{var i;const l=n[e.references[0]];return a(l&&"sourceField"in l?null===(i=t.getFieldByName(l.sourceField))||void 0===i?void 0:i.displayName:void 0)},toExpression:(e,t)=>function(e,t,a,n={}){const i=e.columns[t],l=e.columnOrder.filter((t=>e.columns[t].isBucketed)),s=l.filter((t=>"date_histogram"!==e.columns[t].operationType&&"range"!==e.columns[t].operationType));return[{type:"function",function:a,arguments:{by:s.length===l.length?[]:s,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}(e,t,"overall_metric",{metric:[i]}),buildColumn:({referenceIds:e,previousColumn:t,layer:n,indexPattern:l},s)=>{var r;const o=n.columns[e[0]];return{label:a(o&&"sourceField"in o?null===(r=l.getFieldByName(o.sourceField))||void 0===r?void 0:r.displayName:void 0),dataType:"number",operationType:`overall_${i}`,isBucketed:!1,scale:"ratio",references:e,params:cl(t)}},isTransferable:()=>!0,filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.overall_metric",{defaultMessage:"metric: number"}),description:n}}}const Xr=Kr({type:"overall_sum",displayName:u.i18n.translate("xpack.lens.indexPattern.overallSum",{defaultMessage:"Overall sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallSumOf",{defaultMessage:"Overall sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"sum",description:u.i18n.translate("xpack.lens.indexPattern.overall_sum.documentation.markdown",{defaultMessage:"\nCalculates the sum of a metric of all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_sum` is calculating the sum over all dimensions no matter the used function.\n\nExample: Percentage of total\n`sum(bytes) / overall_sum(sum(bytes))`\n      "})}),Zr=Kr({type:"overall_min",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMin",{defaultMessage:"Overall min"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMinOf",{defaultMessage:"Overall min of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"min",description:u.i18n.translate("xpack.lens.indexPattern.overall_min.documentation.markdown",{defaultMessage:"\nCalculates the minimum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_min` is calculating the minimum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes)) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Qr=Kr({type:"overall_max",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMaxOf",{defaultMessage:"Overall max of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"max",description:u.i18n.translate("xpack.lens.indexPattern.overall_max.documentation.markdown",{defaultMessage:"\nCalculates the maximum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_max` is calculating the maximum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes))) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Jr=Kr({type:"overall_average",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallAverageOf",{defaultMessage:"Overall average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"average",description:u.i18n.translate("xpack.lens.indexPattern.overall_average.documentation.markdown",{defaultMessage:"\nCalculates the average of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_average` is calculating the average over all dimensions no matter the used function\n\nExample: Divergence from the mean:\n`sum(bytes) - overall_average(sum(bytes))`\n      "})}),eo={type:"normalize_by_unit",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"}),input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"unit",type:"string",required:!0}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,a)=>"normalize_by_unit",toExpression:(e,t)=>{const a=e.columns[t];return[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:[e.columnOrder.filter((t=>e.columns[t].isBucketed)).find((t=>"date_histogram"===e.columns[t].operationType))],inputColumnId:[a.references[0]],outputColumnId:[t],outputColumnName:[a.label],targetUnit:[a.params.unit]}}]},buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>({label:"Normalize by unit",dataType:"number",operationType:"normalize_by_unit",isBucketed:!1,scale:"ratio",references:e,params:{...cl(t),unit:null==i?void 0:i.unit}}),isTransferable:()=>!0,getErrorMessage:(e,t)=>ll([Dr(e,t,u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"})),Ai(e,t),e.columns[t].params.unit?[]:[u.i18n.translate("xpack.lens.indexPattern.timeScale.missingUnit",{defaultMessage:"No unit specified for normalize by unit."})],-1===["s","m","h","d"].indexOf(e.columns[t].params.unit||"s")?[u.i18n.translate("xpack.lens.indexPattern.timeScale.wrongUnit",{defaultMessage:"Unknown unit specified, use s,m,h or d."})]:[]]),filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.time_scale",{defaultMessage:"metric: number, unit: s|m|h|d|w|M|y"}),description:u.i18n.translate("xpack.lens.indexPattern.time_scale.documentation.markdown",{defaultMessage:"\n\nThis advanced function is useful for normalizing counts and sums to a specific time interval. It allows for integration with metrics that are stored already normalized to a specific time interval.\n\nThis function can only be used if there's a date histogram function used in the current chart.\n\nExample: A ratio comparing an already normalized metric to another metric that needs to be normalized.\n`normalize_by_unit(counter_rate(max(system.diskio.write.bytes)), unit='s') / last_value(apache.status.bytes_per_second)`\n      "})}},to=u.i18n.translate("xpack.lens.indexPattern.countOf",{defaultMessage:"Count of records"}),ao={type:"count",priority:2,displayName:u.i18n.translate("xpack.lens.indexPattern.count",{defaultMessage:"Count"}),input:"field",getErrorMessage:(e,t,a)=>ll([il(e.columns[t],a),Ai(e,t)]),onFieldChange:(e,t)=>({...e,label:lr(t.displayName,void 0,e.timeScale,void 0,e.timeShift),sourceField:t.name}),getPossibleOperationForField:e=>{if("document"===e.type)return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:e=>lr(to,void 0,e.timeScale,void 0,e.timeShift),buildColumn({field:e,previousColumn:t},a){var n;return{label:lr(to,void 0,null==t?void 0:t.timeScale,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"count",isBucketed:!1,scale:"ratio",sourceField:e.name,timeScale:null==t?void 0:t.timeScale,filter:dl(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),params:{...cl(t),emptyAsNull:t&&ol("count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,updateLayer:n})=>{var i;return[{dataTestSubj:"hide-zero-values",optionElement:Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"}),labelProps:{style:{fontWeight:R.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(ts({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})),title:"",showInPopover:!0,inlineElement:null,onClick:()=>{}}]},onOtherColumnChanged:(e,t,a)=>sr(e,t),toEsAggsFn:(e,t)=>{var a;return Object(ue.buildExpressionFunction)("aggCount",{id:t,enabled:!0,schema:"metric",timeShift:e.filter?void 0:e.timeShift,emptyAsNull:null===(a=e.params)||void 0===a?void 0:a.emptyAsNull}).toAst()},isTransferable:()=>!0,timeScalingMode:"optional",filterable:!0,documentation:{section:"elasticsearch",signature:"",description:u.i18n.translate("xpack.lens.indexPattern.count.documentation.markdown",{defaultMessage:"\nCalculates the number of documents.\n\nExample: Calculate the number of documents:\n`count()`\n\nExample: Calculate the number of documents matching a certain filter:\n`count(kql='price > 500')`\n      "})},shiftable:!0},no=u.i18n.translate("xpack.lens.indexPattern.staticValueLabelDefault",{defaultMessage:"Static value"});function io(e){return function(e){return null==e||""===e}(e)?no:u.i18n.translate("xpack.lens.indexPattern.staticValueLabelWithValue",{defaultMessage:"Static value: {value}",values:{value:e}})}const lo={type:"static_value",displayName:no,getDefaultLabel:e=>io(e.params.value),input:"managedReference",hidden:!0,getDisabledStatus(e){},getErrorMessage(e,t){const a=e.columns[t];return null==a.params.value||rl(a.params.value)?void 0:[u.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:a.params.value}})]},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio",isStaticValue:!0}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,l=n.label!==no,s=rl(i.value)?l?n.label:null!==(a=null==i?void 0:i.value)&&void 0!==a?a:no:no;return[{type:"function",function:rl(i.value)?"mathColumn":"mapColumn",arguments:{id:[t],name:[s||no],expression:[String(rl(i.value)?i.value:100)]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){var l,s;const r={value:e&&(s=e,Boolean("params"in s&&s.params&&"value"in s.params))&&rl(e.params.value)?e.params.value:void 0,...cl(e),...n};return{label:io(r.value),dataType:"number",operationType:"static_value",isStaticValue:!0,isBucketed:!1,scale:"ratio",params:{...r,value:String(null!==(l=r.value)&&void 0!==l?l:100)},references:[]}},isTransferable:e=>!0,createCopy(e,t,a,n,i){const l=e.columns[t];return{...e,columns:{...e.columns,[a]:{...l}}}},paramEditor:function({updateLayer:e,currentColumn:t,columnId:a,activeData:n,layerId:i,paramEditorCustomProps:s}){var r,o,u,c;const d=Object(l.useCallback)((n=>{t.params.value!==n&&e((e=>{const t=e.columns[a];return{...e,columns:{...e.columns,[a]:{...t,label:null!=t&&t.customLabel?t.label:io(n),params:{...t.params,value:n}}}}}))}),[a,e,null==t||null===(r=t.params)||void 0===r?void 0:r.value]),p=1===(null==n||null===(o=n[i])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)&&n[i].rows[0][a],m="static_value"!==(null==t?void 0:t.operationType)&&null!=p?p:String(100),{inputValue:f,handleInputChange:b}=Object(y.t)({value:(null==t||null===(c=t.params)||void 0===c?void 0:c.value)||m,onChange:d},{allowFalsyValue:!0}),h=Object(l.useCallback)((e=>{const t=e.currentTarget.value;b(rl(t)?t:void 0)}),[b]);return Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(x.jsx)(g.EuiFormLabel,null,(null==s?void 0:s.label)||no),Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(g.EuiFieldNumber,{"data-test-subj":"lns-indexPattern-static_value-input",compressed:!0,value:null!=f?f:"",onChange:h,step:"any"}))}};function so(e,t){return lr(u.i18n.translate("xpack.lens.indexPattern.lastValueOf",{defaultMessage:"Last value of {name}",values:{name:e}}),void 0,void 0,void 0,t)}const ro=new Set(["string","boolean","number","ip","date","ip_range","number_range","date_range"]);function oo(e,t){if(!t)return;const a=t.getFieldByName(e);return a?"date"!==a.type?u.i18n.translate("xpack.lens.indexPattern.lastValue.invalidTypeSortField",{defaultMessage:"Field {invalidField} is not a date field and cannot be used for sorting",values:{invalidField:e}}):void 0:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldNotFound",{defaultMessage:"Field {invalidField} was not found",values:{invalidField:e}})}function uo(e){return e.timeFieldName&&e.fields.find((t=>t.name===e.timeFieldName&&"date"===t.type))}function co(e){const t=e.fields.filter((e=>"date"===e.type));return uo(e)&&t.sort((({name:t},{name:a})=>t===e.timeFieldName?-1:a===e.timeFieldName?1:0)),t}function po(e){return{query:`${e}: *`,language:"kuery"}}const mo={type:"last_value",displayName:u.i18n.translate("xpack.lens.indexPattern.lastValue",{defaultMessage:"Last value"}),getDefaultLabel:(e,t)=>so(sl(e.sourceField,t),e.timeShift),input:"field",onFieldChange:(e,t)=>{const a={...e.params};return a.showArrayValues=Bl(t)||e.params.showArrayValues,"format"in a&&"number"!==t.type&&delete a.format,{...e,dataType:t.type,label:so(t.displayName,e.timeShift),sourceField:t.name,params:a,scale:"string"===t.type?"ordinal":"ratio",filter:e.filter&&Object(Me.isEqual)(e.filter,po(e.sourceField))?po(t.name):e.filter}},getPossibleOperationForField:({aggregationRestrictions:e,type:t})=>{if(ro.has(t)&&!e)return{dataType:t,isBucketed:!1,scale:"string"===t?"ordinal":"ratio"}},getDisabledStatus(e){if(!e||!co(e).length)return u.i18n.translate("xpack.lens.indexPattern.lastValue.disabled",{defaultMessage:"This function requires the presence of a date field in your data view"})},getErrorMessage(e,t,a){const n=e.columns[t];let i=[];const l=il(n,a),s=oo(n.params.sortField,a);return l&&(i=[...l]),s&&(i=[s]),i.push(...Ai(e,t)||[]),i.length?i:void 0},buildColumn({field:e,previousColumn:t,indexPattern:a},n){var i;const l=n,s=uo(a)?a.timeFieldName:null===(i=a.fields.find((e=>"date"===e.type)))||void 0===i?void 0:i.name;if(!s)throw new Error(u.i18n.translate("xpack.lens.functions.lastValue.missingSortField",{defaultMessage:"This data view does not contain any date fields"}));const r=Bl(e)||(null==l?void 0:l.showArrayValues);return{label:so(e.displayName,null==t?void 0:t.timeShift),dataType:e.type,operationType:"last_value",isBucketed:!1,scale:"string"===e.type?"ordinal":"ratio",sourceField:e.name,filter:dl(t,n)||po(e.name),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:{showArrayValues:r,sortField:(null==l?void 0:l.sortField)||s,...cl(t)}}},filterable:!0,shiftable:!0,toEsAggsFn:(e,t,a)=>{const n={id:t,enabled:!0,schema:"metric",field:e.sourceField,size:1,sortOrder:"desc",sortField:e.params.sortField,timeShift:e.filter?void 0:e.timeShift};return(e.params.showArrayValues?Object(ue.buildExpressionFunction)("aggTopHit",{...n,aggregate:"concat"}):Object(ue.buildExpressionFunction)("aggTopMetrics",n)).toAst()},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField),n=t.getFieldByName(e.params.sortField);return Boolean(a&&a.type===e.dataType&&!a.aggregationRestrictions&&"date"===(null==n?void 0:n.type)&&ro.has(a.type))},paramEditor:({layer:e,updateLayer:t,columnId:a,currentColumn:n,indexPattern:i})=>{var l,r;const o=co(i),c=!!oo(n.params.sortField,i),d=Object.keys(e.columns).some((t=>"terms"===e.columns[t].operationType));return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),display:"rowCompressed",fullWidth:!0,error:u.i18n.translate("xpack.lens.indexPattern.sortField.invalid",{defaultMessage:"Invalid field. Check your data view or pick another field."}),isInvalid:c},Object(x.jsx)(g.EuiComboBox,{placeholder:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldPlaceholder",{defaultMessage:"Sort field"}),compressed:!0,isClearable:!1,"data-test-subj":"lns-indexPattern-lastValue-sortField",isInvalid:c,singleSelection:{asPlainText:!0},"aria-label":u.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),options:null==o?void 0:o.map((e=>({value:e.name,label:e.displayName}))),onChange:n=>{0!==n.length&&t(ts({layer:e,columnId:a,paramName:"sortField",value:n[0].value}))},selectedOptions:null!==(l=n.params)&&void 0!==l&&l.sortField?[{label:(null===(r=i.getFieldByName(n.params.sortField))||void 0===r?void 0:r.displayName)||n.params.sortField,value:n.params.sortField}]:[]})),Object(x.jsx)(g.EuiFormRow,{error:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesWithTopValuesWarning",{defaultMessage:"When you show array values, you are unable to use this field to rank Top values."}),isInvalid:n.params.showArrayValues&&d,display:"rowCompressed",fullWidth:!0,"data-test-subj":"lns-indexPattern-lastValue-showArrayValues"},Object(x.jsx)(g.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesExplanation",{defaultMessage:"Displays all values associated with this field in each last document."}),position:"left"},Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValues",{defaultMessage:"Show array values"}),compressed:!0,checked:Boolean(n.params.showArrayValues),disabled:Bl(n.sourceField,i),onChange:()=>(n=>{let i=ts({layer:e,columnId:a,paramName:"showArrayValues",value:n});i={...i,columns:as(i,a)},t(i)})(!n.params.showArrayValues)}))))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.lastValue.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.markdown",{defaultMessage:"\nReturns the value of a field from the last document, ordered by the default time field of the data view.\n\nThis function is usefull the retrieve the latest state of an entity.\n\nExample: Get the current status of server A:\n`last_value(server.status, kql='server.name=\"A\"')`\n      "})}};a(312);const go="auto",fo="range",bo="histogram",ho=Object(g.htmlIdGenerator)(),xo=(e,t)=>e.label||t.convert({gte:rl(e.from)?e.from:-1/0,lt:rl(e.to)?e.to:1/0}),vo=({range:e,setRange:t,button:a,triggerClose:n,isOpen:i})=>{const[r,o]=Object(l.useState)(e),c=s.a.useRef(),d=s.a.useRef(),p=(a,n=!1)=>{n&&o(e),t(a)},{from:m,to:f,label:b}=r,h=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualAppend",{defaultMessage:""}),v=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualTooltip",{defaultMessage:"Less than or equal to"}),y=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanPrepend",{defaultMessage:"<"}),j=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanTooltip",{defaultMessage:"Less than"});return Object(x.jsx)(g.EuiPopover,{display:"block",ownFocus:!0,isOpen:i,closePopover:()=>n(),button:a,"data-test-subj":"indexPattern-ranges-popover"},Object(x.jsx)(g.EuiFormRow,null,Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:rl(m)?Number(m):"",onChange:({target:e})=>{const t={...r,from:""!==e.value?Number(e.value):-1/0};o(t),p(t)},append:Object(x.jsx)(g.EuiToolTip,{content:v},Object(x.jsx)(g.EuiText,{size:"s"},h)),onKeyDown:({key:e})=>{g.keys.ENTER===e&&d.current&&d.current.focus()},compressed:!0,placeholder:"",isInvalid:!Fo(r),step:1})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiIcon,{type:"sortRight",color:"subdued"})),Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:rl(f)?Number(f):"",inputRef:e=>{d&&e&&(d.current=e)},onChange:({target:e})=>{const t={...r,to:""!==e.value?Number(e.value):1/0};o(t),p(t)},prepend:Object(x.jsx)(g.EuiToolTip,{content:j},Object(x.jsx)(g.EuiText,{size:"s"},y)),compressed:!0,placeholder:"+",isInvalid:!Fo(r),onKeyDown:({key:e})=>{g.keys.ENTER===e&&c.current&&c.current.focus()},step:1})))),Object(x.jsx)(g.EuiFormRow,null,Object(x.jsx)(fl,{inputRef:c,value:b||"",onChange:e=>{const t={...r,label:e};o(t),p(t)},placeholder:u.i18n.translate("xpack.lens.indexPattern.ranges.customRangeLabelPlaceholder",{defaultMessage:"Custom label"}),onSubmit:()=>{n()},compressed:!0,dataTestSubj:"indexPattern-ranges-label"})))},yo=({ranges:e,setRanges:t,onToggleEditor:a,formatter:n})=>{const[i,r]=Object(l.useState)(""),[o,c]=Object(l.useState)((()=>e.map((e=>({...e,id:ho()})))));Object(y.s)((()=>{t(o.map((({id:e,...t})=>({...t}))))}),{skipFirstRender:!0},256,[o]);const d=e=>{let t=e;i===e&&(t=""),r(t)};return Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.ranges.customRanges",{defaultMessage:"Ranges"}),labelAppend:Object(x.jsx)(g.EuiText,{size:"xs"},Object(x.jsx)(g.EuiLink,{color:"danger",onClick:a},Object(x.jsx)(g.EuiIcon,{size:"s",type:"cross",color:"danger"})," ",u.i18n.translate("xpack.lens.indexPattern.ranges.customRangesRemoval",{defaultMessage:"Remove custom ranges"})))},Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(vl,{onDragEnd:c,onDragStart:()=>{},droppableId:"RANGES_DROPPABLE_AREA",items:o},o.map(((e,t)=>Object(x.jsx)(xl,{key:e.id,idx:t,id:e.id,isInvalid:!Fo(e),invalidMessage:u.i18n.translate("xpack.lens.indexPattern.range.isInvalid",{defaultMessage:"This range is invalid"}),onRemoveClick:()=>{const e=o.filter(((e,a)=>a!==t));c(e)},removeTitle:u.i18n.translate("xpack.lens.indexPattern.ranges.deleteRange",{defaultMessage:"Delete range"}),isNotRemovable:1===o.length},Object(x.jsx)(vo,{range:e,isOpen:e.id===i,triggerClose:()=>d(""),setRange:e=>{const a=[...o];e.id===a[t].id?a[t]=e:a.push(e),c(a)},button:Object(x.jsx)(g.EuiLink,{color:"text",onClick:()=>d(e.id),className:"lnsRangesOperation__popoverButton","data-test-subj":"indexPattern-ranges-popover-trigger"},Object(x.jsx)(g.EuiText,{size:"s",textAlign:"left",color:Fo(e)?"default":"danger"},xo(e,n)))}))))),Object(x.jsx)(bl,{onClick:()=>{(()=>{const e=ho();c([...o,{id:e,from:o[o.length-1].to,to:1/0,label:""}]),r(e)})()},label:u.i18n.translate("xpack.lens.indexPattern.ranges.addRange",{defaultMessage:"Add range"})})))},jo=()=>{const[e,t]=Object(l.useState)(!1);return Object(x.jsx)(Ir,{anchorPosition:"upCenter",button:Object(x.jsx)(kr,{onClick:()=>{t(!e)}},u.i18n.translate("xpack.lens.indexPattern.ranges.granularityHelpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverTitle",{defaultMessage:"How granularity interval works"})},Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverBasicExplanation",{defaultMessage:"Interval granularity divides the field into evenly spaced intervals based on the minimum and maximum values for the field."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ranges.granularityPopoverExplanation",defaultMessage:'The size of the interval is a "nice" value. When the granularity of the slider changes, the interval stays the same when the nice interval is the same. The minimum granularity is 1, and the maximum value is {setting}. To change the maximum granularity, go to Advanced settings.',values:{setting:Object(x.jsx)(g.EuiCode,null,_i.UI_SETTINGS.HISTOGRAM_MAX_BARS)}})),Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverAdvancedExplanation",{defaultMessage:"Intervals are incremented by 10, 5 or 2. For example, an interval can be 100 or 0.2 ."})))},Oo=({maxBars:e,step:t,maxHistogramBars:a,onToggleEditor:n,onMaxBarsChange:i,includeEmptyRows:r,onChangeIncludeEmptyRows:o})=>{const[c,d]=Object(l.useState)(String(e));Object(y.s)((()=>{i(Number(c))}),{skipFirstRender:!0},256,[c]);const p=u.i18n.translate("xpack.lens.indexPattern.ranges.granularity",{defaultMessage:"Intervals granularity"}),m=u.i18n.translate("xpack.lens.indexPattern.ranges.decreaseButtonLabel",{defaultMessage:"Decrease granularity"}),f=u.i18n.translate("xpack.lens.indexPattern.ranges.increaseButtonLabel",{defaultMessage:"Increase granularity"});return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{label:p,"data-test-subj":"indexPattern-ranges-section-label",labelType:"legend",fullWidth:!0,display:"rowCompressed",labelAppend:Object(x.jsx)(jo,null)},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiToolTip,{content:m,delay:"long"},Object(x.jsx)(g.EuiButtonIcon,{iconType:"minusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-minus",onClick:()=>d(""+Math.max(Number(c)-t,1)),"aria-label":m}))),Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiRange,{compressed:!0,fullWidth:!0,"aria-label":p,"data-test-subj":"lns-indexPattern-range-maxBars-field",min:1,max:a,step:t,value:c,onChange:({currentTarget:e})=>d(e.value)})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiToolTip,{content:f,delay:"long"},Object(x.jsx)(g.EuiButtonIcon,{iconType:"plusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-plus",onClick:()=>d(""+Math.min(Number(c)+t,a)),"aria-label":f}))))),Object(x.jsx)(g.EuiButtonEmpty,{size:"xs",iconType:"controlsHorizontal",onClick:()=>n()},u.i18n.translate("xpack.lens.indexPattern.ranges.customIntervalsToggle",{defaultMessage:"Create custom ranges"})),Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.indexPattern.ranges.includeEmptyRows",{defaultMessage:"Include empty rows"}),checked:Boolean(r),onChange:()=>{o(!r)},compressed:!0})))},ko=({setParam:e,params:t,maxHistogramBars:a,maxBars:n,granularityStep:i,onChangeMode:s,rangeFormatter:r})=>{const[o,u]=Object(l.useState)(t.type===fo);return o?Object(x.jsx)(yo,{ranges:t.ranges,setRanges:t=>{e("ranges",t)},onToggleEditor:()=>{s(bo),u(!1)},formatter:r}):Object(x.jsx)(Oo,{includeEmptyRows:t.includeEmptyRows,maxBars:n,step:i,maxHistogramBars:a,onMaxBarsChange:t=>{e("maxBars",t)},onChangeIncludeEmptyRows:t=>{e("includeEmptyRows",t)},onToggleEditor:()=>{s(fo),u(!0)}})};var Io=a(102);const To=e=>rl(e.from)&&rl(e.to),Fo=e=>!To(e)||(e=>e.from<=e.to)(e);function Mo(e,t){if(t&&e.fieldFormatMap&&e.fieldFormatMap[t.name])return e.fieldFormatMap[t.name]}const wo=[_l,Ks,_r,xr,vr,yr,dr,jr,Or,gr,mo,ao,{type:"range",displayName:u.i18n.translate("xpack.lens.indexPattern.intervals",{defaultMessage:"Intervals"}),priority:4,input:"field",getErrorMessage:(e,t,a)=>il(e.columns[t],a),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if("number"===a&&t&&(!e||e.range))return{dataType:"number",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>{var a,n;return null!==(a=null===(n=t.getFieldByName(e.sourceField))||void 0===n?void 0:n.displayName)&&void 0!==a?a:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})},buildColumn:({field:e})=>({label:e.displayName,dataType:"number",operationType:"range",sourceField:e.name,isBucketed:!0,scale:"interval",params:{includeEmptyRows:!0,type:bo,ranges:[{from:0,to:1e3,label:""}],maxBars:go,format:void 0,parentFormat:void 0}}),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"number"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.range))},onFieldChange:(e,t)=>({...e,label:t.name,sourceField:t.name}),toEsAggsFn:(e,t,a,n,i)=>{const{sourceField:l,params:s}=e;if(s.type===fo)return Object(ue.buildExpressionFunction)("aggRange",{id:t,enabled:!0,schema:"segment",field:l,ranges:s.ranges.filter(Fo).map((e=>{if(To(e))return e;const t={label:e.label};return rl(e.from)&&(t.from=Number(e.from)),rl(e.to)&&(t.to=Number(e.to)),t})).map(ii.numericalRangeToAst)}).toAst();const r=(i.get(_i.UI_SETTINGS.HISTOGRAM_MAX_BARS)-1)/2;return Object(ue.buildExpressionFunction)("aggHistogram",{id:t,enabled:!0,schema:"segment",field:l,maxBars:s.maxBars===go?r:s.maxBars,interval:"auto",has_extended_bounds:!1,min_doc_count:Boolean(s.includeEmptyRows),autoExtendBounds:Boolean(s.includeEmptyRows),extended_bounds:Object(ii.extendedBoundsToAst)({})}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,updateLayer:n,indexPattern:i,uiSettings:l,data:s})=>{var r,o;const u=i.getFieldByName(a.sourceField),c=a.params.format,d=c&&Io.a[c.id]&&Io.a[c.id].decimalsToPattern((null===(r=c.params)||void 0===r?void 0:r.decimals)||0),p=s.fieldFormats.deserialize({...a.params.parentFormat||{id:"range"},params:{...null===(o=a.params.parentFormat)||void 0===o?void 0:o.params,...c?{id:c.id,params:{pattern:d}}:Mo(i,u)}}),m=l.get(_i.UI_SETTINGS.HISTOGRAM_MAX_BARS),g=(m-1)/6,f=(m-1)/2;return Object(x.jsx)(ko,{setParam:(a,i)=>{n(ts({layer:e,columnId:t,paramName:a,value:i}))},maxBars:a.params.maxBars===go?f:a.params.maxBars,granularityStep:g,params:a.params,onChangeMode:i=>{const l=i===fo?"ordinal":"interval",s=i===fo?"string":"number",r=i===fo?{id:"range",params:{template:"arrow_right",replaceInfinity:!0}}:void 0;n({...e,columns:{...e.columns,[t]:{...a,scale:l,dataType:s,params:{type:i,ranges:[{from:0,to:1e3,label:""}],maxBars:f,format:a.params.format,parentFormat:r}}}})},maxHistogramBars:l.get(_i.UI_SETTINGS.HISTOGRAM_MAX_BARS),rangeFormatter:p})}},Hr,Vr,$r,Ur,Ui,gl,Xr,Zr,Qr,Jr,lo,eo],_o=wo,Co=wo.reduce(((e,t)=>({...e,[t.type]:t})),{}),Eo={avg:"average",cardinality:"unique_count"};function So(){const e={};return _o.forEach((({type:t,displayName:a})=>{e[t]={type:t,displayName:a}})),e}function Po(e,t){return(t.priority||Number.NEGATIVE_INFINITY)-(e.priority||Number.NEGATIVE_INFINITY)}function Ao(e){var t,a,n;return al(e)?null!==(t=null===(a=Co[e.operationType])||void 0===a||null===(n=a.getCurrentFields)||void 0===n?void 0:n.call(a,e))&&void 0!==t?t:[e.sourceField]:[]}function Lo(e){var t;return null===(t=Co[e])||void 0===t?void 0:t.getParamsForMultipleFields}function Do(e,t,a,n){var i,l;return Boolean(null===(i=Co[t.operationType])||void 0===i||null===(l=i.canAddNewField)||void 0===l?void 0:l.call(i,{targetColumn:t,sourceColumn:a,field:n,indexPattern:e}))}function No(e,t){return _o.filter((a=>{if("field"!==a.input)return!1;const n=a.getPossibleOperationForField(e);return t?n&&t(n):n})).sort(Po).map((({type:e})=>e))}const zo=Object(Me.memoize)((function(e,t){const a={},n=(e,t)=>{if(!t)return;const n=JSON.stringify(t);a[n]?a[n].operations.push(e):a[n]={operationMetaData:t,operations:[e]}};return(t?Object.values(t):_o).sort(Po).forEach((t=>{if("field"===t.input)e.fields.forEach((e=>{n({type:"field",operationType:t.type,field:e.name},t.getPossibleOperationForField(e))}));else if("none"===t.input)n({type:"none",operationType:t.type},t.getPossibleOperation());else if("fullReference"===t.input){const a=t.getPossibleOperation(e);a&&n({type:"fullReference",operationType:t.type},a)}else if("managedReference"===t.input){const e=t.getPossibleOperation();e&&n({type:"managedReference",operationType:t.type},e)}})),Object.values(a)}));var Bo=a(54),Vo=a(103);function Ro(e){const t=e.fields.filter((e=>!(Object(Bo.isNestedField)(e)||!e.aggregatable&&!e.scripted))).map((t=>{const a={name:t.name,displayName:t.displayName,type:t.type,aggregatable:t.aggregatable,searchable:t.searchable,meta:e.metaFields.includes(t.name),esTypes:t.esTypes,scripted:t.scripted,runtime:Boolean(t.runtimeField)};return a.scripted?{...a,lang:t.lang,script:t.script}:a})).concat(Ki),{typeMeta:a,title:n,timeFieldName:i,fieldFormatMap:l}=e;if(null!=a&&a.aggs){const e=Object.keys(a.aggs);t.forEach(((n,i)=>{const l={};e.forEach((e=>{const t=a.aggs&&a.aggs[e]&&a.aggs[e][n.name];t&&(l[function(e){return e in Eo?Eo[e]:e}(e)]=t)})),Object.keys(l).length&&(t[i]={...n,aggregationRestrictions:l})}))}return{id:e.id,title:n,timeFieldName:i,fieldFormatMap:l&&Object.fromEntries(Object.entries(l).map((([e,t])=>[e,"toJSON"in t?t.toJSON():t]))),fields:t,getFieldByName:Ss(t),hasRestrictions:!(null==a||!a.aggs)}}async function Ho({indexPatternsService:e,patterns:t,notUsedPatterns:a,cache:n}){const i=t.filter((e=>!n[e]));if(0===i.length)return n;zo.cache.clear&&zo.cache.clear();let l=(await Promise.allSettled(i.map((t=>e.get(t))))).filter((e=>"fulfilled"===e.status)).map((e=>e.value));for(let t=0;a&&t<(null==a?void 0:a.length)&&!l.length;t++){const n=await e.get(a[t]).catch((e=>{}));n&&(l=[n])}return l.reduce(((e,t)=>({[t.id]:Ro(t),...e})),{...n})}const Go=(e,t)=>{Object(Vo.b)(e,"indexPatternId",t)},qo="indexpattern-datasource-current-indexpattern";function $o(e){return`indexpattern-datasource-layer-${e}`}function Wo(e,t){const a={};return Object.entries(e.layers).forEach((([e,n])=>{a[e]={...n,indexPatternId:t.find((({name:t})=>t===$o(e))).id}})),{currentIndexPatternId:t.find((({name:e})=>e===qo)).id,layers:a}}function Uo(e){return e.reduce(((e,t)=>(e[t]=!0,e)),{})}function Yo(e){const t=Object.values(e);return 1===t.length&&0===t[0].columnOrder.length}function Ko({state:e,layerId:t,newLayer:a}){return{...e,layers:{...e.layers,[t]:{...e.layers[t],...a}}}}function Xo(e,t,a){var n;const i=e.columns[t];if(!i||!a)return;const l=i.operationType&&Co[i.operationType],s="references"in i&&Boolean(function(e,t,a){var n;return null===(n=t.references)||void 0===n?void 0:n.map((t=>{var n,i;const l=null===(n=e.columns[t])||void 0===n?void 0:n.operationType,s=Co[l];return null==s||null===(i=s.getErrorMessage)||void 0===i?void 0:i.call(s,e,t,a,Co)}))}(e,i,a).filter(Boolean).length),r=l&&(null===(n=l.getErrorMessage)||void 0===n?void 0:n.call(l,e,t,a,Co)),o=!!i.filter&&!wl(i.filter,a);return r&&r.length>0||s||o}function Zo(e,{activeData:t},a,n){const i=[];return e&&t&&Object.entries(t).reduce(((e,[t,{columns:a}])=>[...e,...a.map((e=>({layerId:t,column:e})))]),[]).forEach((({layerId:t,column:l})=>{const r=e.layers[t],o=null==r?void 0:r.columns[l.id];if(r&&o&&Object(ii.checkColumnForPrecisionError)(l)){const d=e.indexPatterns[r.indexPatternId],p=ol("terms",o)&&"column"===o.params.orderBy.type&&"asc"===o.params.orderDirection&&ol("count",r.columns[o.params.orderBy.columnId]),m=ol("terms",o)&&!qs(d.getFieldByName(o.sourceField)),f=ol("terms",o)&&(o.params.secondaryFields||[]).length>0;!p||m||f?i.push(Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning",defaultMessage:"{name} for this visualization may be approximate due to how the data is indexed. Try increasing the number of {topValues} or use {filters} instead of {topValues} for precise results. To learn more about this limit, {link}.",values:{name:Object(x.jsx)(g.EuiTextColor,{color:"accent"},l.name),topValues:Object(x.jsx)(g.EuiTextColor,{color:"subdued"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.topValues",defaultMessage:"Top values"})),filters:Object(x.jsx)(g.EuiTextColor,{color:"subdued"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.filters",defaultMessage:"Filters"})),link:Object(x.jsx)(g.EuiLink,{href:a.links.aggs.terms_doc_count_error,color:"text",target:"_blank",external:!0},Object(x.jsx)(c.FormattedMessage,{defaultMessage:"visit the documentation",id:"xpack.lens.indexPattern.precisionErrorWarning.link"}))}})):i.push(Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning",defaultMessage:"{name} for this visualization may be approximate due to how the data is indexed. Try sorting by rarity instead of ascending count of records. To learn more about this limit, {link}.",values:{name:Object(x.jsx)(g.EuiTextColor,{color:"accent"},l.name),link:Object(x.jsx)(g.EuiLink,{href:a.links.aggs.rare_terms,color:"text",target:"_blank",external:!0},Object(x.jsx)(c.FormattedMessage,{defaultMessage:"visit the documentation",id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning.link"}))}}),Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(g.EuiButton,{onClick:()=>{n((e=>Ko({state:e,layerId:t,newLayer:ms(ts({layer:r,columnId:l.id,paramName:"orderBy",value:{type:"rare",maxDocCount:1}}),d)})))}},u.i18n.translate("xpack.lens.indexPattern.switchToRare",{defaultMessage:"Rank by rarity"}))))}})),i}function Qo(e){return null==e?void 0:e.map((({input:e})=>e)).filter((({query:e})=>(null==e?void 0:e.trim())&&"*"!==e))}function Jo(e){return e.params.ranges.map((({from:t,to:a})=>{let n="";return null!=t&&isFinite(t)&&(n+=`${e.sourceField} >= ${t}`),null!=a&&isFinite(a)&&(n.length&&(n+=" AND "),n+=`${e.sourceField} <= ${a}`),{query:n,language:"kuery"}})).filter((({query:e})=>null==e?void 0:e.trim()))}function eu(e,t,a){const n=[e.sourceField].concat(e.params.secondaryFields||[]).filter(Boolean),i=a.rows.map((({[t]:a})=>{if(null!=a)return"string"!=typeof a&&Array.isArray(a.keys)?a.keys.map(((e,t)=>`${n[t]}: "${""===e?Object(Me.escape)(e):e}"`)).join(" AND "):`${e.sourceField}: "${""===a?Object(Me.escape)(a):a}"`})).filter(Boolean);return[...new Set(i)].map((e=>({language:"kuery",query:e})))}function tu(e,t,a){return[e[a],...t.map((({[a]:e})=>e))].filter((e=>null==e?void 0:e.length))}function au(e,t,a){const n=e.filter((e=>e!==a)),i=n.indexOf(t);return n.splice(i+1,0,a),n}function nu(e,t){var a;return al(e)?(null===(a=t(e.sourceField))||void 0===a?void 0:a.displayName)||e.sourceField:""}function iu({columnId:e,layer:t,setColumns:a,getFieldByName:n}){const i=t.columns[e],l=Object.entries(t.columns).filter((([t,a])=>t!==e&&a.isBucketed)).map((([e,t])=>({value:e,text:t.label,fieldName:nu(t,n),operationType:t.operationType})));if(!i||!i.isBucketed||!l.length)return null;const s=t.columnOrder[t.columnOrder.indexOf(e)-1];if(1===l.length){const[n]=l,i=u.i18n.translate("xpack.lens.indexPattern.useAsTopLevelAgg",{defaultMessage:"Group by this field first"});return Object(x.jsx)(g.EuiFormRow,{label:i,display:"columnCompressedSwitch"},Object(x.jsx)(g.EuiSwitch,{compressed:!0,label:i,showLabel:!1,"data-test-subj":"indexPattern-nesting-switch",name:"nestingSwitch",checked:!s,onChange:()=>{a(s?au(t.columnOrder,e,n.value):au(t.columnOrder,n.value,e))}}))}return Object(x.jsx)(g.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.groupByDropdown",{defaultMessage:"Group by"}),display:"columnCompressed",fullWidth:!0},Object(x.jsx)(g.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-nesting-select",options:[{value:"",text:u.i18n.translate("xpack.lens.xyChart.nestUnderRoot",{defaultMessage:"Entire data set"})},...l.map((({value:e,text:t})=>({value:e,text:t})))],value:s,onChange:n=>a(au(t.columnOrder,n.target.value,e))}))}a(104);const lu={number:{title:u.i18n.translate("xpack.lens.indexPattern.numberFormatLabel",{defaultMessage:"Number"})},percent:{title:u.i18n.translate("xpack.lens.indexPattern.percentFormatLabel",{defaultMessage:"Percent"})},bytes:{title:u.i18n.translate("xpack.lens.indexPattern.bytesFormatLabel",{defaultMessage:"Bytes (1024)"})}},su={value:"",label:u.i18n.translate("xpack.lens.indexPattern.defaultFormatLabel",{defaultMessage:"Default"})},ru={asPlainText:!0},ou=u.i18n.translate("xpack.lens.indexPattern.columnFormatLabel",{defaultMessage:"Value format"}),uu=u.i18n.translate("xpack.lens.indexPattern.decimalPlacesLabel",{defaultMessage:"Decimals"}),cu=u.i18n.translate("xpack.lens.indexPattern.suffixLabel",{defaultMessage:"Suffix"});function du(e){var t,a,n,i,r;const{selectedColumn:o,onChange:u}=e,c=ul(o)?null===(t=o.params)||void 0===t?void 0:t.format:void 0,[d,p]=Object(l.useState)(null!==(a=null==c||null===(n=c.params)||void 0===n?void 0:n.decimals)&&void 0!==a?a:2),m=Object(l.useCallback)((e=>{c&&u({id:c.id,params:{...c.params,suffix:e}})}),[c,u]),{handleInputChange:f,inputValue:b}=Object(y.t)({onChange:m,value:null!==(i=null==c||null===(r=c.params)||void 0===r?void 0:r.suffix)&&void 0!==i?i:""},{allowFalsyValue:!0}),h=null!=c&&c.id?lu[c.id]:void 0,v=Object(l.useMemo)((()=>[su,...Object.entries(lu).map((([e,t])=>{var a;return{value:e,label:null!==(a=t.title)&&void 0!==a?a:e}}))]),[]),j=Object(l.useCallback)((e=>{0!==e.length&&(e[0].value?u({id:e[0].value,params:{decimals:d}}):u())}),[u,d]),O=Object(l.useMemo)((()=>{var e;return c?[{value:c.id,label:null!==(e=null==h?void 0:h.title)&&void 0!==e?e:c.id}]:[su]}),[c,null==h?void 0:h.title]);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{label:ou,display:"columnCompressed",fullWidth:!0},Object(x.jsx)("div",null,Object(x.jsx)(g.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-format","aria-label":ou,singleSelection:ru,options:v,selectedOptions:O,onChange:j}),c?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiSpacer,{size:"xs"}),Object(x.jsx)(g.EuiRange,{showInput:"inputWithPopover",value:d,min:0,max:15,onChange:e=>{const t=Number(e.currentTarget.value);p(t);const a=Math.min(15,Math.max(0,t));u({id:c.id,params:{...c.params,decimals:a}})},"data-test-subj":"indexPattern-dimension-formatDecimals",compressed:!0,fullWidth:!0,prepend:uu,"aria-label":uu}),Object(x.jsx)(g.EuiSpacer,{size:"xs"}),Object(x.jsx)(g.EuiFieldText,{value:b,onChange:e=>{f(e.currentTarget.value)},"data-test-subj":"indexPattern-dimension-formatSuffix",compressed:!0,fullWidth:!0,prepend:cu,"aria-label":cu})):null)))}const pu=So();function mu(e){var t;const{layer:a,layerId:n,activeData:r,columnId:o,updateLayer:c,currentIndexPattern:d,existingFields:p,validation:m,selectionStyle:f,dateRange:b,labelAppend:h,dimensionGroups:v,isFullscreen:y,toggleFullscreen:j,setIsCloseable:O,paramEditorCustomProps:k,...I}=e,T=a.columns[o],F=T&&Co[T.operationType],M=null==F?void 0:F.paramEditor,w=a.incompleteColumns?a.incompleteColumns[o]:void 0,_=null==w?void 0:w.operationType,C=null!==(t=null==w?void 0:w.sourceField)&&void 0!==t?t:null,E=Object(l.useMemo)((()=>{const e=new Set,t=new Set,a={},n={};return Object.values(Co).filter((({hidden:e})=>!e)).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).forEach((i=>{if("field"===i.input){const t=d.fields.filter((e=>ps({operationType:i.type,validation:m,field:e,indexPattern:d})));t.length&&(e.add(i.type),n[i.type]=new Set(t.map((({name:e})=>e))),t.forEach((e=>{var t;a[e.name]||(a[e.name]=new Set),null===(t=a[e.name])||void 0===t||t.add(i.type)})))}else ps({operationType:i.type,validation:m,indexPattern:d})&&(e.add(i.type),t.add(i.type))})),{operationTypes:e,operationWithoutField:t,operationByField:a,fieldByOperation:n}}),[d,m]),S=Array.from(E.operationTypes).map((e=>{var t;const a=Co[e];return{label:pu[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e}${!T||T&&al(T)&&"field"===a.input&&(null===(t=E.fieldByOperation[e])||void 0===t?void 0:t.has(T.sourceField))||T&&!al(T)&&"field"!==a.input?"":" incompatible"}`}}));if("hidden"===f)return null;const P=_?[S.find((({value:e})=>e===_))]:T?[S.find((({value:e})=>e===T.operationType))]:[],A=!T&&!Boolean(_),L=Boolean(_)||"field"===f&&!T,D=!d.getFieldByName(null!=C?C:null==T?void 0:T.sourceField),N=Boolean(P.length&&null==P[0]);if(N){const e=_||T.operationType,t={label:pu[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e} incompatible`};S.push(t),P[0]=t}return Object(x.jsx)("div",{id:o},Object(x.jsx)("div",null,"field"!==f?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFormRow,{"data-test-subj":"indexPattern-subFunction-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseSubFunction",{defaultMessage:"Choose a sub-function"}),fullWidth:!0,isInvalid:A||N},Object(x.jsx)(g.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-reference-function",placeholder:u.i18n.translate("xpack.lens.indexPattern.referenceFunctionPlaceholder",{defaultMessage:"Sub-function"}),options:S,isInvalid:A||N,selectedOptions:P,singleSelection:{asPlainText:!0},onChange:e=>{0!==e.length?(Object(Ya.e)("indexpattern_dimension_field_changed"),function(e){if((null==T?void 0:T.operationType)===e)return;const t=E.fieldByOperation[e];if(T&&"sourceField"in T&&null!=t&&t.has(T.sourceField))c(Gl({layer:a,columnId:o,op:e,indexPattern:d,field:d.getFieldByName(T.sourceField),visualizationGroups:v}));else{const n=1===(null==t?void 0:t.size)?d.getFieldByName(t.values().next().value):void 0;c(Gl({layer:a,columnId:o,op:e,indexPattern:d,field:n,visualizationGroups:v}))}Object(Ya.e)(`indexpattern_dimension_operation_${e}`)}(e[0].value)):c(ns({layer:a,columnId:o,indexPattern:d}))}})),Object(x.jsx)(g.EuiSpacer,{size:"s"})):null,T&&"field"!==F.input?null:Object(x.jsx)(g.EuiFormRow,{"data-test-subj":"indexPattern-reference-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:L||D,labelAppend:h},Object(x.jsx)(Ns,{fieldIsInvalid:L||D,currentIndexPattern:d,existingFields:p,operationByField:E.operationByField,selectedOperationType:T?T.operationType:_,selectedField:null!=C?C:null==T?void 0:T.sourceField,incompleteOperation:_,markAllFieldsCompatible:"field"===f,onDeleteColumn:()=>{c(ns({layer:a,columnId:o,indexPattern:d}))},onChoose:e=>{c(Gl({layer:a,columnId:o,indexPattern:d,op:e.operationType,field:d.getFieldByName(e.field),visualizationGroups:v}))}})),T&&!w&&M&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(M,i()({updateLayer:c,currentColumn:T,layer:a,layerId:n,activeData:r,columnId:o,indexPattern:d,dateRange:b,operationDefinitionMap:Co,isFullscreen:y,toggleFullscreen:j,setIsCloseable:O,paramEditorCustomProps:k},I)))))}function gu(e,t,a){const n=t.columns[e],i=n.customLabel?n.label:lr(n.label,n.timeScale,a,n.timeShift,n.timeShift);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:i,timeScale:a}}}}function fu({selectedColumn:e,columnId:t,layer:a,updateLayer:n}){const i=a.columnOrder.some((e=>"date_histogram"===a.columns[e].operationType)),l=Co[e.operationType];return l.timeScalingMode&&"disabled"!==l.timeScalingMode&&i&&e.timeScale?Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:Object(x.jsx)(g.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.timeScale.tooltip",{defaultMessage:"Normalize values to be always shown as rate per specified time unit, regardless of the underlying date interval."})},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.indexPattern.timeScale.label",{defaultMessage:"Normalize by unit"})," ",Object(x.jsx)(g.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiSelect,{compressed:!0,options:Object.entries(tr).map((([e,t])=>({value:e,text:t}))),"data-test-subj":"indexPattern-time-scaling-unit",value:e.timeScale,onChange:e=>{n(gu(t,a,e.target.value))}})),"optional"===l.timeScalingMode&&Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonIcon,{"data-test-subj":"indexPattern-time-scaling-remove",color:"danger","aria-label":u.i18n.translate("xpack.lens.timeScale.removeLabel",{defaultMessage:"Remove normalizing by time unit"}),onClick:()=>{n(gu(t,a,void 0))},iconType:"cross"})))):null}const bu=u.i18n.translate("xpack.lens.indexPattern.filterBy.label",{defaultMessage:"Filter by"}),hu={query:"",language:"kuery"};function xu(e,t,a){return{...t,columns:{...t.columns,[e]:{...t.columns[e],filter:a}}}}function vu({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,isInitiallyOpen:r,helpMessage:o}){const c=e.filter,d=Object(l.useCallback)((e=>{const{isValid:l}=Ml(e,i);l&&!Object(Me.isEqual)(c,e)&&n(xu(t,a,e))}),[t,i,c,a,n]),{inputValue:p,handleInputChange:m}=Object(y.t)({value:null!=c?c:hu,onChange:d}),[f,b]=Object(l.useState)(r),h=Object(l.useCallback)((()=>{b(!1),c&&m(c)}),[c,m]);if(!Co[e.operationType].filterable||!c)return null;const{isValid:v}=Ml(c,i),{isValid:j,error:O}=Ml(p,i),k=o?Object(x.jsx)(s.a.Fragment,null,bu," ",Object(x.jsx)(g.EuiIconTip,{color:"subdued",content:o,iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})):bu;return Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",label:k,fullWidth:!0,isInvalid:!v},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiPopover,{isOpen:f,closePopover:h,anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",button:Object(x.jsx)(g.EuiPanel,{paddingSize:"none",hasShadow:!1,hasBorder:!0},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1}),Object(x.jsx)(g.EuiFlexItem,{grow:!0},Object(x.jsx)(g.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>{b(!f)},color:v?"text":"danger",title:u.i18n.translate("xpack.lens.indexPattern.filterBy.clickToEdit",{defaultMessage:"Click to edit"})},c.query||u.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}))),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonIcon,{"data-test-subj":"indexPattern-filter-by-remove",color:"danger","aria-label":u.i18n.translate("xpack.lens.filterBy.removeLabel",{defaultMessage:"Remove filter"}),onClick:()=>{n(xu(t,a,void 0))},iconType:"cross"}))))},Object(x.jsx)(g.EuiFormRow,{label:bu,isInvalid:!j,error:O,fullWidth:!0,"data-test-subj":"indexPattern-filter-by-input"},Object(x.jsx)(yl,{indexPatternTitle:i.title,value:p,onChange:m,isInvalid:!j,onSubmit:()=>{}}))))))}function yu(e){const[t,a]=Object(l.useState)(!1),n=e.options.filter((e=>e.showInPopover)),i=e.options.filter((e=>e.inlineElement));return Object(x.jsx)(s.a.Fragment,null,n.length>0&&Object(x.jsx)(g.EuiText,{textAlign:"right"},Object(x.jsx)(g.EuiPopover,{ownFocus:!0,button:Object(x.jsx)(g.EuiButtonEmpty,{size:"xs",iconType:"arrowDown",iconSide:"right","data-test-subj":"indexPattern-advanced-popover",onClick:()=>{a(!t)}},u.i18n.translate("xpack.lens.indexPattern.advancedSettings",{defaultMessage:"Add advanced options"})),isOpen:t,closePopover:()=>{a(!1)}},n.map((({dataTestSubj:e,onClick:t,title:i,optionElement:l},r)=>Object(x.jsx)(s.a.Fragment,{key:e},l||Object(x.jsx)(g.EuiText,{size:"s"},Object(x.jsx)(g.EuiLink,{"data-test-subj":e,color:"text",onClick:()=>{a(!1),t()}},i)),n.length-1!==r&&Object(x.jsx)(g.EuiSpacer,{size:"s"})))))),i.map((e=>Object(x.jsx)(s.a.Fragment,{key:e.dataTestSubj},Object(x.jsx)(g.EuiSpacer,{size:"s"}),e.inlineElement))))}function ju(e,t,a){const n=null==a?void 0:a.trim(),i=t.columns[e],l=i.customLabel?i.label:lr(i.label,i.timeScale,i.timeScale,i.timeShift,n);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:l,timeShift:n}}}}function Ou({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,isFocused:s,activeData:r,layerId:o}){const c=Object(l.useRef)(!1),[d,p]=Object(l.useState)(e.timeShift);if(Object(l.useEffect)((()=>{p(e.timeShift)}),[e.timeShift]),!Co[e.operationType].shiftable||void 0===e.timeShift)return null;const m=Si(a,i,r,o),{isValueTooSmall:f,isValueNotMultiple:b,isInvalid:h,canShift:v}=Pi(m);if(!v)return null;const y=d&&Object(ii.parseTimeShift)(d),j=Boolean(y&&h(y)),O=y&&f(y),k=y&&b(y);return Object(x.jsx)("div",{ref:e=>{if(e&&s){const t=e.querySelector('[data-test-subj="comboBoxSearchInput"]');!c.current&&t instanceof HTMLInputElement&&(c.current=!0,t.focus())}}},Object(x.jsx)(g.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-time-shift-row",label:u.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),helpText:u.i18n.translate("xpack.lens.indexPattern.timeShift.help",{defaultMessage:"Enter the time shift number and unit"}),error:O&&u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})||k&&u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})||j&&u.i18n.translate("xpack.lens.indexPattern.timeShift.genericInvalidHelp",{defaultMessage:"Time shift value is not valid."}),isInvalid:Boolean(j||O||k)},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-time-shift",placeholder:u.i18n.translate("xpack.lens.indexPattern.timeShiftPlaceholder",{defaultMessage:"Type custom values (e.g. 8w)"}),options:Ci.filter((({value:e})=>{const t=Object(ii.parseTimeShift)(e);return t&&!f(t)&&!b(t)&&!("previous"===t&&m.interval)})),selectedOptions:function(){if(!d)return[];const e=Ci.filter((({value:e})=>e===d));return e.length>0?e:[{value:d,label:d}]}(),singleSelection:{asPlainText:!0},isInvalid:j,onCreateOption:e=>{const i=Object(ii.parseTimeShift)(e);h(i)?p(e):n(ju(t,a,e))},onChange:e=>{if(0===e.length)return n(ju(t,a,"")),void p("");const i=e[0].value,l=Object(ii.parseTimeShift)(i);h(l)?p(i):n(ju(t,a,i))}})),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiButtonIcon,{"data-test-subj":"indexPattern-time-shift-remove",color:"danger","aria-label":u.i18n.translate("xpack.lens.timeShift.removeLabel",{defaultMessage:"Remove time shift"}),onClick:()=>{n(ju(t,a,void 0))},iconType:"cross"})))))}const ku="formula",Iu="static_value",Tu="quickFunctions",Fu=new Set([ku,Iu]);function Mu(e){return!Fu.has(e)}const wu=({currentOperationType:e,temporaryStateType:t})=>"none"===t||null!=e&&Mu(e)?null:e===Iu&&"quickFunctions"===t?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.staticValueWarning",{defaultMessage:"Static value currently applied"}),iconType:"alert",color:"warning"},Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.staticValueWarningText",{defaultMessage:"To overwrite your static value, select a quick function"})))):Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.formulaWarning",{defaultMessage:"Formula currently applied"}),iconType:"alert",color:"warning"},"quickFunctions"!==t?Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningStaticValueText",{defaultMessage:"To overwrite your formula, change the value in the input field"})):Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningText",{defaultMessage:"To overwrite your formula, select a quick function"})))),_u=({tabs:e})=>Object(x.jsx)(g.EuiTabs,{size:"s",className:"lnsIndexPatternDimensionEditor__header","data-test-subj":"lens-dimensionTabs"},e.map((({id:e,enabled:t,state:a,onClick:n,label:i})=>t?Object(x.jsx)(g.EuiTab,{key:e,isSelected:a,"data-test-subj":`lens-dimensionTabs-${e}`,onClick:n},i):null))),Cu=So();function Eu(e){var t,a,n,r,o;const{selectedColumn:c,operationSupportMatrix:d,state:p,columnId:m,setState:f,layerId:b,currentIndexPattern:h,hideGrouping:v,dateRange:j,dimensionGroups:O,toggleFullscreen:k,isFullscreen:I,supportStaticValue:T,supportFieldFormat:F=!0,layerType:M,paramEditorCustomProps:w}=e,_={data:e.data,uiSettings:e.uiSettings,savedObjectsClient:e.savedObjectsClient,http:e.http,storage:e.storage},{fieldByOperation:C,operationWithoutField:E}=d,S=c&&Co[c.operationType],[P,A]=Object(l.useState)("none"),L=Boolean(P===Tu),D=Boolean(P===Iu),N=Object(l.useCallback)((e=>f((t=>Ko({state:t,layerId:b,newLayer:e})))),[b,f]),z=(e,t={})=>{const a="function"==typeof e?e(p.layers[b]):e,n=Boolean(a.columns[m]);f((t=>{const a="function"==typeof e?e(t.layers[b]):e;return Ko({state:t,layerId:b,newLayer:a})}),{isDimensionComplete:n,...t})},B=e=>{f((t=>({...t,isDimensionClosePrevented:!e})))},V=(null!==(t=p.layers[b].incompleteColumns)&&void 0!==t?t:{})[m],{operationType:R,sourceField:H=null,...G}=V||{},q=Boolean(T?S&&Mu(S.type):!S||Mu(S.type)),$=L||q,W=D||"none"===P&&T&&(!c||(null==c?void 0:c.operationType)===Iu),U=(t=e.state.layers[e.layerId])=>{if((null==c?void 0:c.operationType)!==Iu){var a,n,i;Object(Ya.e)("indexpattern_dimension_operation_static_value");const o=Gl({layer:t,indexPattern:h,columnId:m,op:Iu,visualizationGroups:O});var l,s,r;return null!=(null===(a=e.activeData)||void 0===a||null===(n=a[b])||void 0===n||null===(i=n.rows[0])||void 0===i?void 0:i[m])?ms(ts({layer:o,columnId:m,paramName:"value",value:null===(l=e.activeData)||void 0===l||null===(s=l[b])||void 0===s||null===(r=s.rows[0])||void 0===r?void 0:r[m]}),h):o}return t},Y=function(e,t,a){return e?Co.static_value.paramEditor:null!=t&&t.paramEditor?t.paramEditor:a?Co.static_value.paramEditor:null}(D,S,T&&!$),K=Object(l.useMemo)((()=>Object.values(Co).filter((({hidden:e})=>!e)).filter((e=>!("selectionStyle"in e)||"hidden"!==e.selectionStyle)).filter((({type:e})=>{var t;return(null===(t=C[e])||void 0===t?void 0:t.size)||E.has(e)})).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((e=>e.type))),[C,E]),[X,Z]=Object(l.useState)(!1),[Q,J]=Object(l.useState)(!1),ee=K.map((t=>{const a=Co[t],n=c&&al(c)&&h.getFieldByName(c.sourceField);return{operationType:t,compatibleWithCurrentField:Yl({layer:p.layers[b],columnId:m,op:t,indexPattern:h,field:n||void 0,filterOperations:e.filterOperations,visualizationGroups:O}),disabledStatus:a.getDisabledStatus&&a.getDisabledStatus(p.indexPatterns[p.currentIndexPatternId],p.layers[b],M)}})),te=Object(l.useMemo)((()=>{return t=h,!(!(e=c)||!al(e)||null===(a=il(e,t))||void 0===a||!a.length);var e,t,a}),[c,h]),ae=ee.map((({operationType:t,compatibleWithCurrentField:a,disabledStatus:n})=>{const i=Boolean(R===t||!R&&c&&c.operationType===t);let l="primary";i?l="text":a||(l="subdued");let s=Cu[t].displayName;return i&&n?s=Object(x.jsx)(g.EuiToolTip,{content:n,display:"block",position:"left"},Object(x.jsx)(g.EuiText,{color:"danger",size:"s"},Object(x.jsx)("strong",null,Cu[t].displayName))):n?s=Object(x.jsx)(g.EuiToolTip,{content:n,display:"block",position:"left"},Object(x.jsx)("span",null,Cu[t].displayName)):i&&(s=Object(x.jsx)("strong",null,Cu[t].displayName)),{id:t,label:s,color:l,isActive:i,size:"s",isDisabled:!!n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${t}${a?"":" incompatible"}`,"aria-pressed":i,onClick(){if(["none","fullReference","managedReference"].includes(Co[t].input)){if((null==c?void 0:c.operationType)===t)return void(V&&z(gs(p.layers[b],m)));const a=Gl({layer:e.state.layers[e.layerId],indexPattern:h,columnId:m,op:t,visualizationGroups:O,targetGroup:e.groupId});return L&&Mu(a.columns[m].operationType)&&A("none"),z(a),void Object(Ya.e)(`indexpattern_dimension_operation_${t}`)}if(!c||!a){const a=C[t]||new Set;let n;return n=1===a.size?Gl({layer:e.state.layers[e.layerId],indexPattern:h,columnId:m,op:t,field:h.getFieldByName(a.values().next().value),visualizationGroups:O,targetGroup:e.groupId}):Gl({layer:e.state.layers[e.layerId],indexPattern:h,columnId:m,op:t,field:void 0,visualizationGroups:O,targetGroup:e.groupId}),L&&Mu(n.columns[m].operationType)&&A("none"),z(n),void Object(Ya.e)(`indexpattern_dimension_operation_${t}`)}if(c.operationType===t)return void(V&&z(gs(p.layers[b],m)));L&&A("none");const n=Wl({layer:e.state.layers[e.layerId],indexPattern:h,columnId:m,op:t,field:al(c)?h.getFieldByName(c.sourceField):void 0,visualizationGroups:O});z(n)}}})),ne=!te&&!V&&c&&Mu(c.operationType)&&Y,ie=!V&&c&&"references"in c&&"fullReference"===(null==S?void 0:S.input),le=!c||"field"===(null==S?void 0:S.input)||R&&"field"===(null===(a=Co[R])||void 0===a?void 0:a.input)||L,se=(null==S?void 0:S.renderFieldInput)||Hs,re={layer:p.layers[b],layerId:b,activeData:e.activeData,updateLayer:e=>{L&&A("none"),z(e,{forceRender:L})},columnId:m,currentColumn:p.layers[b].columns[m],dateRange:j,indexPattern:h,operationDefinitionMap:Co,toggleFullscreen:k,isFullscreen:I,setIsCloseable:B,paramEditorCustomProps:w,..._},oe=Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(x.jsx)(g.EuiFormLabel,null,u.i18n.translate("xpack.lens.indexPattern.functionsLabel",{defaultMessage:"Functions"})),Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object(x.jsx)(g.EuiListGroup,{className:ae.length>3?"lnsIndexPatternDimensionEditor__columns":"",gutterSize:"none",listItems:ae.length%2==1?[...ae,{label:""}]:ae,maxWidth:!1})),Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},ie?Object(x.jsx)(s.a.Fragment,null,c.references.map(((t,a)=>{var n;const l=S.requiredReferences[a];return Object(x.jsx)(mu,i()({key:a,layer:p.layers[b],layerId:b,activeData:e.activeData,columnId:t,updateLayer:e=>{N("function"==typeof e?e(p.layers[b]):e)},validation:l,currentIndexPattern:h,existingFields:p.existingFields,selectionStyle:S.selectionStyle,dateRange:j,labelAppend:null==S||null===(n=S.getHelpMessage)||void 0===n?void 0:n.call(S,{data:e.data,uiSettings:e.uiSettings,currentColumn:p.layers[b].columns[m]}),dimensionGroups:O,isFullscreen:I,toggleFullscreen:k,setIsCloseable:B,paramEditorCustomProps:w},_))})),"field"!==S.selectionStyle?Object(x.jsx)(g.EuiSpacer,{size:"s"}):null):null,le?Object(x.jsx)(se,{layer:p.layers[b],selectedColumn:c,columnId:m,indexPattern:h,existingFields:p.existingFields,operationSupportMatrix:d,updateLayer:e=>{L&&A("none"),z(e,{forceRender:L})},incompleteField:H,incompleteOperation:R,incompleteParams:G,currentFieldIsInvalid:te,helpMessage:null==S||null===(n=S.getHelpMessage)||void 0===n?void 0:n.call(S,{data:e.data,uiSettings:e.uiSettings,currentColumn:p.layers[b].columns[m]}),dimensionGroups:O,groupId:e.groupId,operationDefinitionMap:Co}):null,ne&&Object(x.jsx)(Y,re))),ue=Y?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(Y,i()({layer:p.layers[b],layerId:b,activeData:e.activeData,updateLayer:D?e=>{if(D&&A("none"),"function"==typeof e)return f((t=>{const a=e(U(t.layers[b]));return Ko({state:t,layerId:b,newLayer:a})}),{isDimensionComplete:!0,forceRender:!0})}:z,columnId:m,currentColumn:p.layers[b].columns[m],dateRange:j,indexPattern:h,operationDefinitionMap:Co,toggleFullscreen:k,isFullscreen:I,setIsCloseable:B,paramEditorCustomProps:w},_))):null,ce=$?oe:ue,de=Object(l.useCallback)((e=>{N(ts({layer:p.layers[b],columnId:m,paramName:"format",value:e}))}),[m,b,p.layers,N]),pe=!I&&d.operationWithoutField.has(ku),me=!I&&(pe||T),ge=[{id:Iu,enabled:Boolean(T),state:W,onClick:()=>{if((null==c?void 0:c.operationType)===ku)return A(Iu);A("none"),z(U())},label:u.i18n.translate("xpack.lens.indexPattern.staticValueLabel",{defaultMessage:"Static value"})},{id:Tu,enabled:!0,state:$,onClick:()=>{!c||Mu(c.operationType)||A(Tu)},label:u.i18n.translate("xpack.lens.indexPattern.quickFunctionsLabel",{defaultMessage:"Quick functions"})},{id:ku,enabled:pe,state:"none"===P&&(null==c?void 0:c.operationType)===ku,onClick:()=>{if(A("none"),(null==c?void 0:c.operationType)!==ku){const t=Gl({layer:e.state.layers[e.layerId],indexPattern:h,columnId:m,op:ku,visualizationGroups:O});z(t),Object(Ya.e)("indexpattern_dimension_operation_formula")}},label:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"})}],fe=Object(l.useMemo)((()=>String(c&&Co[c.operationType].getDefaultLabel(c,p.indexPatterns[p.layers[b].indexPatternId],p.layers[b].columns))),[b,c,p.indexPatterns,p.layers]),be=!I&&!te&&!V&&c&&"none"===P&&S&&(S.timeScalingMode||S.filterable||S.shiftable);return Object(x.jsx)("div",{id:m},me?Object(x.jsx)(_u,{tabs:ge}):null,Object(x.jsx)(wu,{currentOperationType:null==c?void 0:c.operationType,temporaryStateType:P}),ce,be&&Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(x.jsx)(yu,{options:[{title:u.i18n.translate("xpack.lens.indexPattern.timeScale.enableTimeScale",{defaultMessage:"Normalize by unit"}),dataTestSubj:"indexPattern-time-scaling-enable",onClick:()=>{z(gu(m,p.layers[b],"s"))},showInPopover:Boolean(S.timeScalingMode&&"disabled"!==S.timeScalingMode&&Object.values(p.layers[b].columns).some((e=>"date_histogram"===e.operationType))&&!c.timeScale),inlineElement:S.timeScalingMode?Object(x.jsx)(fu,{selectedColumn:c,columnId:m,layer:p.layers[b],updateLayer:z}):null},{title:u.i18n.translate("xpack.lens.indexPattern.filterBy.label",{defaultMessage:"Filter by"}),dataTestSubj:"indexPattern-filter-by-enable",onClick:()=>{Z(!0),z(xu(m,p.layers[b],hu))},showInPopover:Boolean(S.filterable&&!c.filter),inlineElement:S.filterable&&c.filter?Object(x.jsx)(vu,{indexPattern:h,selectedColumn:c,columnId:m,layer:p.layers[b],updateLayer:z,isInitiallyOpen:X,helpMessage:S.filterable&&"boolean"!=typeof S.filterable?S.filterable.helpMessage:null}):null},{title:u.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),dataTestSubj:"indexPattern-time-shift-enable",onClick:()=>{J(!0),z(ju(m,p.layers[b],""))},showInPopover:Boolean(S.shiftable&&void 0===c.timeShift&&(h.timeFieldName||Object.values(p.layers[b].columns).some((e=>"date_histogram"===e.operationType)))),inlineElement:S.shiftable&&void 0!==c.timeShift?Object(x.jsx)(Ou,{indexPattern:h,selectedColumn:c,columnId:m,layer:p.layers[b],updateLayer:z,isFocused:Q,activeData:e.activeData,layerId:b}):null},...(null===(r=(o=Co[c.operationType]).getAdvancedOptions)||void 0===r?void 0:r.call(o,re))||[]]})),!I&&!te&&Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded  lnsIndexPatternDimensionEditor__section--collapseNext"},!V&&c&&"none"===P&&Object(x.jsx)(y.g,{key:fe,value:c.label,defaultValue:fe,onChange:e=>{N({columns:{...p.layers[b].columns,[m]:{...c,label:e,customLabel:Co[c.operationType].getDefaultLabel(c,p.indexPatterns[p.layers[b].indexPatternId],p.layers[b].columns)!==e}}})}}),!I&&!V&&!v&&"none"===P&&Object(x.jsx)(iu,{layer:p.layers[e.layerId],columnId:e.columnId,setColumns:e=>N({columnOrder:e}),getFieldByName:h.getFieldByName}),!F||I||!c||"number"!==c.dataType&&"range"!==c.operationType?null:Object(x.jsx)(du,{selectedColumn:c,onChange:de})))}const Su=$n()((function(e,t){const a=e.filter((e=>t(e.operationMetaData))),n={},i=new Set,l={};return a.forEach((({operations:e})=>{e.forEach((e=>{var t,a;"field"===e.type?(n[e.field]||(n[e.field]=new Set),null===(t=n[e.field])||void 0===t||t.add(e.operationType),l[e.operationType]||(l[e.operationType]=new Set),null===(a=l[e.operationType])||void 0===a||a.add(e.field)):i.add(e.operationType)}))})),{operationByField:n,operationWithoutField:i,fieldByOperation:l}})),Pu=function(e){var t;const a=e.layerId,n=e.state.layers[a],i=e.state.indexPatterns[n.indexPatternId],{columnId:s,uniqueLabel:r,invalid:o,invalidMessage:u,hideTooltip:c}=e,d=Object(l.useMemo)((()=>o||Xo(n,s,i)),[n,s,i,o]),p=null!==(t=n.columns[e.columnId])&&void 0!==t?t:null;if(!p)return null;const m=(g=r)?g.replace(/\./g,"."):"";var g;return Object(x.jsx)(tn,{id:s,label:d?p.label:m,isInvalid:Boolean(d),hideTooltip:c,invalidMessage:u})},Au=function(e){var t;const a=e.layerId,n=e.state.indexPatterns[null===(t=e.state.layers[a])||void 0===t?void 0:t.indexPatternId];if(!n)return null;const l=(e=>{const t=e.layerId,a=e.state.indexPatterns[e.state.layers[t].indexPatternId],n=zo(a);return Su(n,e.filterOperations)})(e),s=e.state.layers[a].columns[e.columnId]||null;return Object(x.jsx)(Eu,i()({},e,{layerType:e.layerType||P.o.DATA,currentIndexPattern:n,selectedColumn:s,operationSupportMatrix:l}))},Lu=Object(l.memo)(Pu),Du=Object(l.memo)(Au);var Nu=a(97);const zu=So();function Bu(e,t,a,n){if(!e)return;const i=No(e,t);return i.length?a&&i.includes(a.operationType)?a.operationType:n&&i.includes(n)?n:i[0]:void 0}function Vu(e,t){if(e)return al(e)&&t.getFieldByName(e.sourceField)||void 0}function Ru(e){const{state:t,columnId:a,layerId:n,dragging:i,groupId:l,filterOperations:s}=e;if(i){if(nl(i))return function({state:e,columnId:t,layerId:a,dragging:n,filterOperations:i}){const l=e.layers[a].columns[t],s=e.layers[a].indexPatternId===n.indexPatternId,r=Bu(n.field,i,l);if(s&&r){const t=zu[r].displayName;if(!l)return{dropTypes:["field_add"],nextLabel:t};if(al(l)&&l.sourceField!==n.field.name||!al(l)){const i=e.indexPatterns[e.layers[a].indexPatternId];return al(l)&&i&&Do(i,l,void 0,n.field)?{dropTypes:["field_replace","field_combine"]}:{dropTypes:["field_replace"],nextLabel:t}}}}({...e,dragging:i});if(Object(Nu.a)(i)&&i.layerId===n&&a!==i.columnId){const r=t.layers[i.layerId].columns[i.columnId],o=t.layers[n].columns[a];if(l===i.groupId)return o?{dropTypes:["reorder"]}:{dropTypes:["duplicate_compatible"]};const u=t.indexPatterns[t.layers[n].indexPatternId];return s(r)?function(e,t,a,n,i){var l;const s=a&&Hu(a,n),r=n&&!s&&(null===(l=e.find((e=>e.accessors.some((e=>e.columnId===t)))))||void 0===l?void 0:l.filterOperations(n)),o=r?["swap_compatible"]:[];if(!n)return{dropTypes:["move_compatible","duplicate_compatible",...o]};if(!i||!al(n))return{dropTypes:["replace_compatible","replace_duplicate_compatible",...o]};const u=[];return s||u.push("replace_compatible","replace_duplicate_compatible"),r&&u.push("swap_compatible"),Do(i,n,a)&&u.push("combine_compatible"),u.length?{dropTypes:u}:void 0}(e.dimensionGroups,i.columnId,r,o,u):Hu(r,o)?void 0:function({state:e,columnId:t,layerId:a,dragging:n,filterOperations:i}){const l=e.layers[a].columns[t],s=e.layers[n.layerId].columns[n.columnId],r=e.indexPatterns[e.layers[a].indexPatternId];if(!r)return;const o=Bu(Vu(s,r),i,l);if(o){const e=Vu(l,r),t=Boolean(Bu(e,n.filterOperations,s)),a=[];return l?(a.push("replace_incompatible","replace_duplicate_incompatible"),t&&a.push("swap_incompatible"),Do(r,l,s)&&a.push("combine_incompatible")):a.push("move_incompatible","duplicate_incompatible"),{dropTypes:a,nextLabel:zu[o].displayName}}}({...e,dragging:i})}}}function Hu(e,t){const a=t?Ao(t):[],n=new Set(Ao(e));return a.length===n.size&&a.every((e=>n.has(e)))}function Gu(e){const{droppedItem:t,dropType:a}=e;return qu[a]({...e,droppedItem:t})}const qu={field_add:Wu,field_replace:Wu,field_combine:e=>Wu(e,!0),reorder:function({columnId:e,setState:t,state:a,layerId:n,droppedItem:i}){return t(Ko({state:a,layerId:n,newLayer:{columnOrder:function(e,t,a){const n=e.filter((e=>e!==a)),i=e.findIndex((e=>e===a)),l=e.findIndex((e=>e===t)),s=n.indexOf(t);return n.splice(i<l?s+1:s,0,a),n}(a.layers[n].columnOrder,e,i.columnId)}})),!0},move_compatible:e=>Uu(e,!0),replace_compatible:e=>Uu(e,!0),duplicate_compatible:Uu,replace_duplicate_compatible:Uu,move_incompatible:e=>Yu(e,!0),replace_incompatible:e=>Yu(e,!0),duplicate_incompatible:Yu,replace_duplicate_incompatible:Yu,swap_compatible:function({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,dimensionGroups:l,groupId:s}){const r=a.layers[n],o=i.columnId,u=e,c={...r.columns[o]},d={...r.columns[u]},p={...r.columns};p[u]=c,p[o]=d;let m=((e,t,a)=>{const n=[...e],i=n.findIndex((e=>e===t)),l=n.findIndex((e=>e===a));return n[i]=a,n[l]=t,n})(r.columnOrder,o,u);return m=Zl(l,s,m,e),t(Ko({state:a,layerId:n,newLayer:{columnOrder:m,columns:p}})),!0},swap_incompatible:function({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,filterOperations:l,dimensionGroups:s,groupId:r}){const o=a.layers[n],u=a.indexPatterns[o.indexPatternId],c=o.columns[i.columnId],d=o.columns[e],p=Vu(c,u),m=Vu(d,u),g=Bu(p,l,d),f=Bu(m,i.filterOperations,c);if(!g||!f)return!1;const b=Gl({layer:Gl({layer:o,columnId:e,targetGroup:r,indexPattern:u,op:g,field:p,visualizationGroups:s,shouldResetLabel:!0}),columnId:i.columnId,indexPattern:u,op:f,field:m,visualizationGroups:s,targetGroup:i.groupId,shouldResetLabel:!0});return Object(Ya.e)("drop_onto_dimension"),t(Ko({state:a,layerId:n,newLayer:b})),!0},combine_compatible:$u,combine_incompatible:$u};function $u({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,dimensionGroups:l,groupId:s}){var r,o;const u=a.layers[n],c=i.columnId,d=e,p=a.indexPatterns[u.indexPatternId],m=u.columns[c],g=u.columns[d],f=Vu(m,p),b=Vu(g,p);if(!f||!b)return!1;const h={params:null!==(r=null===(o=Lo(g.operationType))||void 0===o?void 0:o({targetColumn:g,sourceColumn:m,indexPattern:p}))&&void 0!==r?r:{}};return t(Ko({state:a,layerId:n,newLayer:ns({layer:Wl({layer:u,columnId:e,indexPattern:p,op:g.operationType,field:b,visualizationGroups:l,targetGroup:s,initialParams:h,shouldCombineField:!0}),columnId:c,indexPattern:p})})),{deleted:c}}function Wu(e,t){var a,n;const{columnId:i,setState:l,state:s,layerId:r,droppedItem:o,filterOperations:u,groupId:c,dimensionGroups:d}=e,p=null===(a=d.find((e=>e.groupId===c)))||void 0===a?void 0:a.prioritizedOperation,m=s.layers[r],g=s.indexPatterns[m.indexPatternId],f=m.columns[i],b=t?f.operationType:Bu(o.field,u,f,p);if(!nl(o)||!b||t&&!Do(g,f,void 0,o.field))return!1;const h=t?Vu(f,g):o.field,x=t?{params:(null===(n=Lo(f.operationType))||void 0===n?void 0:n({targetColumn:f,field:o.field,indexPattern:g}))||{}}:void 0,v=Gl({layer:m,columnId:i,indexPattern:g,op:b,field:h,visualizationGroups:d,targetGroup:c,shouldCombineField:t,initialParams:x});Object(Ya.e)("drop_onto_dimension");const y=Object.values(s.layers).some((({columns:e})=>e.length));return Object(Ya.e)(y?"drop_non_empty":"drop_empty"),l(Ko({state:s,layerId:r,newLayer:v})),!0}function Uu({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,dimensionGroups:l,groupId:s},r){const o=a.layers[n],u=o.columns[i.columnId],c=a.indexPatterns[o.indexPatternId],d=Rl({layer:o,targetId:e,sourceColumnId:i.columnId,sourceColumn:u,shouldDeleteSource:r,indexPattern:c});return t(Ko({state:a,layerId:n,newLayer:{columnOrder:Zl(l,s,is(d),e),columns:d.columns}})),!r||{deleted:i.columnId}}function Yu({columnId:e,setState:t,state:a,layerId:n,droppedItem:i,filterOperations:l,dimensionGroups:s,groupId:r},o){const u=a.layers[n],c=a.indexPatterns[u.indexPatternId],d=u.columns[i.columnId],p=u.columns[e]||null,m=Vu(d,c),g=Bu(m,l,p);if(!g)return!1;const f=Gl({layer:o?ns({layer:u,columnId:i.columnId,indexPattern:c}):u,columnId:e,indexPattern:c,op:g,field:m,visualizationGroups:s,targetGroup:r,shouldResetLabel:!0});return Object(Ya.e)("drop_onto_dimension"),t(Ko({state:a,layerId:n,newLayer:f})),!o||{deleted:i.columnId}}a(132);var Ku=a(75);function Xu(e){const[t,a]=Object(l.useState)(!1),n=Object(l.useRef)(void 0),i=Object(l.useRef)(void 0);return Object(l.useEffect)((function t(){n.current?i.current=t:(a(!0),n.current=e.load().catch((()=>{})).then((()=>{const e=i.current;n.current=void 0,i.current=void 0,e?e():a(!1)})))}),e.loadDeps),t?Object(x.jsx)(g.EuiProgress,{size:"xs",color:"accent",position:"absolute"}):null}var Zu=a(4);function Qu({indexPatternRefs:e,isMissingCurrent:t,indexPatternId:a,onChangeIndexPattern:n,trigger:r,selectableProps:o}){const[c,p]=Object(l.useState)(!1),m=t?{color:"danger"}:{};return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiPopover,{panelClassName:"lnsChangeIndexPatternPopover",button:function(){const{label:e,title:t,...a}=r;return Object(x.jsx)(d.ToolbarButton,i()({title:t,onClick:()=>p(!c),fullWidth:!0},m,a),e)}(),panelProps:{"data-test-subj":"lnsChangeIndexPatternPopover"},isOpen:c,closePopover:()=>p(!1),display:"block",panelPaddingSize:"s",ownFocus:!0},Object(x.jsx)("div",null,Object(x.jsx)(g.EuiPopoverTitle,null,u.i18n.translate("xpack.lens.indexPattern.changeDataViewTitle",{defaultMessage:"Data view"})),Object(x.jsx)(g.EuiSelectable,i()({},o,{searchable:!0,singleSelection:"always",options:e.map((({title:e,id:t})=>({key:t,label:e,value:t,checked:t===a?"on":void 0}))),onChange:e=>{const t=e.find((({checked:e})=>e));Object(Ya.e)("indexpattern_changed"),n(t.value),p(!1)},searchProps:{compressed:!0,...o?o.searchProps:void 0}}),((e,t)=>Object(x.jsx)(s.a.Fragment,null,t,e))))))}a(332),a(337);var Ju=a(55),ec=a.n(Ju),tc=a(3);function ac(e){const[t,a]=Object(l.useState)(void 0);return Object(l.useEffect)((()=>{!async function(){var t,n;const i=await e.uiActions.getTriggerCompatibleActions(Zu.VISUALIZE_GEO_FIELD_TRIGGER,{indexPatternId:e.indexPatternId,fieldName:e.fieldName}),l={indexPatternId:e.indexPatternId,fieldName:e.fieldName,trigger:Zu.visualizeGeoFieldTrigger},s=i.length?await(null===(t=(n=i[0]).getHref)||void 0===t?void 0:t.call(n,l)):void 0;a(s)}()}),[]),Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiButton,{onClick:function(t){t.preventDefault(),e.uiActions.getTrigger(Zu.VISUALIZE_GEO_FIELD_TRIGGER).exec({indexPatternId:e.indexPatternId,fieldName:e.fieldName,originatingApp:tc.APP_ID})},href:t,size:"s","data-test-subj":`lensVisualize-GeoField-${e.fieldName}`},Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.fieldItem.visualizeGeoFieldLinkText",defaultMessage:"Visualize in Maps"})))}var nc=a(73);function ic(e){return e?e.replace(/\./g,"."):""}const lc=function(e,t=256){const a=Object(l.memo)(e);return e=>{const[n,i]=Object(l.useState)(e),r=Object(l.useMemo)((()=>Object(Me.debounce)(i,t)),[i]);return Object(l.useEffect)((()=>()=>r.cancel()),[r]),r(e),s.a.createElement(a,n)}}((function(e){const{core:t,field:a,indexPattern:n,highlight:s,exists:r,query:o,dateRange:c,filters:d,hideDetails:p,itemIndex:m,groupIndex:f,dropOntoWorkspace:b,editField:h,removeField:v}=e,[y,j]=Object(l.useState)(!1),O=Object(l.useMemo)((()=>h?e=>{h(e),j(!1)}:void 0),[h,j]),k=Object(l.useMemo)((()=>v?e=>{v(e),j(!1)}:void 0),[v,j]),I=Object(l.useCallback)((e=>{b(e),j(!1)}),[b,j]),[T,F]=Object(l.useState)({isLoading:!1}),M=Object(l.useCallback)((()=>{j(!1)}),[j]),w=Object(l.useMemo)((()=>({field:a,indexPatternId:n.id,id:a.name,humanData:{label:a.displayName,position:m+1}})),[a,n.id,m]),_=Object(l.useMemo)((()=>[0,f,m]),[f,m]),C=Object(x.jsx)(Cs,{type:a.type}),E=Object(x.jsx)(g.EuiIconTip,{anchorClassName:"lnsFieldItem__infoIcon",content:p?u.i18n.translate("xpack.lens.indexPattern.fieldItemTooltip",{defaultMessage:"Drag and drop to visualize."}):r?u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonLabel",{defaultMessage:"Click for a field preview, or drag and drop to visualize."}):u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonEmptyLabel",{defaultMessage:"This field doesnt have any data but you can still drag and drop to visualize."}),type:"iInCircle",color:"subdued",size:"s"});return Object(x.jsx)("li",null,Object(x.jsx)(g.EuiPopover,{ownFocus:!0,className:"lnsFieldItem__popoverAnchor",display:"block","data-test-subj":"lnsFieldListPanelField",container:document.querySelector(".application")||void 0,button:Object(x.jsx)(Ku.c,{draggable:!0,order:_,value:w,dataTestSubj:`lnsFieldListPanelField-${a.name}`,onDragStart:M},Object(x.jsx)(_s,{className:`lnsFieldItem lnsFieldItem--${a.type} lnsFieldItem--${r?"exists":"missing"}`,isActive:y,onClick:function(){j(!y),y||(Object(Ya.e)("indexpattern_field_info_click"),T.isLoading||"document"===a.type||a.type.includes("range")||"geo_point"===a.type||"geo_shape"===a.type||(F((e=>({...e,isLoading:!0}))),t.http.post(`/api/lens/index_stats/${n.id}/field`,{body:JSON.stringify({dslQuery:Object(Un.c)(n,o,d,Object(_i.getEsQueryConfig)(t.uiSettings)),fromDate:c.fromDate,toDate:c.toDate,fieldName:a.name})}).then((e=>{F((t=>({...t,isLoading:!1,totalDocuments:e.totalDocuments,sampledDocuments:e.sampledDocuments,sampledValues:e.sampledValues,histogram:e.histogram,topValues:e.topValues})))})).catch((()=>{F((e=>({...e,isLoading:!1})))}))))},buttonProps:{"aria-label":u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonAriaLabel",{defaultMessage:"Preview {fieldName}: {fieldType}",values:{fieldName:a.displayName,fieldType:a.type}})},fieldIcon:C,fieldName:Object(x.jsx)(g.EuiHighlight,{search:ic(s)},ic(a.displayName)),fieldInfoIcon:E})),isOpen:y,closePopover:()=>j(!1),anchorPosition:"rightUp",panelClassName:"lnsFieldItem__fieldPanel",initialFocus:".lnsFieldItem__fieldPanel"},Object(x.jsx)(rc,i()({},T,e,{editField:O,removeField:k,dropOntoWorkspace:I}))))}));function sc({indexPatternId:e,field:t,hasSuggestionForField:a,dropOntoWorkspace:n,editField:i,removeField:l}){const s={indexPatternId:e,id:t.name,field:t,humanData:{label:t.displayName}};return Object(x.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiTitle,{size:"xxs"},Object(x.jsx)("h5",{className:"eui-textBreakWord lnsFieldItem__fieldPanelTitle"},t.displayName))),Object(x.jsx)(oc,{isEnabled:a(s),dropOntoWorkspace:n,field:s}),i&&Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.editFieldLabel",{defaultMessage:"Edit data view field"})},Object(x.jsx)(g.EuiButtonIcon,{onClick:()=>i(t.name),iconType:"pencil","data-test-subj":"lnsFieldListPanelEdit","aria-label":u.i18n.translate("xpack.lens.indexPattern.editFieldLabel",{defaultMessage:"Edit data view field"})}))),l&&t.runtime&&Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.removeFieldLabel",{defaultMessage:"Remove data view field"})},Object(x.jsx)(g.EuiButtonIcon,{onClick:()=>l(t.name),iconType:"trash","data-test-subj":"lnsFieldListPanelRemove",color:"danger","aria-label":u.i18n.translate("xpack.lens.indexPattern.removeFieldLabel",{defaultMessage:"Remove data view field"})}))))}function rc(e){const{histogram:t,topValues:a,indexPattern:n,field:i,dateRange:r,core:o,sampledValues:c,chartsThemeService:d,fieldFormats:p,dropOntoWorkspace:m,editField:f,removeField:b,hasSuggestionForField:h,hideDetails:v,uiActions:y}=e,j=d.useChartsTheme(),O=d.useChartsBaseTheme();let k=!!e.histogram;const I=a&&a.buckets.reduce(((e,t)=>t.count+e),0),T=c&&I?c-I:0;I&&t&&t.buckets.length&&a&&a.buckets.length&&(k=T/I>.9);const[F,M]=Object(l.useState)(k),w=Object(x.jsx)(sc,{indexPatternId:n.id,field:i,dropOntoWorkspace:m,hasSuggestionForField:h,editField:f,removeField:b});if(v)return w;let _;if(n.fieldFormatMap&&n.fieldFormatMap[i.name]){const e=p.getType(n.fieldFormatMap[i.name].id);_=e?new e(n.fieldFormatMap[i.name].params,o.uiSettings.get.bind(o.uiSettings)):{convert:e=>JSON.stringify(e)}}else _=p.getDefaultInstance(i.type,i.esTypes);const C=ec.a.parse(r.fromDate),E=ec.a.parse(r.toDate);let S=Object(x.jsx)(s.a.Fragment,null);if(e.isLoading)return Object(x.jsx)(g.EuiLoadingSpinner,null);if(i.type.includes("range"))return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiPopoverTitle,null,w),Object(x.jsx)(g.EuiText,{size:"s"},u.i18n.translate("xpack.lens.indexPattern.fieldStatsLimited",{defaultMessage:"Summary information is not available for range type fields."})));if("geo_point"===i.type||"geo_shape"===i.type)return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiPopoverTitle,null,w),Object(x.jsx)(g.EuiText,{size:"s"},Object(nc.getVisualizeGeoFieldMessage)(i.type)),Object(x.jsx)(g.EuiSpacer,{size:"m"}),Object(x.jsx)(ac,{uiActions:y,indexPatternId:n.id,fieldName:i.name}));if(!(e.histogram&&0!==e.histogram.buckets.length||e.topValues&&0!==e.topValues.buckets.length)){const e=o.uiSettings.get("lens:useFieldExistenceSampling");return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiPopoverTitle,null,w),Object(x.jsx)(g.EuiText,{size:"s"},e?u.i18n.translate("xpack.lens.indexPattern.fieldStatsSamplingNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data in the first 500 documents that match your filters. To create a visualization, drag and drop a different field."}):u.i18n.translate("xpack.lens.indexPattern.fieldStatsNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data. To create a visualization, drag and drop a different field."})))}function P(t){return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiPopoverTitle,null,w),S||Object(x.jsx)(s.a.Fragment,null),Object(x.jsx)(g.EuiSpacer,{size:"s"}),t,e.totalDocuments?Object(x.jsx)(g.EuiPopoverFooter,null,Object(x.jsx)(g.EuiText,{color:"subdued",size:"xs"},e.sampledDocuments&&Object(x.jsx)(s.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.percentageOfLabel",{defaultMessage:"{percentage}% of",values:{percentage:Math.round(e.sampledDocuments/e.totalDocuments*100)}}))," ",Object(x.jsx)("strong",null,p.getDefaultInstance(_i.KBN_FIELD_TYPES.NUMBER,[_i.ES_FIELD_TYPES.INTEGER]).convert(e.totalDocuments))," ",u.i18n.translate("xpack.lens.indexPattern.ofDocumentsLabel",{defaultMessage:"documents"}))):Object(x.jsx)(s.a.Fragment,null))}if(t&&t.buckets.length&&a&&a.buckets.length?S=Object(x.jsx)(g.EuiButtonGroup,{className:"lnsFieldItem__buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:u.i18n.translate("xpack.lens.indexPattern.fieldStatsDisplayToggle",{defaultMessage:"Toggle either the"}),options:[{label:u.i18n.translate("xpack.lens.indexPattern.fieldTopValuesLabel",{defaultMessage:"Top values"}),id:"topValues"},{label:u.i18n.translate("xpack.lens.indexPattern.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram"}],onChange:e=>{M("histogram"===e)},idSelected:F?"histogram":"topValues"}):"date"===i.type?S=Object(x.jsx)(g.EuiTitle,{size:"xxxs"},Object(x.jsx)("h6",null,u.i18n.translate("xpack.lens.indexPattern.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):a&&a.buckets.length&&(S=Object(x.jsx)(g.EuiTitle,{size:"xxxs"},Object(x.jsx)("h6",null,u.i18n.translate("xpack.lens.indexPattern.fieldTopValuesLabel",{defaultMessage:"Top values"})))),t&&t.buckets.length){const e=u.i18n.translate("xpack.lens.indexPattern.fieldStatsCountLabel",{defaultMessage:"Count"});if("date"===i.type)return P(Object(x.jsx)(oe.Chart,{"data-test-subj":"lnsFieldListPanel-histogram",size:{height:200,width:268}},Object(x.jsx)(oe.Settings,{tooltip:{type:oe.TooltipType.None},theme:j,baseTheme:O,xDomain:C&&E?{min:C.valueOf(),max:E.valueOf(),minInterval:Math.round((E.valueOf()-C.valueOf())/10)}:void 0}),Object(x.jsx)(oe.Axis,{id:"key",position:oe.Position.Bottom,tickFormat:C&&E?Object(oe.niceTimeFormatter)([C.valueOf(),E.valueOf()]):void 0,showOverlappingTicks:!0}),Object(x.jsx)(oe.HistogramBarSeries,{data:t.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:oe.ScaleType.Time,yScaleType:oe.ScaleType.Linear,timeZone:"local"})));if(F||!a||!a.buckets.length)return P(Object(x.jsx)(oe.Chart,{"data-test-subj":"lnsFieldListPanel-histogram",size:{height:200,width:"100%"}},Object(x.jsx)(oe.Settings,{rotation:90,tooltip:{type:oe.TooltipType.None},theme:j,baseTheme:O}),Object(x.jsx)(oe.Axis,{id:"key",position:oe.Position.Left,showOverlappingTicks:!0,tickFormat:e=>_.convert(e)}),Object(x.jsx)(oe.HistogramBarSeries,{data:t.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:oe.ScaleType.Linear,yScaleType:oe.ScaleType.Linear})))}if(e.topValues&&e.topValues.buckets.length){const t=e.topValues.buckets.some((t=>!Number.isInteger(t.count/e.sampledValues)));return P(Object(x.jsx)("div",{"data-test-subj":"lnsFieldListPanel-topValues"},e.topValues.buckets.map((a=>{const n=_.convert(a.key);return Object(x.jsx)("div",{className:"lnsFieldItem__topValue",key:a.key},Object(x.jsx)(g.EuiFlexGroup,{alignItems:"stretch",key:a.key,gutterSize:"xs",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!0,className:"eui-textTruncate"},""===n?Object(x.jsx)(g.EuiText,{size:"xs",color:"subdued"},Object(x.jsx)("em",null,u.i18n.translate("xpack.lens.indexPattern.fieldPanelEmptyStringValue",{defaultMessage:"Empty string"}))):Object(x.jsx)(g.EuiToolTip,{content:n,delay:"long"},Object(x.jsx)(g.EuiText,{size:"xs",color:"subdued",className:"eui-textTruncate"},n))),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiText,{size:"xs",textAlign:"left",color:"accent"},(Math.round(a.count/e.sampledValues*1e3)/10).toFixed(t?1:0),"%"))),Object(x.jsx)(g.EuiProgress,{className:"lnsFieldItem__topValueProgress",value:a.count/e.sampledValues,max:1,size:"s",color:"accent"}))})),T?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(g.EuiFlexGroup,{alignItems:"stretch",gutterSize:"xs",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!0,className:"eui-textTruncate"},Object(x.jsx)(g.EuiText,{size:"xs",className:"eui-textTruncate",color:"subdued"},u.i18n.translate("xpack.lens.indexPattern.otherDocsLabel",{defaultMessage:"Other"}))),Object(x.jsx)(g.EuiFlexItem,{grow:!1,className:"eui-textTruncate"},Object(x.jsx)(g.EuiText,{size:"xs",color:"subdued"},(Math.round(T/e.sampledValues*1e3)/10).toFixed(t?1:0),"%"))),Object(x.jsx)(g.EuiProgress,{className:"lnsFieldItem__topValueProgress",value:T/e.sampledValues,max:1,size:"s",color:"subdued"})):Object(x.jsx)(s.a.Fragment,null)))}return Object(x.jsx)(s.a.Fragment,null)}const oc=({field:e,dropOntoWorkspace:t,isEnabled:a})=>{const n=a?u.i18n.translate("xpack.lens.indexPattern.moveToWorkspace",{defaultMessage:"Add {field} to workspace",values:{field:e.field.name}}):u.i18n.translate("xpack.lens.indexPattern.moveToWorkspaceDisabled",{defaultMessage:"This field can't be added to the workspace automatically. You can still use it directly in the configuration panel."});return Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiToolTip,{content:n},Object(x.jsx)(g.EuiButtonIcon,{"aria-label":n,isDisabled:!a,iconType:"plusInCircle",onClick:()=>{t(e)}})))},uc=u.i18n.translate("xpack.lens.indexPatterns.noDataLabel",{defaultMessage:"There are no fields."}),cc=({existFieldsInIndex:e,defaultNoFieldsMessage:t=uc,isAffectedByFieldFilter:a=!1,isAffectedByTimerange:n=!1,isAffectedByGlobalFilter:i=!1})=>e?Object(x.jsx)(g.EuiCallOut,{size:"s",color:"warning",title:a?u.i18n.translate("xpack.lens.indexPatterns.noFilteredFieldsLabel",{defaultMessage:"No fields match the selected filters."}):t},(n||a||i)&&Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("strong",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.tryText",{defaultMessage:"Try:"})),Object(x.jsx)("ul",null,n&&Object(x.jsx)("li",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.extendTimeBullet",{defaultMessage:"Extending the time range"})),a&&Object(x.jsx)("li",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.fieldTypeFilterBullet",{defaultMessage:"Using different field filters"})),i&&Object(x.jsx)("li",null,u.i18n.translate("xpack.lens.indexPatterns.noFields.globalFiltersBullet",{defaultMessage:"Changing the global filters"}))))):Object(x.jsx)(g.EuiCallOut,{size:"s",color:"warning",title:u.i18n.translate("xpack.lens.indexPatterns.noFieldsLabel",{defaultMessage:"No fields exist in this data view."})}),dc=Object(l.memo)((function({initialIsOpen:e,onToggle:t,id:a,label:n,helpTooltip:s,hasLoaded:r,fieldsCount:o,isFiltered:c,paginatedFields:d,fieldProps:p,renderCallout:m,exists:f,hideDetails:b,showExistenceFetchError:v,showExistenceFetchTimeout:y,groupIndex:j,dropOntoWorkspace:O,hasSuggestionForField:k,editField:I,removeField:T,uiActions:F}){const M=Object(l.useCallback)(((e,t)=>Object(x.jsx)(lc,i()({},p,{key:e.name,field:e,exists:f(e),hideDetails:b,itemIndex:t,groupIndex:j,dropOntoWorkspace:O,hasSuggestionForField:k,editField:I,removeField:T,uiActions:F}))),[p,f,b,O,k,j,I,T,F]),w=Object(l.useMemo)((()=>{const e=h()({lnsInnerIndexPatternDataPanel__titleTooltip:!!s});return Object(x.jsx)(g.EuiText,{size:"xs"},Object(x.jsx)("strong",{className:e},n),!!s&&Object(x.jsx)(g.EuiIconTip,{"aria-label":s,type:"questionInCircle",color:"subdued",size:"s",position:"right",content:s,iconProps:{className:"eui-alignTop"}}))}),[n,s]),_=Object(l.useMemo)((()=>v?Object(x.jsx)(g.EuiIconTip,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.existenceErrorAriaLabel",{defaultMessage:"Existence fetch failed"}),type:"alert",color:"warning",content:u.i18n.translate("xpack.lens.indexPattern.existenceErrorLabel",{defaultMessage:"Field information can't be loaded"})}):y?Object(x.jsx)(g.EuiIconTip,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.existenceTimeoutAriaLabel",{defaultMessage:"Existence fetch timed out"}),type:"clock",color:"warning",content:u.i18n.translate("xpack.lens.indexPattern.existenceTimeoutLabel",{defaultMessage:"Field information took too long"})}):r?Object(x.jsx)(g.EuiNotificationBadge,{size:"m",color:c?"accent":"subdued"},o):Object(x.jsx)(g.EuiLoadingSpinner,{size:"m"})),[v,y,r,c,o]);return Object(x.jsx)(g.EuiAccordion,{initialIsOpen:e,onToggle:t,"data-test-subj":a,id:a,buttonContent:w,extraAction:_},Object(x.jsx)(g.EuiSpacer,{size:"s"}),r&&(o?Object(x.jsx)("ul",{className:"lnsInnerIndexPatternDataPanel__fieldItems"},d&&d.map(M)):m))}));function pc(e,t){return Object.entries(e).filter((([e])=>t[e])).reduce(((e,[,{fields:t}])=>e+t.length),0)}const mc=s.a.memo((function({exists:e,fieldGroups:t,existenceFetchFailed:a,existenceFetchTimeout:n,fieldProps:s,hasSyncedExistingFields:r,filter:o,currentIndexPatternId:u,existFieldsInIndex:c,dropOntoWorkspace:d,hasSuggestionForField:p,editField:m,removeField:f,uiActions:b}){const[h,v]=Object(l.useState)(50),[y,j]=Object(l.useState)(void 0),[O,k]=Object(l.useState)((()=>Object.fromEntries(Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([e,{isInitiallyOpen:t}])=>[e,t])))));Object(l.useEffect)((()=>{y&&(y.scrollTop=0,v(50))}),[o.nameFilter,o.typeFilter,u,y]);const I=Object(l.useCallback)((()=>{y&&y.scrollTop+y.clientHeight>.9*y.scrollHeight&&v(Math.max(50,Math.min(h+25,pc(t,O))))}),[y,h,v,t,O]),T=Object(l.useMemo)((()=>{let e=h;return Object.fromEntries(Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([t,a])=>{if(!O[t]||e<=0)return[t,[]];const n=a.fields.slice(0,e);return e-=n.length,[t,n]})))}),[h,t,O]);return Object(x.jsx)("div",{className:"lnsIndexPatternFieldList",ref:e=>{e&&!e.dataset.dynamicScroll&&(e.dataset.dynamicScroll="true",j(e))},onScroll:Object(Me.throttle)(I,100)},Object(x.jsx)("div",{className:"lnsIndexPatternFieldList__accordionContainer"},Object(x.jsx)("ul",null,Object.entries(t).filter((([,{showInAccordion:e}])=>!e)).flatMap((([,{fields:t}])=>t.map(((t,a)=>Object(x.jsx)(lc,i()({},s,{exists:e(t),field:t,editField:m,removeField:f,hideDetails:!0,key:t.name,itemIndex:a,groupIndex:0,dropOntoWorkspace:d,hasSuggestionForField:p,uiActions:b}))))))),Object(x.jsx)(g.EuiSpacer,{size:"s"}),Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([i,o],u)=>Object(x.jsx)(l.Fragment,{key:i},Object(x.jsx)(dc,{dropOntoWorkspace:d,hasSuggestionForField:p,initialIsOpen:Boolean(O[i]),key:i,id:`lnsIndexPattern${i}`,label:o.title,helpTooltip:o.helpText,exists:e,editField:m,removeField:f,hideDetails:o.hideDetails,hasLoaded:!!r,fieldsCount:o.fields.length,isFiltered:o.fieldCount!==o.fields.length,paginatedFields:T[i],fieldProps:s,groupIndex:u+1,onToggle:e=>{k((t=>({...t,[i]:e})));const a=pc(t,{...O,[i]:e});v(Math.max(50,Math.min(1.5*h,a)))},showExistenceFetchError:a,showExistenceFetchTimeout:n,renderCallout:Object(x.jsx)(cc,{isAffectedByGlobalFilter:o.isAffectedByGlobalFilter,isAffectedByTimerange:o.isAffectedByTimeFilter,isAffectedByFieldFilter:o.fieldCount!==o.fields.length,existFieldsInIndex:!!c,defaultNoFieldsMessage:o.defaultNoFieldsMessage}),uiActions:b}),Object(x.jsx)(g.EuiSpacer,{size:"m"}))))))}));function gc(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}const fc=new Set(["string","number","boolean","date","ip","number_range","date_range","ip_range","histogram","document","geo_point","geo_shape"]),bc={document:u.i18n.translate("xpack.lens.datatypes.record",{defaultMessage:"record"}),string:u.i18n.translate("xpack.lens.datatypes.string",{defaultMessage:"string"}),number:u.i18n.translate("xpack.lens.datatypes.number",{defaultMessage:"number"}),boolean:u.i18n.translate("xpack.lens.datatypes.boolean",{defaultMessage:"boolean"}),date:u.i18n.translate("xpack.lens.datatypes.date",{defaultMessage:"date"}),ip:u.i18n.translate("xpack.lens.datatypes.ipAddress",{defaultMessage:"IP"}),histogram:u.i18n.translate("xpack.lens.datatypes.histogram",{defaultMessage:"histogram"}),geo_point:u.i18n.translate("xpack.lens.datatypes.geoPoint",{defaultMessage:"geo_point"}),geo_shape:u.i18n.translate("xpack.lens.datatypes.geoShape",{defaultMessage:"geo_shape"})};function hc({setState:e,state:t,dragDropContext:a,core:n,data:i,dataViews:r,fieldFormats:o,query:d,filters:p,dateRange:m,changeIndexPattern:f,charts:b,indexPatternFieldEditor:h,showNoDataPopover:v,dropOntoWorkspace:y,hasSuggestionForField:j,uiActions:O}){const{indexPatternRefs:k,indexPatterns:I,currentIndexPatternId:T}=t,F=Object(l.useCallback)((a=>f(a,t,e)),[t,e,f]),M=Object(l.useCallback)((t=>{e((e=>({...e,indexPatterns:{...e.indexPatterns,[t.id]:t}})))}),[e]),w=Object(Me.uniq)(Object.values(t.layers).map((e=>e.indexPatternId)).concat(T)).filter((e=>!!I[e])).sort(((e,t)=>e.localeCompare(t))).map((e=>({id:e,title:I[e].title,timeFieldName:I[e].timeFieldName,fields:I[e].fields,hasRestrictions:I[e].hasRestrictions}))),_=function(e,t,a,n){try{return Object(Un.c)(e,t,a,n)}catch(e){return{bool:{must_not:{match_all:{}}}}}}(I[T],d,p,Object(_i.getEsQueryConfig)(n.uiSettings));return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)(Xu,{load:()=>{var a;return async function({indexPatterns:e,dateRange:t,fetchJson:a,setState:n,isFirstExistenceFetch:i,currentIndexPatternTitle:l,dslQuery:s,showNoDataPopover:r}){const o=e.map((e=>{if(e.hasRestrictions)return{indexPatternTitle:e.title,existingFieldNames:e.fields.map((e=>e.name))};const n={dslQuery:s,fromDate:t.fromDate,toDate:t.toDate};return e.timeFieldName&&(n.timeFieldName=e.timeFieldName),a(`${P.b}/existing_fields/${e.id}`,{body:JSON.stringify(n)})}));try{const e=await Promise.all(o);if(i){const t=e.find((e=>e.indexPatternTitle===l));t&&0===t.existingFieldNames.length&&r()}n((t=>({...t,isFirstExistenceFetch:!1,existenceFetchFailed:!1,existenceFetchTimeout:!1,existingFields:e.reduce(((e,t)=>(e[t.indexPatternTitle]=Uo(t.existingFieldNames),e)),{...t.existingFields})})),{applyImmediately:!0})}catch(t){n((a=>{var n,i;return{...a,existenceFetchFailed:408!==(null===(n=t.res)||void 0===n?void 0:n.status),existenceFetchTimeout:408===(null===(i=t.res)||void 0===i?void 0:i.status),existingFields:e.reduce(((e,t)=>(e[t.title]=Uo(t.fields.map((e=>e.name))),e)),{...a.existingFields})}}),{applyImmediately:!0})}}({dateRange:m,setState:e,isFirstExistenceFetch:t.isFirstExistenceFetch,currentIndexPatternTitle:(null===(a=I[T])||void 0===a?void 0:a.title)||"",showNoDataPopover:v,indexPatterns:w,fetchJson:n.http.post,dslQuery:_})},loadDeps:[d,p,m.fromDate,m.toDate,w.map((e=>`${e.title}:${e.timeFieldName}`)).join(","),t.indexPatterns]}),0===Object.keys(I).length&&0===k.length?Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"m",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:null},Object(x.jsx)(g.EuiCallOut,{"data-test-subj":"indexPattern-no-indexpatterns",title:u.i18n.translate("xpack.lens.indexPattern.noDataViewsLabel",{defaultMessage:"No data views"}),color:"warning",iconType:"alert"},Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.noDataViewDescription",defaultMessage:"Please create a data view or switch to another data source"}))))):Object(x.jsx)(Oc,{currentIndexPatternId:T,indexPatternRefs:k,indexPatterns:I,query:d,dateRange:m,filters:p,dragDropContext:a,core:n,data:i,dataViews:r,fieldFormats:o,charts:b,indexPatternFieldEditor:h,onChangeIndexPattern:F,onUpdateIndexPattern:M,existingFields:t.existingFields,existenceFetchFailed:t.existenceFetchFailed,existenceFetchTimeout:t.existenceFetchTimeout,dropOntoWorkspace:y,hasSuggestionForField:j,uiActions:O}))}const xc={specialFields:[],availableFields:[],emptyFields:[],metaFields:[]},vc=u.i18n.translate("xpack.lens.indexPatterns.fieldFiltersLabel",{defaultMessage:"Filter by type"}),yc=Object(g.htmlIdGenerator)("datapanel")(),jc=function({currentIndexPatternId:e,indexPatternRefs:t,indexPatterns:a,existenceFetchFailed:n,existenceFetchTimeout:i,query:s,dateRange:r,filters:o,dragDropContext:c,onChangeIndexPattern:d,onUpdateIndexPattern:p,core:m,data:f,dataViews:b,fieldFormats:h,indexPatternFieldEditor:v,existingFields:y,charts:j,dropOntoWorkspace:O,hasSuggestionForField:k,uiActions:I}){var T;const[F,M]=Object(l.useState)({nameFilter:"",typeFilter:[],isTypeFilterOpen:!1,isAvailableAccordionOpen:!0,isEmptyAccordionOpen:!1,isMetaAccordionOpen:!1}),w=a[e],_=I.getTrigger(Zu.VISUALIZE_GEO_FIELD_TRIGGER)?w.fields:w.fields.filter((({type:e})=>"geo_point"!==e&&"geo_shape"!==e)),C=()=>M((e=>({...e,nameFilter:"",typeFilter:[]}))),E=y[w.title],S=Object(Me.uniq)(_.map((({type:e})=>e))).filter((e=>e in bc)),P=n||i||w.hasRestrictions,A=v.userPermissions.editIndexPattern(),L=Object(l.useMemo)((()=>{const e=_.filter((e=>fc.has(e.type))).sort(gc),t={...xc,...Object(Me.groupBy)(e,(e=>"document"===e.type?"specialFields":e.meta?"metaFields":(e=>{const t=w.getFieldByName(e.name);return t&&Es(y,w.title,t.name)})(e)?"availableFields":"emptyFields"))},a=m.uiSettings.get("lens:useFieldExistenceSampling"),n={SpecialFields:{fields:t.specialFields,fieldCount:1,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!1,title:"",hideDetails:!0},AvailableFields:{fields:t.availableFields,fieldCount:t.availableFields.length,isInitiallyOpen:!0,showInAccordion:!0,title:P?u.i18n.translate("xpack.lens.indexPattern.allFieldsLabel",{defaultMessage:"All fields"}):u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"}),helpText:a?u.i18n.translate("xpack.lens.indexPattern.allFieldsSamplingLabelHelp",{defaultMessage:"Available fields contain the data in the first 500 documents that match your filters. To view all fields, expand Empty fields. You are unable to create visualizations with full text, geographic, flattened, and object fields."}):u.i18n.translate("xpack.lens.indexPattern.allFieldsLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, select a different data view, edit your queries, or use a different time range. Some field types cannot be visualized in Lens, including full text and geographic fields."}),isAffectedByGlobalFilter:!!o.length,isAffectedByTimeFilter:!0,hideDetails:P&&!i,defaultNoFieldsMessage:u.i18n.translate("xpack.lens.indexPatterns.noAvailableDataLabel",{defaultMessage:"There are no available fields that contain data."})},EmptyFields:{fields:t.emptyFields,fieldCount:t.emptyFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,title:u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"}),defaultNoFieldsMessage:u.i18n.translate("xpack.lens.indexPatterns.noEmptyDataLabel",{defaultMessage:"There are no empty fields."}),helpText:u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabelHelp",{defaultMessage:"Empty fields did not contain any values in the first 500 documents based on your filters."})},MetaFields:{fields:t.metaFields,fieldCount:t.metaFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,title:u.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}),defaultNoFieldsMessage:u.i18n.translate("xpack.lens.indexPatterns.noMetaDataLabel",{defaultMessage:"There are no meta fields."})}};return P&&delete n.EmptyFields,n}),[_,m.uiSettings,P,o.length,i,w,y]),D=Object(l.useMemo)((()=>Object.fromEntries(Object.entries(L).map((([e,t])=>{return[e,{...t,fields:(a=t.fields,a.filter((e=>!(F.nameFilter.length&&!e.name.toLowerCase().includes(F.nameFilter.toLowerCase())&&!e.displayName.toLowerCase().includes(F.nameFilter.toLowerCase()))&&(!(F.typeFilter.length>0)||F.typeFilter.includes(e.type)))))}];var a})))),[L,F.nameFilter,F.typeFilter]),N=Object(l.useCallback)((e=>"document"===e.type||Es(y,w.title,e.name)),[y,w.title]),{nameFilter:z,typeFilter:B}=F,V=Object(l.useMemo)((()=>({nameFilter:z,typeFilter:B})),[z,B]),R=Object(l.useRef)();Object(l.useEffect)((()=>()=>{R.current&&R.current()}),[]);const H=Object(l.useCallback)((async()=>{const e=await Ho({indexPatternsService:b,cache:{},patterns:[w.id]});p(e[w.id]),f.search.session.start()}),[f,b,w,p]),G=Object(l.useMemo)((()=>A?async(e,t="edit")=>{Object(Ya.e)(`open_field_editor_${t}`);const a=await b.get(w.id);R.current=v.openEditor({ctx:{dataView:a},fieldName:e,onSave:async()=>{Object(Ya.e)(`save_field_${t}`),await H()}})}:void 0),[A,b,w.id,v,H]),q=Object(l.useMemo)((()=>A?async e=>{Object(Ya.e)("open_field_delete_modal");const t=await b.get(w.id);R.current=v.openDeleteModal({ctx:{dataView:t},fieldName:e,onDelete:async()=>{Object(Ya.e)("delete_field"),await H()}})}:void 0),[w.id,b,A,v,H]),$=Object(l.useMemo)((()=>A&&G?()=>G(void 0,"add"):void 0),[G,A]),W=Object(l.useMemo)((()=>({core:m,data:f,fieldFormats:h,indexPattern:w,highlight:F.nameFilter.toLowerCase(),dateRange:r,query:s,filters:o,chartsThemeService:j.theme})),[m,f,h,w,r,s,o,F.nameFilter,j.theme]),[U,Y]=Object(l.useState)(!1);return Object(x.jsx)(Ku.a,c,Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"none",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",className:"lnsInnerIndexPatternDataPanel__header",responsive:!1},Object(x.jsx)(g.EuiFlexItem,{grow:!0,className:"lnsInnerIndexPatternDataPanel__switcher"},Object(x.jsx)(Qu,{"data-test-subj":"indexPattern-switcher",trigger:{label:w.title,title:w.title,"data-test-subj":"indexPattern-switch-link",fontWeight:"bold"},indexPatternId:e,indexPatternRefs:t,onChangeIndexPattern:e=>{d(e),C()}})),$&&Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiPopover,{panelPaddingSize:"s",isOpen:U,closePopover:()=>{Y(!1)},ownFocus:!0,"data-test-subj":"lnsIndexPatternActions-popover",button:Object(x.jsx)(g.EuiButtonIcon,{color:"text",iconType:"boxesHorizontal","data-test-subj":"lnsIndexPatternActions","aria-label":u.i18n.translate("xpack.lens.indexPatterns.actionsPopoverLabel",{defaultMessage:"Data view settings"}),onClick:()=>{Y(!U)}})},Object(x.jsx)(g.EuiContextMenuPanel,{size:"s",items:[Object(x.jsx)(g.EuiContextMenuItem,{key:"add",icon:"indexOpen","data-test-subj":"indexPattern-add-field",onClick:()=>{Y(!1),$()}},u.i18n.translate("xpack.lens.indexPatterns.addFieldButton",{defaultMessage:"Add field to data view"})),Object(x.jsx)(g.EuiContextMenuItem,{key:"manage",icon:"indexSettings",onClick:()=>{Y(!1),m.application.navigateToApp("management",{path:`/kibana/indexPatterns/patterns/${w.id}`})}},u.i18n.translate("xpack.lens.indexPatterns.manageFieldButton",{defaultMessage:"Manage data view fields"}))]}))))),Object(x.jsx)(g.EuiFlexItem,{grow:!1},Object(x.jsx)(g.EuiFormControlLayout,{icon:"search",fullWidth:!0,clear:{title:u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),"aria-label":u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),onClick:()=>{Object(Ya.e)("indexpattern_filters_cleared"),C()}}},Object(x.jsx)("input",{className:"euiFieldText euiFieldText--fullWidth lnsInnerIndexPatternDataPanel__textField","data-test-subj":"lnsIndexPatternFieldSearch",placeholder:u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),value:F.nameFilter,onChange:e=>{M({...F,nameFilter:e.target.value})},"aria-label":u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),"aria-describedby":yc})),Object(x.jsx)(g.EuiSpacer,{size:"xs"}),Object(x.jsx)(g.EuiFilterGroup,null,Object(x.jsx)(g.EuiPopover,{id:"dataPanelTypeFilter",panelClassName:"euiFilterGroup__popoverPanel",panelPaddingSize:"none",anchorPosition:"rightUp",display:"block",isOpen:F.isTypeFilterOpen,closePopover:()=>M((()=>({...F,isTypeFilterOpen:!1}))),button:Object(x.jsx)(g.EuiFilterButton,{iconType:"arrowDown",isSelected:F.isTypeFilterOpen,numFilters:F.typeFilter.length,hasActiveFilters:!!F.typeFilter.length,numActiveFilters:F.typeFilter.length,"data-test-subj":"lnsIndexPatternFiltersToggle",onClick:()=>{M((e=>({...e,isTypeFilterOpen:!F.isTypeFilterOpen})))}},vc)},Object(x.jsx)(g.EuiContextMenuPanel,{watchedItemProps:["icon","disabled"],"data-test-subj":"lnsIndexPatternTypeFilterOptions",items:S.map((e=>Object(x.jsx)(g.EuiContextMenuItem,{className:"lnsInnerIndexPatternDataPanel__filterType",key:e,icon:F.typeFilter.includes(e)?"check":"empty","data-test-subj":`typeFilter-${e}`,onClick:()=>{Object(Ya.e)("indexpattern_type_filter_toggled"),M((t=>({...t,typeFilter:F.typeFilter.includes(e)?F.typeFilter.filter((t=>t!==e)):[...F.typeFilter,e]})))}},Object(x.jsx)("span",{className:"lnsInnerIndexPatternDataPanel__filterTypeInner"},Object(x.jsx)(Cs,{type:e})," ",bc[e]))))})))),Object(x.jsx)(g.EuiScreenReaderOnly,null,Object(x.jsx)("div",{"aria-live":"polite",id:yc},u.i18n.translate("xpack.lens.indexPatterns.fieldSearchLiveRegion",{defaultMessage:"{availableFields} available {availableFields, plural, one {field} other {fields}}. {emptyFields} empty {emptyFields, plural, one {field} other {fields}}. {metaFields} meta {metaFields, plural, one {field} other {fields}}.",values:{availableFields:D.AvailableFields.fields.length,emptyFields:(null===(T=D.EmptyFields)||void 0===T?void 0:T.fields.length)||0,metaFields:D.MetaFields.fields.length}}))),Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(mc,{exists:N,fieldProps:W,fieldGroups:D,hasSyncedExistingFields:!!E,filter:V,currentIndexPatternId:e,existenceFetchFailed:n,existenceFetchTimeout:i,existFieldsInIndex:!!_.length,dropOntoWorkspace:O,hasSuggestionForField:k,editField:G,removeField:q,uiActions:I}))))},Oc=Object(l.memo)(jc);function kc({state:e,updatedLayer:t,layerId:a,label:n,changeType:i}){const l=t?{...e,layers:{...e.layers,[a]:t}}:e,s=Object(Me.mapValues)(l.layers,(e=>({...e,columns:Object(Me.pick)(e.columns,e.columnOrder)}))),r=s[a].columnOrder,o=s[a].columns,u=Object.values(o).some((e=>e.isBucketed));return{state:{...l,layers:s},table:{columns:r.filter((e=>!os(s[a],e))).map((e=>({columnId:e,operation:Bc(o[e])}))),isMultiRow:u,layerId:a,changeType:i,label:n},keptLayerIds:Object.keys(e.layers)}}function Ic(e,t){return 0!==Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t[0].indexPatternId)).length?[]:function(e,t){const a=[];for(let n=0;n<t.length;n++){const i=t[n],l=e.indexPatterns[i.indexPatternId];if(!l)return[];const s=Object(Xt.a)();let r;if(l.timeFieldName&&(r=Tc(l,i)),r){const i=kc({state:e,updatedLayer:r,layerId:s,changeType:"initial"}),l=Object.keys(i.state.layers)[0];t[n].layerId=l,a.push(i)}}return a}(e,t)}function Tc(e,t){const{timeFieldName:a,splitMode:n,splitFilters:i,metrics:l,timeInterval:s,dropPartialBuckets:r}=t,o=e.getFieldByName(a),u=t.splitFields?t.splitFields.map((t=>e.getFieldByName(t))).filter(Boolean):null;if("terms"===n&&null!=u&&u.length)return function(e,t,a,n){const{termsParams:i,metrics:l,timeInterval:s,splitWithDateHistogram:r,dropPartialBuckets:o}=n,u=[...l],c=hs(1===l.length,u,e,n.format,n.label),[d,...p]=t,m=Object(Xt.a)();let g=$l({op:r?"date_histogram":"terms",layer:$l({op:"date_histogram",layer:c,columnId:Object(Xt.a)(),field:a,indexPattern:e,visualizationGroups:[],columnParams:{interval:s,dropPartials:o}}),columnId:m,field:d,indexPattern:e,visualizationGroups:[]});p.length&&(g=ts({layer:g,columnId:m,paramName:"secondaryFields",value:p.map((e=>e.name))}),g=ms(g,e));const f=i;if(f)for(const[e,t]of Object.entries(f)){let a=t;if("orderBy"===e){const[e]=Object.keys(g.columns).filter((e=>zl(g,e)));a="column"===f.orderBy.type&&e?{type:"column",columnId:e}:{type:"alphabetical",fallback:!0}}g=ts({layer:g,columnId:m,paramName:e,value:a})}return g}(e,u,o,t);if(null!=n&&n.includes("filter")&&i&&i.length)return function(e,t,a){const{splitFilters:n,metrics:i,timeInterval:l,dropPartialBuckets:s}=a,r=null==n?void 0:n.map((e=>{var t;return{input:{query:e.filter?e.filter.query:"",language:e.filter?e.filter.language:"kuery"},label:null!==(t=e.label)&&void 0!==t?t:""}})),o=[...i],u=hs(1===i.length,o,e,a.format,a.label),c=Object(Xt.a)();let d=$l({op:"filters",layer:$l({op:"date_histogram",layer:u,columnId:Object(Xt.a)(),field:t,indexPattern:e,visualizationGroups:[],columnParams:{interval:l,dropPartials:s}}),columnId:c,field:void 0,indexPattern:e,visualizationGroups:[]});return r&&(d=ts({layer:d,columnId:c,paramName:"filters",value:r})),d}(e,o,t);{const a=[...l],n=hs(1===l.length,a,e,t.format,t.label);return Object.values(n.columns)[0].isStaticValue?n:$l({op:"date_histogram",layer:n,columnId:Object(Xt.a)(),field:o,indexPattern:e,visualizationGroups:[],columnParams:{interval:s,dropPartials:r}})}}function Fc(e,t,a){const n=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t)),i=e.indexPatterns[t].getFieldByName(a);if(0!==n.length||!i)return[];const l=Object(Xt.a)();return wc(e,l,t,i).concat(wc({...e,layers:{}},l,t,i))}function Mc(e){if("number"!==e.type)return No(e).find((e=>"date_histogram"===e||"terms"===e))}function wc(e,t,a,n){const i=e.indexPatterns[a];let l;const s=Mc(n);s?l=function(e,t,a){return $l({op:a,layer:$l({op:"count",layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(Xt.a)(),field:Ki,indexPattern:e,visualizationGroups:[]}),columnId:Object(Xt.a)(),field:t,indexPattern:e,visualizationGroups:[]})}(i,n,s):i.timeFieldName&&No(n).length>0&&(l=function(e,t){const a=e.getFieldByName(e.timeFieldName),[n]=Jl(t);if(n)return $l({op:"date_histogram",layer:$l({op:n.type,layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(Xt.a)(),field:t,indexPattern:e,visualizationGroups:[]}),columnId:Object(Xt.a)(),field:a,indexPattern:e,visualizationGroups:[]})}(i,n));const r=l?[kc({state:e,updatedLayer:l,layerId:t,changeType:"initial"})]:[],o=Cc(i,t,e,n);return o?r.concat(o):r}function _c(e,t=(()=>!0)){const a=Object.entries(e.layers||{}).filter((([e])=>t(e)));return a.length>1?a.map((([t,n],i)=>{const l=a.some((([e,a])=>e!==t&&a.indexPatternId===n.indexPatternId))?u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerPositionLabel",{defaultMessage:"Show only layer {layerNumber}",values:{layerNumber:i+1}}):u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerLabel",{defaultMessage:"Show only {indexPatternTitle}",values:{indexPatternTitle:e.indexPatterns[n.indexPatternId].title}});return kc({state:{...e,layers:{[t]:n}},layerId:t,changeType:"layers",label:l})})).concat([kc({state:e,layerId:a[0][0],changeType:"unchanged"})]):Object(Me.flatten)(a.filter((([e,t])=>t.columnOrder.length&&t.indexPatternId)).map((([t,a])=>{const n=e.indexPatterns[a.indexPatternId],[i,l,s]=ls(a),r=a.columnOrder.find((e=>a.columns[e].isBucketed&&"date"===a.columns[e].dataType)),o=(null==n?void 0:n.timeFieldName)&&n.getFieldByName(n.timeFieldName),u=1===i.length&&i.some((e=>"number"===a.columns[e].dataType)),c=[];return c.push(kc({state:e,layerId:t,changeType:"unchanged"})),!s.length&&l.length&&0===i.length?(o&&i.length<1&&!ds(a)&&c.push(Sc(e,t,o)),n&&c.push(...function(e,t,a){const n=a.layers[t],i=[];return n.columnOrder.filter((e=>!os(n,e))).forEach((l=>{const s=n.columns[l];if(!al(s))return;const r=e.getFieldByName(s.sourceField);if(!r)return;const o=Jl(r).filter((({type:e})=>e!==s.operationType));if(o.length){const s=Wl({layer:n,indexPattern:e,field:r,columnId:l,op:o[0].type,visualizationGroups:[]});s&&i.push(kc({state:a,layerId:t,updatedLayer:s,changeType:"initial"}))}})),i}(n,t,e))):(c.push(...function(e,t){const a=e.layers[t],[n,i]=Object(Me.partition)(a.columnOrder,(e=>a.columns[e].isBucketed)),l=i.filter((e=>!os(a,e)));return Object(Me.flatten)(n.map(((e,t)=>{const s=n.slice(0,t+1),r={...a,columnOrder:[...s,...i],noBuckets:!1};return s.length>0&&l.length>1?[{...a,columnOrder:[...s,l[0],...cs(a,l[0])],noBuckets:!1}]:n.length>1?r:[]}))).concat(n.length>0||l.length>1?l.map((e=>({...a,columnOrder:[e,...cs(a,e)],noBuckets:!0}))):[]).map((({noBuckets:a,...n})=>kc({state:e,layerId:t,updatedLayer:n,changeType:"reduced",label:a?Pc(n,1===i.length):void 0})))}(e,t)),!r&&o&&i.length<2&&!u&&!ds(a)&&c.push(Sc(e,t,o)),2===i.length&&c.push(function(e,t){var a,n;const i=e.layers[t],[l,s,...r]=i.columnOrder,o={...i,columnOrder:[s,l,...r]},u=e.indexPatterns[e.currentIndexPatternId],c=i.columns[l],d=al(c)&&(null===(a=u.getFieldByName(c.sourceField))||void 0===a?void 0:a.displayName)||"",p=i.columns[s];return kc({state:e,layerId:t,updatedLayer:o,label:Ec([al(p)&&(null===(n=u.getFieldByName(p.sourceField))||void 0===n?void 0:n.displayName)||"",d]),changeType:"reorder"})}(e,t))),c})))}function Cc(e,t,a,n){const[i]=Jl(n);if(i)return kc({layerId:t,state:a,changeType:"initial",updatedLayer:$l({layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(Xt.a)(),op:i.type,field:"count"===i.type?Ki:n,indexPattern:e,visualizationGroups:[]})})}function Ec([e,t]){return u.i18n.translate("xpack.lens.indexpattern.suggestions.nestingChangeLabel",{defaultMessage:"{innerOperation} for each {outerOperation}",values:{innerOperation:t,outerOperation:e}})}function Sc(e,t,a){const n=e.layers[t];return kc({state:e,layerId:t,updatedLayer:$l({layer:n,indexPattern:e.indexPatterns[n.indexPatternId],field:a,op:"date_histogram",columnId:Object(Xt.a)(),visualizationGroups:[]}),label:u.i18n.translate("xpack.lens.indexpattern.suggestions.overTimeLabel",{defaultMessage:"Over time"}),changeType:"extended"})}function Pc(e,t){const{operationType:a,label:n}=e.columns[e.columnOrder[0]];return u.i18n.translate("xpack.lens.indexpattern.suggestions.overallLabel",{defaultMessage:"{operation} overall",values:{operation:t?Co[a].displayName:n},description:"Title of a suggested chart containing only a single numerical metric calculated over all available data"})}function Ac({state:e,layerId:t,onChangeIndexPattern:a}){const n=e.layers[t],i=e.indexPatterns[n.indexPatternId],l=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"});return Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Qu,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==i?void 0:i.title)||l,title:(null==i?void 0:i.title)||l,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal"},indexPatternId:n.indexPatternId,indexPatternRefs:e.indexPatternRefs,isMissingCurrent:!i,onChangeIndexPattern:a}))}const Lc=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",{width:"176",height:"176",viewBox:"0 0 176 176",xmlns:"http://www.w3.org/2000/svg"},Object(x.jsx)("path",{d:"M88 152c35.346 0 64-28.654 64-64 0-13.35-4.087-25.745-11.079-36.002L51.998 140.92C62.255 147.913 74.65 152 88 152zm-58.277-.083l-5.64-5.64 15.93-15.929C30.047 119.064 24 104.238 24 88c0-35.346 28.654-64 64-64 16.238 0 31.064 6.047 42.348 16.013l15.929-15.93 5.64 5.64L29.723 151.917z",fill:"#F9B110"}),Object(x.jsx)("path",{d:"M87.992 151.961h-2.248a76.025 76.025 0 01-.679-.027v-36.978h-7.102l5.87-5.869h1.232v-1.233L90.92 102v7.087h28.52a121.923 121.923 0 001.806-21.048 122.722 122.722 0 00-.951-15.414l10.102-10.102H146.7a67.977 67.977 0 012.211 5.869h-23.228a132.499 132.499 0 011.432 19.647 132.001 132.001 0 01-1.65 21.048h22.963a64.832 64.832 0 01-2.366 5.838h-21.687c-2.957 13.793-8.126 25.36-14.758 33.315a63.132 63.132 0 01-4.943 1.567 63.66 63.66 0 01-7.399 1.526c9.248-5.54 16.955-19.087 20.982-36.377H90.919v36.979c-.22.01-.442.018-.663.026h-2.264zm35.642-93.956l-10.387 10.387 10.387-10.386zM90.919 90.721l-5.854 5.853 5.854-5.854zm0-11.28l-5.854 5.854V68.392h-28.77a122.988 122.988 0 00.25 40.695h4.728l-8.941 8.941a111.251 111.251 0 01-.707-3.072H29.94l-.22-.509c-.755-1.75-1.523-3.529-2.162-5.36H50.52a132.014 132.014 0 01-1.65-21.017 134.648 134.648 0 011.432-19.647H27.09a67.9 67.9 0 012.21-5.869h21.967c2.88-14.4 8.173-26.497 15.039-34.732a64.165 64.165 0 0112.454-3.114c-9.527 5.683-17.42 19.834-21.344 37.815h27.68V24.117c.966-.078 1.93-.078 2.912-.078.492 0 .98.02 1.467.039.483.02.963.039 1.444.039v38.375h16.949l-5.9 5.9h-11.05v11.049zm25.363-25.363l4.804-4.804c-2.947-8.592-6.862-15.903-11.486-21.483a64.417 64.417 0 00-12.454-3.114c7.985 4.762 14.822 15.473 19.136 29.401zM54.881 126.76l4.74-4.74-4.74 4.74zm11.802-11.803l5.87-5.869-5.87 5.869zm-4.036 15.316l-4.551 4.551c2.385 5.173 5.168 9.702 8.271 13.429a63.532 63.532 0 0012.27 3.068c-6.257-3.801-11.806-11.256-15.99-21.048z",fill:"#FEC514"}),Object(x.jsx)("path",{d:"M115.909 138.807c.444-.825.878-1.669 1.299-2.534a1.56 1.56 0 011.223.823c.156.498-.732 1.868-1.401 2.055a1.381 1.381 0 01-1.121-.344zm-5.488-2.505c-.226.416-.455.826-.687 1.23a5.47 5.47 0 01-1.048.171 1.03 1.03 0 01-.826-.342 1.284 1.284 0 010-1.043c.172-.249.701-.514.919-.421.439.311.975.454 1.51.405h.132zm3.41-7.241l-.084.207c-.191.429-.39.896-.578 1.352a.959.959 0 01-.293-.295.958.958 0 01-.143-.39.764.764 0 01.623-.872c.156-.038.319-.039.475-.002zm-28.766 20.867v2.004c-.352-.013-.705-.044-1.057-.074-.464-.04-.928-.08-1.392-.081l-.02-.002c.377-.244.81-.388 1.259-.419a1.83 1.83 0 01.902.125.99.99 0 01-.124-.296 1.715 1.715 0 01.432-1.257zm0-4.223v3.069a1.278 1.278 0 01-.12-.578v-.654a2.033 2.033 0 01-2.149.28 8.458 8.458 0 01-1.697-1.463 1.323 1.323 0 01.39-2.179 2.57 2.57 0 01-1.075-.779 2.03 2.03 0 01-.234.67c-.128.235-.31.437-.529.591-.273.225-.6.376-.95.436.078.027.15.064.219.109a1.402 1.402 0 01.155 1.884 1.438 1.438 0 01-.94.79 1.424 1.424 0 01-1.208-.23 1.415 1.415 0 01-.639-1.79 2.202 2.202 0 011.557-.825l-.249-.109a2.45 2.45 0 01-1.183-1.464c-.327-.327-.576-.685-.483-.856.183-.217.42-.383.685-.482.67-1.075 1.293-1.23 2.647-.576.431.189.79.511 1.028.918a2.477 2.477 0 011.043-1.728 14.152 14.152 0 011.946-.483c-.032-.669.373-1.058 1.198-1.058h.094a.682.682 0 01.494-.11v1.56a.449.449 0 01-.541-.002c-.348.373-.329.766-.307 1.21.005.112.011.227.011.346a2.085 2.085 0 01-1.043 2.024c.717.367 1.355.87 1.88 1.479zm0-3.296v.909a1.091 1.091 0 01-.136-.259.718.718 0 01.136-.65zm0-7.629v2.477a1.282 1.282 0 01-.875.557 1.276 1.276 0 01-1.005-.282 1.247 1.247 0 01-.545-1.759 2.208 2.208 0 012.289-.856l.136-.137zM65.94 147.731c.142.176.284.349.427.521a67.88 67.88 0 01-.447-.163v-.22c0-.037.011-.096.02-.138zm-5.292-7.889c.449.801.908 1.582 1.378 2.341a1.427 1.427 0 01-.325-.105 1.154 1.154 0 01-.81-.42.86.86 0 010-.296 1.87 1.87 0 01-.243-1.52zm-1.22-2.279c.247.485.5.963.755 1.435a.851.851 0 01-.413.569.85.85 0 01-.746.051 5.625 5.625 0 00-.7-.171 2.195 2.195 0 01-1.309 2.335 2.055 2.055 0 01-2.382-1.074v-.234a1.551 1.551 0 01-.778-.155 1.871 1.871 0 01-.716 1.323 62.51 62.51 0 01-1.112-.75l4.416-4.417a1.727 1.727 0 011.18.294 1.786 1.786 0 001.804.794zm-1.184-2.421c.125.269.251.535.379.8a1.056 1.056 0 01-.379-.8zm-13.376-9.65l-.904.904a.94.94 0 01.255-.54.76.76 0 01.65-.364zm2.423-2.423l-.1.099a.38.38 0 00-.077-.099h.177zm-16.669-8.113h4.681a.946.946 0 01-.005.127c-.23.447-.597.517-.97.588a5.091 5.091 0 00-.244.05l-.436.109h.109a2.026 2.026 0 011.557 1.464h.187a1.076 1.076 0 011.276.794 1.119 1.119 0 01-.685 1.354.981.981 0 01-1.152-.56 2.466 2.466 0 01-1.946.934 1.738 1.738 0 01-.723-.324 62.044 62.044 0 01-.78-1.42 3.119 3.119 0 01.009-.701 1.56 1.56 0 01.56-1.152 1.992 1.992 0 01-1.438-1.263zm48.905 35.918c.048.187.048.383.001.57a15.906 15.906 0 01-.217-.029l-.656-.105c-.292-.175-.584-.377-.876-.578l-.107-.074-.185-.127c.129-.249.323-.459.56-.607a1.017 1.017 0 010-.763 1.424 1.424 0 011.044-.716 1.082 1.082 0 011.122.95 1.09 1.09 0 01-.064.529 1.23 1.23 0 01-.653.561c.031.127.042.258.03.389zm-17.312-4.437c.01.053.014.108.012.162a63.978 63.978 0 01-6.015-3.039c.159-.192.366-.339.601-.423a3.55 3.55 0 011.059-.576c.421-.141.763.021 1.118.188.275.13.557.263.89.263a2.281 2.281 0 011.76.841c.309.4.468.895.45 1.401a4.07 4.07 0 010 .747c.055.141.097.287.125.436zm29.171 5.475a64.518 64.518 0 003.223-.249 1.388 1.388 0 00-1.133-.618 5.86 5.86 0 00-1.277.016c.228-.447.294-.959.187-1.448a1.852 1.852 0 00-1.463-1.355v3.659c.154 0 .309-.002.463-.005zm25.699-6.887c.331-.17.661-.342.989-.517l.139-.079c.074-.174.121-.358.14-.545a1.67 1.67 0 00-.576-1.479 4.637 4.637 0 01-.44-.319h-.001c-.337-.265-.656-.516-1.007-.428a1.035 1.035 0 00-.747.544c-.041.066-.09.127-.141.19-.143.177-.299.369-.31.713a2.223 2.223 0 00.747 1.806c.229.17.496.282.778.327l.228-.113.201-.1zm-72.85-92.93a1.65 1.65 0 00-1.558-2.896 1.697 1.697 0 00-.654 2.304 1.76 1.76 0 002.211.592zM38.77 55.8a2.07 2.07 0 00.98-2.522 1.977 1.977 0 00-2.428-1.12 2.008 2.008 0 00-1.417 2.303 2.6 2.6 0 002.865 1.34zm4.24-2.034c.115-.084.245-.144.383-.176a1.557 1.557 0 011.915.716 1.23 1.23 0 01-.7 1.556 1.774 1.774 0 01-1.993-.965 1.06 1.06 0 01.395-1.13zm-5.813 4.39a1.09 1.09 0 01.747-.13c.883.073.878.723.873 1.377v.149c1.82.14 2.226.42 2.226 1.323a2.322 2.322 0 01-1.106 1.635h-1.292a2.429 2.429 0 01-.7-2.008 13.872 13.872 0 00-.46-.39c-.275-.23-.539-.449-.77-.7a.825.825 0 010-.67 1.09 1.09 0 01.482-.586zm-6.4 13.32a.903.903 0 01.31-.311.951.951 0 011.292.685.638.638 0 010 .265c.087-.11.186-.21.296-.296a.606.606 0 01.856.171c.438.015.864.15 1.23.39a1.246 1.246 0 01.374 1.556 1.853 1.853 0 01-1.868.654 1.853 1.853 0 01-.748-1.37 1.168 1.168 0 01-.498-.607.778.778 0 01-.84.109 1.12 1.12 0 01-.53-.825.904.904 0 01.127-.42zm9.3 11.502c.233 0 .529-.265.575-.498.047-.234-.155-.608-.435-.623a.544.544 0 00-.577.39.81.81 0 00.436.73zm-.05 14.544c.186-.389.824-.436 1.65-.124a.795.795 0 01.576 1.105c-.28.483-1.168.919-1.557.732a1.774 1.774 0 01-.67-1.713zm2.163 8.672c.42-.281.903.015 1.043.529.11.374.14.732-.327.919a1.057 1.057 0 01-1.166-.312 1.073 1.073 0 01-.204-.373 3.21 3.21 0 01.654-.763zm31.225 18.686a1.095 1.095 0 01-.494.073.751.751 0 01-.434-.522.765.765 0 01.154-.661c.218-.187.888-.576 1.183-.358.296.218.156.965 0 1.183a1.093 1.093 0 01-.409.285zm.705 8.106a1.695 1.695 0 00-.514-2.024.948.948 0 00-1.338.343 1.462 1.462 0 00.218 1.915 1.18 1.18 0 001.634-.234zm.39-1.93a1.425 1.425 0 001.147.149 1.417 1.417 0 00.876-.756 1.714 1.714 0 00-.296-2.18 2.056 2.056 0 00-2.241.638 1.419 1.419 0 00.513 2.149zm-34.748-25.407c-.094.031-.327.062-.42-.125a.31.31 0 01.077-.42c.09-.045.164.015.245.082a.93.93 0 00.098.074c.124.077.093.358 0 .389zm.794-3.425c-.748-.561-1.261-.436-1.869.42-.607.856-.529 1.557 0 1.868a2.453 2.453 0 002.335-.342 1.387 1.387 0 00-.466-1.946zm26.805 26.793a2 2 0 01-.028 1.229c-.312.561-1.417.576-2.382-.062a1.353 1.353 0 01-.28-1.557 1.871 1.871 0 011.992-.623c.334.256.578.61.698 1.013zm4.33-2.196a1.56 1.56 0 00-.856-.171c.14-.257.183-.555.125-.841a1.886 1.886 0 00-2.024-1.183c-.592.14-1.043 1.214-.856 2.024a1.381 1.381 0 001.074 1.074 1.56 1.56 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.165 1.165 0 00-.186-1.728zm2.602 8.123c-.066.169-.134.346-.235.346-.203.031-.732.031-.794-.233-.062-.265.327-.592.451-.592.234.059.456.159.654.296-.026.052-.05.117-.076.183zM37.789 94.876c.156-.607.498-1.121 1.23-.934.733.198.657.846.58 1.502l-.004.039c-.27.135-.572.19-.872.156.031.31-.047 1.074-.374 1.183-.326.109-.871-.436-.965-.685a1.058 1.058 0 01.218-.934.56.56 0 01.327-.125c-.054-.062-.1-.13-.14-.202zm.47-5.461a.902.902 0 00.171 1.354 1.106 1.106 0 001.557-.124 1.043 1.043 0 00-.327-1.464.935.935 0 00-1.4.234zm45.032 41.572a.693.693 0 01.252-.258.628.628 0 01.607.264c.041.124-.026.281-.108.472a3.526 3.526 0 00-.125.322c-.106-.06-.219-.111-.322-.158-.216-.097-.394-.177-.394-.293a.698.698 0 01.09-.349zm.377-5.24a.704.704 0 00-.847-.192.704.704 0 00-.243.192c-.327.405-.311 1.199.125 1.339.435.14 1.23.327 1.556-.14.29-.414-.204-.853-.493-1.11l-.064-.058a.704.704 0 01-.034-.031zm9.512 1.51c.607-.202 1.666.218 1.448 1.074a2.55 2.55 0 01-3.083 1.51 2.92 2.92 0 01-.623-.467v-2.802a1.265 1.265 0 011.34.311c.148.115.234.214.3.29.15.17.198.224.618.084zm.218 5.075c-.218-.887-1.168-1.556-1.853-1.385a1.735 1.735 0 00-.623.389v2.273c.423.231.911.313 1.386.233a1.266 1.266 0 001.084-.992c.037-.17.04-.346.006-.518zm-1.775 2.6c.483.125.607.67.327 1.137-.265.404-.514.591-.965.404v-1.541c.21-.039.427-.039.638 0zm-11.645.841a1.559 1.559 0 001.915 0c-.202-1.043-.53-1.557-1.074-1.401-.545.155-.903.716-.84 1.401zm-2.989-2.491a2.33 2.33 0 01.343-1.09 2.006 2.006 0 012.475-.607 1.434 1.434 0 011.417-.95 1.798 1.798 0 011.385 1.37 1.417 1.417 0 01-1.09 1.542.947.947 0 01-.716-.281 2.64 2.64 0 01-.358.857 1.82 1.82 0 01-1.759 1.043v.109a2.008 2.008 0 010 2.101.378.378 0 01.171.094 1.066 1.066 0 01.49.713 1.072 1.072 0 01-.194.844 1.137 1.137 0 01-1.463.404.963.963 0 01-.374-1.214 2.446 2.446 0 01-2.008-.716.844.844 0 01-.078-.125.606.606 0 01-.498.234 1.058 1.058 0 01-.794-.529c-.078-.234.156-1.059.342-1.137.187-.078.514.125.763.358a2.649 2.649 0 01.996-1.557 1.552 1.552 0 011.215-.373 1.822 1.822 0 01-.267-1.047c-.028.248-.425.595-.605.595a.727.727 0 01-.623-.358c-.046-.202.25-.56.42-.607.172-.047.81.078.81.327zm3.503-15.615a.343.343 0 00-.14-.404c-.094 0-.327 0-.374.14a.652.652 0 00-.008.29c.004.033.008.061.008.083a.311.311 0 00.514-.109zm2.11 5.675a1.57 1.57 0 01-1.176-.241c-.716-.374-1.12-1.37-.763-1.9a2.105 2.105 0 012.522-.7 1.569 1.569 0 01-.582 2.841zm22.332 14.688a.82.82 0 00.593-.312.816.816 0 00.154-.653c0-.887-.405-1.432-.825-1.432a1.787 1.787 0 00-1.246 1.354c0 .467.794 1.043 1.324 1.043zm2.257-5.262c.234.919-.124 1.868-.763 2.009-.467.14-1.416-.592-1.557-1.153-.14-.56.483-1.307 1.246-1.463a.786.786 0 01.682.048.788.788 0 01.392.559zm.576-5.635c.134-.208-.076-.645-.263-1.034a9.273 9.273 0 01-.142-.305c0-.082-.128-.124-.295-.178a2.951 2.951 0 01-.281-.102c-.063.15-.176.308-.292.47-.256.357-.524.733-.299 1.086a.963.963 0 001.572.063zm-6.679.965c.032.218.016.809-.249.809-.264.047-.576-.358-.576-.482a2.01 2.01 0 01.312-.639c.062.037.137.059.21.081.145.044.283.086.303.231zm-4.763 11.489c.035.209.109.41.218.592a.947.947 0 00-.53.264c-.22.272-.325.618-.296.965.11.623.576.794 1.744.717a5.12 5.12 0 00.327-.888c.332.146.7.195 1.059.14a2.426 2.426 0 001.556-2.537 1.552 1.552 0 00-.513-.81 2.41 2.41 0 00.186-1.261 1.372 1.372 0 001.697.81 1.717 1.717 0 001.436-1.507 1.713 1.713 0 00-.081-.735 1.807 1.807 0 00-1.993-1.401c-.809.14-1.37 1.292-1.214 2.366a1.401 1.401 0 00-.607-.778 2.99 2.99 0 00-3.114.731 1.964 1.964 0 00.311 2.242 1.838 1.838 0 00-.186 1.09zm-.623-6.414c-.203.389-.452.607-.903.389a1.06 1.06 0 01-.579-1.111c.023-.148.077-.289.159-.414.33-.049.665-.049.996 0a.708.708 0 01.463.481.718.718 0 01-.136.655zm2.942.483a2.199 2.199 0 001.339-2.367 1.602 1.602 0 00-2.962-.028 1.605 1.605 0 00-.011 1.227c.249.872 1.027 1.37 1.634 1.168zm1.03-7.534a.744.744 0 01-.267.263c-.202.047-.545-.264-.592-.436-.046-.171.094-.809.343-.809.249 0 .623.436.623.623a.745.745 0 01-.106.359zm-21.61 14.197c0 .638 1.245 1.245 1.68.918.437-.327 0-1.759-.606-1.806a1.077 1.077 0 00-1.075.888zm-41.707-35.246c-.153.45-.455.835-.856 1.09a.983.983 0 01-.841-.234 1.794 1.794 0 01-1.464-.202 1.557 1.557 0 01-.186-1.822c.12-.376.162-.774.124-1.167a2.348 2.348 0 010-.327h-.109a2.043 2.043 0 01-.87-2.218c.07-.275.197-.533.372-.756.178-.24.421-.424.7-.53a1.338 1.338 0 011.168-1.867c.191-.029.385-.029.576 0 .507.177.722.483.928.777.281.401.546.78 1.516.78a.935.935 0 01.53.731c.342-.373 1.152-.638 1.556 0a2.553 2.553 0 01-.996 3.269 2.575 2.575 0 01-1.806 0 1.787 1.787 0 01-1.448 0l-.186-.155a.67.67 0 010 .171c.082.157.154.318.218.483a1.169 1.169 0 011.058.591c.163.447.169.936.016 1.386zm-2.74 2.382a1.748 1.748 0 00-1.977.06 1.742 1.742 0 00-.468.516 1.401 1.401 0 00-.155 1.043h3.69c.046-.623-.359-.981-1.09-1.619zm5.65-.218c.179.195.307.43.374.685.08.379.122.765.125 1.152h-2.942a1.448 1.448 0 01-.312-.981 1.556 1.556 0 01.748-1.105.952.952 0 01.825-.934 1.01 1.01 0 011.183.731c.03.149.03.303 0 .452zm29.206 25.749a2.209 2.209 0 002.413 1.277 1.595 1.595 0 10-1.198-2.958c.123-.109.224-.241.296-.389a.873.873 0 00-.405-1.277 1.152 1.152 0 00-1.463.405 1.12 1.12 0 00.466 1.432.93.93 0 00.576 0 1.323 1.323 0 00-.685 1.51zm7.771 8.671c-.383.198-.808.418-1.014.296a.976.976 0 01-.382-.806.978.978 0 01.429-.782c.323-.229.687.016 1.043.254.175.118.349.235.513.291-.043.098-.075.2-.104.291-.053.169-.095.301-.176.301-.096.044-.2.098-.308.154v.001zm29.141-.887c-.171-.405.218-.903 1.012-1.308a.793.793 0 011.168.39 1.56 1.56 0 01-.452 1.556 1.769 1.769 0 01-1.728-.638zm-22.48 7.146c-.98-.592-1.868-.576-2.258 0a1.932 1.932 0 00.436 2.039 1.988 1.988 0 002.087-.763.877.877 0 00.147-.696.885.885 0 00-.412-.58zm-12.75-7.566c.133.054.266.095.382.13.184.056.327.099.365.166.017.03-.025.139-.086.302-.163.429-.465 1.227-.194 1.893a2.384 2.384 0 003.118.885c.354-.181.658-.448.883-.776a1.963 1.963 0 00-.172-2.164c-.286-.286-.75-.45-1.13-.584-.323-.113-.586-.206-.629-.335-.031-.094.045-.269.143-.494.192-.444.468-1.081.169-1.67a1.555 1.555 0 00-1.247-.869c.15.013.302.012.453-.003a1 1 0 00.812-.909.996.996 0 00-.065-.429 1.37 1.37 0 00-1.557-1.028 1.356 1.356 0 00-.98 1.557 1.229 1.229 0 001.151.841c-.27.001-.539.048-.793.14a2.951 2.951 0 00-1.308 2.444.959.959 0 00-.779-.218c-.38.15-.698.424-.903.778a24.62 24.62 0 001.09 1.557c.237.037.479.037.716 0a.824.824 0 00.592-1.09.125.125 0 01-.031-.124zm-2.058-3.606a1.82 1.82 0 01-1.056.757 2.143 2.143 0 01-.591.062 65.347 65.347 0 01-3.379-6.772 1.744 1.744 0 011.557 1.355c.1.446.1.908 0 1.354a2.224 2.224 0 012.74-.498 2.1 2.1 0 01.872 2.133.73.73 0 01.14.342 1.82 1.82 0 01-.283 1.267zm25.659 7.513a1.135 1.135 0 00-.436-.918 1.292 1.292 0 001.276-1.199c0-.682-.381-1.081-.606-1.316-.11-.114-.182-.19-.156-.241l.014-.027c.113-.222.594-1.159-.014-1.529a1.558 1.558 0 00-1.043-.25 1.716 1.716 0 00-.857-1.307 1.273 1.273 0 00-.871-.249v3.923c.196.214.216.417.236.627.032.322.065.661.744 1.085.194.117.404.206.623.265-.278.067-.518.24-.67.483a1.098 1.098 0 00-.215.823 1.098 1.098 0 00.433.733h.187c-.16.307-.204.66-.124.997a.58.58 0 00.14.218 1.32 1.32 0 00-.576 1.432 1.108 1.108 0 001.36.57c.17-.059.323-.158.446-.29a1.463 1.463 0 00.233-1.23h.203a1.37 1.37 0 001.183-1.479 1.82 1.82 0 00-1.51-1.121zm-21.375 1.744a2.711 2.711 0 011.557-1.339 1.571 1.571 0 011.219.229 1.564 1.564 0 01.665 1.048 1.929 1.929 0 01-.654 2.039 1.284 1.284 0 01-.094.327c-.047.066-.1.129-.156.187a34.636 34.636 0 01-2.537-2.491zm39.807-.887a.573.573 0 000 .7.79.79 0 00.825.156c.218-.125.141-.561 0-.763a.608.608 0 00-.825-.093zm14.121-10.309a.99.99 0 01.404.516c.203.545-.373 1.293-1.261 1.744a4.745 4.745 0 01-.08.425c-.046.213-.091.421-.091.618-.552.444-1.17.398-1.759.353-.175-.013-.347-.026-.514-.026a.717.717 0 01-.389-1.261 20.077 20.077 0 011.697-1.152c.202-1.043.467-1.37 1.354-1.37a.994.994 0 01.639.153zm-5.558-1.57s-.327.389-.28.514c.046.125.389.576.653.529.265-.046.312-.622.249-.716a1.055 1.055 0 00-.622-.327zm-25.084 18.02c0-.097.029-.191.082-.272.186-.312.731-.14.794-.031a.873.873 0 01.217.451l-1.011.125a.5.5 0 01-.081-.273zm28.244-19.374c.374-.498-.592-1.557-1.277-1.557-.685 0-1.276.887-1.058 1.386.218.498 1.977.669 2.335.171zm-14.163.217c.122-.254.339-.449.603-.544a1.556 1.556 0 011.604.856c.124.389-.483 1.246-.981 1.37a1.202 1.202 0 01-1.277-.872 1.074 1.074 0 01.051-.81zm-10.434 12.159a1.806 1.806 0 00-2.367.639 2.116 2.116 0 00-.296 1.074 1.674 1.674 0 00-1.005.805 1.664 1.664 0 00-.131 1.281 2.102 2.102 0 002.366 1.557 2.225 2.225 0 001.557-1.9 1.29 1.29 0 00.358-.358 2.46 2.46 0 00-.483-3.098zm-1.448 6.663c-.25-.28-.405-.622-.25-.825a2.573 2.573 0 011.806-.28c-.499.396-1.018.765-1.556 1.105zm2.475-8.936a.964.964 0 00-.607.432.946.946 0 00-.11.736.899.899 0 00.738.792.905.905 0 00.384-.014 1.087 1.087 0 00.903-1.229 1.035 1.035 0 00-.504-.633 1.058 1.058 0 00-.804-.084zm1.885 4.474c.233-.382.582-.678.995-.846a2.119 2.119 0 011.588-1.65c.19-.04.386-.04.576 0a36.783 36.783 0 01-3.456 3.767c-.039-.445.065-.89.297-1.271zm1.275-6.669c-.404-.529-.84-1.043-1.556-.591-.717.451-.468 1.012-.125 1.557a1.204 1.204 0 001.681-.966zm-1.276 3.441c-.031-.218.233-.95.623-.856a.882.882 0 01.591.762.842.842 0 01-.576.592.789.789 0 01-.638-.498zM48.469 56.236c.124.078.093.39 0 .39a.358.358 0 01-.514-.11.311.311 0 01.171-.42c.093-.047.17.011.254.076.028.022.057.045.089.064zm-5.154 5.511c-.34.133-.617.389-.778.716h3.27a2.382 2.382 0 00-2.492-.716zm5.574.467c-.42.125-.7-.311-.7-.467a.794.794 0 01.342-.607c.062-.062.467.031.514.233.006.028.015.06.026.098.067.237.181.635-.182.743zm-14.89 57.962c.329-.39.793-.641 1.299-.703a1.933 1.933 0 011.557 1.915 3.114 3.114 0 01-.965 1.728c.28.244.494.554.622.903.12.557.03 1.138-.249 1.635a60.352 60.352 0 01-2.74-4.079 2.025 2.025 0 01.476-1.399zm-6.5-19.898c-.016-.218.015-.81.295-.81.327-.062.607.405.607.561a.748.748 0 01-.436.56c-.202.062-.451-.093-.466-.311zM39.5 126.759a1.12 1.12 0 00.56 2.148 1.337 1.337 0 00.701-1.556 1.045 1.045 0 00-1.261-.592zm-9.496-65.806c.294.122.576.274.84.452a1.417 1.417 0 01.608 1.105h-2.117l.15-.354c.168-.401.339-.807.519-1.203zm1.728-1.277c.623.265 1.059-.077 1.37-.7l-.066-.126c-.24-.465-.49-.947-1.133-.761a1.169 1.169 0 00-.576.84.872.872 0 00.405.747zm8.593 62.907a1.703 1.703 0 01-.218-.592 1.838 1.838 0 01.187-1.09 1.963 1.963 0 01-.311-2.242 2.995 2.995 0 013.114-.731c.29.177.505.454.607.778-.156-1.074.404-2.226 1.214-2.366a1.804 1.804 0 011.993 1.401 1.71 1.71 0 01-.666 1.971 1.718 1.718 0 01-.689.271 1.372 1.372 0 01-1.697-.81c.052.43-.012.865-.186 1.261.252.209.431.493.513.81a2.428 2.428 0 01-1.556 2.537 1.913 1.913 0 01-1.06-.14 5.15 5.15 0 01-.326.888c-1.168.077-1.635-.094-1.744-.717-.03-.347.077-.693.296-.965a.947.947 0 01.53-.264zM32.784 83.58a1.698 1.698 0 00-.514-2.024.951.951 0 00-1.339.343 1.464 1.464 0 00.218 1.914 1.183 1.183 0 001.635-.233zm.947-1.733a1.418 1.418 0 01-.558-.198 1.416 1.416 0 01-.514-2.148 2.055 2.055 0 012.242-.638 1.712 1.712 0 01.296 2.18 1.418 1.418 0 01-1.466.804zm-3.376-4.432a1.556 1.556 0 00-.856-.171c.139-.257.183-.555.125-.841A1.884 1.884 0 0027.6 75.22c-.592.14-1.043 1.214-.856 2.024a1.386 1.386 0 001.074 1.074 1.556 1.556 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.168 1.168 0 00-.187-1.728zm.537 10.57c.022-.385.14-.76.343-1.09a2.008 2.008 0 012.475-.606 1.432 1.432 0 011.417-.95 1.79 1.79 0 011.385 1.37 1.416 1.416 0 01-1.09 1.541.949.949 0 01-.716-.28 2.644 2.644 0 01-.358.856 1.821 1.821 0 01-1.759 1.043v.11a2.008 2.008 0 010 2.101.373.373 0 01.171.093 1.072 1.072 0 01.296 1.557 1.137 1.137 0 01-1.463.405.965.965 0 01-.374-1.214 2.444 2.444 0 01-2.008-.717.871.871 0 01-.078-.124.607.607 0 01-.498.234 1.06 1.06 0 01-.794-.53c-.078-.233.156-1.058.342-1.136.187-.078.514.124.763.358a2.646 2.646 0 01.997-1.557 1.554 1.554 0 011.214-.374 1.82 1.82 0 01-.266-1.046c-.03.248-.426.595-.606.595a.732.732 0 01-.623-.358c-.046-.203.25-.56.42-.607.172-.047.81.078.81.327zm9.178-14.29a1.57 1.57 0 001.759-2.6 2.102 2.102 0 00-2.522.7c-.358.53.047 1.526.763 1.9z",fill:"#EA9600"}));a(342);const Dc={id:"lnsGeoFieldWorkspace",humanData:{label:u.i18n.translate("xpack.lens.geoFieldWorkspace.dropZoneLabel",{defaultMessage:"drop zone to open in maps"})}},Nc=[1,0,0,0];function zc(e){return Object(x.jsx)(g.EuiPageContentBody,{className:"lnsWorkspacePanelWrapper__pageContentBody"},Object(x.jsx)(g.EuiText,{className:"lnsWorkspacePanel__emptyContent",textAlign:"center",size:"s"},Object(x.jsx)("h2",null,Object(x.jsx)("strong",null,Object(nc.getVisualizeGeoFieldMessage)(e.fieldType))),Object(x.jsx)(Lc,{"aria-hidden":!0,className:"lnsWorkspacePanel__promptIllustration"}),Object(x.jsx)(Ku.c,{className:"lnsVisualizeGeoFieldWorkspacePanel__dragDrop",dataTestSubj:"lnsGeoFieldWorkspace",draggable:!1,dropTypes:["field_add"],order:Nc,value:Dc,onDrop:function(){e.uiActions.getTrigger(Zu.VISUALIZE_GEO_FIELD_TRIGGER).exec({indexPatternId:e.indexPatternId,fieldName:e.fieldName,originatingApp:tc.APP_ID})}},Object(x.jsx)("p",null,Object(x.jsx)("strong",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.geoFieldWorkspace.dropMessage",defaultMessage:"Drop field here to open in Maps"}))))))}function Bc(e,t,a){var n;const{dataType:i,label:l,isBucketed:s,scale:r,operationType:o,timeShift:u}=e,c="sourceField"in e?null==a||null===(n=a.getFieldByName(e.sourceField))||void 0===n?void 0:n.esTypes:void 0;return{dataType:tl(i),isBucketed:s,scale:r,label:t||l,isStaticValue:"static_value"===o,sortingHint:"string"===e.dataType&&null!=c&&c.includes(_i.ES_FIELD_TYPES.VERSION)?"version":void 0,hasTimeShift:Boolean(u)}}function Vc({core:e,storage:t,data:a,dataViews:n,fieldFormats:l,charts:s,dataViewFieldEditor:o,uiActions:p}){const m=e.uiSettings,g=t=>e.notifications.toasts.addError(t,{title:u.i18n.translate("xpack.lens.indexPattern.dataViewLoadError",{defaultMessage:"Error loading data view"})}),f=n,b=(e,a,n)=>{!async function({id:e,state:t,setState:a,onError:n,storage:i,indexPatternsService:l}){const s=await Ho({indexPatternsService:l,cache:t.indexPatterns,patterns:[e]});if(null==s[e])return n(Error("Missing indexpatterns"));try{a((a=>({...a,layers:Yo(t.layers)?Object(Me.mapValues)(t.layers,(t=>rs(t,s[e]))):t.layers,indexPatterns:{...a.indexPatterns,[e]:s[e]},currentIndexPatternId:e})),{applyImmediately:!0}),Go(i,e)}catch(e){n(e)}}({id:e,state:a,setState:n,onError:g,storage:t,indexPatternsService:f})},h={id:"indexpattern",initialize:async(a,n,i,l)=>async function({persistedState:e,references:t,defaultIndexPatternId:a,storage:n,indexPatternsService:i,initialContext:l,options:s}){var r;const{isFullEditor:o}=null!=s?s:{},u=await(o?async function(e){return(await e.getIdsWithTitle()).sort(((e,t)=>e.title.localeCompare(t.title)))}(i):[]),c=((e,t)=>{var a;const n=Object(Vo.a)(e,"indexPatternId");return n&&(null===(a=t.find((e=>e.id===n)))||void 0===a?void 0:a.id)})(n,u),d=c||a||(null===(r=u[0])||void 0===r?void 0:r.id),p=[];if(l&&"isVisualizeAction"in l)for(let e=0;e<l.layers.length;e++){const t=l.layers[e];p.push(t.indexPatternId)}else l&&p.push(l.indexPatternId);const m=e&&t?Wo(e,t):void 0,g=(l?p:Object(Me.uniq)(m?Object.values(m.layers).map((e=>e.indexPatternId)).concat(m.currentIndexPatternId):[d])).filter(Boolean),f=Object(Me.difference)(Object(Me.uniq)(u.map((({id:e})=>e))),g),b=new Set(u.map((({id:e})=>e))),h=await Ho({indexPatternsService:i,cache:{},patterns:g,notUsedPatterns:f}),x=[...p,...g,...f].filter((e=>null!=e&&b.has(e)&&h[e]))[0];return x&&Go(n,x),{layers:{},...m,currentIndexPatternId:x,indexPatternRefs:u,indexPatterns:h,existingFields:{},isFirstExistenceFetch:!0}}({persistedState:a,references:n,defaultIndexPatternId:e.uiSettings.get("defaultIndex"),storage:t,indexPatternsService:f,initialContext:i,options:l}),getPersistableState:e=>function({currentIndexPatternId:e,layers:t}){const a=[];a.push({type:"index-pattern",id:e,name:qo});const n={};return Object.entries(t).forEach((([e,{indexPatternId:t,...i}])=>{a.push({type:"index-pattern",id:t,name:$o(e)}),n[e]=i})),{savedObjectReferences:a,state:{layers:n}}}(e),insertLayer:(e,t)=>({...e,layers:{...e.layers,[t]:Rc(e.currentIndexPatternId)}}),removeLayer(e,t){const a={...e.layers};return delete a[t],{...e,layers:a}},clearLayer:(e,t)=>({...e,layers:{...e.layers,[t]:Rc(e.currentIndexPatternId)}}),getLayers:e=>Object.keys(e.layers),removeColumn({prevState:e,layerId:t,columnId:a}){var n;const i=e.indexPatterns[null===(n=e.layers[t])||void 0===n?void 0:n.indexPatternId];return Ko({state:e,layerId:t,newLayer:ns({layer:e.layers[t],columnId:a,indexPattern:i})})},initializeDimension(e,t,{columnId:a,groupId:n,staticValue:i}){var l;const s=e.indexPatterns[null===(l=e.layers[t])||void 0===l?void 0:l.indexPatternId];return null==i?e:Ko({state:e,layerId:t,newLayer:$l({layer:e.layers[t],op:"static_value",columnId:a,field:void 0,indexPattern:s,visualizationGroups:[],initialParams:{params:{value:i}},targetGroup:n})})},toExpression:(e,t)=>function(e,t,a){return e.layers[t]?function(e,t,a){const{columnOrder:n}=e;if(0===n.length||!t)return null;const i={...e.columns};Object.keys(i).forEach((e=>{const t=i[e],a=Co[t.operationType];"references"in t&&a.filterable&&"fullReference"===a.input&&t.filter&&t.references.forEach((e=>{const a=i[e];Co[t.operationType].filterable&&(i[e]={...a,filter:t.filter})})),"references"in t&&a.shiftable&&"fullReference"===a.input&&t.timeShift&&t.references.forEach((e=>{const a=i[e];Co[t.operationType].shiftable&&(i[e]={...a,timeShift:t.timeShift})}))}));const l=n.map((e=>[e,i[e]])),[s,r]=Object(Me.partition)(l,(([,e])=>{var t,a;return"fullReference"===(null===(t=Co[e.operationType])||void 0===t?void 0:t.input)||"managedReference"===(null===(a=Co[e.operationType])||void 0===a?void 0:a.input)}));if(s.length||r.length){const n=[],o=[];(function(e){const t={};e.forEach((([e,a])=>{t[e]="references"in a?a.references:[]})),e.forEach((([e])=>{t[e]=t[e].filter((e=>!!t[e]))}));const a=[];for(;a.length<e.length;)Object.keys(t).forEach((e=>{0===t[e].length&&(a.push(e),delete t[e],Object.keys(t).forEach((a=>{t[a]=t[a].filter((t=>t!==e))})))}));return a})(s).forEach((a=>{const n=i[a],l=Co[n.operationType];"fullReference"!==l.input&&"managedReference"!==l.input||o.push(...l.toExpression(e,a,t))}));const u=r.map((([e])=>e));r.forEach((([i,l],s)=>{const r=Co[l.operationType];if("fullReference"!==r.input&&"managedReference"!==r.input){const i=Boolean(r.filterable&&l.filter);let o=r.toEsAggsFn(l,i?`${s}-metric`:String(s),t,e,a,u);i&&(o=Object(ue.buildExpressionFunction)("aggFilteredMetric",{id:String(s),enabled:!0,schema:"metric",customBucket:Object(ue.buildExpression)([Object(ue.buildExpressionFunction)("aggFilter",{id:`${s}-filter`,enabled:!0,schema:"bucket",filter:l.filter&&Object(ii.queryToAst)(l.filter)})]),customMetric:Object(ue.buildExpression)({type:"expression",chain:[o]}),timeShift:l.timeShift}).toAst()),n.push(Object(ue.buildExpression)({type:"expression",chain:[o]}))}})),window.ELASTIC_LENS_DELAY_SECONDS&&n.push(Object(ue.buildExpression)({type:"expression",chain:[Object(ue.buildExpressionFunction)("aggShardDelay",{id:"the-delay",enabled:!0,schema:"metric",delay:`${window.ELASTIC_LENS_DELAY_SECONDS}s`}).toAst()]}));const c=r.reduce(((e,[t,a],n)=>({...e,[window.ELASTIC_LENS_DELAY_SECONDS?`col-${n+(a.isBucketed?0:1)}-${n}`:`col-${n}-${n}`]:{...a,id:t}})),{}),d=l.filter((([,e])=>{var t,a;return ol("range",e)&&(null===(t=e.params)||void 0===t?void 0:t.parentFormat)||ul(e)&&(null===(a=e.params)||void 0===a?void 0:a.format)})).map((([e,t])=>{var a;const n="parentFormat"in t.params?t.params.parentFormat:void 0,i=t.params.format;return{type:"function",function:"lens_format_column",arguments:{format:i?[i.id]:[""],columnId:[e],decimals:"number"==typeof(null==i||null===(a=i.params)||void 0===a?void 0:a.decimals)?[i.params.decimals]:[],suffix:null!=i&&i.params&&"suffix"in i.params&&i.params.suffix?[i.params.suffix]:[],parentFormat:n?[JSON.stringify(n)]:[]}}})),p=l.find((([,e])=>"date_histogram"===e.operationType)),m=(p?l.filter((([,e])=>e.timeScale&&Co[e.operationType].timeScalingMode&&"disabled"!==Co[e.operationType].timeScalingMode)):[]).flatMap((([e,t])=>[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:[p[0]],inputColumnId:[e],outputColumnId:[e],outputColumnName:[t.label],targetUnit:[t.timeScale]}},{type:"function",function:"lens_format_column",arguments:{format:[""],columnId:[e],parentFormat:[JSON.stringify({id:"suffix",params:{unit:t.timeScale}})]}}]));if(0===r.length)return{type:"expression",chain:[{type:"function",function:"createTable",arguments:{ids:[],names:[],rowCount:[1]}},...o,...d,...m]};const g=Object.values(i).map((e=>ol("date_histogram",e)&&!e.params.ignoreTimeRange?e.sourceField:null)).filter((e=>Boolean(e)));return{type:"expression",chain:[Object(ue.buildExpressionFunction)("esaggs",{index:Object(ue.buildExpression)([Object(ue.buildExpressionFunction)("indexPatternLoad",{id:t.id})]),aggs:n,metricsAtAllLevels:!1,partialRows:!1,timeFields:g}).toAst(),{type:"function",function:"lens_rename_columns",arguments:{idMap:[JSON.stringify(c)]}},...o,...d,...m]}}return null}(e.layers[t],e.indexPatterns[e.layers[t].indexPatternId],a):null}(e,t,m),renderDataPanel(t,u){Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(hc,i()({changeIndexPattern:b,data:a,dataViews:n,fieldFormats:l,charts:s,indexPatternFieldEditor:o},u,{core:e,uiActions:p})))),t)},uniqueLabels(e){const t=e.layers,a={},n={};return Object.values(t).forEach((e=>{e.columns&&Object.entries(e.columns).forEach((([e,t])=>{a[e]=(e=>{let t=e;for(;n[t]>=0;){const a=++n[t];t=u.i18n.translate("xpack.lens.indexPattern.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:a}})}return n[t]=0,t})(t.label)}))})),a},isValidColumn:(e,t,a)=>{const n=e.layers[t];return!Xo(n,a,e.indexPatterns[n.indexPatternId])},renderDimensionTrigger:(n,s)=>{const o=h.uniqueLabels(s.state);Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:m,data:a,fieldFormats:l,savedObjects:e.savedObjects,docLinks:e.docLinks}},Object(x.jsx)(Lu,i()({uniqueLabel:o[s.columnId]},s))))),n)},renderDimensionEditor:(n,s)=>{const o=h.uniqueLabels(s.state);Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:m,data:a,fieldFormats:l,savedObjects:e.savedObjects,docLinks:e.docLinks,http:e.http}},Object(x.jsx)(Du,i()({uiSettings:m,storage:t,savedObjectsClient:e.savedObjects.client,http:e.http,data:a,uniqueLabel:o[s.columnId]},s))))),n)},renderLayerPanel:(a,n)=>{Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(x.jsx)(Ac,i()({onChangeIndexPattern:e=>{!async function({indexPatternId:e,layerId:t,state:a,setState:n,onError:i,replaceIfPossible:l,storage:s,indexPatternsService:r}){const o=await Ho({indexPatternsService:r,cache:a.indexPatterns,patterns:[e]});if(null==o[e])return i(Error("Missing indexpatterns"));try{n((a=>({...a,layers:{...a.layers,[t]:rs(a.layers[t],o[e])},indexPatterns:{...a.indexPatterns,[e]:o[e]},currentIndexPatternId:l?e:a.currentIndexPatternId}))),Go(s,e)}catch(e){i(e)}}({indexPatternId:e,setState:n.setState,state:n.state,layerId:n.layerId,onError:g,replaceIfPossible:!0,storage:t,indexPatternsService:f})}},n))),a)},canCloseDimensionEditor:e=>!e.isDimensionClosePrevented,getDropProps:Ru,onDrop:Gu,getCustomWorkspaceRenderer:(e,t)=>{if(void 0===t.field||void 0===t.indexPatternId)return;const a=t,n=a.field.esTypes&&a.field.esTypes.find((e=>["geo_point","geo_shape"].includes(e)));return n?()=>Object(x.jsx)(zc,{uiActions:p,fieldType:n,indexPatternId:a.indexPatternId,fieldName:a.field.name}):void 0},updateStateOnCloseDimension:({state:e,layerId:t})=>{const a=e.layers[t];if(Object.values(a.incompleteColumns||{}).length)return Ko({state:e,layerId:t,newLayer:{...a,incompleteColumns:void 0}})},getPublicAPI({state:e,layerId:t}){const a=h.uniqueLabels(e),n=e.layers[t],i=n.columnOrder.filter((e=>!os(n,e)));return{datasourceId:"indexpattern",getTableSpec:()=>{const e={};return Object.keys(n.columns).forEach((t=>{const a=function(e,t){const a=us(e);let n=t;for(;os(e,n);)n=a[n];return n}(n,t);e[a]=e[a]||[];const i=n.columns[t];var l;ol("terms",i)&&e[a].push(...[i.sourceField].concat(null!==(l=i.params.secondaryFields)&&void 0!==l?l:[])),"sourceField"in i&&i.sourceField!==tc.DOCUMENT_FIELD_NAME&&e[a].push(i.sourceField)})),i.map(((t,a)=>({columnId:t,fields:[...new Set(e[t]||[])]})))},getOperationForColumnId:t=>n&&n.columns[t]&&!os(n,t)?Bc(n.columns[t],a[t],e.indexPatterns[n.indexPatternId]):null,getSourceId:()=>n.indexPatternId,getFilters:e=>function(e,t,a){const n=function(e,t){const a=Object.keys(e.columns).filter((t=>{const a=e.columns[t],n=Co[null==a?void 0:a.operationType];return!(null!=a&&a.isBucketed)&&!ol("formula",a)&&(null==n?void 0:n.filterable)})),{filtered:n=[],unfiltered:i=[]}=Object(Me.groupBy)(a,(t=>{var a;return null!==(a=e.columns[t])&&void 0!==a&&a.filter?"filtered":"unfiltered"})),l=n.map((t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.filter})).filter((e=>{var t;return null==e||null===(t=e.query)||void 0===t?void 0:t.trim()}));return{enabled:i.length?[]:l,disabled:i.length?l:[]}}(e),[i,l]=["enabled","disabled"].map((e=>Object(Me.groupBy)(n[e],"language"))),s=t.map((t=>{const n=e.columns[t];if(ol("filters",n)){const e=Object(Me.groupBy)(n.params.filters,(({input:e})=>e.language));return{kuery:Qo(e.kuery),lucene:Qo(e.lucene)}}return ol("range",n)&&n.sourceField?{kuery:Jo(n)}:!ol("terms",n)||n.params.otherBucket||n.params.missingBucket?void 0:!a||function(e,t){var a;const n=null==e||null===(a=e.columns.find((({id:e})=>Object(O.c)(e)===t)))||void 0===a?void 0:a.id;return!n||n!==t}(a,t)?{kuery:Co[n.operationType].getCurrentFields(n).map((e=>({query:`${e}: *`,language:"kuery"})))}:{kuery:eu(n,t,a)}})).filter(Boolean);return{enabled:{kuery:tu(i,s,"kuery"),lucene:tu(i,s,"lucene")},disabled:{kuery:[l.kuery||[]].filter((e=>e.length)),lucene:[l.lucene||[]].filter((e=>e.length))}}}(n,i,null==e?void 0:e[t]),getVisualDefaults:()=>function(e){return Object.keys(e.columns).reduce(((t,a)=>{const n=e.columns[a];if(null!=n&&n.operationType){var i;const e=Co[n.operationType],l=null===(i=e.getDefaultVisualSettings)||void 0===i?void 0:i.call(e,n);l&&(t[a]=l)}return t}),{})}(n)}},getDatasourceSuggestionsForField:(e,t,a)=>nl(t)?function(e,t,a,n){let i=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t));if(n&&(i=i.filter(n)),0===i.length){const n=Object(Xt.a)();return wc(e,n,t,a).concat(wc({...e,layers:{}},n,t,a))}{const n=Object(Me.minBy)(i,(t=>e.layers[t].columnOrder.length));return 0===e.layers[n].columnOrder.length?wc(e,n,t,a):function(e,t,a){const n=e.layers[t],i=e.indexPatterns[n.indexPatternId],l=No(a),s=Mc(a),r=Object.values(n.columns).some((e=>al(e)&&e.sourceField===a.name)),o=[];if(s&&!r)if("date_histogram"===s&&n.columnOrder.some((e=>"date_histogram"===n.columns[e].operationType))){const l=n.columnOrder.find((e=>"date_histogram"===n.columns[e].operationType));o.push(kc({state:e,updatedLayer:Wl({layer:n,indexPattern:i,field:a,op:s,columnId:l,visualizationGroups:[]}),layerId:t,changeType:"initial"}))}else o.push(kc({state:e,updatedLayer:$l({layer:n,indexPattern:i,field:a,op:s,columnId:Object(Xt.a)(),visualizationGroups:[]}),layerId:t,changeType:"extended"}));if(!s&&l.length>0&&!r){const[l]=Jl(a);if(l){const s=$l({layer:n,indexPattern:i,field:a,columnId:Object(Xt.a)(),op:l.type,visualizationGroups:[]});s&&o.push(kc({state:e,layerId:t,updatedLayer:s,changeType:"extended"}));const[,r,u]=ls(n);if(1===r.length&&0===u.length){const s=Wl({layer:n,indexPattern:i,field:a,columnId:r[0],op:l.type,visualizationGroups:[]});s&&o.push(kc({state:e,layerId:t,updatedLayer:s,changeType:"extended"}))}}}if(!r){const n=Cc(i,t,e,a);n&&o.push(n)}return o}(e,n,a)}}(e,t.indexPatternId,t.field,a):[],getDatasourceSuggestionsFromCurrentState:_c,getDatasourceSuggestionsForVisualizeField:Fc,getDatasourceSuggestionsForVisualizeCharts:Ic,getErrorMessages(t){if(!t)return;const a=Object.entries(t.layers).filter((([e,a])=>!!t.indexPatterns[a.indexPatternId])).map((([a,n])=>{var i;return(null!==(i=function(e,t,a,n,i){const l=Object.entries(e.columns),s=l.filter((([t,a])=>!os(e,t)&&"managedReference"===Co[a.operationType].input)).flatMap((([t])=>bs(t,e.columns).map((([e])=>e)))),r=l.flatMap((([a,n])=>{if(s.includes(a))return;const i=Co[n.operationType];return i.getErrorMessage?i.getErrorMessage(e,a,t,Co):void 0})).map((e=>"object"!=typeof e?e:{...e,fixAction:e.fixAction?{...e.fixAction,newState:async t=>({...a,layers:{...a.layers,[n]:await e.fixAction.newState(i,t,n)}})}:void 0})).filter((e=>null!=e));return r.length?r:void 0}(n,t.indexPatterns[n.indexPatternId],t,a,e))&&void 0!==i?i:[]).map((e=>({shortMessage:"",longMessage:"string"==typeof e?e:e.message,fixAction:"object"==typeof e?e.fixAction:void 0})))}));var n;if(a.length<=1)return null!==(n=a[0])&&void 0!==n&&n.length?a[0]:void 0;const i=a.flatMap(((e,t)=>e.map((e=>{const{shortMessage:a,longMessage:n}=e;return{shortMessage:a?u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:a}}):"",longMessage:n?u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:n}}):""}}))));return i.length?i:void 0},getWarningMessages:(t,a,n)=>[...Li(t,a)||[],...Zo(t,a,e.docLinks,n)],checkIntegrity:e=>Object.values(e.layers||{}).map((({indexPatternId:e})=>e)).filter((t=>!e.indexPatterns[t])),isTimeBased:e=>{if(!e)return!1;const{layers:t,indexPatterns:a}=e;return Boolean(t)&&Object.values(t).some((e=>{var t;return Boolean(null===(t=a[e.indexPatternId])||void 0===t?void 0:t.timeFieldName)||e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>{const a=e.columns[t];return ol("date_histogram",a)&&!a.params.ignoreTimeRange}))}))},isEqual:(e,t,a,n)=>Object(Me.isEqual)(Wo(e,t),Wo(a,n))};return h}function Rc(e){return{indexPatternId:e,columns:{},columnOrder:[]}}const Hc=()=>{const e=new WeakMap;return{insertOrReplaceFormulaColumn:(t,{formula:a,label:n},i,l)=>{const s=(t=>{const a=e.get(t);if(a)return a;const n=Ro(t);return e.set(t,n),n})(l);return Zi(t,{label:null!=n?n:a,customLabel:Boolean(n),operationType:"formula",dataType:"number",references:[],isBucketed:!1,params:{formula:a}},{...i,indexPatternId:s.id},{indexPattern:s}).layer}}};var Gc=a(25);class indexpattern_datasource_IndexPatternDatasource{setup(e,{fieldFormats:t,expressions:n,editorFrame:i,charts:l}){i.registerDatasource((async()=>{const{getIndexPatternDatasource:n,getSuffixFormatter:i,suffixFormatterId:s}=await Promise.resolve().then(a.bind(null,433));if(!t.has(s)){const a=Object(Gc.createStartServicesGetter)(e.getStartServices),n=i((()=>a().plugins.fieldFormats.deserialize));t.register([n])}const[r,{dataViewFieldEditor:o,uiActions:u,data:c,fieldFormats:d,dataViews:p}]=await e.getStartServices();return n({core:r,fieldFormats:d,storage:new Gc.Storage(localStorage),data:c,dataViews:p,charts:l,dataViewFieldEditor:o,uiActions:u})}))}}var qc=a(86);async function $c(e){const t=await Promise.all(e.map((e=>"function"==typeof e?e():e))),a={};return t.forEach((e=>{a[e.id]=e})),a}class service_EditorFrameService{constructor(){Zs()(this,"datasources",[]),Zs()(this,"visualizations",[]),Zs()(this,"loadDatasources",(()=>$c(this.datasources))),Zs()(this,"loadVisualizations",(()=>$c(this.visualizations))),Zs()(this,"documentToExpression",(async e=>{const[t,n]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{persistedStateToExpression:i}=await Promise.resolve().then(a.bind(null,433));return await i(t,n,e)}))}setup(){return{registerDatasource:e=>{this.datasources.push(e)},registerVisualization:e=>{this.visualizations.push(e)}}}start(e,t){return{createInstance:async()=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{EditorFrame:l}=await Promise.resolve().then(a.bind(null,433));return{EditorFrameContainer:({showNoDataPopover:a,lensInspector:s})=>Object(x.jsx)("div",{className:"lnsApp__frame"},Object(x.jsx)(l,{"data-test-subj":"lnsEditorFrame",core:e,plugins:t,lensInspector:s,showNoDataPopover:a,datasourceMap:n,visualizationMap:i,ExpressionRenderer:t.expressions.ReactExpressionRenderer})),datasourceMap:n,visualizationMap:i}}}}}var Wc=a(93),Uc=a(49),Yc=a(420),Kc=a.n(Yc),Xc=a(50),Zc=a(5),Qc=a(112);function Jc({errors:e,canEdit:t}){const a=e&&e.length>1,n=t&&(null==e?void 0:e.some((({type:e})=>"fixable"===e)));return Object(x.jsx)("div",{className:"lnsEmbeddedError"},Object(x.jsx)(g.EuiEmptyPrompt,{iconType:"alert",iconColor:"danger","data-test-subj":"embeddable-lens-failure",body:Object(x.jsx)(s.a.Fragment,null,e?Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("p",null,e[0].longMessage),a&&!n?Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.moreErrors",defaultMessage:"Edit in Lens editor to see more errors"})):null,n?Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.fixErrors",defaultMessage:"Edit in Lens editor to fix the error"})):null):Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.failure",defaultMessage:"Visualization couldn't be displayed"})))}))}function ed({ExpressionRenderer:e,expression:t,searchContext:a,variables:n,handleEvent:i,interactive:l,searchSessionId:s,onData$:r,onRender$:o,renderMode:u,syncColors:d,hasCompatibleActions:p,style:m,className:f,errors:b,canEdit:v,onRuntimeError:y,executionContext:j,lensInspector:O}){return Object(x.jsx)(c.I18nProvider,null,b||null===t||""===t?Object(x.jsx)(Jc,{errors:b,canEdit:v}):Object(x.jsx)("div",{className:h()("lnsExpressionRenderer",f),style:m},Object(x.jsx)(e,{className:"lnsExpressionRenderer__component",padding:"s",variables:n,expression:t,interactive:l,searchContext:a,searchSessionId:s,onData$:r,onRender$:o,inspectorAdapters:O.adapters,renderMode:u,syncColors:d,executionContext:j,renderError:(e,t)=>(y(),Object(x.jsx)("div",{"data-test-subj":"expression-renderer-error"},Object(x.jsx)(g.EuiFlexGroup,{direction:"column",alignItems:"center",justifyContent:"center"},Object(x.jsx)(g.EuiFlexItem,null,Object(x.jsx)(g.EuiIcon,{type:"alert",color:"danger"})),Object(x.jsx)(g.EuiFlexItem,null,(Object(Qc.d)(t)||[e]).map((e=>Object(x.jsx)(g.EuiText,{size:"s"},e))))))),onEvent:i,hasCompatibleActions:p})))}const td=e=>{const t=Object(ue.createDefaultInspectorAdapters)();let a;return{adapters:t,inspect:n=>(a=e.open(t,n),a.onClose.then((()=>{a&&(a=void 0)})),a),close:()=>{var e;return null===(e=a)||void 0===e?void 0:e.close()}}};function ad(e){if(1===e.length&&1===e[0].length)return e[0][0].query;const t=e.filter((e=>e.length)).map((e=>e.length>1?`( ${e.map((({query:e})=>`( ${e} )`)).join(" OR ")} )`:`( ${e[0].query} )`)).join(" AND ");return e.length>1?`( ${t} )`:t}function nd(e,t,a,n){var i,l;const s=Boolean((null===(i=n.navLinks)||void 0===i?void 0:i.discover)&&(null===(l=n.discover)||void 0===l?void 0:l.show)),[r,...o]=Object.values(a||{});if(!r||!e||!t)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataNoData",{defaultMessage:"Visualization has no data available to show"}),isVisible:s};if(o.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataMultipleLayers",{defaultMessage:"Cannot show underlying data for visualizations with multiple layers"}),isVisible:s};const[c]=e.getLayers(t),d=e.getPublicAPI({layerId:c,state:t});if("indexpattern"!==d.datasourceId)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataUnsupportedDatasource",{defaultMessage:"Underlying data does not support the current datasource"}),isVisible:s};const p=d.getTableSpec(),m=p.filter((({columnId:e})=>{var t;return!(null!==(t=d.getOperationForColumnId(e))&&void 0!==t&&t.hasTimeShift)}));if(m.length<p.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataTimeShifts",{defaultMessage:"Cannot show underlying data when there's a time shift configured"}),isVisible:s};const g=[...new Set(m.map((({fields:e})=>e)).flat())];return{meta:{id:d.getSourceId(),columns:g,filters:d.getFilters(a)},error:void 0,isVisible:s}}function id(e,t,a,n){var i,l;const s={kuery:[],lucene:[]},r=(Array.isArray(e)?e:e?[e]:[]).filter((e=>Boolean(e.query.trim())));[s.lucene,s.kuery]=Object(Me.partition)(r,(e=>"lucene"===e.language));const o=(null===(i=r[0])||void 0===i?void 0:i.language)||"kuery",c={language:o,query:ad([...s[o].map((e=>[e])),...a.filters.enabled[o]||[]])},d="lucene"===o?"kuery":"lucene",p=[...t],m=null==n?void 0:n.find((({id:e})=>e===a.id));if(Boolean((null===(l=a.filters.enabled[d])||void 0===l?void 0:l.length)||s[d].length)){const e=ad([...s[d].map((e=>[e])),...a.filters.enabled[d]||[]]);p.push(Object(Un.b)(a.id,Object(Un.c)(m,{language:d,query:e},[]),!1,!1,u.i18n.translate("xpack.lens.app.lensContext",{defaultMessage:"Lens context ({language})",values:{language:d}}),Un.a.APP_STATE))}for(const e of["lucene","kuery"]){const[t]=a.filters.disabled[e]||[];for(const n of t||[]){let t=n.query;"lucene"===e&&(t+=` (${e})`),p.push(Object(Un.b)(a.id,Object(Un.c)(m,n,[]),!0,!1,t,Un.a.APP_STATE))}}return{filters:p,query:c}}const ld=async(e,t)=>{const{ast:a,errors:n}=await t(e);return{expression:a?Object(Wc.toExpression)(a):null,errors:n}};class embeddable_Embeddable extends Zc.Embeddable{logError(e){var t;null===(t=this.deps.usageCollection)||void 0===t||t.reportUiCounter(P.k,Xc.METRIC_TYPE.COUNT,"runtime"===e?"embeddable_runtime_error":"embeddable_validation_error")}constructor(e,t,a){super(t,{editApp:"lens"},a),Zs()(this,"type",P.e),Zs()(this,"deferEmbeddableLoad",!0),Zs()(this,"expressionRenderer",void 0),Zs()(this,"savedVis",void 0),Zs()(this,"expression",void 0),Zs()(this,"domNode",void 0),Zs()(this,"subscription",void 0),Zs()(this,"isInitialized",!1),Zs()(this,"errors",void 0),Zs()(this,"inputReloadSubscriptions",void 0),Zs()(this,"isDestroyed",void 0),Zs()(this,"embeddableTitle",void 0),Zs()(this,"lensInspector",void 0),Zs()(this,"externalSearchContext",{}),Zs()(this,"activeDataInfo",{}),Zs()(this,"indexPatterns",[]),Zs()(this,"viewUnderlyingDataArgs",void 0),Zs()(this,"updateActiveData",((e,t)=>{var a;this.activeDataInfo.activeData=null==t||null===(a=t.tables)||void 0===a?void 0:a.tables,this.input.onLoad&&this.input.onLoad(!1)})),Zs()(this,"onRender",(()=>{this.renderComplete.dispatchComplete()})),Zs()(this,"hasCompatibleActions",(async e=>{if(Object(Nu.e)(e)){const{getTriggerCompatibleActions:t}=this.deps;return!!t&&(await t(A.VIS_EVENT_TO_TRIGGER[e.name],{data:e.data,embeddable:this})).length>0}return!1})),Zs()(this,"handleEvent",(async e=>{if(this.deps.getTrigger&&!this.input.disableTriggers&&(Object(Nu.b)(e)&&(this.deps.getTrigger(A.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(nc.inferTimeField)(e.data)},embeddable:this}),this.input.onBrushEnd&&this.input.onBrushEnd(e.data)),Object(Nu.d)(e)&&(this.deps.getTrigger(A.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(nc.inferTimeField)(e.data)},embeddable:this}),this.input.onFilter&&this.input.onFilter(e.data)),Object(Nu.e)(e)&&(this.deps.getTrigger(A.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this},!0),this.input.onTableRowClick&&this.input.onTableRowClick(e.data)),Object(Nu.c)(e)&&this.onEditAction)){if(!this.savedVis)return;const t=JSON.parse(JSON.stringify(this.savedVis));t.state.visualization=this.onEditAction(t.state.visualization,e),this.savedVis=t;const{expression:a,errors:n}=await ld(this.savedVis,this.deps.documentToExpression);this.expression=a,this.errors=n,this.reload()}})),Zs()(this,"inputIsRefType",(e=>this.deps.attributeService.inputIsRefType(e))),Zs()(this,"getInputAsRefType",(async()=>this.deps.attributeService.getInputAsRefType(this.getExplicitInput(),{showSaveModal:!0,saveModalTitle:this.getTitle()}))),Zs()(this,"getInputAsValueType",(async()=>this.deps.attributeService.getInputAsValueType(this.getExplicitInput()))),this.deps=e,this.lensInspector=td(e.inspector),this.expressionRenderer=e.expressionRenderer,this.initializeSavedVis(t).then((()=>this.onContainerStateChanged(t))),this.subscription=this.getUpdated$().subscribe((()=>this.onContainerStateChanged(this.input)));const n=this.getInput$();this.embeddableTitle=this.getTitle(),this.inputReloadSubscriptions=[],this.inputReloadSubscriptions.push(n.pipe(Object(Uc.map)((e=>{var t;return null===(t=e.enhancements)||void 0===t?void 0:t.dynamicActions})),Object(Uc.distinctUntilChanged)(((e,t)=>Kc()(e,t))),Object(Uc.skip)(1)).subscribe((e=>{this.reload()}))),this.inputReloadSubscriptions.push(n.pipe(Object(Uc.map)((e=>e.viewMode)),Object(Uc.distinctUntilChanged)(),Object(Uc.skip)(1)).subscribe((e=>{var t;null!==(t=this.getInput().enhancements)&&void 0!==t&&t.dynamicActions&&this.reload()}))),this.inputReloadSubscriptions.push(n.pipe(Object(Uc.distinctUntilChanged)(((e,t)=>Kc()(["attributes"in e&&e.attributes,"savedObjectId"in e&&e.savedObjectId],["attributes"in t&&t.attributes,"savedObjectId"in t&&t.savedObjectId]))),Object(Uc.skip)(1)).subscribe((async e=>{await this.initializeSavedVis(e),this.reload()}))),this.inputReloadSubscriptions.push(this.getUpdated$().pipe(Object(Uc.map)((()=>this.getInput()))).pipe(Object(Uc.distinctUntilChanged)(((e,t)=>Kc()([e.filters,e.query,e.timeRange,e.searchSessionId],[t.filters,t.query,t.timeRange,t.searchSessionId]))),Object(Uc.skip)(1)).subscribe((async e=>{this.onContainerStateChanged(e)})))}supportedTriggers(){var e;return this.savedVis&&this.savedVis.visualizationType&&(null===(e=this.deps.visualizationMap[this.savedVis.visualizationType])||void 0===e?void 0:e.triggers)||[]}getInspectorAdapters(){return this.lensInspector.adapters}maybeAddConflictError(e,t){const a=[...e||[]];return"conflict"===(null==t?void 0:t.outcome)&&this.deps.spaces&&a.push({shortMessage:u.i18n.translate("xpack.lens.embeddable.legacyURLConflict.shortMessage",{defaultMessage:"You've encountered a URL conflict"}),longMessage:Object(x.jsx)(this.deps.spaces.ui.components.getEmbeddableLegacyUrlConflict,{targetType:P.e,sourceId:t.sourceId})}),null!=a&&a.length?a:void 0}maybeAddTimeRangeError(e,t,a){return null==t.timeRange&&a.some((e=>e.isTimeBased()))?[...e||[],{shortMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.shortMessage",{defaultMessage:"Missing timeRange property"}),longMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.longMessage",{defaultMessage:"The timeRange property is required for the given configuration"})}]:e}async initializeSavedVis(e){const t=await this.deps.attributeService.unwrapAttributes(e).catch((e=>(this.onFatalError(e),!1)));if(!t||this.isDestroyed)return;const{metaInfo:a,attributes:n}=t;this.savedVis={...n,type:this.type,savedObjectId:null==e?void 0:e.savedObjectId};const{expression:i,errors:l}=await ld(this.savedVis,this.deps.documentToExpression);this.expression=i,this.errors=this.maybeAddConflictError(l,null==a?void 0:a.sharingSavedObjectProps),await this.initializeOutput(),this.isInitialized=!0}onContainerStateChanged(e){var t;(this.handleContainerStateChanged(e)||null!==(t=this.errors)&&void 0!==t&&t.length)&&this.reload()}handleContainerStateChanged(e){let t=!1;const a=e.filters?e.filters.filter((e=>!e.meta.disabled)):void 0;return Object(Me.isEqual)(e.timeRange,this.externalSearchContext.timeRange)&&Object(Me.isEqual)(e.query,this.externalSearchContext.query)&&Object(Me.isEqual)(a,this.externalSearchContext.filters)&&this.externalSearchContext.searchSessionId===e.searchSessionId&&this.embeddableTitle===this.getTitle()||(this.externalSearchContext={timeRange:e.timeRange,query:e.query,filters:a,searchSessionId:e.searchSessionId},this.embeddableTitle=this.getTitle(),t=!0),t}render(e){var t;if(this.domNode=e,super.render(e),!this.savedVis||!this.isInitialized||this.isDestroyed)return;this.input.onLoad&&this.input.onLoad(!0),this.domNode.setAttribute("data-shared-item",""),this.renderComplete.dispatchInProgress();const a=this.input.executionContext,n={type:"lens",name:null!==(t=this.savedVis.visualizationType)&&void 0!==t?t:"",id:this.id,description:this.savedVis.title||this.input.title||"",url:this.output.editUrl},i=a?{...a,child:n}:n,l=this.getInput();Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(x.jsx)(ed,{ExpressionRenderer:this.expressionRenderer,expression:this.expression||null,errors:this.errors,lensInspector:this.lensInspector,searchContext:this.getMergedSearchContext(),variables:l.palette?{theme:{palette:l.palette},embeddableTitle:this.getTitle()}:{embeddableTitle:this.getTitle()},searchSessionId:this.externalSearchContext.searchSessionId,handleEvent:this.handleEvent,onData$:this.updateActiveData,onRender$:this.onRender,interactive:!l.disableTriggers,renderMode:l.renderMode,syncColors:l.syncColors,hasCompatibleActions:this.hasCompatibleActions,className:l.className,style:l.style,executionContext:i,canEdit:this.getIsEditable()&&"edit"===l.viewMode,onRuntimeError:()=>{this.logError("runtime")}})),e)}getMergedSearchContext(){var e;if(!this.savedVis)throw new Error("savedVis is required for getMergedSearchContext");const t={timeRange:this.externalSearchContext.timeRange,query:[this.savedVis.state.query],filters:this.deps.injectFilterReferences(this.savedVis.state.filters,this.savedVis.references)};return this.externalSearchContext.query&&(t.query=[this.externalSearchContext.query,...t.query]),null!==(e=this.externalSearchContext.filters)&&void 0!==e&&e.length&&(t.filters=[...this.externalSearchContext.filters,...t.filters]),t}get onEditAction(){var e;const t=null===(e=this.savedVis)||void 0===e?void 0:e.visualizationType;if(t)return this.deps.visualizationMap[t].onEditAction}reload(){this.savedVis&&this.isInitialized&&!this.isDestroyed&&(this.handleContainerStateChanged(this.input),this.domNode&&this.render(this.domNode))}async loadViewUnderlyingDataArgs(){var e;const t=this.getMergedSearchContext();if(!this.activeDataInfo.activeData||!t.timeRange)return!1;const a=Object(nc.getActiveDatasourceIdFromDoc)(this.savedVis);if(!a)return!1;this.activeDataInfo.activeDatasource=this.deps.datasourceMap[a];const n=null===(e=this.savedVis)||void 0===e?void 0:e.state.datasourceStates[a];var i;this.activeDataInfo.activeDatasourceState||(this.activeDataInfo.activeDatasourceState=await this.activeDataInfo.activeDatasource.initialize(n,null===(i=this.savedVis)||void 0===i?void 0:i.references));const l=function({activeDatasource:e,activeDatasourceState:t,activeData:a,dataViews:n,capabilities:i,query:l,filters:s,timeRange:r}){const{error:o,meta:u}=nd(e,t,a,i);if(o||!u)return;const{filters:c,query:d}=id(l,s,u,n);return{indexPatternId:u.id,timeRange:r,filters:c,query:d,columns:u.columns}}({activeDatasource:this.activeDataInfo.activeDatasource,activeDatasourceState:this.activeDataInfo.activeDatasourceState,activeData:this.activeDataInfo.activeData,dataViews:this.indexPatterns,capabilities:this.deps.capabilities,query:t.query,filters:t.filters||[],timeRange:t.timeRange}),s=void 0!==l;return s&&(this.viewUnderlyingDataArgs=l),s}getViewUnderlyingDataArgs(){return this.viewUnderlyingDataArgs}canViewUnderlyingData(){return this.loadViewUnderlyingDataArgs()}async initializeOutput(){var e,t;if(!this.savedVis)return;const{indexPatterns:a}=await Object(nc.getIndexPatternsObjects)((null===(e=this.savedVis)||void 0===e?void 0:e.references.map((({id:e})=>e)))||[],this.deps.indexPatternService);this.indexPatterns=Object(Me.uniqBy)(a,"id");const n=this.getInput();this.errors=this.maybeAddTimeRangeError(this.errors,n,this.indexPatterns),this.errors&&this.logError("validation");const i=n.hidePanelTitles?"":null!==(t=n.title)&&void 0!==t?t:this.savedVis.title,l=n.savedObjectId;this.updateOutput({...this.getOutput(),defaultTitle:this.savedVis.title,editable:this.getIsEditable(),title:i,editPath:Object(P.m)(l),editUrl:this.deps.basePath.prepend(`/app/lens${Object(P.m)(l)}`),indexPatterns:this.indexPatterns}),this.setInitializationFinished()}getIsEditable(){return this.deps.capabilities.canSaveVisualizations||!this.inputIsRefType(this.getInput())&&this.deps.capabilities.canSaveDashboards}getDescription(){return this.savedVis&&this.savedVis.description}destroy(){super.destroy(),this.isDestroyed=!0,this.inputReloadSubscriptions.length>0&&this.inputReloadSubscriptions.forEach((e=>{e.unsubscribe()})),this.domNode&&Object(r.unmountComponentAtNode)(this.domNode),this.subscription&&this.subscription.unsubscribe()}}var sd=a(56),rd=a(90),od=(a(421),a(57)),ud=a(70),cd=a(114);const dd=document.createElement("div");let pd=!1;function md({anchorElement:e,isOpen:t,onClose:a}){const n=Object(ud.R)(ud.r),i=Object(ud.Q)(),s=Object(l.useCallback)((()=>{Object(Ya.e)("toggle_autoapply"),Object(Vo.b)(new Gc.Storage(localStorage),cd.a,String(n)),i(n?Object(ud.c)():Object(ud.e)())}),[i,n]);return Object(x.jsx)(g.EuiWrappingPopover,{"data-test-subj":"lnsApp__settingsMenu",ownFocus:!0,button:e,closePopover:a,isOpen:!0},Object(x.jsx)(g.EuiPopoverTitle,null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.settings.title",defaultMessage:"Lens settings"})),Object(x.jsx)(g.EuiSwitch,{label:u.i18n.translate("xpack.lens.settings.autoApply",{defaultMessage:"Auto-apply visualization changes"}),checked:n,onChange:()=>s(),"data-test-subj":"lnsToggleAutoApply"}))}function gd(){o.a.unmountComponentAtNode(dd),document.body.removeChild(dd),pd=!1}const fd=({setHeaderActionMenu:e,initialInput:t,indicateNoData:a,lensInspector:n,setIsSaveModalVisible:r,getIsByValueMode:p,runSave:m,onAppLeave:g,redirectToOrigin:f,datasourceMap:b,title:h,goBackToOriginatingApp:v,contextOriginatingApp:y,initialContextIsEmbedded:j,topNavMenuEntryGenerators:O,initialContext:k,theme$:I})=>{var T;const{data:F,fieldFormats:M,navigation:w,uiSettings:_,application:C,attributeService:E,discover:S,dashboardFeatureFlag:P,dataViews:A}=Object(d.useKibana)().services,L=Object(ud.Q)(),D=s.a.useCallback((e=>L(Object(ud.I)(e))),[L]),[N,z]=Object(l.useState)([]),[B,V]=Object(l.useState)([]),{isSaveable:R,isLinkedToOriginatingApp:H,query:G,activeData:q,savedQuery:$,activeDatasourceId:W,datasourceStates:U,visualization:Y,filters:K}=Object(ud.R)((e=>e.lens)),X=Object.values(U).every((({isLoading:e})=>!1===e));Object(l.useEffect)((()=>{if(!(b&&W&&!U[W].isLoading?b[W]:void 0))return;const e=Object(nc.getIndexPatternsIds)({activeDatasources:Object.keys(U).reduce(((e,t)=>({...e,[t]:b[t]})),{}),datasourceStates:U});(N.length+B.length!==e.length||e.some((e=>![...N.map((e=>e.id)),...B].find((t=>t===e)))))&&Object(nc.getIndexPatternsObjects)(e,A).then((({indexPatterns:e,rejectedIds:t})=>{z(e),V(t)}))}),[U,W,B,b,N,A]);const{TopNavMenu:Z}=w.ui,{from:Q,to:J}=F.query.timefilter.timefilter.getTime(),ee=Boolean(R&&C.capabilities.visualize.save),te=Boolean(R&&(null===(T=C.capabilities.dashboard)||void 0===T?void 0:T.showWriteControls)),ae=u.i18n.translate("xpack.lens.app.unsavedFilename",{defaultMessage:"unsaved"}),ne=Object(l.useMemo)((()=>{if(!Y.activeId)return;const e=Y.activeId,t=O.flatMap((t=>{const a=t({datasourceStates:U,visualizationId:e,visualizationState:Y.state,query:G,filters:K,initialContext:k});return a?[a]:[]}));return t.length>0?t:void 0}),[U,O,Y.activeId,Y.state,G,K,k]),ie=Object(l.useMemo)((()=>{if(W&&S)return nd(b[W],U[W].state,q,C.capabilities)}),[q,W,b,U,S,C.capabilities]),le=Object(rd.useStore)(),se=Object(l.useMemo)((()=>{const e=function(e){const{actions:t,showCancel:a,allowByValue:n,enableExportToCSV:i,showOpenInDiscover:l,showSaveAndReturn:s,savingToLibraryPermitted:r,savingToDashboardPermitted:o,tooltips:c,contextOriginatingApp:d,isSaveable:p}=e,m=[],g=r||n&&o&&!e.isByValueMode&&!e.showSaveAndReturn,f=e.isByValueMode?u.i18n.translate("xpack.lens.app.addToLibrary",{defaultMessage:"Save to library"}):e.showSaveAndReturn?u.i18n.translate("xpack.lens.app.saveAs",{defaultMessage:"Save as"}):u.i18n.translate("xpack.lens.app.save",{defaultMessage:"Save"});if(d&&m.push({label:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:d}}),run:t.goBack,className:"lnsNavItem__goBack",testId:"lnsApp_goBackToAppButton",description:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:d}}),disableButton:!1}),l){const e=u.i18n.translate("xpack.lens.app.exploreDataInDiscover",{defaultMessage:"Explore data in Discover"});m.push({label:e,run:()=>{},testId:"lnsApp_openInDiscover",description:e,disableButton:Boolean(c.showUnderlyingDataWarning()),tooltip:c.showUnderlyingDataWarning,target:"_blank",href:t.getUnderlyingDataUrl()})}return m.push({label:u.i18n.translate("xpack.lens.app.inspect",{defaultMessage:"Inspect"}),run:t.inspect,testId:"lnsApp_inspectButton",description:u.i18n.translate("xpack.lens.app.inspectAriaLabel",{defaultMessage:"inspect"}),disableButton:!1}),m.push({label:u.i18n.translate("xpack.lens.app.downloadCSV",{defaultMessage:"Download as CSV"}),run:t.exportToCSV,testId:"lnsApp_downloadCSVButton",description:u.i18n.translate("xpack.lens.app.downloadButtonAriaLabel",{defaultMessage:"Download the data as CSV file"}),disableButton:!i,tooltip:c.showExportWarning}),m.push({label:u.i18n.translate("xpack.lens.app.settings",{defaultMessage:"Settings"}),run:t.openSettings,testId:"lnsApp_settingsButton",description:u.i18n.translate("xpack.lens.app.settingsAriaLabel",{defaultMessage:"Open the Lens settings menu"})}),a&&m.push({label:u.i18n.translate("xpack.lens.app.cancel",{defaultMessage:"Cancel"}),run:t.cancel,testId:"lnsApp_cancelButton",description:u.i18n.translate("xpack.lens.app.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"})}),m.push({label:f,iconType:s?void 0:"save",emphasize:!s,run:t.showSaveModal,testId:"lnsApp_saveButton",description:u.i18n.translate("xpack.lens.app.saveButtonAriaLabel",{defaultMessage:"Save the current lens visualization"}),disableButton:!g}),s&&m.push({label:u.i18n.translate("xpack.lens.app.saveAndReturn",{defaultMessage:"Save and return"}),emphasize:!0,iconType:"checkInCircleFilled",run:t.saveAndReturn,testId:"lnsApp_saveAndReturnButton",disableButton:!p,description:u.i18n.translate("xpack.lens.app.saveAndReturnButtonAriaLabel",{defaultMessage:"Save the current lens visualization and return to the last app"})}),m}({showSaveAndReturn:Boolean(H&&(P.allowByValueEmbeddables||Boolean(t)))||Boolean(j),enableExportToCSV:Boolean(R&&q&&Object.keys(q).length),showOpenInDiscover:Boolean(null==ie?void 0:ie.isVisible),isByValueMode:p(),allowByValue:P.allowByValueEmbeddables,showCancel:Boolean(H),savingToLibraryPermitted:ee,savingToDashboardPermitted:te,isSaveable:R,contextOriginatingApp:y,tooltips:{showExportWarning:()=>{if(q&&Object.values(q).some((e=>Object(ii.tableHasFormulas)(e.columns,e.rows))))return u.i18n.translate("xpack.lens.app.downloadButtonFormulasWarning",{defaultMessage:"Your CSV contains characters that spreadsheet applications might interpret as formulas."})},showUnderlyingDataWarning:()=>null==ie?void 0:ie.error},actions:{inspect:()=>n.inspect({title:h}),exportToCSV:()=>{if(!q)return;const e=Object.values(q),t=e.reduce(((t,a,n)=>{if(a){const i=e.length>1?`-${n+1}`:"";t[`${h||ae}${i}.csv`]={content:_i.exporters.datatableToCSV(a,{csvSeparator:_.get("csv:separator",","),quoteValues:_.get("csv:quoteValues",!0),formatFactory:M.deserialize,escapeFormulaValues:!1}),type:_i.exporters.CSV_MIME_TYPE}}return t}),{});t&&Object(od.downloadMultipleAs)(t)},saveAndReturn:()=>{var e;R&&(g((e=>e.default())),m({newTitle:h||"",newCopyOnSave:!1,isTitleDuplicateConfirmed:!1,returnToOrigin:!0},{saveToLibrary:null!==(e=t&&E.inputIsRefType(t))&&void 0!==e&&e}))},showSaveModal:()=>{(te||ee)&&r(!0)},goBack:()=>{y&&(null==v||v())},cancel:()=>{f&&f()},getUnderlyingDataUrl:()=>{if(!ie)return;const{error:e,meta:t}=ie;if(e||!S||!t)return;const{filters:a,query:n}=id(G,K,t,N);return S.locator.getRedirectUrl({indexPatternId:t.id,timeRange:F.query.timefilter.timefilter.getTime(),filters:a,query:n,columns:t.columns})},openSettings:e=>function(e){if(pd)return void gd();pd=!0,document.body.appendChild(dd);const t=Object(x.jsx)(rd.Provider,{store:e.lensStore},Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(md,i()({},e,{isOpen:pd,onClose:gd})))));o.a.render(t,dd)}({lensStore:le,anchorElement:e,theme$:I})}});return[...ne||[],...e]}),[H,P.allowByValueEmbeddables,t,j,R,q,ie,p,ee,te,y,ne,n,h,ae,_,M.deserialize,g,m,E,r,v,f,S,G,K,N,F.query.timefilter.timefilter,le,I]),re=Object(l.useCallback)((e=>{const{dateRange:t,query:a}=e,n=F.query.timefilter.timefilter.getTime();t.from!==n.from||t.to!==n.to?(F.query.timefilter.timefilter.setTime(t),Object(Ya.e)("app_date_change")):(D({searchSessionId:F.search.session.start(),resolvedDateRange:Object(nc.getResolvedDateRange)(F.query.timefilter.timefilter)}),Object(Ya.e)("app_query_change")),a&&(Object(Me.isEqual)(a,G)||D({query:a}))}),[F.query.timefilter.timefilter,F.search.session,D,G]),oe=Object(l.useCallback)((e=>{D({savedQuery:e})}),[D]),ue=Object(l.useCallback)((e=>{const t=e.attributes.filters||[],a=F.query.filterManager.getGlobalFilters();F.query.filterManager.setFilters([...a,...t]),D({query:e.attributes.query,savedQuery:{...e}})}),[F.query.filterManager,D]),ce=Object(l.useCallback)((()=>{F.query.filterManager.setFilters(F.query.filterManager.getGlobalFilters()),D({filters:F.query.filterManager.getGlobalFilters(),query:F.query.queryString.getDefaultQuery(),savedQuery:void 0})}),[F.query.filterManager,F.query.queryString,D]);return Object(x.jsx)(Z,{setMenuMountPoint:e,config:se,showSaveQuery:Boolean(C.capabilities.visualize.saveQuery),savedQuery:$,onQuerySubmit:re,onSaved:oe,onSavedQueryUpdated:ue,onClearSavedQuery:ce,indexPatterns:N,query:G,dateRangeFrom:Q,dateRangeTo:J,indicateNoData:a,showSearchBar:!0,showDatePicker:N.some((e=>e.isTimeBased()))||Boolean(X&&W&&b[W].isTimeBased(U[W].state)),showQueryBar:!0,showFilterBar:!0,"data-test-subj":"lnsApp_topNav",screenTitle:"lens",appName:"lens"})};var bd=a(95);const hd=e=>JSON.parse(JSON.stringify(e)),xd=(e,t,a,n)=>{if(void 0===e||void 0===t)return e===t;const i=hd(e),l=hd(t);if((null==i?void 0:i.visualizationType)!==(null==l?void 0:l.visualizationType))return!1;if(!Object(Me.isEqual)(i.state.query,l.state.query))return!1;if(!Object(Me.isEqual)(i.state.visualization,l.state.visualization))return!1;const s=Object.keys(i.state.datasourceStates),r=Object.keys(l.state.datasourceStates);let o=Object(Me.intersection)(s,r).length===Object(Me.union)(s,r).length;if(o&&(o=s.map((e=>n[e].isEqual(i.state.datasourceStates[e],i.references,l.state.datasourceStates[e],l.references))).every((e=>e))),!o)return!1;const[u,c]=[i,l].map((e=>Object(bd.removePinnedFilters)(function(e,t){var a;return t?{...t,state:{...t.state,filters:e((null===(a=t.state)||void 0===a?void 0:a.filters)||[],t.references)}}:void 0}(a,e))));return!!Object(Me.isEqual)(null==u?void 0:u.state.filters,null==c?void 0:c.state.filters)};function vd({history:e,onAppLeave:t,redirectTo:a,editorFrame:n,initialInput:i,incomingState:r,redirectToOrigin:o,setHeaderActionMenu:c,datasourceMap:p,visualizationMap:m,contextOriginatingApp:f,topNavMenuEntryGenerators:b,initialContext:h,theme$:v}){const y=Object(d.useKibana)().services,{data:j,chrome:O,uiSettings:k,inspector:I,application:T,notifications:F,savedObjectsTagging:M,getOriginatingAppName:w,spaces:_,http:C,executionContext:E,dashboardFeatureFlag:S}=y,A=Object(ud.Q)(),L=Object(l.useCallback)((e=>A(Object(ud.I)(e))),[A]),{persistedDoc:D,sharingSavedObjectProps:N,isLinkedToOriginatingApp:z,searchSessionId:B,isLoading:V,isSaveable:R}=Object(ud.R)((e=>e.lens)),H=Object(l.useMemo)((()=>({datasourceMap:p,visualizationMap:m,extractFilterReferences:j.query.filterManager.extract.bind(j.query.filterManager)})),[p,m,j.query.filterManager]),G=Object(ud.R)((e=>Object(ud.C)(e,H))),[q,$]=Object(l.useState)(!1),[W,U]=Object(l.useState)(!1),[Y,K]=Object(l.useState)(void 0),[X,Z]=Object(l.useState)(void 0),[Q,J]=Object(l.useState)(!1),ee=null==i?void 0:i.savedObjectId;Object(l.useEffect)((()=>{G&&K(G)}),[G]);const te=Object(l.useCallback)((()=>{$(!0)}),[$]);Object(d.useExecutionContext)(E,{type:"application",id:ee||"new",page:"editor"}),Object(l.useEffect)((()=>{q&&$(!1)}),[$,q,B]);const ae=Object(l.useCallback)((()=>Boolean(S.allowByValueEmbeddables&&z&&!ee)),[S.allowByValueEmbeddables,z,ee]);Object(l.useEffect)((()=>{const t=Object(Gc.createKbnUrlStateStorage)({history:e,useHash:k.get("state:storeInSessionStorage"),...Object(Gc.withNotifyOnErrors)(F.toasts)}),{stop:a}=Object(_i.syncQueryStateWithUrl)(j.query,t);return()=>{a()}}),[j.search.session,F.toasts,k,j.query,e]),Object(l.useEffect)((()=>{t((e=>T.capabilities.visualize.save&&!xd(D,Y,j.query.filterManager.inject.bind(j.query.filterManager),p)&&(R||D)?e.confirm(u.i18n.translate("xpack.lens.app.unsavedWorkMessage",{defaultMessage:"Leave Lens with unsaved work?"}),u.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"}),void 0,u.i18n.translate("xpack.lens.app.unsavedWorkConfirmBtn",{defaultMessage:"Discard changes"}),"danger"):e.default()))}),[t,Y,R,D,T.capabilities.visualize.save,j.query.filterManager,p]);const ne=Object(l.useCallback)((()=>{if(_&&"conflict"===(null==N?void 0:N.outcome)&&null!=D&&D.savedObjectId){const t=D.savedObjectId,a=null==N?void 0:N.aliasTargetId,n=C.basePath.prepend(`${Object(P.m)(a)}${e.location.search}`);return _.ui.components.getLegacyUrlConflict({objectNoun:u.i18n.translate("xpack.lens.appName",{defaultMessage:"Lens visualization"}),currentObjectId:t,otherObjectId:a,otherObjectPath:n})}return null}),[D,N,_,C,e]);Object(l.useEffect)((()=>{const e=ae(),t=h&&"originatingApp"in h&&h.originatingApp,a=[];(z||t)&&w()&&o&&a.push({onClick:()=>{o()},text:w()}),e||a.push({href:T.getUrlForApp("visualize"),onClick:e=>{T.navigateToApp("visualize",{path:"/"}),e.preventDefault()},text:u.i18n.translate("xpack.lens.breadcrumbsTitle",{defaultMessage:"Visualize Library"})});let n=u.i18n.translate("xpack.lens.breadcrumbsCreate",{defaultMessage:"Create"});D&&(n=e?u.i18n.translate("xpack.lens.breadcrumbsByValue",{defaultMessage:"Edit visualization"}):D.title),a.push({text:n}),O.setBreadcrumbs(a)}),[S.allowByValueEmbeddables,w,o,ae,T,O,z,D,h]);const ie=Object(l.useCallback)(((e,n)=>(A(Object(ud.b)()),Object(bd.runSaveLensVisualization)({lastKnownDoc:Y,getIsByValueMode:ae,savedObjectsTagging:M,initialInput:i,redirectToOrigin:o,persistedDoc:D,onAppLeave:t,redirectTo:a,originatingApp:null==r?void 0:r.originatingApp,...y},e,n).then((e=>{e&&(L(e),U(!1))}),(()=>{})))),[null==r?void 0:r.originatingApp,Y,D,ae,M,i,o,t,a,y,L,A,U]);Object(l.useEffect)((()=>{Y&&!X&&Z(Y)}),[Y,X]);const le=Object(l.useCallback)((()=>{h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl&&(xd(X,Y,j.query.filterManager.inject,p)?(t((e=>e.default())),T.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl})):J(!0))}),[T,j.query.filterManager.inject,p,h,X,Y,t]),se=Object(l.useCallback)((()=>{J(!1),h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl&&(t((e=>e.default())),T.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl}))}),[T,h,t]),re=Object(l.useMemo)((()=>Boolean(h&&"originatingApp"in h&&h.originatingApp)),[h]);return Object(x.jsx)(s.a.Fragment,null,Object(x.jsx)("div",{className:"lnsApp","data-test-subj":"lnsApp"},Object(x.jsx)(fd,{initialInput:i,redirectToOrigin:o,getIsByValueMode:ae,onAppLeave:t,runSave:ie,setIsSaveModalVisible:U,setHeaderActionMenu:c,indicateNoData:q,datasourceMap:p,title:null==D?void 0:D.title,lensInspector:I,goBackToOriginatingApp:le,contextOriginatingApp:f,initialContextIsEmbedded:re,topNavMenuEntryGenerators:b,initialContext:h,theme$:v}),ne(),(!V||D)&&Object(x.jsx)(yd,{editorFrame:n,showNoDataPopover:te,lensInspector:I})),W&&Object(x.jsx)(bd.SaveModalContainer,{lensServices:y,originatingApp:z?null==r?void 0:r.originatingApp:void 0,isSaveable:R,runSave:ie,onClose:()=>{U(!1)},getAppNameFromId:()=>w(),lastKnownDoc:Y,onAppLeave:t,persistedDoc:D,initialInput:i,redirectTo:a,redirectToOrigin:o,returnToOriginSwitchLabel:ae()&&i?u.i18n.translate("xpack.lens.app.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:w()}}):void 0}),Q&&Object(x.jsx)(g.EuiConfirmModal,{maxWidth:600,title:u.i18n.translate("xpack.lens.app.goBackModalTitle",{defaultMessage:"Discard changes?"}),onCancel:()=>J(!1),onConfirm:se,cancelButtonText:u.i18n.translate("xpack.lens.app.goBackModalCancelBtn",{defaultMessage:"Cancel"}),confirmButtonText:u.i18n.translate("xpack.lens.app.goBackModalTitle",{defaultMessage:"Discard changes?"}),buttonColor:"danger",defaultFocusedButton:"confirm"},u.i18n.translate("xpack.lens.app.goBackModalMessage",{defaultMessage:"The changes you have made here are not backwards compatible with your original {contextOriginatingApp} visualization. Are you sure you want to discard these unsaved changes and return to {contextOriginatingApp}?",values:{contextOriginatingApp:f}})))}const yd=s.a.memo((function({editorFrame:e,showNoDataPopover:t,lensInspector:a}){const{EditorFrameContainer:n}=e;return Object(x.jsx)(n,{showNoDataPopover:t,lensInspector:a})}));var jd=a(83);async function Od(e,t,a){const{data:n,inspector:i,navigation:l,embeddable:s,savedObjectsTagging:r,usageCollection:o,fieldFormats:u,spaces:c,discover:d}=t,p=new Gc.Storage(localStorage),m=null==s?void 0:s.getStateTransfer(),g=null==m?void 0:m.getIncomingEditorState(P.a);return{data:n,storage:p,inspector:td(i),navigation:l,fieldFormats:u,stateTransfer:m,usageCollection:o,savedObjectsTagging:r,attributeService:a,executionContext:e.executionContext,http:e.http,chrome:e.chrome,overlays:e.overlays,uiSettings:e.uiSettings,application:e.application,notifications:e.notifications,savedObjectsClient:e.savedObjects.client,presentationUtil:t.presentationUtil,dashboard:t.dashboard,getOriginatingAppName:()=>null!=g&&g.originatingApp?null==m?void 0:m.getAppNameFromId(g.originatingApp):void 0,dataViews:t.dataViews,dashboardFeatureFlag:t.dashboard.dashboardFeatureFlagConfig,spaces:c,discover:d}}async function kd(e,t,a){const{createEditorFrame:n,attributeService:o,getPresentationUtilContext:p,topNavMenuEntryGenerators:m}=a,[[g,f],b]=await Promise.all([e.getStartServices(),n()]),h=t.history.location.state,v=await Od(g,f,o),{stateTransfer:y,data:j,storage:O}=v,k=null==y?void 0:y.getIncomingEditorState(P.a);var I,T;I=g.chrome,T=g.docLinks,I.setHelpExtension({appName:"Lens",links:[{linkType:"documentation",href:T.links.visualize.lensPanels},{linkType:"github",title:"[Lens]",labels:["Feature:Lens"]}]}),g.chrome.docTitle.change(u.i18n.translate("xpack.lens.pageTitle",{defaultMessage:"Lens"})),Object(Ya.b)(new Ya.a({http:e.http,storage:O}));const F=e=>{var t;const a=M&&"originatingApp"in M?M.originatingApp:null,n=null!==(t=null==k?void 0:k.originatingApp)&&void 0!==t?t:a;if(!n)throw new Error("redirectToOrigin called without an originating app");let i=null==k?void 0:k.embeddableId;if(M&&"embeddableId"in M&&(i=M.embeddableId),y&&null!=e&&e.input){const{input:t,isCopied:a}=e;y.navigateToWithEmbeddablePackage(n,{path:null==k?void 0:k.originatingPath,state:{embeddableId:a?void 0:i,type:P.h,input:t,searchSessionId:j.search.session.getSessionId()}})}else g.application.navigateToApp(n,{path:null==k?void 0:k.originatingPath})},M=!h||h.type!==Zu.ACTION_VISUALIZE_LENS_FIELD&&h.type!==A.ACTION_CONVERT_TO_LENS?void 0:h.payload;null!=k&&k.searchSessionId&&j.search.session.continue(k.searchSessionId);const{datasourceMap:w,visualizationMap:_}=b,C={lensServices:v,datasourceMap:w,visualizationMap:_,embeddableEditorIncomingState:k,initialContext:M},E=Object(ud.i)(C,{lens:Object(jd.b)(C)}),S=s.a.memo((a=>{const n=Object(l.useCallback)((e=>{var t,n;t=a.history,(n=e)?t.push({pathname:`/edit/${n}`,search:t.location.search}):t.push({pathname:"/",search:t.location.search})}),[a.history]);Object(Ya.e)("loaded");const i=(s=a.id,a.editByValue?null==k?void 0:k.valueInput:s?{savedObjectId:s}:void 0);var s;return M||j.query.filterManager.setAppFilters([]),E.dispatch(Object(jd.g)(Object(jd.b)(C))),E.dispatch(Object(ud.h)({redirectCallback:n,initialInput:i,history:a.history})),Object(x.jsx)(rd.Provider,{store:E},Object(x.jsx)(vd,{incomingState:k,editorFrame:b,initialInput:i,redirectTo:n,redirectToOrigin:F,onAppLeave:t.onAppLeave,setHeaderActionMenu:t.setHeaderActionMenu,history:a.history,datasourceMap:w,visualizationMap:_,initialContext:M,contextOriginatingApp:null==h?void 0:h.originatingApp,topNavMenuEntryGenerators:m,theme$:e.theme.theme$}))})),L=e=>Object(x.jsx)(S,{id:e.match.params.id,history:e.history,editByValue:e.editByValue}),D=t.history.listen((()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))}));t.element.classList.add("lnsAppWrapper");const N=p();return Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:g.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(d.KibanaContextProvider,{services:v},Object(x.jsx)(N,null,Object(x.jsx)(sd.HashRouter,null,Object(x.jsx)(sd.Switch,null,Object(x.jsx)(sd.Route,{exact:!0,path:"/edit/:id",component:L}),Object(x.jsx)(sd.Route,{exact:!0,path:`/${P.g}`,render:e=>Object(x.jsx)(L,i()({},e,{editByValue:!0}))}),Object(x.jsx)(sd.Route,{exact:!0,path:"/",component:L}),Object(x.jsx)(sd.Route,{path:"/",component:function(){return Object(Ya.e)("loaded_404"),Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.app404",defaultMessage:"404 Not Found"})}}))))))),t.element),()=>{j.search.session.clear(),Object(r.unmountComponentAtNode)(t.element),v.inspector.close(),D(),E.dispatch(Object(ud.j)())}}var Id=a(150);function Td(e,t){const a=new Id.a(e.savedObjects.client);return t.embeddable.getAttributeService(tc.DOC_TYPE,{saveMethod:async(e,t)=>({id:(await a.save({...e,savedObjectId:t,type:tc.DOC_TYPE})).savedObjectId}),unwrapMethod:async e=>{const{saved_object:t,outcome:n,alias_target_id:i,alias_purpose:l}=await a.load(e),{attributes:s,references:r,id:o}=t;return{attributes:{...{...s,references:r}},metaInfo:{sharingSavedObjectProps:{aliasTargetId:i,outcome:n,aliasPurpose:l,sourceId:o}}}},checkForDuplicateTitle:t=>{const a=e.savedObjects.client,n=e.overlays;return Object(Id.b)({title:t.newTitle,copyOnSave:!1,lastSavedTitle:"",getEsType:()=>tc.DOC_TYPE,getDisplayName:()=>tc.DOC_TYPE},t.isTitleDuplicateConfirmed,t.onTitleDuplicate,{savedObjectsClient:a,overlays:n})}})}}])]);