(window.controls_bundle_jsonpfunction=window.controls_bundle_jsonpfunction||[]).push([[6],{85:function(e,t,i){"use strict";i.r(t),i.d(t,"providers",(function(){return g})),i.d(t,"registry",(function(){return h}));var r=i(2),n=i(20),s=i(19),o=i(14),a=i(1),c=i.n(a),l=i(35),d=i.n(l),u=i(41);class options_list_OptionsListService{constructor(e){c()(this,"data",void 0),c()(this,"http",void 0),c()(this,"getRoundedTimeRange",(e=>({from:d.a.parse(e.from).startOf("minute").toISOString(),to:d.a.parse(e.to).endOf("minute").toISOString()}))),c()(this,"optionsListCacheResolver",(e=>{const{query:t,filters:i,timeRange:r,searchString:n,selectedOptions:s,field:{name:o},dataView:{title:a}}=e;return[...r?JSON.stringify(this.getRoundedTimeRange(r)):[],Math.floor(Date.now()/1e3/60),null==s?void 0:s.join(","),JSON.stringify(i),JSON.stringify(t),a,n,o].join("|")})),c()(this,"cachedOptionsListRequest",Object(s.memoize)((async(e,t)=>{const i=e.dataView.title,r=this.getRequestBody(e);return await this.http.fetch(`/api/kibana/controls/optionsList/${i}`,{body:JSON.stringify(r),signal:t,method:"POST"})}),this.optionsListCacheResolver)),c()(this,"getRequestBody",(e=>{var t;const i=this.data.query.timefilter.timefilter,{query:r,filters:n,dataView:s,timeRange:o,field:a,...c}=e,l=o?i.createFilter(s,o):void 0,d=[...null!=n?n:[],...l?[l]:[]];return{...c,filters:[Object(u.b)(s,null!=r?r:[],null!=d?d:[])],fieldName:a.name,fieldSpec:null===(t=a.toSpec)||void 0===t?void 0:t.call(a)}})),c()(this,"runOptionsListRequest",(async(e,t)=>{try{return await this.cachedOptionsListRequest(e,t)}catch(t){return this.cachedOptionsListRequest.cache.delete(this.optionsListCacheResolver(e)),{}}})),({data:this.data,http:this.http}=e)}}const g={http:new r.PluginServiceProvider((({coreStart:e})=>{const{http:{fetch:t}}=e;return{fetch:t}})),data:new r.PluginServiceProvider((({startPlugins:e})=>{const{data:{query:t,search:i,autocomplete:r}}=e,{data:n}=e,a=async(e,t,i)=>{const{ignoreParentSettings:r,query:o,timeRange:a}=i;let{filters:c=[]}=i;const l=e.getFieldByName(t);if(!l)throw new Error("Field Missing Error");if(a){const t=n.query.timefilter.timefilter.createFilter(e,a);t&&(c=c.concat(t))}const d=await n.search.searchSource.create();d.setField("size",0),d.setField("index",e);const u=(e=>{const t={};return e&&(e.scripted?t.script={source:e.script,lang:e.lang}:t.field=e.name),{maxAgg:{max:t},minAgg:{min:t}}})(l);d.setField("aggs",u),d.setField("filter",null!=r&&r.ignoreFilters?[]:c),d.setField("query",null!=r&&r.ignoreQuery?void 0:o);const g=await d.fetch$().toPromise(),h=Object(s.get)(g,"rawResponse.aggregations.minAgg.value",void 0),f=Object(s.get)(g,"rawResponse.aggregations.maxAgg.value",void 0);return{min:null===h?void 0:h,max:null===f?void 0:f}};return{fetchFieldRange:a,fetchFieldRange$:(e,t,i)=>Object(o.from)(a(e,t,i)),getDataView:n.dataViews.get,getDataView$:e=>Object(o.from)(n.dataViews.get(e)),autocomplete:r,query:t,searchSource:i.searchSource,timefilter:t.timefilter.timefilter}})),overlays:new r.PluginServiceProvider((({coreStart:e})=>{const{overlays:{openFlyout:t,openConfirm:i}}=e;return{openFlyout:t,openConfirm:i}})),dataViews:new r.PluginServiceProvider((({startPlugins:e})=>{const{dataViews:{get:t,getIdsWithTitle:i,getDefaultId:r}}=e;return{get:t,getDefaultId:r,getIdsWithTitle:i}})),settings:new r.PluginServiceProvider((({coreStart:e})=>({getDateFormat:()=>e.uiSettings.get("dateFormat","MMM D, YYYY @ HH:mm:ss.SSS"),getTimezone:()=>e.uiSettings.get("dateFormat:tz","Browser")}))),optionsList:new r.PluginServiceProvider(((e,t)=>new options_list_OptionsListService(t)),["data","http"]),controls:new r.PluginServiceProvider(n.b)},h=new r.PluginServiceRegistry(g)}}]);